var Kv=Object.defineProperty;var Ap=r=>{throw TypeError(r)};var Hv=(r,e,t)=>e in r?Kv(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t;var h=(r,e,t)=>Hv(r,typeof e!="symbol"?e+"":e,t),Pf=(r,e,t)=>e.has(r)||Ap("Cannot "+t);var oe=(r,e,t)=>(Pf(r,e,"read from private field"),t?t.call(r):e.get(r)),ut=(r,e,t)=>e.has(r)?Ap("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),mt=(r,e,t,n)=>(Pf(r,e,"write to private field"),n?n.call(r,t):e.set(r,t),t),Ke=(r,e,t)=>(Pf(r,e,"access private method"),t);var Ia=(r,e,t,n)=>({set _(i){mt(r,e,i,t)},get _(){return oe(r,e,n)}});(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))n(i);new MutationObserver(i=>{for(const s of i)if(s.type==="childList")for(const o of s.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&n(o)}).observe(document,{childList:!0,subtree:!0});function t(i){const s={};return i.integrity&&(s.integrity=i.integrity),i.referrerPolicy&&(s.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?s.credentials="include":i.crossOrigin==="anonymous"?s.credentials="omit":s.credentials="same-origin",s}function n(i){if(i.ep)return;i.ep=!0;const s=t(i);fetch(i.href,s)}})();/**
* @vue/shared v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**//*! #__NO_SIDE_EFFECTS__ */function d3(r){const e=Object.create(null);for(const t of r.split(","))e[t]=1;return t=>t in e}const ft={},po=[],Nn=()=>{},jv=()=>!1,sh=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&(r.charCodeAt(2)>122||r.charCodeAt(2)<97),p3=r=>r.startsWith("onUpdate:"),gr=Object.assign,g3=(r,e)=>{const t=r.indexOf(e);t>-1&&r.splice(t,1)},zv=Object.prototype.hasOwnProperty,Je=(r,e)=>zv.call(r,e),De=Array.isArray,go=r=>oh(r)==="[object Map]",T7=r=>oh(r)==="[object Set]",Me=r=>typeof r=="function",Lt=r=>typeof r=="string",Yi=r=>typeof r=="symbol",Tt=r=>r!==null&&typeof r=="object",P7=r=>(Tt(r)||Me(r))&&Me(r.then)&&Me(r.catch),B7=Object.prototype.toString,oh=r=>B7.call(r),Wv=r=>oh(r).slice(8,-1),N7=r=>oh(r)==="[object Object]",m3=r=>Lt(r)&&r!=="NaN"&&r[0]!=="-"&&""+parseInt(r,10)===r,qa=d3(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),ah=r=>{const e=Object.create(null);return t=>e[t]||(e[t]=r(t))},Gv=/-(\w)/g,Ki=ah(r=>r.replace(Gv,(e,t)=>t?t.toUpperCase():"")),Qv=/\B([A-Z])/g,Hs=ah(r=>r.replace(Qv,"-$1").toLowerCase()),O7=ah(r=>r.charAt(0).toUpperCase()+r.slice(1)),Bf=ah(r=>r?`on${O7(r)}`:""),Mi=(r,e)=>!Object.is(r,e),Nf=(r,...e)=>{for(let t=0;t<r.length;t++)r[t](...e)},Zd=(r,e,t,n=!1)=>{Object.defineProperty(r,e,{configurable:!0,enumerable:!1,writable:n,value:t})},Yv=r=>{const e=parseFloat(r);return isNaN(e)?r:e};let _p;const ch=()=>_p||(_p=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function y3(r){if(De(r)){const e={};for(let t=0;t<r.length;t++){const n=r[t],i=Lt(n)?eS(n):y3(n);if(i)for(const s in i)e[s]=i[s]}return e}else if(Lt(r)||Tt(r))return r}const Zv=/;(?![^(]*\))/g,Xv=/:([^]+)/,Jv=/\/\*[^]*?\*\//g;function eS(r){const e={};return r.replace(Jv,"").split(Zv).forEach(t=>{if(t){const n=t.split(Xv);n.length>1&&(e[n[0].trim()]=n[1].trim())}}),e}function w3(r){let e="";if(Lt(r))e=r;else if(De(r))for(let t=0;t<r.length;t++){const n=w3(r[t]);n&&(e+=n+" ")}else if(Tt(r))for(const t in r)r[t]&&(e+=t+" ");return e.trim()}const tS="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",rS=d3(tS);function R7(r){return!!r||r===""}const D7=r=>!!(r&&r.__v_isRef===!0),Xd=r=>Lt(r)?r:r==null?"":De(r)||Tt(r)&&(r.toString===B7||!Me(r.toString))?D7(r)?Xd(r.value):JSON.stringify(r,L7,2):String(r),L7=(r,e)=>D7(e)?L7(r,e.value):go(e)?{[`Map(${e.size})`]:[...e.entries()].reduce((t,[n,i],s)=>(t[Of(n,s)+" =>"]=i,t),{})}:T7(e)?{[`Set(${e.size})`]:[...e.values()].map(t=>Of(t))}:Yi(e)?Of(e):Tt(e)&&!De(e)&&!N7(e)?String(e):e,Of=(r,e="")=>{var t;return Yi(r)?`Symbol(${(t=r.description)!=null?t:e})`:r};/**
* @vue/reactivity v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let vr;class nS{constructor(e=!1){this.detached=e,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=vr,!e&&vr&&(this.index=(vr.scopes||(vr.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].pause();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let e,t;if(this.scopes)for(e=0,t=this.scopes.length;e<t;e++)this.scopes[e].resume();for(e=0,t=this.effects.length;e<t;e++)this.effects[e].resume()}}run(e){if(this._active){const t=vr;try{return vr=this,e()}finally{vr=t}}}on(){++this._on===1&&(this.prevScope=vr,vr=this)}off(){this._on>0&&--this._on===0&&(vr=this.prevScope,this.prevScope=void 0)}stop(e){if(this._active){this._active=!1;let t,n;for(t=0,n=this.effects.length;t<n;t++)this.effects[t].stop();for(this.effects.length=0,t=0,n=this.cleanups.length;t<n;t++)this.cleanups[t]();if(this.cleanups.length=0,this.scopes){for(t=0,n=this.scopes.length;t<n;t++)this.scopes[t].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!e){const i=this.parent.scopes.pop();i&&i!==this&&(this.parent.scopes[this.index]=i,i.index=this.index)}this.parent=void 0}}}function iS(){return vr}let ht;const Rf=new WeakSet;class M7{constructor(e){this.fn=e,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,vr&&vr.active&&vr.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,Rf.has(this)&&(Rf.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||F7(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,Ip(this),$7(this);const e=ht,t=gn;ht=this,gn=!0;try{return this.fn()}finally{V7(this),ht=e,gn=t,this.flags&=-3}}stop(){if(this.flags&1){for(let e=this.deps;e;e=e.nextDep)S3(e);this.deps=this.depsTail=void 0,Ip(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?Rf.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){Jd(this)&&this.run()}get dirty(){return Jd(this)}}let U7=0,Ka,Ha;function F7(r,e=!1){if(r.flags|=8,e){r.next=Ha,Ha=r;return}r.next=Ka,Ka=r}function b3(){U7++}function v3(){if(--U7>0)return;if(Ha){let e=Ha;for(Ha=void 0;e;){const t=e.next;e.next=void 0,e.flags&=-9,e=t}}let r;for(;Ka;){let e=Ka;for(Ka=void 0;e;){const t=e.next;if(e.next=void 0,e.flags&=-9,e.flags&1)try{e.trigger()}catch(n){r||(r=n)}e=t}}if(r)throw r}function $7(r){for(let e=r.deps;e;e=e.nextDep)e.version=-1,e.prevActiveLink=e.dep.activeLink,e.dep.activeLink=e}function V7(r){let e,t=r.depsTail,n=t;for(;n;){const i=n.prevDep;n.version===-1?(n===t&&(t=i),S3(n),sS(n)):e=n,n.dep.activeLink=n.prevActiveLink,n.prevActiveLink=void 0,n=i}r.deps=e,r.depsTail=t}function Jd(r){for(let e=r.deps;e;e=e.nextDep)if(e.dep.version!==e.version||e.dep.computed&&(q7(e.dep.computed)||e.dep.version!==e.version))return!0;return!!r._dirty}function q7(r){if(r.flags&4&&!(r.flags&16)||(r.flags&=-17,r.globalVersion===hc)||(r.globalVersion=hc,!r.isSSR&&r.flags&128&&(!r.deps&&!r._dirty||!Jd(r))))return;r.flags|=2;const e=r.dep,t=ht,n=gn;ht=r,gn=!0;try{$7(r);const i=r.fn(r._value);(e.version===0||Mi(i,r._value))&&(r.flags|=128,r._value=i,e.version++)}catch(i){throw e.version++,i}finally{ht=t,gn=n,V7(r),r.flags&=-3}}function S3(r,e=!1){const{dep:t,prevSub:n,nextSub:i}=r;if(n&&(n.nextSub=i,r.prevSub=void 0),i&&(i.prevSub=n,r.nextSub=void 0),t.subs===r&&(t.subs=n,!n&&t.computed)){t.computed.flags&=-5;for(let s=t.computed.deps;s;s=s.nextDep)S3(s,!0)}!e&&!--t.sc&&t.map&&t.map.delete(t.key)}function sS(r){const{prevDep:e,nextDep:t}=r;e&&(e.nextDep=t,r.prevDep=void 0),t&&(t.prevDep=e,r.nextDep=void 0)}let gn=!0;const K7=[];function oi(){K7.push(gn),gn=!1}function ai(){const r=K7.pop();gn=r===void 0?!0:r}function Ip(r){const{cleanup:e}=r;if(r.cleanup=void 0,e){const t=ht;ht=void 0;try{e()}finally{ht=t}}}let hc=0;class oS{constructor(e,t){this.sub=e,this.dep=t,this.version=t.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class E3{constructor(e){this.computed=e,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(e){if(!ht||!gn||ht===this.computed)return;let t=this.activeLink;if(t===void 0||t.sub!==ht)t=this.activeLink=new oS(ht,this),ht.deps?(t.prevDep=ht.depsTail,ht.depsTail.nextDep=t,ht.depsTail=t):ht.deps=ht.depsTail=t,H7(t);else if(t.version===-1&&(t.version=this.version,t.nextDep)){const n=t.nextDep;n.prevDep=t.prevDep,t.prevDep&&(t.prevDep.nextDep=n),t.prevDep=ht.depsTail,t.nextDep=void 0,ht.depsTail.nextDep=t,ht.depsTail=t,ht.deps===t&&(ht.deps=n)}return t}trigger(e){this.version++,hc++,this.notify(e)}notify(e){b3();try{for(let t=this.subs;t;t=t.prevSub)t.sub.notify()&&t.sub.dep.notify()}finally{v3()}}}function H7(r){if(r.dep.sc++,r.sub.flags&4){const e=r.dep.computed;if(e&&!r.dep.subs){e.flags|=20;for(let n=e.deps;n;n=n.nextDep)H7(n)}const t=r.dep.subs;t!==r&&(r.prevSub=t,t&&(t.nextSub=r)),r.dep.subs=r}}const e0=new WeakMap,gs=Symbol(""),t0=Symbol(""),fc=Symbol("");function tr(r,e,t){if(gn&&ht){let n=e0.get(r);n||e0.set(r,n=new Map);let i=n.get(t);i||(n.set(t,i=new E3),i.map=n,i.key=t),i.track()}}function Xn(r,e,t,n,i,s){const o=e0.get(r);if(!o){hc++;return}const a=c=>{c&&c.trigger()};if(b3(),e==="clear")o.forEach(a);else{const c=De(r),l=c&&m3(t);if(c&&t==="length"){const u=Number(n);o.forEach((f,g)=>{(g==="length"||g===fc||!Yi(g)&&g>=u)&&a(f)})}else switch((t!==void 0||o.has(void 0))&&a(o.get(t)),l&&a(o.get(fc)),e){case"add":c?l&&a(o.get("length")):(a(o.get(gs)),go(r)&&a(o.get(t0)));break;case"delete":c||(a(o.get(gs)),go(r)&&a(o.get(t0)));break;case"set":go(r)&&a(o.get(gs));break}}v3()}function Qs(r){const e=Xe(r);return e===r?e:(tr(e,"iterate",fc),mn(r)?e:e.map(ur))}function x3(r){return tr(r=Xe(r),"iterate",fc),r}const aS={__proto__:null,[Symbol.iterator](){return Df(this,Symbol.iterator,ur)},concat(...r){return Qs(this).concat(...r.map(e=>De(e)?Qs(e):e))},entries(){return Df(this,"entries",r=>(r[1]=ur(r[1]),r))},every(r,e){return Kn(this,"every",r,e,void 0,arguments)},filter(r,e){return Kn(this,"filter",r,e,t=>t.map(ur),arguments)},find(r,e){return Kn(this,"find",r,e,ur,arguments)},findIndex(r,e){return Kn(this,"findIndex",r,e,void 0,arguments)},findLast(r,e){return Kn(this,"findLast",r,e,ur,arguments)},findLastIndex(r,e){return Kn(this,"findLastIndex",r,e,void 0,arguments)},forEach(r,e){return Kn(this,"forEach",r,e,void 0,arguments)},includes(...r){return Lf(this,"includes",r)},indexOf(...r){return Lf(this,"indexOf",r)},join(r){return Qs(this).join(r)},lastIndexOf(...r){return Lf(this,"lastIndexOf",r)},map(r,e){return Kn(this,"map",r,e,void 0,arguments)},pop(){return Ca(this,"pop")},push(...r){return Ca(this,"push",r)},reduce(r,...e){return Cp(this,"reduce",r,e)},reduceRight(r,...e){return Cp(this,"reduceRight",r,e)},shift(){return Ca(this,"shift")},some(r,e){return Kn(this,"some",r,e,void 0,arguments)},splice(...r){return Ca(this,"splice",r)},toReversed(){return Qs(this).toReversed()},toSorted(r){return Qs(this).toSorted(r)},toSpliced(...r){return Qs(this).toSpliced(...r)},unshift(...r){return Ca(this,"unshift",r)},values(){return Df(this,"values",ur)}};function Df(r,e,t){const n=x3(r),i=n[e]();return n!==r&&!mn(r)&&(i._next=i.next,i.next=()=>{const s=i._next();return s.value&&(s.value=t(s.value)),s}),i}const cS=Array.prototype;function Kn(r,e,t,n,i,s){const o=x3(r),a=o!==r&&!mn(r),c=o[e];if(c!==cS[e]){const f=c.apply(r,s);return a?ur(f):f}let l=t;o!==r&&(a?l=function(f,g){return t.call(this,ur(f),g,r)}:t.length>2&&(l=function(f,g){return t.call(this,f,g,r)}));const u=c.call(o,l,n);return a&&i?i(u):u}function Cp(r,e,t,n){const i=x3(r);let s=t;return i!==r&&(mn(r)?t.length>3&&(s=function(o,a,c){return t.call(this,o,a,c,r)}):s=function(o,a,c){return t.call(this,o,ur(a),c,r)}),i[e](s,...n)}function Lf(r,e,t){const n=Xe(r);tr(n,"iterate",fc);const i=n[e](...t);return(i===-1||i===!1)&&C3(t[0])?(t[0]=Xe(t[0]),n[e](...t)):i}function Ca(r,e,t=[]){oi(),b3();const n=Xe(r)[e].apply(r,t);return v3(),ai(),n}const lS=d3("__proto__,__v_isRef,__isVue"),j7=new Set(Object.getOwnPropertyNames(Symbol).filter(r=>r!=="arguments"&&r!=="caller").map(r=>Symbol[r]).filter(Yi));function uS(r){Yi(r)||(r=String(r));const e=Xe(this);return tr(e,"has",r),e.hasOwnProperty(r)}class z7{constructor(e=!1,t=!1){this._isReadonly=e,this._isShallow=t}get(e,t,n){if(t==="__v_skip")return e.__v_skip;const i=this._isReadonly,s=this._isShallow;if(t==="__v_isReactive")return!i;if(t==="__v_isReadonly")return i;if(t==="__v_isShallow")return s;if(t==="__v_raw")return n===(i?s?vS:Y7:s?Q7:G7).get(e)||Object.getPrototypeOf(e)===Object.getPrototypeOf(n)?e:void 0;const o=De(e);if(!i){let c;if(o&&(c=aS[t]))return c;if(t==="hasOwnProperty")return uS}const a=Reflect.get(e,t,sr(e)?e:n);return(Yi(t)?j7.has(t):lS(t))||(i||tr(e,"get",t),s)?a:sr(a)?o&&m3(t)?a:a.value:Tt(a)?i?Z7(a):_3(a):a}}class W7 extends z7{constructor(e=!1){super(!1,e)}set(e,t,n,i){let s=e[t];if(!this._isShallow){const c=vs(s);if(!mn(n)&&!vs(n)&&(s=Xe(s),n=Xe(n)),!De(e)&&sr(s)&&!sr(n))return c?!1:(s.value=n,!0)}const o=De(e)&&m3(t)?Number(t)<e.length:Je(e,t),a=Reflect.set(e,t,n,sr(e)?e:i);return e===Xe(i)&&(o?Mi(n,s)&&Xn(e,"set",t,n):Xn(e,"add",t,n)),a}deleteProperty(e,t){const n=Je(e,t);e[t];const i=Reflect.deleteProperty(e,t);return i&&n&&Xn(e,"delete",t,void 0),i}has(e,t){const n=Reflect.has(e,t);return(!Yi(t)||!j7.has(t))&&tr(e,"has",t),n}ownKeys(e){return tr(e,"iterate",De(e)?"length":gs),Reflect.ownKeys(e)}}class hS extends z7{constructor(e=!1){super(!0,e)}set(e,t){return!0}deleteProperty(e,t){return!0}}const fS=new W7,dS=new hS,pS=new W7(!0);const r0=r=>r,Pl=r=>Reflect.getPrototypeOf(r);function gS(r,e,t){return function(...n){const i=this.__v_raw,s=Xe(i),o=go(s),a=r==="entries"||r===Symbol.iterator&&o,c=r==="keys"&&o,l=i[r](...n),u=t?r0:e?n0:ur;return!e&&tr(s,"iterate",c?t0:gs),{next(){const{value:f,done:g}=l.next();return g?{value:f,done:g}:{value:a?[u(f[0]),u(f[1])]:u(f),done:g}},[Symbol.iterator](){return this}}}}function Bl(r){return function(...e){return r==="delete"?!1:r==="clear"?void 0:this}}function mS(r,e){const t={get(i){const s=this.__v_raw,o=Xe(s),a=Xe(i);r||(Mi(i,a)&&tr(o,"get",i),tr(o,"get",a));const{has:c}=Pl(o),l=e?r0:r?n0:ur;if(c.call(o,i))return l(s.get(i));if(c.call(o,a))return l(s.get(a));s!==o&&s.get(i)},get size(){const i=this.__v_raw;return!r&&tr(Xe(i),"iterate",gs),Reflect.get(i,"size",i)},has(i){const s=this.__v_raw,o=Xe(s),a=Xe(i);return r||(Mi(i,a)&&tr(o,"has",i),tr(o,"has",a)),i===a?s.has(i):s.has(i)||s.has(a)},forEach(i,s){const o=this,a=o.__v_raw,c=Xe(a),l=e?r0:r?n0:ur;return!r&&tr(c,"iterate",gs),a.forEach((u,f)=>i.call(s,l(u),l(f),o))}};return gr(t,r?{add:Bl("add"),set:Bl("set"),delete:Bl("delete"),clear:Bl("clear")}:{add(i){!e&&!mn(i)&&!vs(i)&&(i=Xe(i));const s=Xe(this);return Pl(s).has.call(s,i)||(s.add(i),Xn(s,"add",i,i)),this},set(i,s){!e&&!mn(s)&&!vs(s)&&(s=Xe(s));const o=Xe(this),{has:a,get:c}=Pl(o);let l=a.call(o,i);l||(i=Xe(i),l=a.call(o,i));const u=c.call(o,i);return o.set(i,s),l?Mi(s,u)&&Xn(o,"set",i,s):Xn(o,"add",i,s),this},delete(i){const s=Xe(this),{has:o,get:a}=Pl(s);let c=o.call(s,i);c||(i=Xe(i),c=o.call(s,i)),a&&a.call(s,i);const l=s.delete(i);return c&&Xn(s,"delete",i,void 0),l},clear(){const i=Xe(this),s=i.size!==0,o=i.clear();return s&&Xn(i,"clear",void 0,void 0),o}}),["keys","values","entries",Symbol.iterator].forEach(i=>{t[i]=gS(i,r,e)}),t}function A3(r,e){const t=mS(r,e);return(n,i,s)=>i==="__v_isReactive"?!r:i==="__v_isReadonly"?r:i==="__v_raw"?n:Reflect.get(Je(t,i)&&i in n?t:n,i,s)}const yS={get:A3(!1,!1)},wS={get:A3(!1,!0)},bS={get:A3(!0,!1)};const G7=new WeakMap,Q7=new WeakMap,Y7=new WeakMap,vS=new WeakMap;function SS(r){switch(r){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function ES(r){return r.__v_skip||!Object.isExtensible(r)?0:SS(Wv(r))}function _3(r){return vs(r)?r:I3(r,!1,fS,yS,G7)}function xS(r){return I3(r,!1,pS,wS,Q7)}function Z7(r){return I3(r,!0,dS,bS,Y7)}function I3(r,e,t,n,i){if(!Tt(r)||r.__v_raw&&!(e&&r.__v_isReactive))return r;const s=ES(r);if(s===0)return r;const o=i.get(r);if(o)return o;const a=new Proxy(r,s===2?n:t);return i.set(r,a),a}function ja(r){return vs(r)?ja(r.__v_raw):!!(r&&r.__v_isReactive)}function vs(r){return!!(r&&r.__v_isReadonly)}function mn(r){return!!(r&&r.__v_isShallow)}function C3(r){return r?!!r.__v_raw:!1}function Xe(r){const e=r&&r.__v_raw;return e?Xe(e):r}function AS(r){return!Je(r,"__v_skip")&&Object.isExtensible(r)&&Zd(r,"__v_skip",!0),r}const ur=r=>Tt(r)?_3(r):r,n0=r=>Tt(r)?Z7(r):r;function sr(r){return r?r.__v_isRef===!0:!1}function _S(r){return IS(r,!1)}function IS(r,e){return sr(r)?r:new CS(r,e)}class CS{constructor(e,t){this.dep=new E3,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=t?e:Xe(e),this._value=t?e:ur(e),this.__v_isShallow=t}get value(){return this.dep.track(),this._value}set value(e){const t=this._rawValue,n=this.__v_isShallow||mn(e)||vs(e);e=n?e:Xe(e),Mi(e,t)&&(this._rawValue=e,this._value=n?e:ur(e),this.dep.trigger())}}function kS(r){return sr(r)?r.value:r}const TS={get:(r,e,t)=>e==="__v_raw"?r:kS(Reflect.get(r,e,t)),set:(r,e,t,n)=>{const i=r[e];return sr(i)&&!sr(t)?(i.value=t,!0):Reflect.set(r,e,t,n)}};function X7(r){return ja(r)?r:new Proxy(r,TS)}class PS{constructor(e,t,n){this.fn=e,this.setter=t,this._value=void 0,this.dep=new E3(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=hc-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!t,this.isSSR=n}notify(){if(this.flags|=16,!(this.flags&8)&&ht!==this)return F7(this,!0),!0}get value(){const e=this.dep.track();return q7(this),e&&(e.version=this.dep.version),this._value}set value(e){this.setter&&this.setter(e)}}function BS(r,e,t=!1){let n,i;return Me(r)?n=r:(n=r.get,i=r.set),new PS(n,i,t)}const Nl={},Tu=new WeakMap;let rs;function NS(r,e=!1,t=rs){if(t){let n=Tu.get(t);n||Tu.set(t,n=[]),n.push(r)}}function OS(r,e,t=ft){const{immediate:n,deep:i,once:s,scheduler:o,augmentJob:a,call:c}=t,l=L=>i?L:mn(L)||i===!1||i===0?Pi(L,1):Pi(L);let u,f,g,m,w=!1,x=!1;if(sr(r)?(f=()=>r.value,w=mn(r)):ja(r)?(f=()=>l(r),w=!0):De(r)?(x=!0,w=r.some(L=>ja(L)||mn(L)),f=()=>r.map(L=>{if(sr(L))return L.value;if(ja(L))return l(L);if(Me(L))return c?c(L,2):L()})):Me(r)?e?f=c?()=>c(r,2):r:f=()=>{if(g){oi();try{g()}finally{ai()}}const L=rs;rs=u;try{return c?c(r,3,[m]):r(m)}finally{rs=L}}:f=Nn,e&&i){const L=f,R=i===!0?1/0:i;f=()=>Pi(L(),R)}const v=iS(),C=()=>{u.stop(),v&&v.active&&g3(v.effects,u)};if(s&&e){const L=e;e=(...R)=>{L(...R),C()}}let N=x?new Array(r.length).fill(Nl):Nl;const O=L=>{if(!(!(u.flags&1)||!u.dirty&&!L))if(e){const R=u.run();if(i||w||(x?R.some((F,K)=>Mi(F,N[K])):Mi(R,N))){g&&g();const F=rs;rs=u;try{const K=[R,N===Nl?void 0:x&&N[0]===Nl?[]:N,m];N=R,c?c(e,3,K):e(...K)}finally{rs=F}}}else u.run()};return a&&a(O),u=new M7(f),u.scheduler=o?()=>o(O,!1):O,m=L=>NS(L,!1,u),g=u.onStop=()=>{const L=Tu.get(u);if(L){if(c)c(L,4);else for(const R of L)R();Tu.delete(u)}},e?n?O(!0):N=u.run():o?o(O.bind(null,!0),!0):u.run(),C.pause=u.pause.bind(u),C.resume=u.resume.bind(u),C.stop=C,C}function Pi(r,e=1/0,t){if(e<=0||!Tt(r)||r.__v_skip||(t=t||new Set,t.has(r)))return r;if(t.add(r),e--,sr(r))Pi(r.value,e,t);else if(De(r))for(let n=0;n<r.length;n++)Pi(r[n],e,t);else if(T7(r)||go(r))r.forEach(n=>{Pi(n,e,t)});else if(N7(r)){for(const n in r)Pi(r[n],e,t);for(const n of Object.getOwnPropertySymbols(r))Object.prototype.propertyIsEnumerable.call(r,n)&&Pi(r[n],e,t)}return r}/**
* @vue/runtime-core v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function Yc(r,e,t,n){try{return n?r(...n):r()}catch(i){lh(i,e,t)}}function Mn(r,e,t,n){if(Me(r)){const i=Yc(r,e,t,n);return i&&P7(i)&&i.catch(s=>{lh(s,e,t)}),i}if(De(r)){const i=[];for(let s=0;s<r.length;s++)i.push(Mn(r[s],e,t,n));return i}}function lh(r,e,t,n=!0){const i=e?e.vnode:null,{errorHandler:s,throwUnhandledErrorInProduction:o}=e&&e.appContext.config||ft;if(e){let a=e.parent;const c=e.proxy,l=`https://vuejs.org/error-reference/#runtime-${t}`;for(;a;){const u=a.ec;if(u){for(let f=0;f<u.length;f++)if(u[f](r,c,l)===!1)return}a=a.parent}if(s){oi(),Yc(s,null,10,[r,c,l]),ai();return}}RS(r,t,i,n,o)}function RS(r,e,t,n=!0,i=!1){if(i)throw r;console.error(r)}const hr=[];let In=-1;const mo=[];let Ci=null,so=0;const J7=Promise.resolve();let Pu=null;function DS(r){const e=Pu||J7;return r?e.then(this?r.bind(this):r):e}function LS(r){let e=In+1,t=hr.length;for(;e<t;){const n=e+t>>>1,i=hr[n],s=dc(i);s<r||s===r&&i.flags&2?e=n+1:t=n}return e}function k3(r){if(!(r.flags&1)){const e=dc(r),t=hr[hr.length-1];!t||!(r.flags&2)&&e>=dc(t)?hr.push(r):hr.splice(LS(e),0,r),r.flags|=1,e9()}}function e9(){Pu||(Pu=J7.then(r9))}function MS(r){De(r)?mo.push(...r):Ci&&r.id===-1?Ci.splice(so+1,0,r):r.flags&1||(mo.push(r),r.flags|=1),e9()}function kp(r,e,t=In+1){for(;t<hr.length;t++){const n=hr[t];if(n&&n.flags&2){if(r&&n.id!==r.uid)continue;hr.splice(t,1),t--,n.flags&4&&(n.flags&=-2),n(),n.flags&4||(n.flags&=-2)}}}function t9(r){if(mo.length){const e=[...new Set(mo)].sort((t,n)=>dc(t)-dc(n));if(mo.length=0,Ci){Ci.push(...e);return}for(Ci=e,so=0;so<Ci.length;so++){const t=Ci[so];t.flags&4&&(t.flags&=-2),t.flags&8||t(),t.flags&=-2}Ci=null,so=0}}const dc=r=>r.id==null?r.flags&2?-1:1/0:r.id;function r9(r){try{for(In=0;In<hr.length;In++){const e=hr[In];e&&!(e.flags&8)&&(e.flags&4&&(e.flags&=-2),Yc(e,e.i,e.i?15:14),e.flags&4||(e.flags&=-2))}}finally{for(;In<hr.length;In++){const e=hr[In];e&&(e.flags&=-2)}In=-1,hr.length=0,t9(),Pu=null,(hr.length||mo.length)&&r9()}}let Bn=null,n9=null;function Bu(r){const e=Bn;return Bn=r,n9=r&&r.type.__scopeId||null,e}function US(r,e=Bn,t){if(!e||r._n)return r;const n=(...i)=>{n._d&&Mp(-1);const s=Bu(e);let o;try{o=r(...i)}finally{Bu(s),n._d&&Mp(1)}return o};return n._n=!0,n._c=!0,n._d=!0,n}function es(r,e,t,n){const i=r.dirs,s=e&&e.dirs;for(let o=0;o<i.length;o++){const a=i[o];s&&(a.oldValue=s[o].value);let c=a.dir[n];c&&(oi(),Mn(c,t,8,[r.el,a,r,e]),ai())}}const FS=Symbol("_vte"),$S=r=>r.__isTeleport;function T3(r,e){r.shapeFlag&6&&r.component?(r.transition=e,T3(r.component.subTree,e)):r.shapeFlag&128?(r.ssContent.transition=e.clone(r.ssContent),r.ssFallback.transition=e.clone(r.ssFallback)):r.transition=e}function i9(r){r.ids=[r.ids[0]+r.ids[2]+++"-",0,0]}function za(r,e,t,n,i=!1){if(De(r)){r.forEach((w,x)=>za(w,e&&(De(e)?e[x]:e),t,n,i));return}if(Wa(n)&&!i){n.shapeFlag&512&&n.type.__asyncResolved&&n.component.subTree.component&&za(r,e,t,n.component.subTree);return}const s=n.shapeFlag&4?O3(n.component):n.el,o=i?null:s,{i:a,r:c}=r,l=e&&e.r,u=a.refs===ft?a.refs={}:a.refs,f=a.setupState,g=Xe(f),m=f===ft?()=>!1:w=>Je(g,w);if(l!=null&&l!==c&&(Lt(l)?(u[l]=null,m(l)&&(f[l]=null)):sr(l)&&(l.value=null)),Me(c))Yc(c,a,12,[o,u]);else{const w=Lt(c),x=sr(c);if(w||x){const v=()=>{if(r.f){const C=w?m(c)?f[c]:u[c]:c.value;i?De(C)&&g3(C,s):De(C)?C.includes(s)||C.push(s):w?(u[c]=[s],m(c)&&(f[c]=u[c])):(c.value=[s],r.k&&(u[r.k]=c.value))}else w?(u[c]=o,m(c)&&(f[c]=o)):x&&(c.value=o,r.k&&(u[r.k]=o))};o?(v.id=-1,Nr(v,t)):v()}}}ch().requestIdleCallback;ch().cancelIdleCallback;const Wa=r=>!!r.type.__asyncLoader,s9=r=>r.type.__isKeepAlive;function VS(r,e){o9(r,"a",e)}function qS(r,e){o9(r,"da",e)}function o9(r,e,t=fr){const n=r.__wdc||(r.__wdc=()=>{let i=t;for(;i;){if(i.isDeactivated)return;i=i.parent}return r()});if(uh(e,n,t),t){let i=t.parent;for(;i&&i.parent;)s9(i.parent.vnode)&&KS(n,e,t,i),i=i.parent}}function KS(r,e,t,n){const i=uh(e,r,n,!0);a9(()=>{g3(n[e],i)},t)}function uh(r,e,t=fr,n=!1){if(t){const i=t[r]||(t[r]=[]),s=e.__weh||(e.__weh=(...o)=>{oi();const a=Zc(t),c=Mn(e,t,r,o);return a(),ai(),c});return n?i.unshift(s):i.push(s),s}}const yi=r=>(e,t=fr)=>{(!gc||r==="sp")&&uh(r,(...n)=>e(...n),t)},HS=yi("bm"),jS=yi("m"),zS=yi("bu"),WS=yi("u"),GS=yi("bum"),a9=yi("um"),QS=yi("sp"),YS=yi("rtg"),ZS=yi("rtc");function XS(r,e=fr){uh("ec",r,e)}const JS=Symbol.for("v-ndc"),i0=r=>r?T9(r)?O3(r):i0(r.parent):null,Ga=gr(Object.create(null),{$:r=>r,$el:r=>r.vnode.el,$data:r=>r.data,$props:r=>r.props,$attrs:r=>r.attrs,$slots:r=>r.slots,$refs:r=>r.refs,$parent:r=>i0(r.parent),$root:r=>i0(r.root),$host:r=>r.ce,$emit:r=>r.emit,$options:r=>l9(r),$forceUpdate:r=>r.f||(r.f=()=>{k3(r.update)}),$nextTick:r=>r.n||(r.n=DS.bind(r.proxy)),$watch:r=>SE.bind(r)}),Mf=(r,e)=>r!==ft&&!r.__isScriptSetup&&Je(r,e),eE={get({_:r},e){if(e==="__v_skip")return!0;const{ctx:t,setupState:n,data:i,props:s,accessCache:o,type:a,appContext:c}=r;let l;if(e[0]!=="$"){const m=o[e];if(m!==void 0)switch(m){case 1:return n[e];case 2:return i[e];case 4:return t[e];case 3:return s[e]}else{if(Mf(n,e))return o[e]=1,n[e];if(i!==ft&&Je(i,e))return o[e]=2,i[e];if((l=r.propsOptions[0])&&Je(l,e))return o[e]=3,s[e];if(t!==ft&&Je(t,e))return o[e]=4,t[e];s0&&(o[e]=0)}}const u=Ga[e];let f,g;if(u)return e==="$attrs"&&tr(r.attrs,"get",""),u(r);if((f=a.__cssModules)&&(f=f[e]))return f;if(t!==ft&&Je(t,e))return o[e]=4,t[e];if(g=c.config.globalProperties,Je(g,e))return g[e]},set({_:r},e,t){const{data:n,setupState:i,ctx:s}=r;return Mf(i,e)?(i[e]=t,!0):n!==ft&&Je(n,e)?(n[e]=t,!0):Je(r.props,e)||e[0]==="$"&&e.slice(1)in r?!1:(s[e]=t,!0)},has({_:{data:r,setupState:e,accessCache:t,ctx:n,appContext:i,propsOptions:s}},o){let a;return!!t[o]||r!==ft&&Je(r,o)||Mf(e,o)||(a=s[0])&&Je(a,o)||Je(n,o)||Je(Ga,o)||Je(i.config.globalProperties,o)},defineProperty(r,e,t){return t.get!=null?r._.accessCache[e]=0:Je(t,"value")&&this.set(r,e,t.value,null),Reflect.defineProperty(r,e,t)}};function Tp(r){return De(r)?r.reduce((e,t)=>(e[t]=null,e),{}):r}let s0=!0;function tE(r){const e=l9(r),t=r.proxy,n=r.ctx;s0=!1,e.beforeCreate&&Pp(e.beforeCreate,r,"bc");const{data:i,computed:s,methods:o,watch:a,provide:c,inject:l,created:u,beforeMount:f,mounted:g,beforeUpdate:m,updated:w,activated:x,deactivated:v,beforeDestroy:C,beforeUnmount:N,destroyed:O,unmounted:L,render:R,renderTracked:F,renderTriggered:K,errorCaptured:H,serverPrefetch:P,expose:U,inheritAttrs:M,components:$,directives:q,filters:G}=e;if(l&&rE(l,n,null),o)for(const Q in o){const Y=o[Q];Me(Y)&&(n[Q]=Y.bind(t))}if(i){const Q=i.call(t,t);Tt(Q)&&(r.data=_3(Q))}if(s0=!0,s)for(const Q in s){const Y=s[Q],ie=Me(Y)?Y.bind(t,t):Me(Y.get)?Y.get.bind(t,t):Nn,Se=!Me(Y)&&Me(Y.set)?Y.set.bind(t):Nn,te=qE({get:ie,set:Se});Object.defineProperty(n,Q,{enumerable:!0,configurable:!0,get:()=>te.value,set:de=>te.value=de})}if(a)for(const Q in a)c9(a[Q],n,t,Q);if(c){const Q=Me(c)?c.call(t):c;Reflect.ownKeys(Q).forEach(Y=>{cE(Y,Q[Y])})}u&&Pp(u,r,"c");function j(Q,Y){De(Y)?Y.forEach(ie=>Q(ie.bind(t))):Y&&Q(Y.bind(t))}if(j(HS,f),j(jS,g),j(zS,m),j(WS,w),j(VS,x),j(qS,v),j(XS,H),j(ZS,F),j(YS,K),j(GS,N),j(a9,L),j(QS,P),De(U))if(U.length){const Q=r.exposed||(r.exposed={});U.forEach(Y=>{Object.defineProperty(Q,Y,{get:()=>t[Y],set:ie=>t[Y]=ie})})}else r.exposed||(r.exposed={});R&&r.render===Nn&&(r.render=R),M!=null&&(r.inheritAttrs=M),$&&(r.components=$),q&&(r.directives=q),P&&i9(r)}function rE(r,e,t=Nn){De(r)&&(r=o0(r));for(const n in r){const i=r[n];let s;Tt(i)?"default"in i?s=lu(i.from||n,i.default,!0):s=lu(i.from||n):s=lu(i),sr(s)?Object.defineProperty(e,n,{enumerable:!0,configurable:!0,get:()=>s.value,set:o=>s.value=o}):e[n]=s}}function Pp(r,e,t){Mn(De(r)?r.map(n=>n.bind(e.proxy)):r.bind(e.proxy),e,t)}function c9(r,e,t,n){let i=n.includes(".")?E9(t,n):()=>t[n];if(Lt(r)){const s=e[r];Me(s)&&Ff(i,s)}else if(Me(r))Ff(i,r.bind(t));else if(Tt(r))if(De(r))r.forEach(s=>c9(s,e,t,n));else{const s=Me(r.handler)?r.handler.bind(t):e[r.handler];Me(s)&&Ff(i,s,r)}}function l9(r){const e=r.type,{mixins:t,extends:n}=e,{mixins:i,optionsCache:s,config:{optionMergeStrategies:o}}=r.appContext,a=s.get(e);let c;return a?c=a:!i.length&&!t&&!n?c=e:(c={},i.length&&i.forEach(l=>Nu(c,l,o,!0)),Nu(c,e,o)),Tt(e)&&s.set(e,c),c}function Nu(r,e,t,n=!1){const{mixins:i,extends:s}=e;s&&Nu(r,s,t,!0),i&&i.forEach(o=>Nu(r,o,t,!0));for(const o in e)if(!(n&&o==="expose")){const a=nE[o]||t&&t[o];r[o]=a?a(r[o],e[o]):e[o]}return r}const nE={data:Bp,props:Np,emits:Np,methods:Ma,computed:Ma,beforeCreate:cr,created:cr,beforeMount:cr,mounted:cr,beforeUpdate:cr,updated:cr,beforeDestroy:cr,beforeUnmount:cr,destroyed:cr,unmounted:cr,activated:cr,deactivated:cr,errorCaptured:cr,serverPrefetch:cr,components:Ma,directives:Ma,watch:sE,provide:Bp,inject:iE};function Bp(r,e){return e?r?function(){return gr(Me(r)?r.call(this,this):r,Me(e)?e.call(this,this):e)}:e:r}function iE(r,e){return Ma(o0(r),o0(e))}function o0(r){if(De(r)){const e={};for(let t=0;t<r.length;t++)e[r[t]]=r[t];return e}return r}function cr(r,e){return r?[...new Set([].concat(r,e))]:e}function Ma(r,e){return r?gr(Object.create(null),r,e):e}function Np(r,e){return r?De(r)&&De(e)?[...new Set([...r,...e])]:gr(Object.create(null),Tp(r),Tp(e??{})):e}function sE(r,e){if(!r)return e;if(!e)return r;const t=gr(Object.create(null),r);for(const n in e)t[n]=cr(r[n],e[n]);return t}function u9(){return{app:null,config:{isNativeTag:jv,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let oE=0;function aE(r,e){return function(n,i=null){Me(n)||(n=gr({},n)),i!=null&&!Tt(i)&&(i=null);const s=u9(),o=new WeakSet,a=[];let c=!1;const l=s.app={_uid:oE++,_component:n,_props:i,_container:null,_context:s,_instance:null,version:KE,get config(){return s.config},set config(u){},use(u,...f){return o.has(u)||(u&&Me(u.install)?(o.add(u),u.install(l,...f)):Me(u)&&(o.add(u),u(l,...f))),l},mixin(u){return s.mixins.includes(u)||s.mixins.push(u),l},component(u,f){return f?(s.components[u]=f,l):s.components[u]},directive(u,f){return f?(s.directives[u]=f,l):s.directives[u]},mount(u,f,g){if(!c){const m=l._ceVNode||Ui(n,i);return m.appContext=s,g===!0?g="svg":g===!1&&(g=void 0),r(m,u,g),c=!0,l._container=u,u.__vue_app__=l,O3(m.component)}},onUnmount(u){a.push(u)},unmount(){c&&(Mn(a,l._instance,16),r(null,l._container),delete l._container.__vue_app__)},provide(u,f){return s.provides[u]=f,l},runWithContext(u){const f=yo;yo=l;try{return u()}finally{yo=f}}};return l}}let yo=null;function cE(r,e){if(fr){let t=fr.provides;const n=fr.parent&&fr.parent.provides;n===t&&(t=fr.provides=Object.create(n)),t[r]=e}}function lu(r,e,t=!1){const n=fr||Bn;if(n||yo){let i=yo?yo._context.provides:n?n.parent==null||n.ce?n.vnode.appContext&&n.vnode.appContext.provides:n.parent.provides:void 0;if(i&&r in i)return i[r];if(arguments.length>1)return t&&Me(e)?e.call(n&&n.proxy):e}}const h9={},f9=()=>Object.create(h9),d9=r=>Object.getPrototypeOf(r)===h9;function lE(r,e,t,n=!1){const i={},s=f9();r.propsDefaults=Object.create(null),p9(r,e,i,s);for(const o in r.propsOptions[0])o in i||(i[o]=void 0);t?r.props=n?i:xS(i):r.type.props?r.props=i:r.props=s,r.attrs=s}function uE(r,e,t,n){const{props:i,attrs:s,vnode:{patchFlag:o}}=r,a=Xe(i),[c]=r.propsOptions;let l=!1;if((n||o>0)&&!(o&16)){if(o&8){const u=r.vnode.dynamicProps;for(let f=0;f<u.length;f++){let g=u[f];if(hh(r.emitsOptions,g))continue;const m=e[g];if(c)if(Je(s,g))m!==s[g]&&(s[g]=m,l=!0);else{const w=Ki(g);i[w]=a0(c,a,w,m,r,!1)}else m!==s[g]&&(s[g]=m,l=!0)}}}else{p9(r,e,i,s)&&(l=!0);let u;for(const f in a)(!e||!Je(e,f)&&((u=Hs(f))===f||!Je(e,u)))&&(c?t&&(t[f]!==void 0||t[u]!==void 0)&&(i[f]=a0(c,a,f,void 0,r,!0)):delete i[f]);if(s!==a)for(const f in s)(!e||!Je(e,f))&&(delete s[f],l=!0)}l&&Xn(r.attrs,"set","")}function p9(r,e,t,n){const[i,s]=r.propsOptions;let o=!1,a;if(e)for(let c in e){if(qa(c))continue;const l=e[c];let u;i&&Je(i,u=Ki(c))?!s||!s.includes(u)?t[u]=l:(a||(a={}))[u]=l:hh(r.emitsOptions,c)||(!(c in n)||l!==n[c])&&(n[c]=l,o=!0)}if(s){const c=Xe(t),l=a||ft;for(let u=0;u<s.length;u++){const f=s[u];t[f]=a0(i,c,f,l[f],r,!Je(l,f))}}return o}function a0(r,e,t,n,i,s){const o=r[t];if(o!=null){const a=Je(o,"default");if(a&&n===void 0){const c=o.default;if(o.type!==Function&&!o.skipFactory&&Me(c)){const{propsDefaults:l}=i;if(t in l)n=l[t];else{const u=Zc(i);n=l[t]=c.call(null,e),u()}}else n=c;i.ce&&i.ce._setProp(t,n)}o[0]&&(s&&!a?n=!1:o[1]&&(n===""||n===Hs(t))&&(n=!0))}return n}const hE=new WeakMap;function g9(r,e,t=!1){const n=t?hE:e.propsCache,i=n.get(r);if(i)return i;const s=r.props,o={},a=[];let c=!1;if(!Me(r)){const u=f=>{c=!0;const[g,m]=g9(f,e,!0);gr(o,g),m&&a.push(...m)};!t&&e.mixins.length&&e.mixins.forEach(u),r.extends&&u(r.extends),r.mixins&&r.mixins.forEach(u)}if(!s&&!c)return Tt(r)&&n.set(r,po),po;if(De(s))for(let u=0;u<s.length;u++){const f=Ki(s[u]);Op(f)&&(o[f]=ft)}else if(s)for(const u in s){const f=Ki(u);if(Op(f)){const g=s[u],m=o[f]=De(g)||Me(g)?{type:g}:gr({},g),w=m.type;let x=!1,v=!0;if(De(w))for(let C=0;C<w.length;++C){const N=w[C],O=Me(N)&&N.name;if(O==="Boolean"){x=!0;break}else O==="String"&&(v=!1)}else x=Me(w)&&w.name==="Boolean";m[0]=x,m[1]=v,(x||Je(m,"default"))&&a.push(f)}}const l=[o,a];return Tt(r)&&n.set(r,l),l}function Op(r){return r[0]!=="$"&&!qa(r)}const P3=r=>r[0]==="_"||r==="$stable",B3=r=>De(r)?r.map(Tn):[Tn(r)],fE=(r,e,t)=>{if(e._n)return e;const n=US((...i)=>B3(e(...i)),t);return n._c=!1,n},m9=(r,e,t)=>{const n=r._ctx;for(const i in r){if(P3(i))continue;const s=r[i];if(Me(s))e[i]=fE(i,s,n);else if(s!=null){const o=B3(s);e[i]=()=>o}}},y9=(r,e)=>{const t=B3(e);r.slots.default=()=>t},w9=(r,e,t)=>{for(const n in e)(t||!P3(n))&&(r[n]=e[n])},dE=(r,e,t)=>{const n=r.slots=f9();if(r.vnode.shapeFlag&32){const i=e.__;i&&Zd(n,"__",i,!0);const s=e._;s?(w9(n,e,t),t&&Zd(n,"_",s,!0)):m9(e,n)}else e&&y9(r,e)},pE=(r,e,t)=>{const{vnode:n,slots:i}=r;let s=!0,o=ft;if(n.shapeFlag&32){const a=e._;a?t&&a===1?s=!1:w9(i,e,t):(s=!e.$stable,m9(e,i)),o=e}else e&&(y9(r,e),o={default:1});if(s)for(const a in i)!P3(a)&&o[a]==null&&delete i[a]},Nr=kE;function gE(r){return mE(r)}function mE(r,e){const t=ch();t.__VUE__=!0;const{insert:n,remove:i,patchProp:s,createElement:o,createText:a,createComment:c,setText:l,setElementText:u,parentNode:f,nextSibling:g,setScopeId:m=Nn,insertStaticContent:w}=r,x=(I,k,V,re=null,Z=null,J=null,ue=void 0,le=null,se=!!k.dynamicChildren)=>{if(I===k)return;I&&!ka(I,k)&&(re=wt(I),de(I,Z,J,!0),I=null),k.patchFlag===-2&&(se=!1,k.dynamicChildren=null);const{type:ee,ref:we,shapeFlag:he}=k;switch(ee){case fh:v(I,k,V,re);break;case Oo:C(I,k,V,re);break;case $f:I==null&&N(k,V,re,ue);break;case dn:$(I,k,V,re,Z,J,ue,le,se);break;default:he&1?R(I,k,V,re,Z,J,ue,le,se):he&6?q(I,k,V,re,Z,J,ue,le,se):(he&64||he&128)&&ee.process(I,k,V,re,Z,J,ue,le,se,$t)}we!=null&&Z?za(we,I&&I.ref,J,k||I,!k):we==null&&I&&I.ref!=null&&za(I.ref,null,J,I,!0)},v=(I,k,V,re)=>{if(I==null)n(k.el=a(k.children),V,re);else{const Z=k.el=I.el;k.children!==I.children&&l(Z,k.children)}},C=(I,k,V,re)=>{I==null?n(k.el=c(k.children||""),V,re):k.el=I.el},N=(I,k,V,re)=>{[I.el,I.anchor]=w(I.children,k,V,re,I.el,I.anchor)},O=({el:I,anchor:k},V,re)=>{let Z;for(;I&&I!==k;)Z=g(I),n(I,V,re),I=Z;n(k,V,re)},L=({el:I,anchor:k})=>{let V;for(;I&&I!==k;)V=g(I),i(I),I=V;i(k)},R=(I,k,V,re,Z,J,ue,le,se)=>{k.type==="svg"?ue="svg":k.type==="math"&&(ue="mathml"),I==null?F(k,V,re,Z,J,ue,le,se):P(I,k,Z,J,ue,le,se)},F=(I,k,V,re,Z,J,ue,le)=>{let se,ee;const{props:we,shapeFlag:he,transition:Ie,dirs:Ce}=I;if(se=I.el=o(I.type,J,we&&we.is,we),he&8?u(se,I.children):he&16&&H(I.children,se,null,re,Z,Uf(I,J),ue,le),Ce&&es(I,null,re,"created"),K(se,I,I.scopeId,ue,re),we){for(const b in we)b!=="value"&&!qa(b)&&s(se,b,null,we[b],J,re);"value"in we&&s(se,"value",null,we.value,J),(ee=we.onVnodeBeforeMount)&&En(ee,re,I)}Ce&&es(I,null,re,"beforeMount");const Fe=yE(Z,Ie);Fe&&Ie.beforeEnter(se),n(se,k,V),((ee=we&&we.onVnodeMounted)||Fe||Ce)&&Nr(()=>{ee&&En(ee,re,I),Fe&&Ie.enter(se),Ce&&es(I,null,re,"mounted")},Z)},K=(I,k,V,re,Z)=>{if(V&&m(I,V),re)for(let J=0;J<re.length;J++)m(I,re[J]);if(Z){let J=Z.subTree;if(k===J||A9(J.type)&&(J.ssContent===k||J.ssFallback===k)){const ue=Z.vnode;K(I,ue,ue.scopeId,ue.slotScopeIds,Z.parent)}}},H=(I,k,V,re,Z,J,ue,le,se=0)=>{for(let ee=se;ee<I.length;ee++){const we=I[ee]=le?ki(I[ee]):Tn(I[ee]);x(null,we,k,V,re,Z,J,ue,le)}},P=(I,k,V,re,Z,J,ue)=>{const le=k.el=I.el;let{patchFlag:se,dynamicChildren:ee,dirs:we}=k;se|=I.patchFlag&16;const he=I.props||ft,Ie=k.props||ft;let Ce;if(V&&ts(V,!1),(Ce=Ie.onVnodeBeforeUpdate)&&En(Ce,V,k,I),we&&es(k,I,V,"beforeUpdate"),V&&ts(V,!0),(he.innerHTML&&Ie.innerHTML==null||he.textContent&&Ie.textContent==null)&&u(le,""),ee?U(I.dynamicChildren,ee,le,V,re,Uf(k,Z),J):ue||Y(I,k,le,null,V,re,Uf(k,Z),J,!1),se>0){if(se&16)M(le,he,Ie,V,Z);else if(se&2&&he.class!==Ie.class&&s(le,"class",null,Ie.class,Z),se&4&&s(le,"style",he.style,Ie.style,Z),se&8){const Fe=k.dynamicProps;for(let b=0;b<Fe.length;b++){const d=Fe[b],p=he[d],A=Ie[d];(A!==p||d==="value")&&s(le,d,p,A,Z,V)}}se&1&&I.children!==k.children&&u(le,k.children)}else!ue&&ee==null&&M(le,he,Ie,V,Z);((Ce=Ie.onVnodeUpdated)||we)&&Nr(()=>{Ce&&En(Ce,V,k,I),we&&es(k,I,V,"updated")},re)},U=(I,k,V,re,Z,J,ue)=>{for(let le=0;le<k.length;le++){const se=I[le],ee=k[le],we=se.el&&(se.type===dn||!ka(se,ee)||se.shapeFlag&198)?f(se.el):V;x(se,ee,we,null,re,Z,J,ue,!0)}},M=(I,k,V,re,Z)=>{if(k!==V){if(k!==ft)for(const J in k)!qa(J)&&!(J in V)&&s(I,J,k[J],null,Z,re);for(const J in V){if(qa(J))continue;const ue=V[J],le=k[J];ue!==le&&J!=="value"&&s(I,J,le,ue,Z,re)}"value"in V&&s(I,"value",k.value,V.value,Z)}},$=(I,k,V,re,Z,J,ue,le,se)=>{const ee=k.el=I?I.el:a(""),we=k.anchor=I?I.anchor:a("");let{patchFlag:he,dynamicChildren:Ie,slotScopeIds:Ce}=k;Ce&&(le=le?le.concat(Ce):Ce),I==null?(n(ee,V,re),n(we,V,re),H(k.children||[],V,we,Z,J,ue,le,se)):he>0&&he&64&&Ie&&I.dynamicChildren?(U(I.dynamicChildren,Ie,V,Z,J,ue,le),(k.key!=null||Z&&k===Z.subTree)&&b9(I,k,!0)):Y(I,k,V,we,Z,J,ue,le,se)},q=(I,k,V,re,Z,J,ue,le,se)=>{k.slotScopeIds=le,I==null?k.shapeFlag&512?Z.ctx.activate(k,V,re,ue,se):G(k,V,re,Z,J,ue,se):W(I,k,se)},G=(I,k,V,re,Z,J,ue)=>{const le=I.component=LE(I,re,Z);if(s9(I)&&(le.ctx.renderer=$t),ME(le,!1,ue),le.asyncDep){if(Z&&Z.registerDep(le,j,ue),!I.el){const se=le.subTree=Ui(Oo);C(null,se,k,V)}}else j(le,I,k,V,Z,J,ue)},W=(I,k,V)=>{const re=k.component=I.component;if(IE(I,k,V))if(re.asyncDep&&!re.asyncResolved){Q(re,k,V);return}else re.next=k,re.update();else k.el=I.el,re.vnode=k},j=(I,k,V,re,Z,J,ue)=>{const le=()=>{if(I.isMounted){let{next:he,bu:Ie,u:Ce,parent:Fe,vnode:b}=I;{const E=v9(I);if(E){he&&(he.el=b.el,Q(I,he,ue)),E.asyncDep.then(()=>{I.isUnmounted||le()});return}}let d=he,p;ts(I,!1),he?(he.el=b.el,Q(I,he,ue)):he=b,Ie&&Nf(Ie),(p=he.props&&he.props.onVnodeBeforeUpdate)&&En(p,Fe,he,b),ts(I,!0);const A=Dp(I),T=I.subTree;I.subTree=A,x(T,A,f(T.el),wt(T),I,Z,J),he.el=A.el,d===null&&CE(I,A.el),Ce&&Nr(Ce,Z),(p=he.props&&he.props.onVnodeUpdated)&&Nr(()=>En(p,Fe,he,b),Z)}else{let he;const{el:Ie,props:Ce}=k,{bm:Fe,m:b,parent:d,root:p,type:A}=I,T=Wa(k);ts(I,!1),Fe&&Nf(Fe),!T&&(he=Ce&&Ce.onVnodeBeforeMount)&&En(he,d,k),ts(I,!0);{p.ce&&p.ce._def.shadowRoot!==!1&&p.ce._injectChildStyle(A);const E=I.subTree=Dp(I);x(null,E,V,re,I,Z,J),k.el=E.el}if(b&&Nr(b,Z),!T&&(he=Ce&&Ce.onVnodeMounted)){const E=k;Nr(()=>En(he,d,E),Z)}(k.shapeFlag&256||d&&Wa(d.vnode)&&d.vnode.shapeFlag&256)&&I.a&&Nr(I.a,Z),I.isMounted=!0,k=V=re=null}};I.scope.on();const se=I.effect=new M7(le);I.scope.off();const ee=I.update=se.run.bind(se),we=I.job=se.runIfDirty.bind(se);we.i=I,we.id=I.uid,se.scheduler=()=>k3(we),ts(I,!0),ee()},Q=(I,k,V)=>{k.component=I;const re=I.vnode.props;I.vnode=k,I.next=null,uE(I,k.props,re,V),pE(I,k.children,V),oi(),kp(I),ai()},Y=(I,k,V,re,Z,J,ue,le,se=!1)=>{const ee=I&&I.children,we=I?I.shapeFlag:0,he=k.children,{patchFlag:Ie,shapeFlag:Ce}=k;if(Ie>0){if(Ie&128){Se(ee,he,V,re,Z,J,ue,le,se);return}else if(Ie&256){ie(ee,he,V,re,Z,J,ue,le,se);return}}Ce&8?(we&16&&Te(ee,Z,J),he!==ee&&u(V,he)):we&16?Ce&16?Se(ee,he,V,re,Z,J,ue,le,se):Te(ee,Z,J,!0):(we&8&&u(V,""),Ce&16&&H(he,V,re,Z,J,ue,le,se))},ie=(I,k,V,re,Z,J,ue,le,se)=>{I=I||po,k=k||po;const ee=I.length,we=k.length,he=Math.min(ee,we);let Ie;for(Ie=0;Ie<he;Ie++){const Ce=k[Ie]=se?ki(k[Ie]):Tn(k[Ie]);x(I[Ie],Ce,V,null,Z,J,ue,le,se)}ee>we?Te(I,Z,J,!0,!1,he):H(k,V,re,Z,J,ue,le,se,he)},Se=(I,k,V,re,Z,J,ue,le,se)=>{let ee=0;const we=k.length;let he=I.length-1,Ie=we-1;for(;ee<=he&&ee<=Ie;){const Ce=I[ee],Fe=k[ee]=se?ki(k[ee]):Tn(k[ee]);if(ka(Ce,Fe))x(Ce,Fe,V,null,Z,J,ue,le,se);else break;ee++}for(;ee<=he&&ee<=Ie;){const Ce=I[he],Fe=k[Ie]=se?ki(k[Ie]):Tn(k[Ie]);if(ka(Ce,Fe))x(Ce,Fe,V,null,Z,J,ue,le,se);else break;he--,Ie--}if(ee>he){if(ee<=Ie){const Ce=Ie+1,Fe=Ce<we?k[Ce].el:re;for(;ee<=Ie;)x(null,k[ee]=se?ki(k[ee]):Tn(k[ee]),V,Fe,Z,J,ue,le,se),ee++}}else if(ee>Ie)for(;ee<=he;)de(I[ee],Z,J,!0),ee++;else{const Ce=ee,Fe=ee,b=new Map;for(ee=Fe;ee<=Ie;ee++){const z=k[ee]=se?ki(k[ee]):Tn(k[ee]);z.key!=null&&b.set(z.key,ee)}let d,p=0;const A=Ie-Fe+1;let T=!1,E=0;const _=new Array(A);for(ee=0;ee<A;ee++)_[ee]=0;for(ee=Ce;ee<=he;ee++){const z=I[ee];if(p>=A){de(z,Z,J,!0);continue}let ce;if(z.key!=null)ce=b.get(z.key);else for(d=Fe;d<=Ie;d++)if(_[d-Fe]===0&&ka(z,k[d])){ce=d;break}ce===void 0?de(z,Z,J,!0):(_[ce-Fe]=ee+1,ce>=E?E=ce:T=!0,x(z,k[ce],V,null,Z,J,ue,le,se),p++)}const D=T?wE(_):po;for(d=D.length-1,ee=A-1;ee>=0;ee--){const z=Fe+ee,ce=k[z],Ne=z+1<we?k[z+1].el:re;_[ee]===0?x(null,ce,V,Ne,Z,J,ue,le,se):T&&(d<0||ee!==D[d]?te(ce,V,Ne,2):d--)}}},te=(I,k,V,re,Z=null)=>{const{el:J,type:ue,transition:le,children:se,shapeFlag:ee}=I;if(ee&6){te(I.component.subTree,k,V,re);return}if(ee&128){I.suspense.move(k,V,re);return}if(ee&64){ue.move(I,k,V,$t);return}if(ue===dn){n(J,k,V);for(let he=0;he<se.length;he++)te(se[he],k,V,re);n(I.anchor,k,V);return}if(ue===$f){O(I,k,V);return}if(re!==2&&ee&1&&le)if(re===0)le.beforeEnter(J),n(J,k,V),Nr(()=>le.enter(J),Z);else{const{leave:he,delayLeave:Ie,afterLeave:Ce}=le,Fe=()=>{I.ctx.isUnmounted?i(J):n(J,k,V)},b=()=>{he(J,()=>{Fe(),Ce&&Ce()})};Ie?Ie(J,Fe,b):b()}else n(J,k,V)},de=(I,k,V,re=!1,Z=!1)=>{const{type:J,props:ue,ref:le,children:se,dynamicChildren:ee,shapeFlag:we,patchFlag:he,dirs:Ie,cacheIndex:Ce}=I;if(he===-2&&(Z=!1),le!=null&&(oi(),za(le,null,V,I,!0),ai()),Ce!=null&&(k.renderCache[Ce]=void 0),we&256){k.ctx.deactivate(I);return}const Fe=we&1&&Ie,b=!Wa(I);let d;if(b&&(d=ue&&ue.onVnodeBeforeUnmount)&&En(d,k,I),we&6)Le(I.component,V,re);else{if(we&128){I.suspense.unmount(V,re);return}Fe&&es(I,null,k,"beforeUnmount"),we&64?I.type.remove(I,k,V,$t,re):ee&&!ee.hasOnce&&(J!==dn||he>0&&he&64)?Te(ee,k,V,!1,!0):(J===dn&&he&384||!Z&&we&16)&&Te(se,k,V),re&&ae(I)}(b&&(d=ue&&ue.onVnodeUnmounted)||Fe)&&Nr(()=>{d&&En(d,k,I),Fe&&es(I,null,k,"unmounted")},V)},ae=I=>{const{type:k,el:V,anchor:re,transition:Z}=I;if(k===dn){Ue(V,re);return}if(k===$f){L(I);return}const J=()=>{i(V),Z&&!Z.persisted&&Z.afterLeave&&Z.afterLeave()};if(I.shapeFlag&1&&Z&&!Z.persisted){const{leave:ue,delayLeave:le}=Z,se=()=>ue(V,J);le?le(I.el,J,se):se()}else J()},Ue=(I,k)=>{let V;for(;I!==k;)V=g(I),i(I),I=V;i(k)},Le=(I,k,V)=>{const{bum:re,scope:Z,job:J,subTree:ue,um:le,m:se,a:ee,parent:we,slots:{__:he}}=I;Rp(se),Rp(ee),re&&Nf(re),we&&De(he)&&he.forEach(Ie=>{we.renderCache[Ie]=void 0}),Z.stop(),J&&(J.flags|=8,de(ue,I,k,V)),le&&Nr(le,k),Nr(()=>{I.isUnmounted=!0},k),k&&k.pendingBranch&&!k.isUnmounted&&I.asyncDep&&!I.asyncResolved&&I.suspenseId===k.pendingId&&(k.deps--,k.deps===0&&k.resolve())},Te=(I,k,V,re=!1,Z=!1,J=0)=>{for(let ue=J;ue<I.length;ue++)de(I[ue],k,V,re,Z)},wt=I=>{if(I.shapeFlag&6)return wt(I.component.subTree);if(I.shapeFlag&128)return I.suspense.next();const k=g(I.anchor||I.el),V=k&&k[FS];return V?g(V):k};let nt=!1;const ot=(I,k,V)=>{I==null?k._vnode&&de(k._vnode,null,null,!0):x(k._vnode||null,I,k,null,null,null,V),k._vnode=I,nt||(nt=!0,kp(),t9(),nt=!1)},$t={p:x,um:de,m:te,r:ae,mt:G,mc:H,pc:Y,pbc:U,n:wt,o:r};return{render:ot,hydrate:void 0,createApp:aE(ot)}}function Uf({type:r,props:e},t){return t==="svg"&&r==="foreignObject"||t==="mathml"&&r==="annotation-xml"&&e&&e.encoding&&e.encoding.includes("html")?void 0:t}function ts({effect:r,job:e},t){t?(r.flags|=32,e.flags|=4):(r.flags&=-33,e.flags&=-5)}function yE(r,e){return(!r||r&&!r.pendingBranch)&&e&&!e.persisted}function b9(r,e,t=!1){const n=r.children,i=e.children;if(De(n)&&De(i))for(let s=0;s<n.length;s++){const o=n[s];let a=i[s];a.shapeFlag&1&&!a.dynamicChildren&&((a.patchFlag<=0||a.patchFlag===32)&&(a=i[s]=ki(i[s]),a.el=o.el),!t&&a.patchFlag!==-2&&b9(o,a)),a.type===fh&&(a.el=o.el),a.type===Oo&&!a.el&&(a.el=o.el)}}function wE(r){const e=r.slice(),t=[0];let n,i,s,o,a;const c=r.length;for(n=0;n<c;n++){const l=r[n];if(l!==0){if(i=t[t.length-1],r[i]<l){e[n]=i,t.push(n);continue}for(s=0,o=t.length-1;s<o;)a=s+o>>1,r[t[a]]<l?s=a+1:o=a;l<r[t[s]]&&(s>0&&(e[n]=t[s-1]),t[s]=n)}}for(s=t.length,o=t[s-1];s-- >0;)t[s]=o,o=e[o];return t}function v9(r){const e=r.subTree.component;if(e)return e.asyncDep&&!e.asyncResolved?e:v9(e)}function Rp(r){if(r)for(let e=0;e<r.length;e++)r[e].flags|=8}const bE=Symbol.for("v-scx"),vE=()=>lu(bE);function Ff(r,e,t){return S9(r,e,t)}function S9(r,e,t=ft){const{immediate:n,deep:i,flush:s,once:o}=t,a=gr({},t),c=e&&n||!e&&s!=="post";let l;if(gc){if(s==="sync"){const m=vE();l=m.__watcherHandles||(m.__watcherHandles=[])}else if(!c){const m=()=>{};return m.stop=Nn,m.resume=Nn,m.pause=Nn,m}}const u=fr;a.call=(m,w,x)=>Mn(m,u,w,x);let f=!1;s==="post"?a.scheduler=m=>{Nr(m,u&&u.suspense)}:s!=="sync"&&(f=!0,a.scheduler=(m,w)=>{w?m():k3(m)}),a.augmentJob=m=>{e&&(m.flags|=4),f&&(m.flags|=2,u&&(m.id=u.uid,m.i=u))};const g=OS(r,e,a);return gc&&(l?l.push(g):c&&g()),g}function SE(r,e,t){const n=this.proxy,i=Lt(r)?r.includes(".")?E9(n,r):()=>n[r]:r.bind(n,n);let s;Me(e)?s=e:(s=e.handler,t=e);const o=Zc(this),a=S9(i,s.bind(n),t);return o(),a}function E9(r,e){const t=e.split(".");return()=>{let n=r;for(let i=0;i<t.length&&n;i++)n=n[t[i]];return n}}const EE=(r,e)=>e==="modelValue"||e==="model-value"?r.modelModifiers:r[`${e}Modifiers`]||r[`${Ki(e)}Modifiers`]||r[`${Hs(e)}Modifiers`];function xE(r,e,...t){if(r.isUnmounted)return;const n=r.vnode.props||ft;let i=t;const s=e.startsWith("update:"),o=s&&EE(n,e.slice(7));o&&(o.trim&&(i=t.map(u=>Lt(u)?u.trim():u)),o.number&&(i=t.map(Yv)));let a,c=n[a=Bf(e)]||n[a=Bf(Ki(e))];!c&&s&&(c=n[a=Bf(Hs(e))]),c&&Mn(c,r,6,i);const l=n[a+"Once"];if(l){if(!r.emitted)r.emitted={};else if(r.emitted[a])return;r.emitted[a]=!0,Mn(l,r,6,i)}}function x9(r,e,t=!1){const n=e.emitsCache,i=n.get(r);if(i!==void 0)return i;const s=r.emits;let o={},a=!1;if(!Me(r)){const c=l=>{const u=x9(l,e,!0);u&&(a=!0,gr(o,u))};!t&&e.mixins.length&&e.mixins.forEach(c),r.extends&&c(r.extends),r.mixins&&r.mixins.forEach(c)}return!s&&!a?(Tt(r)&&n.set(r,null),null):(De(s)?s.forEach(c=>o[c]=null):gr(o,s),Tt(r)&&n.set(r,o),o)}function hh(r,e){return!r||!sh(e)?!1:(e=e.slice(2).replace(/Once$/,""),Je(r,e[0].toLowerCase()+e.slice(1))||Je(r,Hs(e))||Je(r,e))}function Dp(r){const{type:e,vnode:t,proxy:n,withProxy:i,propsOptions:[s],slots:o,attrs:a,emit:c,render:l,renderCache:u,props:f,data:g,setupState:m,ctx:w,inheritAttrs:x}=r,v=Bu(r);let C,N;try{if(t.shapeFlag&4){const L=i||n,R=L;C=Tn(l.call(R,L,u,f,m,g,w)),N=a}else{const L=e;C=Tn(L.length>1?L(f,{attrs:a,slots:o,emit:c}):L(f,null)),N=e.props?a:AE(a)}}catch(L){Qa.length=0,lh(L,r,1),C=Ui(Oo)}let O=C;if(N&&x!==!1){const L=Object.keys(N),{shapeFlag:R}=O;L.length&&R&7&&(s&&L.some(p3)&&(N=_E(N,s)),O=Ro(O,N,!1,!0))}return t.dirs&&(O=Ro(O,null,!1,!0),O.dirs=O.dirs?O.dirs.concat(t.dirs):t.dirs),t.transition&&T3(O,t.transition),C=O,Bu(v),C}const AE=r=>{let e;for(const t in r)(t==="class"||t==="style"||sh(t))&&((e||(e={}))[t]=r[t]);return e},_E=(r,e)=>{const t={};for(const n in r)(!p3(n)||!(n.slice(9)in e))&&(t[n]=r[n]);return t};function IE(r,e,t){const{props:n,children:i,component:s}=r,{props:o,children:a,patchFlag:c}=e,l=s.emitsOptions;if(e.dirs||e.transition)return!0;if(t&&c>=0){if(c&1024)return!0;if(c&16)return n?Lp(n,o,l):!!o;if(c&8){const u=e.dynamicProps;for(let f=0;f<u.length;f++){const g=u[f];if(o[g]!==n[g]&&!hh(l,g))return!0}}}else return(i||a)&&(!a||!a.$stable)?!0:n===o?!1:n?o?Lp(n,o,l):!0:!!o;return!1}function Lp(r,e,t){const n=Object.keys(e);if(n.length!==Object.keys(r).length)return!0;for(let i=0;i<n.length;i++){const s=n[i];if(e[s]!==r[s]&&!hh(t,s))return!0}return!1}function CE({vnode:r,parent:e},t){for(;e;){const n=e.subTree;if(n.suspense&&n.suspense.activeBranch===r&&(n.el=r.el),n===r)(r=e.vnode).el=t,e=e.parent;else break}}const A9=r=>r.__isSuspense;function kE(r,e){e&&e.pendingBranch?De(r)?e.effects.push(...r):e.effects.push(r):MS(r)}const dn=Symbol.for("v-fgt"),fh=Symbol.for("v-txt"),Oo=Symbol.for("v-cmt"),$f=Symbol.for("v-stc"),Qa=[];let Mr=null;function _9(r=!1){Qa.push(Mr=r?null:[])}function TE(){Qa.pop(),Mr=Qa[Qa.length-1]||null}let pc=1;function Mp(r,e=!1){pc+=r,r<0&&Mr&&e&&(Mr.hasOnce=!0)}function PE(r){return r.dynamicChildren=pc>0?Mr||po:null,TE(),pc>0&&Mr&&Mr.push(r),r}function I9(r,e,t,n,i,s){return PE(qt(r,e,t,n,i,s,!0))}function C9(r){return r?r.__v_isVNode===!0:!1}function ka(r,e){return r.type===e.type&&r.key===e.key}const k9=({key:r})=>r??null,uu=({ref:r,ref_key:e,ref_for:t})=>(typeof r=="number"&&(r=""+r),r!=null?Lt(r)||sr(r)||Me(r)?{i:Bn,r,k:e,f:!!t}:r:null);function qt(r,e=null,t=null,n=0,i=null,s=r===dn?0:1,o=!1,a=!1){const c={__v_isVNode:!0,__v_skip:!0,type:r,props:e,key:e&&k9(e),ref:e&&uu(e),scopeId:n9,slotScopeIds:null,children:t,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:s,patchFlag:n,dynamicProps:i,dynamicChildren:null,appContext:null,ctx:Bn};return a?(N3(c,t),s&128&&r.normalize(c)):t&&(c.shapeFlag|=Lt(t)?8:16),pc>0&&!o&&Mr&&(c.patchFlag>0||s&6)&&c.patchFlag!==32&&Mr.push(c),c}const Ui=BE;function BE(r,e=null,t=null,n=0,i=null,s=!1){if((!r||r===JS)&&(r=Oo),C9(r)){const a=Ro(r,e,!0);return t&&N3(a,t),pc>0&&!s&&Mr&&(a.shapeFlag&6?Mr[Mr.indexOf(r)]=a:Mr.push(a)),a.patchFlag=-2,a}if(VE(r)&&(r=r.__vccOpts),e){e=NE(e);let{class:a,style:c}=e;a&&!Lt(a)&&(e.class=w3(a)),Tt(c)&&(C3(c)&&!De(c)&&(c=gr({},c)),e.style=y3(c))}const o=Lt(r)?1:A9(r)?128:$S(r)?64:Tt(r)?4:Me(r)?2:0;return qt(r,e,t,n,i,o,s,!0)}function NE(r){return r?C3(r)||d9(r)?gr({},r):r:null}function Ro(r,e,t=!1,n=!1){const{props:i,ref:s,patchFlag:o,children:a,transition:c}=r,l=e?OE(i||{},e):i,u={__v_isVNode:!0,__v_skip:!0,type:r.type,props:l,key:l&&k9(l),ref:e&&e.ref?t&&s?De(s)?s.concat(uu(e)):[s,uu(e)]:uu(e):s,scopeId:r.scopeId,slotScopeIds:r.slotScopeIds,children:a,target:r.target,targetStart:r.targetStart,targetAnchor:r.targetAnchor,staticCount:r.staticCount,shapeFlag:r.shapeFlag,patchFlag:e&&r.type!==dn?o===-1?16:o|16:o,dynamicProps:r.dynamicProps,dynamicChildren:r.dynamicChildren,appContext:r.appContext,dirs:r.dirs,transition:c,component:r.component,suspense:r.suspense,ssContent:r.ssContent&&Ro(r.ssContent),ssFallback:r.ssFallback&&Ro(r.ssFallback),el:r.el,anchor:r.anchor,ctx:r.ctx,ce:r.ce};return c&&n&&T3(u,c.clone(u)),u}function ns(r=" ",e=0){return Ui(fh,null,r,e)}function Tn(r){return r==null||typeof r=="boolean"?Ui(Oo):De(r)?Ui(dn,null,r.slice()):C9(r)?ki(r):Ui(fh,null,String(r))}function ki(r){return r.el===null&&r.patchFlag!==-1||r.memo?r:Ro(r)}function N3(r,e){let t=0;const{shapeFlag:n}=r;if(e==null)e=null;else if(De(e))t=16;else if(typeof e=="object")if(n&65){const i=e.default;i&&(i._c&&(i._d=!1),N3(r,i()),i._c&&(i._d=!0));return}else{t=32;const i=e._;!i&&!d9(e)?e._ctx=Bn:i===3&&Bn&&(Bn.slots._===1?e._=1:(e._=2,r.patchFlag|=1024))}else Me(e)?(e={default:e,_ctx:Bn},t=32):(e=String(e),n&64?(t=16,e=[ns(e)]):t=8);r.children=e,r.shapeFlag|=t}function OE(...r){const e={};for(let t=0;t<r.length;t++){const n=r[t];for(const i in n)if(i==="class")e.class!==n.class&&(e.class=w3([e.class,n.class]));else if(i==="style")e.style=y3([e.style,n.style]);else if(sh(i)){const s=e[i],o=n[i];o&&s!==o&&!(De(s)&&s.includes(o))&&(e[i]=s?[].concat(s,o):o)}else i!==""&&(e[i]=n[i])}return e}function En(r,e,t,n=null){Mn(r,e,7,[t,n])}const RE=u9();let DE=0;function LE(r,e,t){const n=r.type,i=(e?e.appContext:r.appContext)||RE,s={uid:DE++,vnode:r,type:n,parent:e,appContext:i,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new nS(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:e?e.provides:Object.create(i.provides),ids:e?e.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:g9(n,i),emitsOptions:x9(n,i),emit:null,emitted:null,propsDefaults:ft,inheritAttrs:n.inheritAttrs,ctx:ft,data:ft,props:ft,attrs:ft,slots:ft,refs:ft,setupState:ft,setupContext:null,suspense:t,suspenseId:t?t.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return s.ctx={_:s},s.root=e?e.root:s,s.emit=xE.bind(null,s),r.ce&&r.ce(s),s}let fr=null,Ou,c0;{const r=ch(),e=(t,n)=>{let i;return(i=r[t])||(i=r[t]=[]),i.push(n),s=>{i.length>1?i.forEach(o=>o(s)):i[0](s)}};Ou=e("__VUE_INSTANCE_SETTERS__",t=>fr=t),c0=e("__VUE_SSR_SETTERS__",t=>gc=t)}const Zc=r=>{const e=fr;return Ou(r),r.scope.on(),()=>{r.scope.off(),Ou(e)}},Up=()=>{fr&&fr.scope.off(),Ou(null)};function T9(r){return r.vnode.shapeFlag&4}let gc=!1;function ME(r,e=!1,t=!1){e&&c0(e);const{props:n,children:i}=r.vnode,s=T9(r);lE(r,n,s,e),dE(r,i,t||e);const o=s?UE(r,e):void 0;return e&&c0(!1),o}function UE(r,e){const t=r.type;r.accessCache=Object.create(null),r.proxy=new Proxy(r.ctx,eE);const{setup:n}=t;if(n){oi();const i=r.setupContext=n.length>1?$E(r):null,s=Zc(r),o=Yc(n,r,0,[r.props,i]),a=P7(o);if(ai(),s(),(a||r.sp)&&!Wa(r)&&i9(r),a){if(o.then(Up,Up),e)return o.then(c=>{Fp(r,c)}).catch(c=>{lh(c,r,0)});r.asyncDep=o}else Fp(r,o)}else P9(r)}function Fp(r,e,t){Me(e)?r.type.__ssrInlineRender?r.ssrRender=e:r.render=e:Tt(e)&&(r.setupState=X7(e)),P9(r)}function P9(r,e,t){const n=r.type;r.render||(r.render=n.render||Nn);{const i=Zc(r);oi();try{tE(r)}finally{ai(),i()}}}const FE={get(r,e){return tr(r,"get",""),r[e]}};function $E(r){const e=t=>{r.exposed=t||{}};return{attrs:new Proxy(r.attrs,FE),slots:r.slots,emit:r.emit,expose:e}}function O3(r){return r.exposed?r.exposeProxy||(r.exposeProxy=new Proxy(X7(AS(r.exposed)),{get(e,t){if(t in e)return e[t];if(t in Ga)return Ga[t](r)},has(e,t){return t in e||t in Ga}})):r.proxy}function VE(r){return Me(r)&&"__vccOpts"in r}const qE=(r,e)=>BS(r,e,gc),KE="3.5.17";/**
* @vue/runtime-dom v3.5.17
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let l0;const $p=typeof window<"u"&&window.trustedTypes;if($p)try{l0=$p.createPolicy("vue",{createHTML:r=>r})}catch{}const B9=l0?r=>l0.createHTML(r):r=>r,HE="http://www.w3.org/2000/svg",jE="http://www.w3.org/1998/Math/MathML",Wn=typeof document<"u"?document:null,Vp=Wn&&Wn.createElement("template"),zE={insert:(r,e,t)=>{e.insertBefore(r,t||null)},remove:r=>{const e=r.parentNode;e&&e.removeChild(r)},createElement:(r,e,t,n)=>{const i=e==="svg"?Wn.createElementNS(HE,r):e==="mathml"?Wn.createElementNS(jE,r):t?Wn.createElement(r,{is:t}):Wn.createElement(r);return r==="select"&&n&&n.multiple!=null&&i.setAttribute("multiple",n.multiple),i},createText:r=>Wn.createTextNode(r),createComment:r=>Wn.createComment(r),setText:(r,e)=>{r.nodeValue=e},setElementText:(r,e)=>{r.textContent=e},parentNode:r=>r.parentNode,nextSibling:r=>r.nextSibling,querySelector:r=>Wn.querySelector(r),setScopeId(r,e){r.setAttribute(e,"")},insertStaticContent(r,e,t,n,i,s){const o=t?t.previousSibling:e.lastChild;if(i&&(i===s||i.nextSibling))for(;e.insertBefore(i.cloneNode(!0),t),!(i===s||!(i=i.nextSibling)););else{Vp.innerHTML=B9(n==="svg"?`<svg>${r}</svg>`:n==="mathml"?`<math>${r}</math>`:r);const a=Vp.content;if(n==="svg"||n==="mathml"){const c=a.firstChild;for(;c.firstChild;)a.appendChild(c.firstChild);a.removeChild(c)}e.insertBefore(a,t)}return[o?o.nextSibling:e.firstChild,t?t.previousSibling:e.lastChild]}},WE=Symbol("_vtc");function GE(r,e,t){const n=r[WE];n&&(e=(e?[e,...n]:[...n]).join(" ")),e==null?r.removeAttribute("class"):t?r.setAttribute("class",e):r.className=e}const qp=Symbol("_vod"),QE=Symbol("_vsh"),YE=Symbol(""),ZE=/(^|;)\s*display\s*:/;function XE(r,e,t){const n=r.style,i=Lt(t);let s=!1;if(t&&!i){if(e)if(Lt(e))for(const o of e.split(";")){const a=o.slice(0,o.indexOf(":")).trim();t[a]==null&&hu(n,a,"")}else for(const o in e)t[o]==null&&hu(n,o,"");for(const o in t)o==="display"&&(s=!0),hu(n,o,t[o])}else if(i){if(e!==t){const o=n[YE];o&&(t+=";"+o),n.cssText=t,s=ZE.test(t)}}else e&&r.removeAttribute("style");qp in r&&(r[qp]=s?n.display:"",r[QE]&&(n.display="none"))}const Kp=/\s*!important$/;function hu(r,e,t){if(De(t))t.forEach(n=>hu(r,e,n));else if(t==null&&(t=""),e.startsWith("--"))r.setProperty(e,t);else{const n=JE(r,e);Kp.test(t)?r.setProperty(Hs(n),t.replace(Kp,""),"important"):r[n]=t}}const Hp=["Webkit","Moz","ms"],Vf={};function JE(r,e){const t=Vf[e];if(t)return t;let n=Ki(e);if(n!=="filter"&&n in r)return Vf[e]=n;n=O7(n);for(let i=0;i<Hp.length;i++){const s=Hp[i]+n;if(s in r)return Vf[e]=s}return e}const jp="http://www.w3.org/1999/xlink";function zp(r,e,t,n,i,s=rS(e)){n&&e.startsWith("xlink:")?t==null?r.removeAttributeNS(jp,e.slice(6,e.length)):r.setAttributeNS(jp,e,t):t==null||s&&!R7(t)?r.removeAttribute(e):r.setAttribute(e,s?"":Yi(t)?String(t):t)}function Wp(r,e,t,n,i){if(e==="innerHTML"||e==="textContent"){t!=null&&(r[e]=e==="innerHTML"?B9(t):t);return}const s=r.tagName;if(e==="value"&&s!=="PROGRESS"&&!s.includes("-")){const a=s==="OPTION"?r.getAttribute("value")||"":r.value,c=t==null?r.type==="checkbox"?"on":"":String(t);(a!==c||!("_value"in r))&&(r.value=c),t==null&&r.removeAttribute(e),r._value=t;return}let o=!1;if(t===""||t==null){const a=typeof r[e];a==="boolean"?t=R7(t):t==null&&a==="string"?(t="",o=!0):a==="number"&&(t=0,o=!0)}try{r[e]=t}catch{}o&&r.removeAttribute(i||e)}function ex(r,e,t,n){r.addEventListener(e,t,n)}function tx(r,e,t,n){r.removeEventListener(e,t,n)}const Gp=Symbol("_vei");function rx(r,e,t,n,i=null){const s=r[Gp]||(r[Gp]={}),o=s[e];if(n&&o)o.value=n;else{const[a,c]=nx(e);if(n){const l=s[e]=ox(n,i);ex(r,a,l,c)}else o&&(tx(r,a,o,c),s[e]=void 0)}}const Qp=/(?:Once|Passive|Capture)$/;function nx(r){let e;if(Qp.test(r)){e={};let n;for(;n=r.match(Qp);)r=r.slice(0,r.length-n[0].length),e[n[0].toLowerCase()]=!0}return[r[2]===":"?r.slice(3):Hs(r.slice(2)),e]}let qf=0;const ix=Promise.resolve(),sx=()=>qf||(ix.then(()=>qf=0),qf=Date.now());function ox(r,e){const t=n=>{if(!n._vts)n._vts=Date.now();else if(n._vts<=t.attached)return;Mn(ax(n,t.value),e,5,[n])};return t.value=r,t.attached=sx(),t}function ax(r,e){if(De(e)){const t=r.stopImmediatePropagation;return r.stopImmediatePropagation=()=>{t.call(r),r._stopped=!0},e.map(n=>i=>!i._stopped&&n&&n(i))}else return e}const Yp=r=>r.charCodeAt(0)===111&&r.charCodeAt(1)===110&&r.charCodeAt(2)>96&&r.charCodeAt(2)<123,cx=(r,e,t,n,i,s)=>{const o=i==="svg";e==="class"?GE(r,n,o):e==="style"?XE(r,t,n):sh(e)?p3(e)||rx(r,e,t,n,s):(e[0]==="."?(e=e.slice(1),!0):e[0]==="^"?(e=e.slice(1),!1):lx(r,e,n,o))?(Wp(r,e,n),!r.tagName.includes("-")&&(e==="value"||e==="checked"||e==="selected")&&zp(r,e,n,o,s,e!=="value")):r._isVueCE&&(/[A-Z]/.test(e)||!Lt(n))?Wp(r,Ki(e),n,s,e):(e==="true-value"?r._trueValue=n:e==="false-value"&&(r._falseValue=n),zp(r,e,n,o))};function lx(r,e,t,n){if(n)return!!(e==="innerHTML"||e==="textContent"||e in r&&Yp(e)&&Me(t));if(e==="spellcheck"||e==="draggable"||e==="translate"||e==="autocorrect"||e==="form"||e==="list"&&r.tagName==="INPUT"||e==="type"&&r.tagName==="TEXTAREA")return!1;if(e==="width"||e==="height"){const i=r.tagName;if(i==="IMG"||i==="VIDEO"||i==="CANVAS"||i==="SOURCE")return!1}return Yp(e)&&Lt(t)?!1:e in r}const ux=gr({patchProp:cx},zE);let Zp;function hx(){return Zp||(Zp=gE(ux))}const fx=(...r)=>{const e=hx().createApp(...r),{mount:t}=e;return e.mount=n=>{const i=px(n);if(!i)return;const s=e._component;!Me(s)&&!s.render&&!s.template&&(s.template=i.innerHTML),i.nodeType===1&&(i.textContent="");const o=t(i,!1,dx(i));return i instanceof Element&&(i.removeAttribute("v-cloak"),i.setAttribute("data-v-app","")),o},e};function dx(r){if(r instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&r instanceof MathMLElement)return"mathml"}function px(r){return Lt(r)?document.querySelector(r):r}const gx=""+new URL("../vite.svg",import.meta.url).href,mx="data:image/svg+xml,%3csvg%20xmlns='http://www.w3.org/2000/svg'%20xmlns:xlink='http://www.w3.org/1999/xlink'%20aria-hidden='true'%20role='img'%20class='iconify%20iconify--logos'%20width='37.07'%20height='36'%20preserveAspectRatio='xMidYMid%20meet'%20viewBox='0%200%20256%20198'%3e%3cpath%20fill='%2341B883'%20d='M204.8%200H256L128%20220.8L0%200h97.92L128%2051.2L157.44%200h47.36Z'%3e%3c/path%3e%3cpath%20fill='%2341B883'%20d='m0%200l128%20220.8L256%200h-51.2L128%20132.48L50.56%200H0Z'%3e%3c/path%3e%3cpath%20fill='%2335495E'%20d='M50.56%200L128%20133.12L204.8%200h-47.36L128%2051.2L97.92%200H50.56Z'%3e%3c/path%3e%3c/svg%3e",N9=(r,e)=>{const t=r.__vccOpts||r;for(const[n,i]of e)t[n]=i;return t},yx={class:"card"},wx={__name:"HelloWorld",props:{msg:String},setup(r){const e=_S(0);return(t,n)=>(_9(),I9(dn,null,[qt("h1",null,Xd(r.msg),1),qt("div",yx,[qt("button",{type:"button",onClick:n[0]||(n[0]=i=>e.value++)},"count is "+Xd(e.value),1),n[1]||(n[1]=qt("p",null,[ns(" Edit "),qt("code",null,"components/HelloWorld.vue"),ns(" to test HMR ")],-1))]),n[2]||(n[2]=qt("p",null,[ns(" Check out "),qt("a",{href:"https://vuejs.org/guide/quick-start.html#local",target:"_blank"},"create-vue"),ns(", the official Vue + Vite starter ")],-1)),n[3]||(n[3]=qt("p",null,[ns(" Learn more about IDE Support for Vue in the "),qt("a",{href:"https://vuejs.org/guide/scaling-up/tooling.html#ide-support",target:"_blank"},"Vue Docs Scaling up Guide"),ns(". ")],-1)),n[4]||(n[4]=qt("p",{class:"read-the-docs"},"Click on the Vite and Vue logos to learn more",-1))],64))}},bx=N9(wx,[["__scopeId","data-v-830e400e"]]),vx=Symbol.for("@libp2p/connection"),u0=Symbol.for("@libp2p/content-routing"),Ru=Symbol.for("@libp2p/peer-discovery"),R3=Symbol.for("@libp2p/peer-id");function Ya(r){return!!(r!=null&&r[R3])}const h0=Symbol.for("@libp2p/peer-routing"),D3="keep-alive";var Du;(function(r){r.Accept="accept",r.Ignore="ignore",r.Reject="reject"})(Du||(Du={}));const Sx=Symbol.for("@libp2p/pubsub"),O9=Symbol.for("@libp2p/transport");var mc;(function(r){r[r.FATAL_ALL=0]="FATAL_ALL",r[r.NO_FATAL=1]="NO_FATAL"})(mc||(mc={}));var Kd;let Hi=(Kd=class extends Error{constructor(e="The operation was aborted"){super(e),this.name="AbortError"}},h(Kd,"name","AbortError"),Kd);class R9 extends Error{constructor(e="Unexpected Peer"){super(e),this.name="UnexpectedPeerError"}}h(R9,"name","UnexpectedPeerError");var Hd;let Ex=(Hd=class extends Error{constructor(e="Invalid crypto exchange"){super(e),this.name="InvalidCryptoExchangeError"}},h(Hd,"name","InvalidCryptoExchangeError"),Hd);var jd;let ke=(jd=class extends Error{constructor(e="Invalid parameters"){super(e),this.name="InvalidParametersError"}},h(jd,"name","InvalidParametersError"),jd);class yc extends Error{constructor(e="Invalid public key"){super(e),this.name="InvalidPublicKeyError"}}h(yc,"name","InvalidPublicKeyError");class L3 extends Error{constructor(e="Invalid private key"){super(e),this.name="InvalidPrivateKeyError"}}h(L3,"name","InvalidPrivateKeyError");class D9 extends Error{constructor(e="The connection is closing"){super(e),this.name="ConnectionClosingError"}}h(D9,"name","ConnectionClosingError");class M3 extends Error{constructor(e="The connection is closed"){super(e),this.name="ConnectionClosedError"}}h(M3,"name","ConnectionClosedError");class L9 extends Error{constructor(e="Connection failed"){super(e),this.name="ConnectionFailedError"}}h(L9,"name","ConnectionFailedError");class oo extends Error{constructor(e="The muxer is closed"){super(e),this.name="MuxerClosedError"}}h(oo,"name","MuxerClosedError");class M9 extends Error{constructor(e="The stream has been reset"){super(e),this.name="StreamResetError"}}h(M9,"name","StreamResetError");class Lu extends Error{constructor(e="The stream is in an invalid state"){super(e),this.name="StreamStateError"}}h(Lu,"name","StreamStateError");var zd;let zr=(zd=class extends Error{constructor(e="Not found"){super(e),this.name="NotFoundError"}},h(zd,"name","NotFoundError"),zd);class U3 extends Error{constructor(e="Invalid PeerID"){super(e),this.name="InvalidPeerIdError"}}h(U3,"name","InvalidPeerIdError");var Wd;let F3=(Wd=class extends Error{constructor(e="Invalid multiaddr"){super(e),this.name="InvalidMultiaddrError"}},h(Wd,"name","InvalidMultiaddrError"),Wd);class U9 extends Error{constructor(e="Invalid CID"){super(e),this.name="InvalidCIDError"}}h(U9,"name","InvalidCIDError");class F9 extends Error{constructor(e="Invalid Multihash"){super(e),this.name="InvalidMultihashError"}}h(F9,"name","InvalidMultihashError");class dh extends Error{constructor(e="Unsupported protocol error"){super(e),this.name="UnsupportedProtocolError"}}h(dh,"name","UnsupportedProtocolError");class We extends Error{constructor(e="Invalid message"){super(e),this.name="InvalidMessageError"}}h(We,"name","InvalidMessageError");class $9 extends Error{constructor(e="Protocol error"){super(e),this.name="ProtocolError"}}h($9,"name","ProtocolError");var Gd;let ph=(Gd=class extends Error{constructor(e="Timed out"){super(e),this.name="TimeoutError"}},h(Gd,"name","TimeoutError"),Gd);class Ss extends Error{constructor(e="Not started"){super(e),this.name="NotStartedError"}}h(Ss,"name","NotStartedError");class fu extends Error{constructor(e="Dial error"){super(e),this.name="DialError"}}h(fu,"name","DialError");class $3 extends Error{constructor(e="Limited connection"){super(e),this.name="LimitedConnectionError"}}h($3,"name","LimitedConnectionError");class V9 extends Error{constructor(e="Too many inbound protocol streams"){super(e),this.name="TooManyInboundProtocolStreamsError"}}h(V9,"name","TooManyInboundProtocolStreamsError");class V3 extends Error{constructor(e="Too many outbound protocol streams"){super(e),this.name="TooManyOutboundProtocolStreamsError"}}h(V3,"name","TooManyOutboundProtocolStreamsError");class Xc extends Error{constructor(e="Unsupported key type"){super(e),this.name="UnsupportedKeyTypeError"}}h(Xc,"name","UnsupportedKeyTypeError");var kn;class or extends EventTarget{constructor(){super();ut(this,kn,new Map)}listenerCount(t){const n=oe(this,kn).get(t);return n==null?0:n.length}addEventListener(t,n,i){super.addEventListener(t,n,i);let s=oe(this,kn).get(t);s==null&&(s=[],oe(this,kn).set(t,s)),s.push({callback:n,once:(i!==!0&&i!==!1&&(i==null?void 0:i.once))??!1})}removeEventListener(t,n,i){super.removeEventListener(t.toString(),n??null,i);let s=oe(this,kn).get(t);s!=null&&(s=s.filter(({callback:o})=>o!==n),oe(this,kn).set(t,s))}dispatchEvent(t){const n=super.dispatchEvent(t);let i=oe(this,kn).get(t.type);return i==null||(i=i.filter(({once:s})=>!s),oe(this,kn).set(t.type,i)),n}safeDispatchEvent(t,n={}){return this.dispatchEvent(new CustomEvent(t,n))}}kn=new WeakMap;function q3(r){return r!=null&&typeof r.start=="function"&&typeof r.stop=="function"}async function Mu(...r){const e=[];for(const t of r)q3(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStart!=null&&await t.beforeStart()})),await Promise.all(e.map(async t=>{await t.start()})),await Promise.all(e.map(async t=>{t.afterStart!=null&&await t.afterStart()}))}async function K3(...r){const e=[];for(const t of r)q3(t)&&e.push(t);await Promise.all(e.map(async t=>{t.beforeStop!=null&&await t.beforeStop()})),await Promise.all(e.map(async t=>{await t.stop()})),await Promise.all(e.map(async t=>{t.afterStop!=null&&await t.afterStop()}))}const Xr=Symbol.for("@libp2p/service-capabilities"),Uu=Symbol.for("@libp2p/service-dependencies");function xx(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function gh(r){if(r instanceof Uint8Array&&r.constructor.name==="Uint8Array")return r;if(r instanceof ArrayBuffer)return new Uint8Array(r);if(ArrayBuffer.isView(r))return new Uint8Array(r.buffer,r.byteOffset,r.byteLength);throw new Error("Unknown type, must be binary type")}function Ax(r){return new TextEncoder().encode(r)}function _x(r){return new TextDecoder().decode(r)}function Ix(r,e){if(r.length>=255)throw new TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var i=0;i<r.length;i++){var s=r.charAt(i),o=s.charCodeAt(0);if(t[o]!==255)throw new TypeError(s+" is ambiguous");t[o]=i}var a=r.length,c=r.charAt(0),l=Math.log(a)/Math.log(256),u=Math.log(256)/Math.log(a);function f(w){if(w instanceof Uint8Array||(ArrayBuffer.isView(w)?w=new Uint8Array(w.buffer,w.byteOffset,w.byteLength):Array.isArray(w)&&(w=Uint8Array.from(w))),!(w instanceof Uint8Array))throw new TypeError("Expected Uint8Array");if(w.length===0)return"";for(var x=0,v=0,C=0,N=w.length;C!==N&&w[C]===0;)C++,x++;for(var O=(N-C)*u+1>>>0,L=new Uint8Array(O);C!==N;){for(var R=w[C],F=0,K=O-1;(R!==0||F<v)&&K!==-1;K--,F++)R+=256*L[K]>>>0,L[K]=R%a>>>0,R=R/a>>>0;if(R!==0)throw new Error("Non-zero carry");v=F,C++}for(var H=O-v;H!==O&&L[H]===0;)H++;for(var P=c.repeat(x);H<O;++H)P+=r.charAt(L[H]);return P}function g(w){if(typeof w!="string")throw new TypeError("Expected String");if(w.length===0)return new Uint8Array;var x=0;if(w[x]!==" "){for(var v=0,C=0;w[x]===c;)v++,x++;for(var N=(w.length-x)*l+1>>>0,O=new Uint8Array(N);w[x];){var L=t[w.charCodeAt(x)];if(L===255)return;for(var R=0,F=N-1;(L!==0||R<C)&&F!==-1;F--,R++)L+=a*O[F]>>>0,O[F]=L%256>>>0,L=L/256>>>0;if(L!==0)throw new Error("Non-zero carry");C=R,x++}if(w[x]!==" "){for(var K=N-C;K!==N&&O[K]===0;)K++;for(var H=new Uint8Array(v+(N-K)),P=v;K!==N;)H[P++]=O[K++];return H}}}function m(w){var x=g(w);if(x)return x;throw new Error(`Non-${e} character`)}return{encode:f,decodeUnsafe:g,decode:m}}var Cx=Ix,kx=Cx;class Tx{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseEncode");this.name=e,this.prefix=t,this.baseEncode=n}encode(e){if(e instanceof Uint8Array)return`${this.prefix}${this.baseEncode(e)}`;throw Error("Unknown type, must be binary type")}}let Px=class{constructor(e,t,n){h(this,"name");h(this,"prefix");h(this,"baseDecode");h(this,"prefixCodePoint");this.name=e,this.prefix=t;const i=t.codePointAt(0);if(i===void 0)throw new Error("Invalid prefix character");this.prefixCodePoint=i,this.baseDecode=n}decode(e){if(typeof e=="string"){if(e.codePointAt(0)!==this.prefixCodePoint)throw Error(`Unable to decode multibase string ${JSON.stringify(e)}, ${this.name} decoder only supports inputs prefixed with ${this.prefix}`);return this.baseDecode(e.slice(this.prefix.length))}else throw Error("Can only multibase decode strings")}or(e){return q9(this,e)}};class Bx{constructor(e){h(this,"decoders");this.decoders=e}or(e){return q9(this,e)}decode(e){const t=e[0],n=this.decoders[t];if(n!=null)return n.decode(e);throw RangeError(`Unable to decode multibase string ${JSON.stringify(e)}, only inputs prefixed with ${Object.keys(this.decoders)} are supported`)}}function q9(r,e){return new Bx({...r.decoders??{[r.prefix]:r},...e.decoders??{[e.prefix]:e}})}class Nx{constructor(e,t,n,i){h(this,"name");h(this,"prefix");h(this,"baseEncode");h(this,"baseDecode");h(this,"encoder");h(this,"decoder");this.name=e,this.prefix=t,this.baseEncode=n,this.baseDecode=i,this.encoder=new Tx(e,t,n),this.decoder=new Px(e,t,i)}encode(e){return this.encoder.encode(e)}decode(e){return this.decoder.decode(e)}}function mh({name:r,prefix:e,encode:t,decode:n}){return new Nx(r,e,t,n)}function Jc({name:r,prefix:e,alphabet:t}){const{encode:n,decode:i}=kx(t,r);return mh({prefix:e,name:r,encode:n,decode:s=>gh(i(s))})}function Ox(r,e,t,n){let i=r.length;for(;r[i-1]==="=";)--i;const s=new Uint8Array(i*t/8|0);let o=0,a=0,c=0;for(let l=0;l<i;++l){const u=e[r[l]];if(u===void 0)throw new SyntaxError(`Non-${n} character`);a=a<<t|u,o+=t,o>=8&&(o-=8,s[c++]=255&a>>o)}if(o>=t||(255&a<<8-o)!==0)throw new SyntaxError("Unexpected end of data");return s}function Rx(r,e,t){const n=e[e.length-1]==="=",i=(1<<t)-1;let s="",o=0,a=0;for(let c=0;c<r.length;++c)for(a=a<<8|r[c],o+=8;o>t;)o-=t,s+=e[i&a>>o];if(o!==0&&(s+=e[i&a<<t-o]),n)for(;(s.length*t&7)!==0;)s+="=";return s}function Dx(r){const e={};for(let t=0;t<r.length;++t)e[r[t]]=t;return e}function Yt({name:r,prefix:e,bitsPerChar:t,alphabet:n}){const i=Dx(n);return mh({prefix:e,name:r,encode(s){return Rx(s,n,t)},decode(s){return Ox(s,i,t,r)}})}const Rt=Jc({name:"base58btc",prefix:"z",alphabet:"123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz"}),Lx=Jc({name:"base58flickr",prefix:"Z",alphabet:"123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ"}),Mx=Object.freeze(Object.defineProperty({__proto__:null,base58btc:Rt,base58flickr:Lx},Symbol.toStringTag,{value:"Module"})),Fi=Yt({prefix:"b",name:"base32",alphabet:"abcdefghijklmnopqrstuvwxyz234567",bitsPerChar:5}),Ux=Yt({prefix:"B",name:"base32upper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567",bitsPerChar:5}),Fx=Yt({prefix:"c",name:"base32pad",alphabet:"abcdefghijklmnopqrstuvwxyz234567=",bitsPerChar:5}),$x=Yt({prefix:"C",name:"base32padupper",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZ234567=",bitsPerChar:5}),Vx=Yt({prefix:"v",name:"base32hex",alphabet:"0123456789abcdefghijklmnopqrstuv",bitsPerChar:5}),qx=Yt({prefix:"V",name:"base32hexupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV",bitsPerChar:5}),Kx=Yt({prefix:"t",name:"base32hexpad",alphabet:"0123456789abcdefghijklmnopqrstuv=",bitsPerChar:5}),Hx=Yt({prefix:"T",name:"base32hexpadupper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUV=",bitsPerChar:5}),jx=Yt({prefix:"h",name:"base32z",alphabet:"ybndrfg8ejkmcpqxot1uwisza345h769",bitsPerChar:5}),zx=Object.freeze(Object.defineProperty({__proto__:null,base32:Fi,base32hex:Vx,base32hexpad:Kx,base32hexpadupper:Hx,base32hexupper:qx,base32pad:Fx,base32padupper:$x,base32upper:Ux,base32z:jx},Symbol.toStringTag,{value:"Module"})),du=Jc({prefix:"k",name:"base36",alphabet:"0123456789abcdefghijklmnopqrstuvwxyz"}),Wx=Jc({prefix:"K",name:"base36upper",alphabet:"0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ"}),Gx=Object.freeze(Object.defineProperty({__proto__:null,base36:du,base36upper:Wx},Symbol.toStringTag,{value:"Module"}));var Qx=K9,Xp=128,Yx=-128,Zx=Math.pow(2,31);function K9(r,e,t){e=e||[],t=t||0;for(var n=t;r>=Zx;)e[t++]=r&255|Xp,r/=128;for(;r&Yx;)e[t++]=r&255|Xp,r>>>=7;return e[t]=r|0,K9.bytes=t-n+1,e}var Xx=f0,Jx=128,Jp=127;function f0(r,n){var t=0,n=n||0,i=0,s=n,o,a=r.length;do{if(s>=a)throw f0.bytes=0,new RangeError("Could not decode varint");o=r[s++],t+=i<28?(o&Jp)<<i:(o&Jp)*Math.pow(2,i),i+=7}while(o>=Jx);return f0.bytes=s-n,t}var eA=Math.pow(2,7),tA=Math.pow(2,14),rA=Math.pow(2,21),nA=Math.pow(2,28),iA=Math.pow(2,35),sA=Math.pow(2,42),oA=Math.pow(2,49),aA=Math.pow(2,56),cA=Math.pow(2,63),lA=function(r){return r<eA?1:r<tA?2:r<rA?3:r<nA?4:r<iA?5:r<sA?6:r<oA?7:r<aA?8:r<cA?9:10},uA={encode:Qx,decode:Xx,encodingLength:lA},Fu=uA;function d0(r,e=0){return[Fu.decode(r,e),Fu.decode.bytes]}function $u(r,e,t=0){return Fu.encode(r,e,t),e}function Vu(r){return Fu.encodingLength(r)}function ji(r,e){const t=e.byteLength,n=Vu(r),i=n+Vu(t),s=new Uint8Array(i+t);return $u(r,s,0),$u(t,s,n),s.set(e,i),new H3(r,t,e,s)}function $r(r){const e=gh(r),[t,n]=d0(e),[i,s]=d0(e.subarray(n)),o=e.subarray(n+s);if(o.byteLength!==i)throw new Error("Incorrect length");return new H3(t,i,o,e)}function hA(r,e){if(r===e)return!0;{const t=e;return r.code===t.code&&r.size===t.size&&t.bytes instanceof Uint8Array&&xx(r.bytes,t.bytes)}}class H3{constructor(e,t,n,i){h(this,"code");h(this,"size");h(this,"digest");h(this,"bytes");this.code=e,this.size=t,this.digest=n,this.bytes=i}}function e6(r,e){const{bytes:t,version:n}=r;switch(n){case 0:return dA(t,p0(r),e??Rt.encoder);default:return pA(t,p0(r),e??Fi.encoder)}}const t6=new WeakMap;function p0(r){const e=t6.get(r);if(e==null){const t=new Map;return t6.set(r,t),t}return e}var Rg;class it{constructor(e,t,n,i){h(this,"code");h(this,"version");h(this,"multihash");h(this,"bytes");h(this,"/");h(this,Rg,"CID");this.code=t,this.version=e,this.multihash=n,this.bytes=i,this["/"]=i}get asCID(){return this}get byteOffset(){return this.bytes.byteOffset}get byteLength(){return this.bytes.byteLength}toV0(){switch(this.version){case 0:return this;case 1:{const{code:e,multihash:t}=this;if(e!==Ta)throw new Error("Cannot convert a non dag-pb CID to CIDv0");if(t.code!==gA)throw new Error("Cannot convert non sha2-256 multihash CID to CIDv0");return it.createV0(t)}default:throw Error(`Can not convert CID version ${this.version} to version 0. This is a bug please report`)}}toV1(){switch(this.version){case 0:{const{code:e,digest:t}=this.multihash,n=ji(e,t);return it.createV1(this.code,n)}case 1:return this;default:throw Error(`Can not convert CID version ${this.version} to version 1. This is a bug please report`)}}equals(e){return it.equals(this,e)}static equals(e,t){const n=t;return n!=null&&e.code===n.code&&e.version===n.version&&hA(e.multihash,n.multihash)}toString(e){return e6(this,e)}toJSON(){return{"/":e6(this)}}link(){return this}[(Rg=Symbol.toStringTag,Symbol.for("nodejs.util.inspect.custom"))](){return`CID(${this.toString()})`}static asCID(e){if(e==null)return null;const t=e;if(t instanceof it)return t;if(t["/"]!=null&&t["/"]===t.bytes||t.asCID===t){const{version:n,code:i,multihash:s,bytes:o}=t;return new it(n,i,s,o??r6(n,i,s.bytes))}else if(t[mA]===!0){const{version:n,multihash:i,code:s}=t,o=$r(i);return it.create(n,s,o)}else return null}static create(e,t,n){if(typeof t!="number")throw new Error("String codecs are no longer supported");if(!(n.bytes instanceof Uint8Array))throw new Error("Invalid digest");switch(e){case 0:{if(t!==Ta)throw new Error(`Version 0 CID must use dag-pb (code: ${Ta}) block encoding`);return new it(e,t,n,n.bytes)}case 1:{const i=r6(e,t,n.bytes);return new it(e,t,n,i)}default:throw new Error("Invalid version")}}static createV0(e){return it.create(0,Ta,e)}static createV1(e,t){return it.create(1,e,t)}static decode(e){const[t,n]=it.decodeFirst(e);if(n.length!==0)throw new Error("Incorrect length");return t}static decodeFirst(e){const t=it.inspectBytes(e),n=t.size-t.multihashSize,i=gh(e.subarray(n,n+t.multihashSize));if(i.byteLength!==t.multihashSize)throw new Error("Incorrect length");const s=i.subarray(t.multihashSize-t.digestSize),o=new H3(t.multihashCode,t.digestSize,s,i);return[t.version===0?it.createV0(o):it.createV1(t.codec,o),e.subarray(t.size)]}static inspectBytes(e){let t=0;const n=()=>{const[f,g]=d0(e.subarray(t));return t+=g,f};let i=n(),s=Ta;if(i===18?(i=0,t=0):s=n(),i!==0&&i!==1)throw new RangeError(`Invalid CID version ${i}`);const o=t,a=n(),c=n(),l=t+c,u=l-o;return{version:i,codec:s,multihashCode:a,digestSize:c,multihashSize:u,size:l}}static parse(e,t){const[n,i]=fA(e,t),s=it.decode(i);if(s.version===0&&e[0]!=="Q")throw Error("Version 0 CID string must not include multibase prefix");return p0(s).set(n,e),s}}function fA(r,e){switch(r[0]){case"Q":{const t=e??Rt;return[Rt.prefix,t.decode(`${Rt.prefix}${r}`)]}case Rt.prefix:{const t=e??Rt;return[Rt.prefix,t.decode(r)]}case Fi.prefix:{const t=e??Fi;return[Fi.prefix,t.decode(r)]}case du.prefix:{const t=e??du;return[du.prefix,t.decode(r)]}default:{if(e==null)throw Error("To parse non base32, base36 or base58btc encoded CID multibase decoder must be provided");return[r[0],e.decode(r)]}}}function dA(r,e,t){const{prefix:n}=t;if(n!==Rt.prefix)throw Error(`Cannot string encode V0 in ${t.name} encoding`);const i=e.get(n);if(i==null){const s=t.encode(r).slice(1);return e.set(n,s),s}else return i}function pA(r,e,t){const{prefix:n}=t,i=e.get(n);if(i==null){const s=t.encode(r);return e.set(n,s),s}else return i}const Ta=112,gA=18;function r6(r,e,t){const n=Vu(r),i=n+Vu(e),s=new Uint8Array(i+t.byteLength);return $u(r,s,0),$u(e,s,n),s.set(t,i),s}const mA=Symbol.for("@ipld/js-cid/CID"),H9=0,yA="identity",j9=gh;function wA(r){return ji(H9,j9(r))}const el={code:H9,name:yA,encode:j9,digest:wA};function pt(r,e){if(r===e)return!0;if(r.byteLength!==e.byteLength)return!1;for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return!1;return!0}function dt(r=0){return new Uint8Array(r)}function wn(r=0){return new Uint8Array(r)}function Jr(r,e){e==null&&(e=r.reduce((i,s)=>i+s.length,0));const t=wn(e);let n=0;for(const i of r)t.set(i,n),n+=i.length;return t}const z9=Symbol.for("@achingbrain/uint8arraylist");function n6(r,e){if(e==null||e<0)throw new RangeError("index is out of bounds");let t=0;for(const n of r){const i=t+n.byteLength;if(e<i)return{buf:n,index:e-t};t=i}throw new RangeError("index is out of bounds")}function Ol(r){return!!(r!=null&&r[z9])}var Dg;class je{constructor(...e){h(this,"bufs");h(this,"length");h(this,Dg,!0);this.bufs=[],this.length=0,e.length>0&&this.appendAll(e)}*[(Dg=z9,Symbol.iterator)](){yield*this.bufs}get byteLength(){return this.length}append(...e){this.appendAll(e)}appendAll(e){let t=0;for(const n of e)if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.push(n);else if(Ol(n))t+=n.byteLength,this.bufs.push(...n.bufs);else throw new Error("Could not append value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}prepend(...e){this.prependAll(e)}prependAll(e){let t=0;for(const n of e.reverse())if(n instanceof Uint8Array)t+=n.byteLength,this.bufs.unshift(n);else if(Ol(n))t+=n.byteLength,this.bufs.unshift(...n.bufs);else throw new Error("Could not prepend value, must be an Uint8Array or a Uint8ArrayList");this.length+=t}get(e){const t=n6(this.bufs,e);return t.buf[t.index]}set(e,t){const n=n6(this.bufs,e);n.buf[n.index]=t}write(e,t=0){if(e instanceof Uint8Array)for(let n=0;n<e.length;n++)this.set(t+n,e[n]);else if(Ol(e))for(let n=0;n<e.length;n++)this.set(t+n,e.get(n));else throw new Error("Could not write value, must be an Uint8Array or a Uint8ArrayList")}consume(e){if(e=Math.trunc(e),!(Number.isNaN(e)||e<=0)){if(e===this.byteLength){this.bufs=[],this.length=0;return}for(;this.bufs.length>0;)if(e>=this.bufs[0].byteLength)e-=this.bufs[0].byteLength,this.length-=this.bufs[0].byteLength,this.bufs.shift();else{this.bufs[0]=this.bufs[0].subarray(e),this.length-=e;break}}}slice(e,t){const{bufs:n,length:i}=this._subList(e,t);return Jr(n,i)}subarray(e,t){const{bufs:n,length:i}=this._subList(e,t);return n.length===1?n[0]:Jr(n,i)}sublist(e,t){const{bufs:n,length:i}=this._subList(e,t),s=new je;return s.length=i,s.bufs=[...n],s}_subList(e,t){if(e=e??0,t=t??this.length,e<0&&(e=this.length+e),t<0&&(t=this.length+t),e<0||t>this.length)throw new RangeError("index is out of bounds");if(e===t)return{bufs:[],length:0};if(e===0&&t===this.length)return{bufs:this.bufs,length:this.length};const n=[];let i=0;for(let s=0;s<this.bufs.length;s++){const o=this.bufs[s],a=i,c=a+o.byteLength;if(i=c,e>=c)continue;const l=e>=a&&e<c,u=t>a&&t<=c;if(l&&u){if(e===a&&t===c){n.push(o);break}const f=e-a;n.push(o.subarray(f,f+(t-e)));break}if(l){if(e===0){n.push(o);continue}n.push(o.subarray(e-a));continue}if(u){if(t===c){n.push(o);break}n.push(o.subarray(0,t-a));break}n.push(o)}return{bufs:n,length:t-e}}indexOf(e,t=0){if(!Ol(e)&&!(e instanceof Uint8Array))throw new TypeError('The "value" argument must be a Uint8ArrayList or Uint8Array');const n=e instanceof Uint8Array?e:e.subarray();if(t=Number(t??0),isNaN(t)&&(t=0),t<0&&(t=this.length+t),t<0&&(t=0),e.length===0)return t>this.length?this.length:t;const i=n.byteLength;if(i===0)throw new TypeError("search must be at least 1 byte long");const s=256,o=new Int32Array(s);for(let f=0;f<s;f++)o[f]=-1;for(let f=0;f<i;f++)o[n[f]]=f;const a=o,c=this.byteLength-n.byteLength,l=n.byteLength-1;let u;for(let f=t;f<=c;f+=u){u=0;for(let g=l;g>=0;g--){const m=this.get(f+g);if(n[g]!==m){u=Math.max(1,g-a[m]);break}}if(u===0)return f}return-1}getInt8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getInt8(0)}setInt8(e,t){const n=wn(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setInt8(0,t),this.write(n,e)}getInt16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt16(0,t)}setInt16(e,t,n){const i=dt(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt16(0,t,n),this.write(i,e)}getInt32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getInt32(0,t)}setInt32(e,t,n){const i=dt(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setInt32(0,t,n),this.write(i,e)}getBigInt64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigInt64(0,t)}setBigInt64(e,t,n){const i=dt(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigInt64(0,t,n),this.write(i,e)}getUint8(e){const t=this.subarray(e,e+1);return new DataView(t.buffer,t.byteOffset,t.byteLength).getUint8(0)}setUint8(e,t){const n=wn(1);new DataView(n.buffer,n.byteOffset,n.byteLength).setUint8(0,t),this.write(n,e)}getUint16(e,t){const n=this.subarray(e,e+2);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint16(0,t)}setUint16(e,t,n){const i=dt(2);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint16(0,t,n),this.write(i,e)}getUint32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getUint32(0,t)}setUint32(e,t,n){const i=dt(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setUint32(0,t,n),this.write(i,e)}getBigUint64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getBigUint64(0,t)}setBigUint64(e,t,n){const i=dt(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setBigUint64(0,t,n),this.write(i,e)}getFloat32(e,t){const n=this.subarray(e,e+4);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat32(0,t)}setFloat32(e,t,n){const i=dt(4);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat32(0,t,n),this.write(i,e)}getFloat64(e,t){const n=this.subarray(e,e+8);return new DataView(n.buffer,n.byteOffset,n.byteLength).getFloat64(0,t)}setFloat64(e,t,n){const i=dt(8);new DataView(i.buffer,i.byteOffset,i.byteLength).setFloat64(0,t,n),this.write(i,e)}equals(e){if(e==null||!(e instanceof je)||e.bufs.length!==this.bufs.length)return!1;for(let t=0;t<this.bufs.length;t++)if(!pt(this.bufs[t],e.bufs[t]))return!1;return!0}static fromUint8Arrays(e,t){const n=new je;return n.bufs=e,t==null&&(t=e.reduce((i,s)=>i+s.byteLength,0)),n.length=t,n}}const bA=Jc({prefix:"9",name:"base10",alphabet:"0123456789"}),vA=Object.freeze(Object.defineProperty({__proto__:null,base10:bA},Symbol.toStringTag,{value:"Module"})),SA=Yt({prefix:"f",name:"base16",alphabet:"0123456789abcdef",bitsPerChar:4}),EA=Yt({prefix:"F",name:"base16upper",alphabet:"0123456789ABCDEF",bitsPerChar:4}),xA=Object.freeze(Object.defineProperty({__proto__:null,base16:SA,base16upper:EA},Symbol.toStringTag,{value:"Module"})),AA=Yt({prefix:"0",name:"base2",alphabet:"01",bitsPerChar:1}),_A=Object.freeze(Object.defineProperty({__proto__:null,base2:AA},Symbol.toStringTag,{value:"Module"})),W9=Array.from("🚀🪐☄🛰🌌🌑🌒🌓🌔🌕🌖🌗🌘🌍🌏🌎🐉☀💻🖥💾💿😂❤😍🤣😊🙏💕😭😘👍😅👏😁🔥🥰💔💖💙😢🤔😆🙄💪😉☺👌🤗💜😔😎😇🌹🤦🎉💞✌✨🤷😱😌🌸🙌😋💗💚😏💛🙂💓🤩😄😀🖤😃💯🙈👇🎶😒🤭❣😜💋👀😪😑💥🙋😞😩😡🤪👊🥳😥🤤👉💃😳✋😚😝😴🌟😬🙃🍀🌷😻😓⭐✅🥺🌈😈🤘💦✔😣🏃💐☹🎊💘😠☝😕🌺🎂🌻😐🖕💝🙊😹🗣💫💀👑🎵🤞😛🔴😤🌼😫⚽🤙☕🏆🤫👈😮🙆🍻🍃🐶💁😲🌿🧡🎁⚡🌞🎈❌✊👋😰🤨😶🤝🚶💰🍓💢🤟🙁🚨💨🤬✈🎀🍺🤓😙💟🌱😖👶🥴▶➡❓💎💸⬇😨🌚🦋😷🕺⚠🙅😟😵👎🤲🤠🤧📌🔵💅🧐🐾🍒😗🤑🌊🤯🐷☎💧😯💆👆🎤🙇🍑❄🌴💣🐸💌📍🥀🤢👅💡💩👐📸👻🤐🤮🎼🥵🚩🍎🍊👼💍📣🥂"),IA=W9.reduce((r,e,t)=>(r[t]=e,r),[]),CA=W9.reduce((r,e,t)=>{const n=e.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${e}`);return r[n]=t,r},[]);function kA(r){return r.reduce((e,t)=>(e+=IA[t],e),"")}function TA(r){const e=[];for(const t of r){const n=t.codePointAt(0);if(n==null)throw new Error(`Invalid character: ${t}`);const i=CA[n];if(i==null)throw new Error(`Non-base256emoji character: ${t}`);e.push(i)}return new Uint8Array(e)}const PA=mh({prefix:"🚀",name:"base256emoji",encode:kA,decode:TA}),BA=Object.freeze(Object.defineProperty({__proto__:null,base256emoji:PA},Symbol.toStringTag,{value:"Module"})),G9=Yt({prefix:"m",name:"base64",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",bitsPerChar:6}),NA=Yt({prefix:"M",name:"base64pad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",bitsPerChar:6}),tl=Yt({prefix:"u",name:"base64url",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_",bitsPerChar:6}),OA=Yt({prefix:"U",name:"base64urlpad",alphabet:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_=",bitsPerChar:6}),RA=Object.freeze(Object.defineProperty({__proto__:null,base64:G9,base64pad:NA,base64url:tl,base64urlpad:OA},Symbol.toStringTag,{value:"Module"})),DA=Yt({prefix:"7",name:"base8",alphabet:"01234567",bitsPerChar:3}),LA=Object.freeze(Object.defineProperty({__proto__:null,base8:DA},Symbol.toStringTag,{value:"Module"})),MA=mh({prefix:"\0",name:"identity",encode:r=>_x(r),decode:r=>Ax(r)}),UA=Object.freeze(Object.defineProperty({__proto__:null,identity:MA},Symbol.toStringTag,{value:"Module"}));new TextEncoder;new TextDecoder;const FA=85;function $A({name:r,code:e,encode:t}){return new VA(r,e,t)}class VA{constructor(e,t,n){h(this,"name");h(this,"code");h(this,"encode");this.name=e,this.code=t,this.encode=n}digest(e){if(e instanceof Uint8Array){const t=this.encode(e);return t instanceof Uint8Array?ji(this.code,t):t.then(n=>ji(this.code,n))}else throw Error("Unknown type, must be binary type")}}function qA(r){return async e=>new Uint8Array(await crypto.subtle.digest(r,e))}const wi=$A({name:"sha2-256",code:18,encode:qA("SHA-256")}),qu={...UA,..._A,...LA,...vA,...xA,...zx,...Gx,...Mx,...RA,...BA};function Q9(r,e,t,n){return{name:r,prefix:e,encoder:{name:r,prefix:e,encode:t},decoder:{decode:n}}}const i6=Q9("utf8","u",r=>"u"+new TextDecoder("utf8").decode(r),r=>new TextEncoder().encode(r.substring(1))),Kf=Q9("ascii","a",r=>{let e="a";for(let t=0;t<r.length;t++)e+=String.fromCharCode(r[t]);return e},r=>{r=r.substring(1);const e=wn(r.length);for(let t=0;t<r.length;t++)e[t]=r.charCodeAt(t);return e}),Y9={utf8:i6,"utf-8":i6,hex:qu.base16,latin1:Kf,ascii:Kf,binary:Kf,...qu};function Ae(r,e="utf8"){const t=Y9[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.decoder.decode(`${t.prefix}${r}`)}function Be(r,e="utf8"){const t=Y9[e];if(t==null)throw new Error(`Unsupported encoding "${e}"`);return t.encoder.encode(r).substring(1)}const KA=parseInt("11111",2),g0=parseInt("10000000",2),HA=parseInt("01111111",2),s6={0:Pa,1:Pa,2:jA,3:GA,4:QA,5:WA,6:zA,16:Pa,22:Pa,48:Pa};function yh(r,e={offset:0}){const t=r[e.offset]&KA;if(e.offset++,s6[t]!=null)return s6[t](r,e);throw new Error("No decoder for tag "+t)}function rl(r,e){let t=0;if((r[e.offset]&g0)===g0){const n=r[e.offset]&HA;let i="0x";e.offset++;for(let s=0;s<n;s++,e.offset++)i+=r[e.offset].toString(16).padStart(2,"0");t=parseInt(i,16)}else t=r[e.offset],e.offset++;return t}function Pa(r,e){rl(r,e);const t=[];for(;!(e.offset>=r.byteLength);){const n=yh(r,e);if(n===null)break;t.push(n)}return t}function jA(r,e){const t=rl(r,e),n=e.offset,i=e.offset+t,s=[];for(let o=n;o<i;o++)o===n&&r[o]===0||s.push(r[o]);return e.offset+=t,Uint8Array.from(s)}function zA(r,e){const t=rl(r,e),n=e.offset+t,i=r[e.offset];e.offset++;let s=0,o=0;i<40?(s=0,o=i):i<80?(s=1,o=i-40):(s=2,o=i-80);let a=`${s}.${o}`,c=[];for(;e.offset<n;){const l=r[e.offset];if(e.offset++,c.push(l&127),l<128){c.reverse();let u=0;for(let f=0;f<c.length;f++)u+=c[f]<<f*7;a+=`.${u}`,c=[]}}return a}function WA(r,e){return e.offset++,null}function GA(r,e){const t=rl(r,e),n=r[e.offset];e.offset++;const i=r.subarray(e.offset,e.offset+t-1);if(e.offset+=t,n!==0)throw new Error("Unused bits in bit string is unimplemented");return i}function QA(r,e){const t=rl(r,e),n=r.subarray(e.offset,e.offset+t);return e.offset+=t,n}function YA(r){let e=r.toString(16);e.length%2===1&&(e="0"+e);const t=new je;for(let n=0;n<e.length;n+=2)t.append(Uint8Array.from([parseInt(`${e[n]}${e[n+1]}`,16)]));return t}function wh(r){if(r.byteLength<128)return Uint8Array.from([r.byteLength]);const e=YA(r.byteLength);return new je(Uint8Array.from([e.byteLength|g0]),e)}function Or(r){const e=new je,t=128;return(r.subarray()[0]&t)===t&&e.append(Uint8Array.from([0])),e.append(r),new je(Uint8Array.from([2]),wh(e),e)}function j3(r){const e=Uint8Array.from([0]),t=new je(e,r);return new je(Uint8Array.from([3]),wh(t),t)}function ZA(r){return new je(Uint8Array.from([4]),wh(r),r)}function ti(r,e=48){const t=new je;for(const n of r)t.append(n);return new je(Uint8Array.from([e]),wh(t),t)}async function XA(r="P-256"){const e=await crypto.subtle.generateKey({name:"ECDSA",namedCurve:r},!0,["sign","verify"]);return{publicKey:await crypto.subtle.exportKey("jwk",e.publicKey),privateKey:await crypto.subtle.exportKey("jwk",e.privateKey)}}async function JA(r,e,t){var s,o;const n=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["sign"]);(s=t==null?void 0:t.signal)==null||s.throwIfAborted();const i=await crypto.subtle.sign({name:"ECDSA",hash:{name:"SHA-256"}},n,e.subarray());return(o=t==null?void 0:t.signal)==null||o.throwIfAborted(),new Uint8Array(i,0,i.byteLength)}async function e_(r,e,t,n){var o,a;const i=await crypto.subtle.importKey("jwk",r,{name:"ECDSA",namedCurve:r.crv??"P-256"},!1,["verify"]);(o=n==null?void 0:n.signal)==null||o.throwIfAborted();const s=await crypto.subtle.verify({name:"ECDSA",hash:{name:"SHA-256"}},i,e,t.subarray());return(a=n==null?void 0:n.signal)==null||a.throwIfAborted(),s}const t_=Uint8Array.from([6,8,42,134,72,206,61,3,1,7]),r_=Uint8Array.from([6,5,43,129,4,0,34]),n_=Uint8Array.from([6,5,43,129,4,0,35]),i_={ext:!0,kty:"EC",crv:"P-256"},s_={ext:!0,kty:"EC",crv:"P-384"},o_={ext:!0,kty:"EC",crv:"P-521"},Hf=32,jf=48,zf=66;function Z9(r){const e=yh(r);return a_(e)}function a_(r){const e=r[1][1][0],t=1;let n,i;if(e.byteLength===Hf*2+1)return n=Be(e.subarray(t,t+Hf),"base64url"),i=Be(e.subarray(t+Hf),"base64url"),new pu({...i_,key_ops:["verify"],x:n,y:i});if(e.byteLength===jf*2+1)return n=Be(e.subarray(t,t+jf),"base64url"),i=Be(e.subarray(t+jf),"base64url"),new pu({...s_,key_ops:["verify"],x:n,y:i});if(e.byteLength===zf*2+1)return n=Be(e.subarray(t,t+zf),"base64url"),i=Be(e.subarray(t+zf),"base64url"),new pu({...o_,key_ops:["verify"],x:n,y:i});throw new ke(`coordinates were wrong length, got ${e.byteLength}, expected 65, 97 or 133`)}function c_(r){return ti([Or(Uint8Array.from([1])),ZA(Ae(r.d??"","base64url")),ti([X9(r.crv)],160),ti([j3(new je(Uint8Array.from([4]),Ae(r.x??"","base64url"),Ae(r.y??"","base64url")))],161)]).subarray()}function l_(r){return ti([Or(Uint8Array.from([1])),ti([X9(r.crv)],160),ti([j3(new je(Uint8Array.from([4]),Ae(r.x??"","base64url"),Ae(r.y??"","base64url")))],161)]).subarray()}function X9(r){if(r==="P-256")return t_;if(r==="P-384")return r_;if(r==="P-521")return n_;throw new ke(`Invalid curve ${r}`)}async function u_(r="P-256"){const e=await XA(r);return new h_(e.privateKey)}class pu{constructor(e){h(this,"type","ECDSA");h(this,"jwk");h(this,"_raw");this.jwk=e}get raw(){return this._raw==null&&(this._raw=l_(this.jwk)),this._raw}toMultihash(){return el.digest(Yr(this))}toCID(){return it.createV1(114,this.toMultihash())}toString(){return Rt.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:pt(this.raw,e.raw)}async verify(e,t,n){return e_(this.jwk,t,e,n)}}class h_{constructor(e){h(this,"type","ECDSA");h(this,"jwk");h(this,"publicKey");h(this,"_raw");this.jwk=e,this.publicKey=new pu({crv:e.crv,ext:e.ext,key_ops:["verify"],kty:"EC",x:e.x,y:e.y})}get raw(){return this._raw==null&&(this._raw=c_(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:pt(this.raw,e.raw)}async sign(e,t){return JA(this.jwk,e,t)}}const Ys=typeof globalThis=="object"&&"crypto"in globalThis?globalThis.crypto:void 0;/*! noble-hashes - MIT License (c) 2022 Paul Miller (paulmillr.com) */function z3(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function Ku(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Un(r,...e){if(!z3(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function W3(r){if(typeof r!="function"||typeof r.create!="function")throw new Error("Hash should be wrapped by utils.createHasher");Ku(r.outputLen),Ku(r.blockLen)}function Hu(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function f_(r,e){Un(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function Es(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function Wf(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}function xn(r,e){return r<<32-e|r>>>e}const J9=typeof Uint8Array.from([]).toHex=="function"&&typeof Uint8Array.fromHex=="function",d_=Array.from({length:256},(r,e)=>e.toString(16).padStart(2,"0"));function Do(r){if(Un(r),J9)return r.toHex();let e="";for(let t=0;t<r.length;t++)e+=d_[r[t]];return e}const Hn={_0:48,_9:57,A:65,F:70,a:97,f:102};function o6(r){if(r>=Hn._0&&r<=Hn._9)return r-Hn._0;if(r>=Hn.A&&r<=Hn.F)return r-(Hn.A-10);if(r>=Hn.a&&r<=Hn.f)return r-(Hn.a-10)}function G3(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);if(J9)return Uint8Array.fromHex(r);const e=r.length,t=e/2;if(e%2)throw new Error("hex string expected, got unpadded hex of length "+e);const n=new Uint8Array(t);for(let i=0,s=0;i<t;i++,s+=2){const o=o6(r.charCodeAt(s)),a=o6(r.charCodeAt(s+1));if(o===void 0||a===void 0){const c=r[s]+r[s+1];throw new Error('hex string expected, got non-hex character "'+c+'" at index '+s)}n[i]=o*16+a}return n}function p_(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function wc(r){return typeof r=="string"&&(r=p_(r)),Un(r),r}function Jn(...r){let e=0;for(let n=0;n<r.length;n++){const i=r[n];Un(i),e+=i.length}const t=new Uint8Array(e);for(let n=0,i=0;n<r.length;n++){const s=r[n];t.set(s,i),i+=s.length}return t}class em{}function tm(r){const e=n=>r().update(wc(n)).digest(),t=r();return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=()=>r(),e}function bh(r=32){if(Ys&&typeof Ys.getRandomValues=="function")return Ys.getRandomValues(new Uint8Array(r));if(Ys&&typeof Ys.randomBytes=="function")return Uint8Array.from(Ys.randomBytes(r));throw new Error("crypto.getRandomValues must be defined")}function g_(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=n?4:0,l=n?0:4;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function m_(r,e,t){return r&e^~r&t}function y_(r,e,t){return r&e^r&t^e&t}class rm extends em{constructor(e,t,n,i){super(),this.finished=!1,this.length=0,this.pos=0,this.destroyed=!1,this.blockLen=e,this.outputLen=t,this.padOffset=n,this.isLE=i,this.buffer=new Uint8Array(e),this.view=Wf(this.buffer)}update(e){Hu(this),e=wc(e),Un(e);const{view:t,buffer:n,blockLen:i}=this,s=e.length;for(let o=0;o<s;){const a=Math.min(i-this.pos,s-o);if(a===i){const c=Wf(e);for(;i<=s-o;o+=i)this.process(c,o);continue}n.set(e.subarray(o,o+a),this.pos),this.pos+=a,o+=a,this.pos===i&&(this.process(t,0),this.pos=0)}return this.length+=e.length,this.roundClean(),this}digestInto(e){Hu(this),f_(e,this),this.finished=!0;const{buffer:t,view:n,blockLen:i,isLE:s}=this;let{pos:o}=this;t[o++]=128,Es(this.buffer.subarray(o)),this.padOffset>i-o&&(this.process(n,0),o=0);for(let f=o;f<i;f++)t[f]=0;g_(n,i-8,BigInt(this.length*8),s),this.process(n,0);const a=Wf(e),c=this.outputLen;if(c%4)throw new Error("_sha2: outputLen should be aligned to 32bit");const l=c/4,u=this.get();if(l>u.length)throw new Error("_sha2: outputLen bigger than state");for(let f=0;f<l;f++)a.setUint32(4*f,u[f],s)}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}_cloneInto(e){e||(e=new this.constructor),e.set(...this.get());const{blockLen:t,buffer:n,length:i,finished:s,destroyed:o,pos:a}=this;return e.destroyed=o,e.finished=s,e.length=i,e.pos=a,i%t&&e.buffer.set(n),e}clone(){return this._cloneInto()}}const xi=Uint32Array.from([1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225]),Zt=Uint32Array.from([1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209]),Rl=BigInt(2**32-1),a6=BigInt(32);function w_(r,e=!1){return e?{h:Number(r&Rl),l:Number(r>>a6&Rl)}:{h:Number(r>>a6&Rl)|0,l:Number(r&Rl)|0}}function b_(r,e=!1){const t=r.length;let n=new Uint32Array(t),i=new Uint32Array(t);for(let s=0;s<t;s++){const{h:o,l:a}=w_(r[s],e);[n[s],i[s]]=[o,a]}return[n,i]}const c6=(r,e,t)=>r>>>t,l6=(r,e,t)=>r<<32-t|e>>>t,Zs=(r,e,t)=>r>>>t|e<<32-t,Xs=(r,e,t)=>r<<32-t|e>>>t,Dl=(r,e,t)=>r<<64-t|e>>>t-32,Ll=(r,e,t)=>r>>>t-32|e<<64-t;function jn(r,e,t,n){const i=(e>>>0)+(n>>>0);return{h:r+t+(i/2**32|0)|0,l:i|0}}const v_=(r,e,t)=>(r>>>0)+(e>>>0)+(t>>>0),S_=(r,e,t,n)=>e+t+n+(r/2**32|0)|0,E_=(r,e,t,n)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0),x_=(r,e,t,n,i)=>e+t+n+i+(r/2**32|0)|0,A_=(r,e,t,n,i)=>(r>>>0)+(e>>>0)+(t>>>0)+(n>>>0)+(i>>>0),__=(r,e,t,n,i,s)=>e+t+n+i+s+(r/2**32|0)|0,I_=Uint32Array.from([1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298]),Ai=new Uint32Array(64);class C_ extends rm{constructor(e=32){super(64,e,8,!1),this.A=xi[0]|0,this.B=xi[1]|0,this.C=xi[2]|0,this.D=xi[3]|0,this.E=xi[4]|0,this.F=xi[5]|0,this.G=xi[6]|0,this.H=xi[7]|0}get(){const{A:e,B:t,C:n,D:i,E:s,F:o,G:a,H:c}=this;return[e,t,n,i,s,o,a,c]}set(e,t,n,i,s,o,a,c){this.A=e|0,this.B=t|0,this.C=n|0,this.D=i|0,this.E=s|0,this.F=o|0,this.G=a|0,this.H=c|0}process(e,t){for(let f=0;f<16;f++,t+=4)Ai[f]=e.getUint32(t,!1);for(let f=16;f<64;f++){const g=Ai[f-15],m=Ai[f-2],w=xn(g,7)^xn(g,18)^g>>>3,x=xn(m,17)^xn(m,19)^m>>>10;Ai[f]=x+Ai[f-7]+w+Ai[f-16]|0}let{A:n,B:i,C:s,D:o,E:a,F:c,G:l,H:u}=this;for(let f=0;f<64;f++){const g=xn(a,6)^xn(a,11)^xn(a,25),m=u+g+m_(a,c,l)+I_[f]+Ai[f]|0,x=(xn(n,2)^xn(n,13)^xn(n,22))+y_(n,i,s)|0;u=l,l=c,c=a,a=o+m|0,o=s,s=i,i=n,n=m+x|0}n=n+this.A|0,i=i+this.B|0,s=s+this.C|0,o=o+this.D|0,a=a+this.E|0,c=c+this.F|0,l=l+this.G|0,u=u+this.H|0,this.set(n,i,s,o,a,c,l,u)}roundClean(){Es(Ai)}destroy(){this.set(0,0,0,0,0,0,0,0),Es(this.buffer)}}const nm=b_(["0x428a2f98d728ae22","0x7137449123ef65cd","0xb5c0fbcfec4d3b2f","0xe9b5dba58189dbbc","0x3956c25bf348b538","0x59f111f1b605d019","0x923f82a4af194f9b","0xab1c5ed5da6d8118","0xd807aa98a3030242","0x12835b0145706fbe","0x243185be4ee4b28c","0x550c7dc3d5ffb4e2","0x72be5d74f27b896f","0x80deb1fe3b1696b1","0x9bdc06a725c71235","0xc19bf174cf692694","0xe49b69c19ef14ad2","0xefbe4786384f25e3","0x0fc19dc68b8cd5b5","0x240ca1cc77ac9c65","0x2de92c6f592b0275","0x4a7484aa6ea6e483","0x5cb0a9dcbd41fbd4","0x76f988da831153b5","0x983e5152ee66dfab","0xa831c66d2db43210","0xb00327c898fb213f","0xbf597fc7beef0ee4","0xc6e00bf33da88fc2","0xd5a79147930aa725","0x06ca6351e003826f","0x142929670a0e6e70","0x27b70a8546d22ffc","0x2e1b21385c26c926","0x4d2c6dfc5ac42aed","0x53380d139d95b3df","0x650a73548baf63de","0x766a0abb3c77b2a8","0x81c2c92e47edaee6","0x92722c851482353b","0xa2bfe8a14cf10364","0xa81a664bbc423001","0xc24b8b70d0f89791","0xc76c51a30654be30","0xd192e819d6ef5218","0xd69906245565a910","0xf40e35855771202a","0x106aa07032bbd1b8","0x19a4c116b8d2d0c8","0x1e376c085141ab53","0x2748774cdf8eeb99","0x34b0bcb5e19b48a8","0x391c0cb3c5c95a63","0x4ed8aa4ae3418acb","0x5b9cca4f7763e373","0x682e6ff3d6b2b8a3","0x748f82ee5defb2fc","0x78a5636f43172f60","0x84c87814a1f0ab72","0x8cc702081a6439ec","0x90befffa23631e28","0xa4506cebde82bde9","0xbef9a3f7b2c67915","0xc67178f2e372532b","0xca273eceea26619c","0xd186b8c721c0c207","0xeada7dd6cde0eb1e","0xf57d4f7fee6ed178","0x06f067aa72176fba","0x0a637dc5a2c898a6","0x113f9804bef90dae","0x1b710b35131c471b","0x28db77f523047d84","0x32caab7b40c72493","0x3c9ebe0a15c9bebc","0x431d67c49c100d4c","0x4cc5d4becb3e42b6","0x597f299cfc657e2a","0x5fcb6fab3ad6faec","0x6c44198c4a475817"].map(r=>BigInt(r))),k_=nm[0],T_=nm[1],_i=new Uint32Array(80),Ii=new Uint32Array(80);class P_ extends rm{constructor(e=64){super(128,e,16,!1),this.Ah=Zt[0]|0,this.Al=Zt[1]|0,this.Bh=Zt[2]|0,this.Bl=Zt[3]|0,this.Ch=Zt[4]|0,this.Cl=Zt[5]|0,this.Dh=Zt[6]|0,this.Dl=Zt[7]|0,this.Eh=Zt[8]|0,this.El=Zt[9]|0,this.Fh=Zt[10]|0,this.Fl=Zt[11]|0,this.Gh=Zt[12]|0,this.Gl=Zt[13]|0,this.Hh=Zt[14]|0,this.Hl=Zt[15]|0}get(){const{Ah:e,Al:t,Bh:n,Bl:i,Ch:s,Cl:o,Dh:a,Dl:c,Eh:l,El:u,Fh:f,Fl:g,Gh:m,Gl:w,Hh:x,Hl:v}=this;return[e,t,n,i,s,o,a,c,l,u,f,g,m,w,x,v]}set(e,t,n,i,s,o,a,c,l,u,f,g,m,w,x,v){this.Ah=e|0,this.Al=t|0,this.Bh=n|0,this.Bl=i|0,this.Ch=s|0,this.Cl=o|0,this.Dh=a|0,this.Dl=c|0,this.Eh=l|0,this.El=u|0,this.Fh=f|0,this.Fl=g|0,this.Gh=m|0,this.Gl=w|0,this.Hh=x|0,this.Hl=v|0}process(e,t){for(let O=0;O<16;O++,t+=4)_i[O]=e.getUint32(t),Ii[O]=e.getUint32(t+=4);for(let O=16;O<80;O++){const L=_i[O-15]|0,R=Ii[O-15]|0,F=Zs(L,R,1)^Zs(L,R,8)^c6(L,R,7),K=Xs(L,R,1)^Xs(L,R,8)^l6(L,R,7),H=_i[O-2]|0,P=Ii[O-2]|0,U=Zs(H,P,19)^Dl(H,P,61)^c6(H,P,6),M=Xs(H,P,19)^Ll(H,P,61)^l6(H,P,6),$=E_(K,M,Ii[O-7],Ii[O-16]),q=x_($,F,U,_i[O-7],_i[O-16]);_i[O]=q|0,Ii[O]=$|0}let{Ah:n,Al:i,Bh:s,Bl:o,Ch:a,Cl:c,Dh:l,Dl:u,Eh:f,El:g,Fh:m,Fl:w,Gh:x,Gl:v,Hh:C,Hl:N}=this;for(let O=0;O<80;O++){const L=Zs(f,g,14)^Zs(f,g,18)^Dl(f,g,41),R=Xs(f,g,14)^Xs(f,g,18)^Ll(f,g,41),F=f&m^~f&x,K=g&w^~g&v,H=A_(N,R,K,T_[O],Ii[O]),P=__(H,C,L,F,k_[O],_i[O]),U=H|0,M=Zs(n,i,28)^Dl(n,i,34)^Dl(n,i,39),$=Xs(n,i,28)^Ll(n,i,34)^Ll(n,i,39),q=n&s^n&a^s&a,G=i&o^i&c^o&c;C=x|0,N=v|0,x=m|0,v=w|0,m=f|0,w=g|0,{h:f,l:g}=jn(l|0,u|0,P|0,U|0),l=a|0,u=c|0,a=s|0,c=o|0,s=n|0,o=i|0;const W=v_(U,$,G);n=S_(W,P,M,q),i=W|0}({h:n,l:i}=jn(this.Ah|0,this.Al|0,n|0,i|0)),{h:s,l:o}=jn(this.Bh|0,this.Bl|0,s|0,o|0),{h:a,l:c}=jn(this.Ch|0,this.Cl|0,a|0,c|0),{h:l,l:u}=jn(this.Dh|0,this.Dl|0,l|0,u|0),{h:f,l:g}=jn(this.Eh|0,this.El|0,f|0,g|0),{h:m,l:w}=jn(this.Fh|0,this.Fl|0,m|0,w|0),{h:x,l:v}=jn(this.Gh|0,this.Gl|0,x|0,v|0),{h:C,l:N}=jn(this.Hh|0,this.Hl|0,C|0,N|0),this.set(n,i,s,o,a,c,l,u,f,g,m,w,x,v,C,N)}roundClean(){Es(_i,Ii)}destroy(){Es(this.buffer),this.set(0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0)}}const im=tm(()=>new C_),B_=tm(()=>new P_);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Q3=BigInt(0),m0=BigInt(1);function xs(r,e){if(typeof e!="boolean")throw new Error(r+" boolean expected, got "+e)}function Ml(r){const e=r.toString(16);return e.length&1?"0"+e:e}function sm(r){if(typeof r!="string")throw new Error("hex string expected, got "+typeof r);return r===""?Q3:BigInt("0x"+r)}function vh(r){return sm(Do(r))}function As(r){return Un(r),sm(Do(Uint8Array.from(r).reverse()))}function Y3(r,e){return G3(r.toString(16).padStart(e*2,"0"))}function nl(r,e){return Y3(r,e).reverse()}function _t(r,e,t){let n;if(typeof e=="string")try{n=G3(e)}catch(s){throw new Error(r+" must be hex string or Uint8Array, cause: "+s)}else if(z3(e))n=Uint8Array.from(e);else throw new Error(r+" must be hex string or Uint8Array");const i=n.length;if(typeof t=="number"&&i!==t)throw new Error(r+" of length "+t+" expected, got "+i);return n}const Gf=r=>typeof r=="bigint"&&Q3<=r;function N_(r,e,t){return Gf(r)&&Gf(e)&&Gf(t)&&e<=r&&r<t}function Ni(r,e,t,n){if(!N_(e,t,n))throw new Error("expected valid "+r+": "+t+" <= n < "+n+", got "+e)}function O_(r){let e;for(e=0;r>Q3;r>>=m0,e+=1);return e}const Sh=r=>(m0<<BigInt(r))-m0;function R_(r,e,t){if(typeof r!="number"||r<2)throw new Error("hashLen must be a number");if(typeof e!="number"||e<2)throw new Error("qByteLen must be a number");if(typeof t!="function")throw new Error("hmacFn must be a function");const n=m=>new Uint8Array(m),i=m=>Uint8Array.of(m);let s=n(r),o=n(r),a=0;const c=()=>{s.fill(1),o.fill(0),a=0},l=(...m)=>t(o,s,...m),u=(m=n(0))=>{o=l(i(0),m),s=l(),m.length!==0&&(o=l(i(1),m),s=l())},f=()=>{if(a++>=1e3)throw new Error("drbg: tried 1000 values");let m=0;const w=[];for(;m<e;){s=l();const x=s.slice();w.push(x),m+=s.length}return Jn(...w)};return(m,w)=>{c(),u(m);let x;for(;!(x=w(f()));)u();return c(),x}}function ca(r,e,t={}){if(!r||typeof r!="object")throw new Error("expected valid options object");function n(i,s,o){const a=r[i];if(o&&a===void 0)return;const c=typeof a;if(c!==s||a===null)throw new Error(`param "${i}" is invalid: expected ${s}, got ${c}`)}Object.entries(e).forEach(([i,s])=>n(i,s,!1)),Object.entries(t).forEach(([i,s])=>n(i,s,!0))}function ju(r){const e=new WeakMap;return(t,...n)=>{const i=e.get(t);if(i!==void 0)return i;const s=r(t,...n);return e.set(t,s),s}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _r=BigInt(0),zt=BigInt(1),as=BigInt(2),D_=BigInt(3),om=BigInt(4),am=BigInt(5),cm=BigInt(8);function It(r,e){const t=r%e;return t>=_r?t:e+t}function At(r,e,t){let n=r;for(;e-- >_r;)n*=n,n%=t;return n}function u6(r,e){if(r===_r)throw new Error("invert: expected non-zero number");if(e<=_r)throw new Error("invert: expected positive modulus, got "+e);let t=It(r,e),n=e,i=_r,s=zt;for(;t!==_r;){const a=n/t,c=n%t,l=i-s*a;n=t,t=c,i=s,s=l}if(n!==zt)throw new Error("invert: does not exist");return It(i,e)}function lm(r,e){const t=(r.ORDER+zt)/om,n=r.pow(e,t);if(!r.eql(r.sqr(n),e))throw new Error("Cannot find square root");return n}function L_(r,e){const t=(r.ORDER-am)/cm,n=r.mul(e,as),i=r.pow(n,t),s=r.mul(e,i),o=r.mul(r.mul(s,as),i),a=r.mul(s,r.sub(o,r.ONE));if(!r.eql(r.sqr(a),e))throw new Error("Cannot find square root");return a}function M_(r){if(r<BigInt(3))throw new Error("sqrt is not defined for small field");let e=r-zt,t=0;for(;e%as===_r;)e/=as,t++;let n=as;const i=la(r);for(;h6(i,n)===1;)if(n++>1e3)throw new Error("Cannot find square root: probably non-prime P");if(t===1)return lm;let s=i.pow(n,e);const o=(e+zt)/as;return function(c,l){if(c.is0(l))return l;if(h6(c,l)!==1)throw new Error("Cannot find square root");let u=t,f=c.mul(c.ONE,s),g=c.pow(l,e),m=c.pow(l,o);for(;!c.eql(g,c.ONE);){if(c.is0(g))return c.ZERO;let w=1,x=c.sqr(g);for(;!c.eql(x,c.ONE);)if(w++,x=c.sqr(x),w===u)throw new Error("Cannot find square root");const v=zt<<BigInt(u-w-1),C=c.pow(f,v);u=w,f=c.sqr(C),g=c.mul(g,f),m=c.mul(m,C)}return m}}function U_(r){return r%om===D_?lm:r%cm===am?L_:M_(r)}const F_=(r,e)=>(It(r,e)&zt)===zt,$_=["create","isValid","is0","neg","inv","sqrt","sqr","eql","add","sub","mul","pow","div","addN","subN","mulN","sqrN"];function V_(r){const e={ORDER:"bigint",MASK:"bigint",BYTES:"number",BITS:"number"},t=$_.reduce((n,i)=>(n[i]="function",n),e);return ca(r,t),r}function q_(r,e,t){if(t<_r)throw new Error("invalid exponent, negatives unsupported");if(t===_r)return r.ONE;if(t===zt)return e;let n=r.ONE,i=e;for(;t>_r;)t&zt&&(n=r.mul(n,i)),i=r.sqr(i),t>>=zt;return n}function um(r,e,t=!1){const n=new Array(e.length).fill(t?r.ZERO:void 0),i=e.reduce((o,a,c)=>r.is0(a)?o:(n[c]=o,r.mul(o,a)),r.ONE),s=r.inv(i);return e.reduceRight((o,a,c)=>r.is0(a)?o:(n[c]=r.mul(o,n[c]),r.mul(o,a)),s),n}function h6(r,e){const t=(r.ORDER-zt)/as,n=r.pow(e,t),i=r.eql(n,r.ONE),s=r.eql(n,r.ZERO),o=r.eql(n,r.neg(r.ONE));if(!i&&!s&&!o)throw new Error("invalid Legendre symbol result");return i?1:s?0:-1}function K_(r,e){e!==void 0&&Ku(e);const t=e!==void 0?e:r.toString(2).length,n=Math.ceil(t/8);return{nBitLength:t,nByteLength:n}}function la(r,e,t=!1,n={}){if(r<=_r)throw new Error("invalid field: expected ORDER > 0, got "+r);let i,s;if(typeof e=="object"&&e!=null){if(n.sqrt||t)throw new Error("cannot specify opts in two arguments");const u=e;u.BITS&&(i=u.BITS),u.sqrt&&(s=u.sqrt),typeof u.isLE=="boolean"&&(t=u.isLE)}else typeof e=="number"&&(i=e),n.sqrt&&(s=n.sqrt);const{nBitLength:o,nByteLength:a}=K_(r,i);if(a>2048)throw new Error("invalid field: expected ORDER of <= 2048 bytes");let c;const l=Object.freeze({ORDER:r,isLE:t,BITS:o,BYTES:a,MASK:Sh(o),ZERO:_r,ONE:zt,create:u=>It(u,r),isValid:u=>{if(typeof u!="bigint")throw new Error("invalid field element: expected bigint, got "+typeof u);return _r<=u&&u<r},is0:u=>u===_r,isValidNot0:u=>!l.is0(u)&&l.isValid(u),isOdd:u=>(u&zt)===zt,neg:u=>It(-u,r),eql:(u,f)=>u===f,sqr:u=>It(u*u,r),add:(u,f)=>It(u+f,r),sub:(u,f)=>It(u-f,r),mul:(u,f)=>It(u*f,r),pow:(u,f)=>q_(l,u,f),div:(u,f)=>It(u*u6(f,r),r),sqrN:u=>u*u,addN:(u,f)=>u+f,subN:(u,f)=>u-f,mulN:(u,f)=>u*f,inv:u=>u6(u,r),sqrt:s||(u=>(c||(c=U_(r)),c(l,u))),toBytes:u=>t?nl(u,a):Y3(u,a),fromBytes:u=>{if(u.length!==a)throw new Error("Field.fromBytes: expected "+a+" bytes, got "+u.length);return t?As(u):vh(u)},invertBatch:u=>um(l,u),cmov:(u,f,g)=>g?f:u});return Object.freeze(l)}function hm(r){if(typeof r!="bigint")throw new Error("field order must be bigint");const e=r.toString(2).length;return Math.ceil(e/8)}function fm(r){const e=hm(r);return e+Math.ceil(e/2)}function H_(r,e,t=!1){const n=r.length,i=hm(e),s=fm(e);if(n<16||n<s||n>1024)throw new Error("expected "+s+"-1024 bytes of input, got "+n);const o=t?As(r):vh(r),a=It(o,e-zt)+zt;return t?nl(a,i):Y3(a,i)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Lo=BigInt(0),cs=BigInt(1);function Za(r,e){const t=e.negate();return r?t:e}function dm(r,e,t){const n=e==="pz"?o=>o.pz:o=>o.ez,i=um(r.Fp,t.map(n));return t.map((o,a)=>o.toAffine(i[a])).map(r.fromAffine)}function pm(r,e){if(!Number.isSafeInteger(r)||r<=0||r>e)throw new Error("invalid window size, expected [1.."+e+"], got W="+r)}function Qf(r,e){pm(r,e);const t=Math.ceil(e/r)+1,n=2**(r-1),i=2**r,s=Sh(r),o=BigInt(r);return{windows:t,windowSize:n,mask:s,maxNumber:i,shiftBy:o}}function f6(r,e,t){const{windowSize:n,mask:i,maxNumber:s,shiftBy:o}=t;let a=Number(r&i),c=r>>o;a>n&&(a-=s,c+=cs);const l=e*n,u=l+Math.abs(a)-1,f=a===0,g=a<0,m=e%2!==0;return{nextN:c,offset:u,isZero:f,isNeg:g,isNegF:m,offsetF:l}}function j_(r,e){if(!Array.isArray(r))throw new Error("array expected");r.forEach((t,n)=>{if(!(t instanceof e))throw new Error("invalid point at index "+n)})}function z_(r,e){if(!Array.isArray(r))throw new Error("array of scalars expected");r.forEach((t,n)=>{if(!e.isValid(t))throw new Error("invalid scalar at index "+n)})}const Yf=new WeakMap,gm=new WeakMap;function Zf(r){return gm.get(r)||1}function d6(r){if(r!==Lo)throw new Error("invalid wNAF")}function mm(r,e){return{constTimeNegate:Za,hasPrecomputes(t){return Zf(t)!==1},unsafeLadder(t,n,i=r.ZERO){let s=t;for(;n>Lo;)n&cs&&(i=i.add(s)),s=s.double(),n>>=cs;return i},precomputeWindow(t,n){const{windows:i,windowSize:s}=Qf(n,e),o=[];let a=t,c=a;for(let l=0;l<i;l++){c=a,o.push(c);for(let u=1;u<s;u++)c=c.add(a),o.push(c);a=c.double()}return o},wNAF(t,n,i){let s=r.ZERO,o=r.BASE;const a=Qf(t,e);for(let c=0;c<a.windows;c++){const{nextN:l,offset:u,isZero:f,isNeg:g,isNegF:m,offsetF:w}=f6(i,c,a);i=l,f?o=o.add(Za(m,n[w])):s=s.add(Za(g,n[u]))}return d6(i),{p:s,f:o}},wNAFUnsafe(t,n,i,s=r.ZERO){const o=Qf(t,e);for(let a=0;a<o.windows&&i!==Lo;a++){const{nextN:c,offset:l,isZero:u,isNeg:f}=f6(i,a,o);if(i=c,!u){const g=n[l];s=s.add(f?g.negate():g)}}return d6(i),s},getPrecomputes(t,n,i){let s=Yf.get(n);return s||(s=this.precomputeWindow(n,t),t!==1&&(typeof i=="function"&&(s=i(s)),Yf.set(n,s))),s},wNAFCached(t,n,i){const s=Zf(t);return this.wNAF(s,this.getPrecomputes(s,t,i),n)},wNAFCachedUnsafe(t,n,i,s){const o=Zf(t);return o===1?this.unsafeLadder(t,n,s):this.wNAFUnsafe(o,this.getPrecomputes(o,t,i),n,s)},setWindowSize(t,n){pm(n,e),gm.set(t,n),Yf.delete(t)}}}function W_(r,e,t,n){let i=e,s=r.ZERO,o=r.ZERO;for(;t>Lo||n>Lo;)t&cs&&(s=s.add(i)),n&cs&&(o=o.add(i)),i=i.double(),t>>=cs,n>>=cs;return{p1:s,p2:o}}function ym(r,e,t,n){j_(t,r),z_(n,e);const i=t.length,s=n.length;if(i!==s)throw new Error("arrays of points and scalars must have equal length");const o=r.ZERO,a=O_(BigInt(i));let c=1;a>12?c=a-3:a>4?c=a-2:a>0&&(c=2);const l=Sh(c),u=new Array(Number(l)+1).fill(o),f=Math.floor((e.BITS-1)/c)*c;let g=o;for(let m=f;m>=0;m-=c){u.fill(o);for(let x=0;x<s;x++){const v=n[x],C=Number(v>>BigInt(m)&l);u[C]=u[C].add(t[x])}let w=o;for(let x=u.length-1,v=o;x>0;x--)v=v.add(u[x]),w=w.add(v);if(g=g.add(w),m!==0)for(let x=0;x<c;x++)g=g.double()}return g}function p6(r,e){if(e){if(e.ORDER!==r)throw new Error("Field.ORDER must match order: Fp == p, Fn == n");return V_(e),e}else return la(r)}function wm(r,e,t={}){if(!e||typeof e!="object")throw new Error(`expected valid ${r} CURVE object`);for(const a of["p","n","h"]){const c=e[a];if(!(typeof c=="bigint"&&c>Lo))throw new Error(`CURVE.${a} must be positive bigint`)}const n=p6(e.p,t.Fp),i=p6(e.n,t.Fn),o=["Gx","Gy","a",r==="weierstrass"?"b":"d"];for(const a of o)if(!n.isValid(e[a]))throw new Error(`CURVE.${a} must be valid field element of CURVE.Fp`);return{Fp:n,Fn:i}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const _n=BigInt(0),ar=BigInt(1),Xf=BigInt(2),G_=BigInt(8),Q_={zip215:!0};function Y_(r,e,t,n){const i=r.sqr(t),s=r.sqr(n),o=r.add(r.mul(e.a,i),s),a=r.add(r.ONE,r.mul(e.d,r.mul(i,s)));return r.eql(o,a)}function Z_(r,e={}){const{Fp:t,Fn:n}=wm("edwards",r,e),{h:i,n:s}=r;ca(e,{},{uvRatio:"function"});const o=Xf<<BigInt(n.BYTES*8)-ar,a=x=>t.create(x),c=e.uvRatio||((x,v)=>{try{return{isValid:!0,value:t.sqrt(t.div(x,v))}}catch{return{isValid:!1,value:_n}}});if(!Y_(t,r,r.Gx,r.Gy))throw new Error("bad curve params: generator point");function l(x,v,C=!1){const N=C?ar:_n;return Ni("coordinate "+x,v,N,o),v}function u(x){if(!(x instanceof m))throw new Error("ExtendedPoint expected")}const f=ju((x,v)=>{const{ex:C,ey:N,ez:O}=x,L=x.is0();v==null&&(v=L?G_:t.inv(O));const R=a(C*v),F=a(N*v),K=a(O*v);if(L)return{x:_n,y:ar};if(K!==ar)throw new Error("invZ was invalid");return{x:R,y:F}}),g=ju(x=>{const{a:v,d:C}=r;if(x.is0())throw new Error("bad point: ZERO");const{ex:N,ey:O,ez:L,et:R}=x,F=a(N*N),K=a(O*O),H=a(L*L),P=a(H*H),U=a(F*v),M=a(H*a(U+K)),$=a(P+a(C*a(F*K)));if(M!==$)throw new Error("bad point: equation left != right (1)");const q=a(N*O),G=a(L*R);if(q!==G)throw new Error("bad point: equation left != right (2)");return!0});class m{constructor(v,C,N,O){this.ex=l("x",v),this.ey=l("y",C),this.ez=l("z",N,!0),this.et=l("t",O),Object.freeze(this)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static fromAffine(v){if(v instanceof m)throw new Error("extended point not allowed");const{x:C,y:N}=v||{};return l("x",C),l("y",N),new m(C,N,ar,a(C*N))}static normalizeZ(v){return dm(m,"ez",v)}static msm(v,C){return ym(m,n,v,C)}_setWindowSize(v){this.precompute(v)}precompute(v=8,C=!0){return w.setWindowSize(this,v),C||this.multiply(Xf),this}assertValidity(){g(this)}equals(v){u(v);const{ex:C,ey:N,ez:O}=this,{ex:L,ey:R,ez:F}=v,K=a(C*F),H=a(L*O),P=a(N*F),U=a(R*O);return K===H&&P===U}is0(){return this.equals(m.ZERO)}negate(){return new m(a(-this.ex),this.ey,this.ez,a(-this.et))}double(){const{a:v}=r,{ex:C,ey:N,ez:O}=this,L=a(C*C),R=a(N*N),F=a(Xf*a(O*O)),K=a(v*L),H=C+N,P=a(a(H*H)-L-R),U=K+R,M=U-F,$=K-R,q=a(P*M),G=a(U*$),W=a(P*$),j=a(M*U);return new m(q,G,j,W)}add(v){u(v);const{a:C,d:N}=r,{ex:O,ey:L,ez:R,et:F}=this,{ex:K,ey:H,ez:P,et:U}=v,M=a(O*K),$=a(L*H),q=a(F*N*U),G=a(R*P),W=a((O+L)*(K+H)-M-$),j=G-q,Q=G+q,Y=a($-C*M),ie=a(W*j),Se=a(Q*Y),te=a(W*Y),de=a(j*Q);return new m(ie,Se,de,te)}subtract(v){return this.add(v.negate())}multiply(v){const C=v;Ni("scalar",C,ar,s);const{p:N,f:O}=w.wNAFCached(this,C,m.normalizeZ);return m.normalizeZ([N,O])[0]}multiplyUnsafe(v,C=m.ZERO){const N=v;return Ni("scalar",N,_n,s),N===_n?m.ZERO:this.is0()||N===ar?this:w.wNAFCachedUnsafe(this,N,m.normalizeZ,C)}isSmallOrder(){return this.multiplyUnsafe(i).is0()}isTorsionFree(){return w.wNAFCachedUnsafe(this,s).is0()}toAffine(v){return f(this,v)}clearCofactor(){return i===ar?this:this.multiplyUnsafe(i)}static fromBytes(v,C=!1){return Un(v),this.fromHex(v,C)}static fromHex(v,C=!1){const{d:N,a:O}=r,L=t.BYTES;v=_t("pointHex",v,L),xs("zip215",C);const R=v.slice(),F=v[L-1];R[L-1]=F&-129;const K=As(R),H=C?o:t.ORDER;Ni("pointHex.y",K,_n,H);const P=a(K*K),U=a(P-ar),M=a(N*P-O);let{isValid:$,value:q}=c(U,M);if(!$)throw new Error("Point.fromHex: invalid y coordinate");const G=(q&ar)===ar,W=(F&128)!==0;if(!C&&q===_n&&W)throw new Error("Point.fromHex: x=0 and x_0=1");return W!==G&&(q=a(-q)),m.fromAffine({x:q,y:K})}static fromPrivateScalar(v){return m.BASE.multiply(v)}toBytes(){const{x:v,y:C}=this.toAffine(),N=nl(C,t.BYTES);return N[N.length-1]|=v&ar?128:0,N}toRawBytes(){return this.toBytes()}toHex(){return Do(this.toBytes())}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}m.BASE=new m(r.Gx,r.Gy,ar,a(r.Gx*r.Gy)),m.ZERO=new m(_n,ar,ar,_n),m.Fp=t,m.Fn=n;const w=mm(m,n.BYTES*8);return m}function X_(r,e){ca(e,{hash:"function"},{adjustScalarBytes:"function",randomBytes:"function",domain:"function",prehash:"function",mapToCurve:"function"});const{prehash:t,hash:n}=e,{BASE:i,Fp:s,Fn:o}=r,a=o.ORDER,c=e.randomBytes||bh,l=e.adjustScalarBytes||(R=>R),u=e.domain||((R,F,K)=>{if(xs("phflag",K),F.length||K)throw new Error("Contexts/pre-hash are not supported");return R});function f(R){return o.create(R)}function g(R){return f(As(R))}function m(R){const F=s.BYTES;R=_t("private key",R,F);const K=_t("hashed private key",n(R),2*F),H=l(K.slice(0,F)),P=K.slice(F,2*F),U=g(H);return{head:H,prefix:P,scalar:U}}function w(R){const{head:F,prefix:K,scalar:H}=m(R),P=i.multiply(H),U=P.toBytes();return{head:F,prefix:K,scalar:H,point:P,pointBytes:U}}function x(R){return w(R).pointBytes}function v(R=Uint8Array.of(),...F){const K=Jn(...F);return g(n(u(K,_t("context",R),!!t)))}function C(R,F,K={}){R=_t("message",R),t&&(R=t(R));const{prefix:H,scalar:P,pointBytes:U}=w(F),M=v(K.context,H,R),$=i.multiply(M).toBytes(),q=v(K.context,$,U,R),G=f(M+q*P);Ni("signature.s",G,_n,a);const W=s.BYTES,j=Jn($,nl(G,W));return _t("result",j,W*2)}const N=Q_;function O(R,F,K,H=N){const{context:P,zip215:U}=H,M=s.BYTES;R=_t("signature",R,2*M),F=_t("message",F),K=_t("publicKey",K,M),U!==void 0&&xs("zip215",U),t&&(F=t(F));const $=As(R.slice(M,2*M));let q,G,W;try{q=r.fromHex(K,U),G=r.fromHex(R.slice(0,M),U),W=i.multiplyUnsafe($)}catch{return!1}if(!U&&q.isSmallOrder())return!1;const j=v(P,G.toBytes(),q.toBytes(),F);return G.add(q.multiplyUnsafe(j)).subtract(W).clearCofactor().is0()}return i.precompute(8),{getPublicKey:x,sign:C,verify:O,utils:{getExtendedPublicKey:w,randomPrivateKey:()=>c(s.BYTES),precompute(R=8,F=r.BASE){return F.precompute(R,!1)}},Point:r}}function J_(r){const e={a:r.a,d:r.d,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},t=r.Fp,n=la(e.n,r.nBitLength,!0),i={Fp:t,Fn:n,uvRatio:r.uvRatio},s={hash:r.hash,randomBytes:r.randomBytes,adjustScalarBytes:r.adjustScalarBytes,domain:r.domain,prehash:r.prehash,mapToCurve:r.mapToCurve};return{CURVE:e,curveOpts:i,eddsaOpts:s}}function eI(r,e){return Object.assign({},e,{ExtendedPoint:e.Point,CURVE:r})}function tI(r){const{CURVE:e,curveOpts:t,eddsaOpts:n}=J_(r),i=Z_(e,t),s=X_(i,n);return eI(r,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Ba=BigInt(0),Js=BigInt(1),Ul=BigInt(2);function rI(r){return ca(r,{adjustScalarBytes:"function",powPminus2:"function"}),Object.freeze({...r})}function nI(r){const e=rI(r),{P:t,type:n,adjustScalarBytes:i,powPminus2:s,randomBytes:o}=e,a=n==="x25519";if(!a&&n!=="x448")throw new Error("invalid type");const c=o||bh,l=a?255:448,u=a?32:56,f=BigInt(a?9:5),g=BigInt(a?121665:39081),m=a?Ul**BigInt(254):Ul**BigInt(447),w=a?BigInt(8)*Ul**BigInt(251)-Js:BigInt(4)*Ul**BigInt(445)-Js,x=m+w+Js,v=P=>It(P,t),C=N(f);function N(P){return nl(v(P),u)}function O(P){const U=_t("u coordinate",P,u);return a&&(U[31]&=127),v(As(U))}function L(P){return As(i(_t("scalar",P,u)))}function R(P,U){const M=H(O(U),L(P));if(M===Ba)throw new Error("invalid private or public key received");return N(M)}function F(P){return R(P,C)}function K(P,U,M){const $=v(P*(U-M));return U=v(U-$),M=v(M+$),{x_2:U,x_3:M}}function H(P,U){Ni("u",P,Ba,t),Ni("scalar",U,m,x);const M=U,$=P;let q=Js,G=Ba,W=P,j=Js,Q=Ba;for(let ie=BigInt(l-1);ie>=Ba;ie--){const Se=M>>ie&Js;Q^=Se,{x_2:q,x_3:W}=K(Q,q,W),{x_2:G,x_3:j}=K(Q,G,j),Q=Se;const te=q+G,de=v(te*te),ae=q-G,Ue=v(ae*ae),Le=de-Ue,Te=W+j,wt=W-j,nt=v(wt*te),ot=v(Te*ae),$t=nt+ot,Et=nt-ot;W=v($t*$t),j=v($*v(Et*Et)),q=v(de*Ue),G=v(Le*(de+v(g*Le)))}({x_2:q,x_3:W}=K(Q,q,W)),{x_2:G,x_3:j}=K(Q,G,j);const Y=s(G);return v(q*Y)}return{scalarMult:R,scalarMultBase:F,getSharedSecret:(P,U)=>R(P,U),getPublicKey:P=>F(P),utils:{randomPrivateKey:()=>c(u)},GuBytes:C.slice()}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */BigInt(0);const iI=BigInt(1),g6=BigInt(2),sI=BigInt(3),oI=BigInt(5),aI=BigInt(8),il={p:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffed"),n:BigInt("0x1000000000000000000000000000000014def9dea2f79cd65812631a5cf5d3ed"),h:aI,a:BigInt("0x7fffffffffffffffffffffffffffffffffffffffffffffffffffffffffffffec"),d:BigInt("0x52036cee2b6ffe738cc740797779e89800700a4d4141d8ab75eb4dca135978a3"),Gx:BigInt("0x216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a"),Gy:BigInt("0x6666666666666666666666666666666666666666666666666666666666666658")};function bm(r){const e=BigInt(10),t=BigInt(20),n=BigInt(40),i=BigInt(80),s=il.p,a=r*r%s*r%s,c=At(a,g6,s)*a%s,l=At(c,iI,s)*r%s,u=At(l,oI,s)*l%s,f=At(u,e,s)*u%s,g=At(f,t,s)*f%s,m=At(g,n,s)*g%s,w=At(m,i,s)*m%s,x=At(w,i,s)*m%s,v=At(x,e,s)*u%s;return{pow_p_5_8:At(v,g6,s)*r%s,b2:a}}function vm(r){return r[0]&=248,r[31]&=127,r[31]|=64,r}const m6=BigInt("19681161376707505956807079304988542015446066515923890162744021073123829784752");function cI(r,e){const t=il.p,n=It(e*e*e,t),i=It(n*n*e,t),s=bm(r*i).pow_p_5_8;let o=It(r*n*s,t);const a=It(e*o*o,t),c=o,l=It(o*m6,t),u=a===r,f=a===It(-r,t),g=a===It(-r*m6,t);return u&&(o=c),(f||g)&&(o=l),F_(o,t)&&(o=It(-o,t)),{isValid:u||f,value:o}}const lI=la(il.p,void 0,!0),uI={...il,Fp:lI,hash:B_,adjustScalarBytes:vm,uvRatio:cI},zu=tI(uI),Fl=(()=>{const r=il.p;return nI({P:r,type:"x25519",powPminus2:e=>{const{pow_p_5_8:t,b2:n}=bm(e);return It(At(t,sI,r)*n,r)},adjustScalarBytes:vm})})();class y6 extends Error{constructor(e="An error occurred while signing a message"){super(e),this.name="SigningError"}}class w6 extends Error{constructor(e="An error occurred while verifying a message"){super(e),this.name="VerificationError"}}class hI extends Error{constructor(e="Missing Web Crypto API"){super(e),this.name="WebCryptoMissingError"}}const en={get(r=globalThis){const e=r.crypto;if((e==null?void 0:e.subtle)==null)throw new hI("Missing Web Crypto API. The most likely cause of this error is that this page is being accessed from an insecure context (i.e. not HTTPS). For more information and possible resolutions see https://github.com/libp2p/js-libp2p/blob/main/packages/crypto/README.md#web-crypto-api");return e}},Sm=32,Z3=64,y0=32;let wo;const Em=(async()=>{try{return await en.get().subtle.generateKey({name:"Ed25519"},!0,["sign","verify"]),!0}catch{return!1}})();function fI(){const r=zu.utils.randomPrivateKey(),e=zu.getPublicKey(r);return{privateKey:bI(r,e),publicKey:e}}async function dI(r,e){let t;r.length===Z3?t=r.subarray(0,32):t=r;const n={crv:"Ed25519",kty:"OKP",x:Be(r.subarray(32),"base64url"),d:Be(t,"base64url"),ext:!0,key_ops:["sign"]},i=await en.get().subtle.importKey("jwk",n,{name:"Ed25519"},!0,["sign"]),s=await en.get().subtle.sign({name:"Ed25519"},i,e instanceof Uint8Array?e:e.subarray());return new Uint8Array(s,0,s.byteLength)}function pI(r,e){const t=r.subarray(0,y0);return zu.sign(e instanceof Uint8Array?e:e.subarray(),t)}async function gI(r,e){return wo==null&&(wo=await Em),wo?dI(r,e):pI(r,e)}async function mI(r,e,t){if(r.buffer instanceof ArrayBuffer){const n=await en.get().subtle.importKey("raw",r.buffer,{name:"Ed25519"},!1,["verify"]);return await en.get().subtle.verify({name:"Ed25519"},n,e,t instanceof Uint8Array?t:t.subarray())}throw new TypeError("WebCrypto does not support SharedArrayBuffer for Ed25519 keys")}function yI(r,e,t){return zu.verify(e,t instanceof Uint8Array?t:t.subarray(),r)}async function wI(r,e,t){return wo==null&&(wo=await Em),wo?mI(r,e,t):yI(r,e,t)}function bI(r,e){const t=new Uint8Array(Z3);for(let n=0;n<y0;n++)t[n]=r[n],t[y0+n]=e[n];return t}function Eh(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}class xm{constructor(e){h(this,"type","Ed25519");h(this,"raw");this.raw=X3(e,Sm)}toMultihash(){return el.digest(Yr(this))}toCID(){return it.createV1(114,this.toMultihash())}toString(){return Rt.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:pt(this.raw,e.raw)}verify(e,t,n){var s;(s=n==null?void 0:n.signal)==null||s.throwIfAborted();const i=wI(this.raw,t,e);return Eh(i)?i.then(o=>{var a;return(a=n==null?void 0:n.signal)==null||a.throwIfAborted(),o}):i}}class vI{constructor(e,t){h(this,"type","Ed25519");h(this,"raw");h(this,"publicKey");this.raw=X3(e,Z3),this.publicKey=new xm(t)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:pt(this.raw,e.raw)}sign(e,t){var i,s;(i=t==null?void 0:t.signal)==null||i.throwIfAborted();const n=gI(this.raw,e);return Eh(n)?n.then(o=>{var a;return(a=t==null?void 0:t.signal)==null||a.throwIfAborted(),o}):((s=t==null?void 0:t.signal)==null||s.throwIfAborted(),n)}}function Am(r){return r=X3(r,Sm),new xm(r)}async function SI(){const{privateKey:r,publicKey:e}=fI();return new vI(r,e)}function X3(r,e){if(r=Uint8Array.from(r??[]),r.length!==e)throw new ke(`Key must be a Uint8Array of length ${e}, got ${r.length}`);return r}const EI=Math.pow(2,7),xI=Math.pow(2,14),AI=Math.pow(2,21),J3=Math.pow(2,28),e4=Math.pow(2,35),t4=Math.pow(2,42),r4=Math.pow(2,49),et=128,Jt=127;function nr(r){if(r<EI)return 1;if(r<xI)return 2;if(r<AI)return 3;if(r<J3)return 4;if(r<e4)return 5;if(r<t4)return 6;if(r<r4)return 7;if(Number.MAX_SAFE_INTEGER!=null&&r>Number.MAX_SAFE_INTEGER)throw new RangeError("Could not encode varint");return 8}function Wu(r,e,t=0){switch(nr(r)){case 8:e[t++]=r&255|et,r/=128;case 7:e[t++]=r&255|et,r/=128;case 6:e[t++]=r&255|et,r/=128;case 5:e[t++]=r&255|et,r/=128;case 4:e[t++]=r&255|et,r>>>=7;case 3:e[t++]=r&255|et,r>>>=7;case 2:e[t++]=r&255|et,r>>>=7;case 1:{e[t++]=r&255,r>>>=7;break}default:throw new Error("unreachable")}return e}function _I(r,e,t=0){switch(nr(r)){case 8:e.set(t++,r&255|et),r/=128;case 7:e.set(t++,r&255|et),r/=128;case 6:e.set(t++,r&255|et),r/=128;case 5:e.set(t++,r&255|et),r/=128;case 4:e.set(t++,r&255|et),r>>>=7;case 3:e.set(t++,r&255|et),r>>>=7;case 2:e.set(t++,r&255|et),r>>>=7;case 1:{e.set(t++,r&255),r>>>=7;break}default:throw new Error("unreachable")}return e}function _m(r,e){let t=r[e],n=0;if(n+=t&Jt,t<et||(t=r[e+1],n+=(t&Jt)<<7,t<et)||(t=r[e+2],n+=(t&Jt)<<14,t<et)||(t=r[e+3],n+=(t&Jt)<<21,t<et)||(t=r[e+4],n+=(t&Jt)*J3,t<et)||(t=r[e+5],n+=(t&Jt)*e4,t<et)||(t=r[e+6],n+=(t&Jt)*t4,t<et)||(t=r[e+7],n+=(t&Jt)*r4,t<et))return n;throw new RangeError("Could not decode varint")}function II(r,e){let t=r.get(e),n=0;if(n+=t&Jt,t<et||(t=r.get(e+1),n+=(t&Jt)<<7,t<et)||(t=r.get(e+2),n+=(t&Jt)<<14,t<et)||(t=r.get(e+3),n+=(t&Jt)<<21,t<et)||(t=r.get(e+4),n+=(t&Jt)*J3,t<et)||(t=r.get(e+5),n+=(t&Jt)*e4,t<et)||(t=r.get(e+6),n+=(t&Jt)*t4,t<et)||(t=r.get(e+7),n+=(t&Jt)*r4,t<et))return n;throw new RangeError("Could not decode varint")}function ms(r,e,t=0){return e==null&&(e=wn(nr(r))),e instanceof Uint8Array?Wu(r,e,t):_I(r,e,t)}function sl(r,e=0){return r instanceof Uint8Array?_m(r,e):II(r,e)}const n4=new Float32Array([-0]),Oi=new Uint8Array(n4.buffer);function CI(r,e,t){n4[0]=r,e[t]=Oi[0],e[t+1]=Oi[1],e[t+2]=Oi[2],e[t+3]=Oi[3]}function kI(r,e){return Oi[0]=r[e],Oi[1]=r[e+1],Oi[2]=r[e+2],Oi[3]=r[e+3],n4[0]}const i4=new Float64Array([-0]),er=new Uint8Array(i4.buffer);function TI(r,e,t){i4[0]=r,e[t]=er[0],e[t+1]=er[1],e[t+2]=er[2],e[t+3]=er[3],e[t+4]=er[4],e[t+5]=er[5],e[t+6]=er[6],e[t+7]=er[7]}function PI(r,e){return er[0]=r[e],er[1]=r[e+1],er[2]=r[e+2],er[3]=r[e+3],er[4]=r[e+4],er[5]=r[e+5],er[6]=r[e+6],er[7]=r[e+7],i4[0]}const BI=BigInt(Number.MAX_SAFE_INTEGER),NI=BigInt(Number.MIN_SAFE_INTEGER);class rr{constructor(e,t){h(this,"lo");h(this,"hi");this.lo=e|0,this.hi=t|0}toNumber(e=!1){if(!e&&this.hi>>>31>0){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(t+n*4294967296)}return this.lo+this.hi*4294967296}toBigInt(e=!1){if(e)return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n);if(this.hi>>>31){const t=~this.lo+1>>>0;let n=~this.hi>>>0;return t===0&&(n=n+1>>>0),-(BigInt(t)+(BigInt(n)<<32n))}return BigInt(this.lo>>>0)+(BigInt(this.hi>>>0)<<32n)}toString(e=!1){return this.toBigInt(e).toString()}zzEncode(){const e=this.hi>>31;return this.hi=((this.hi<<1|this.lo>>>31)^e)>>>0,this.lo=(this.lo<<1^e)>>>0,this}zzDecode(){const e=-(this.lo&1);return this.lo=((this.lo>>>1|this.hi<<31)^e)>>>0,this.hi=(this.hi>>>1^e)>>>0,this}length(){const e=this.lo,t=(this.lo>>>28|this.hi<<4)>>>0,n=this.hi>>>24;return n===0?t===0?e<16384?e<128?1:2:e<2097152?3:4:t<16384?t<128?5:6:t<2097152?7:8:n<128?9:10}static fromBigInt(e){if(e===0n)return ys;if(e<BI&&e>NI)return this.fromNumber(Number(e));const t=e<0n;t&&(e=-e);let n=e>>32n,i=e-(n<<32n);return t&&(n=~n|0n,i=~i|0n,++i>b6&&(i=0n,++n>b6&&(n=0n))),new rr(Number(i),Number(n))}static fromNumber(e){if(e===0)return ys;const t=e<0;t&&(e=-e);let n=e>>>0,i=(e-n)/4294967296>>>0;return t&&(i=~i>>>0,n=~n>>>0,++n>4294967295&&(n=0,++i>4294967295&&(i=0))),new rr(n,i)}static from(e){return typeof e=="number"?rr.fromNumber(e):typeof e=="bigint"?rr.fromBigInt(e):typeof e=="string"?rr.fromBigInt(BigInt(e)):e.low!=null||e.high!=null?new rr(e.low>>>0,e.high>>>0):ys}}const ys=new rr(0,0);ys.toBigInt=function(){return 0n};ys.zzEncode=ys.zzDecode=function(){return this};ys.length=function(){return 1};const b6=4294967296n;function OI(r){let e=0,t=0;for(let n=0;n<r.length;++n)t=r.charCodeAt(n),t<128?e+=1:t<2048?e+=2:(t&64512)===55296&&(r.charCodeAt(n+1)&64512)===56320?(++n,e+=4):e+=3;return e}function RI(r,e,t){if(t-e<1)return"";let i;const s=[];let o=0,a;for(;e<t;)a=r[e++],a<128?s[o++]=a:a>191&&a<224?s[o++]=(a&31)<<6|r[e++]&63:a>239&&a<365?(a=((a&7)<<18|(r[e++]&63)<<12|(r[e++]&63)<<6|r[e++]&63)-65536,s[o++]=55296+(a>>10),s[o++]=56320+(a&1023)):s[o++]=(a&15)<<12|(r[e++]&63)<<6|r[e++]&63,o>8191&&((i??(i=[])).push(String.fromCharCode.apply(String,s)),o=0);return i!=null?(o>0&&i.push(String.fromCharCode.apply(String,s.slice(0,o))),i.join("")):String.fromCharCode.apply(String,s.slice(0,o))}function Im(r,e,t){const n=t;let i,s;for(let o=0;o<r.length;++o)i=r.charCodeAt(o),i<128?e[t++]=i:i<2048?(e[t++]=i>>6|192,e[t++]=i&63|128):(i&64512)===55296&&((s=r.charCodeAt(o+1))&64512)===56320?(i=65536+((i&1023)<<10)+(s&1023),++o,e[t++]=i>>18|240,e[t++]=i>>12&63|128,e[t++]=i>>6&63|128,e[t++]=i&63|128):(e[t++]=i>>12|224,e[t++]=i>>6&63|128,e[t++]=i&63|128);return t-n}function cn(r,e){return RangeError(`index out of range: ${r.pos} + ${e??1} > ${r.len}`)}function $l(r,e){return(r[e-4]|r[e-3]<<8|r[e-2]<<16|r[e-1]<<24)>>>0}class DI{constructor(e){h(this,"buf");h(this,"pos");h(this,"len");h(this,"_slice",Uint8Array.prototype.subarray);this.buf=e,this.pos=0,this.len=e.length}uint32(){let e=4294967295;if(e=(this.buf[this.pos]&127)>>>0,this.buf[this.pos++]<128||(e=(e|(this.buf[this.pos]&127)<<7)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<14)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&127)<<21)>>>0,this.buf[this.pos++]<128)||(e=(e|(this.buf[this.pos]&15)<<28)>>>0,this.buf[this.pos++]<128))return e;if((this.pos+=5)>this.len)throw this.pos=this.len,cn(this,10);return e}int32(){return this.uint32()|0}sint32(){const e=this.uint32();return e>>>1^-(e&1)|0}bool(){return this.uint32()!==0}fixed32(){if(this.pos+4>this.len)throw cn(this,4);return $l(this.buf,this.pos+=4)}sfixed32(){if(this.pos+4>this.len)throw cn(this,4);return $l(this.buf,this.pos+=4)|0}float(){if(this.pos+4>this.len)throw cn(this,4);const e=kI(this.buf,this.pos);return this.pos+=4,e}double(){if(this.pos+8>this.len)throw cn(this,4);const e=PI(this.buf,this.pos);return this.pos+=8,e}bytes(){const e=this.uint32(),t=this.pos,n=this.pos+e;if(n>this.len)throw cn(this,e);return this.pos+=e,t===n?new Uint8Array(0):this.buf.subarray(t,n)}string(){const e=this.bytes();return RI(e,0,e.length)}skip(e){if(typeof e=="number"){if(this.pos+e>this.len)throw cn(this,e);this.pos+=e}else do if(this.pos>=this.len)throw cn(this);while((this.buf[this.pos++]&128)!==0);return this}skipType(e){switch(e){case 0:this.skip();break;case 1:this.skip(8);break;case 2:this.skip(this.uint32());break;case 3:for(;(e=this.uint32()&7)!==4;)this.skipType(e);break;case 5:this.skip(4);break;default:throw Error(`invalid wire type ${e} at offset ${this.pos}`)}return this}readLongVarint(){const e=new rr(0,0);let t=0;if(this.len-this.pos>4){for(;t<4;++t)if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e;if(e.lo=(e.lo|(this.buf[this.pos]&127)<<28)>>>0,e.hi=(e.hi|(this.buf[this.pos]&127)>>4)>>>0,this.buf[this.pos++]<128)return e;t=0}else{for(;t<3;++t){if(this.pos>=this.len)throw cn(this);if(e.lo=(e.lo|(this.buf[this.pos]&127)<<t*7)>>>0,this.buf[this.pos++]<128)return e}return e.lo=(e.lo|(this.buf[this.pos++]&127)<<t*7)>>>0,e}if(this.len-this.pos>4){for(;t<5;++t)if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}else for(;t<5;++t){if(this.pos>=this.len)throw cn(this);if(e.hi=(e.hi|(this.buf[this.pos]&127)<<t*7+3)>>>0,this.buf[this.pos++]<128)return e}throw Error("invalid varint encoding")}readFixed64(){if(this.pos+8>this.len)throw cn(this,8);const e=$l(this.buf,this.pos+=4),t=$l(this.buf,this.pos+=4);return new rr(e,t)}int64(){return this.readLongVarint().toBigInt()}int64Number(){return this.readLongVarint().toNumber()}int64String(){return this.readLongVarint().toString()}uint64(){return this.readLongVarint().toBigInt(!0)}uint64Number(){const e=_m(this.buf,this.pos);return this.pos+=nr(e),e}uint64String(){return this.readLongVarint().toString(!0)}sint64(){return this.readLongVarint().zzDecode().toBigInt()}sint64Number(){return this.readLongVarint().zzDecode().toNumber()}sint64String(){return this.readLongVarint().zzDecode().toString()}fixed64(){return this.readFixed64().toBigInt()}fixed64Number(){return this.readFixed64().toNumber()}fixed64String(){return this.readFixed64().toString()}sfixed64(){return this.readFixed64().toBigInt()}sfixed64Number(){return this.readFixed64().toNumber()}sfixed64String(){return this.readFixed64().toString()}}function LI(r){return new DI(r instanceof Uint8Array?r:r.subarray())}function at(r,e,t){const n=LI(r);return e.decode(n,void 0,t)}function MI(r){let n,i=8192;return function(o){if(o<1||o>4096)return wn(o);i+o>8192&&(n=wn(8192),i=0);const a=n.subarray(i,i+=o);return(i&7)!==0&&(i=(i|7)+1),a}}class Ua{constructor(e,t,n){h(this,"fn");h(this,"len");h(this,"next");h(this,"val");this.fn=e,this.len=t,this.next=void 0,this.val=n}}function Jf(){}class UI{constructor(e){h(this,"head");h(this,"tail");h(this,"len");h(this,"next");this.head=e.head,this.tail=e.tail,this.len=e.len,this.next=e.states}}const FI=MI();function $I(r){return globalThis.Buffer!=null?wn(r):FI(r)}class w0{constructor(){h(this,"len");h(this,"head");h(this,"tail");h(this,"states");this.len=0,this.head=new Ua(Jf,0,0),this.tail=this.head,this.states=null}_push(e,t,n){return this.tail=this.tail.next=new Ua(e,t,n),this.len+=t,this}uint32(e){return this.len+=(this.tail=this.tail.next=new qI((e=e>>>0)<128?1:e<16384?2:e<2097152?3:e<268435456?4:5,e)).len,this}int32(e){return e<0?this._push(Vl,10,rr.fromNumber(e)):this.uint32(e)}sint32(e){return this.uint32((e<<1^e>>31)>>>0)}uint64(e){const t=rr.fromBigInt(e);return this._push(Vl,t.length(),t)}uint64Number(e){return this._push(Wu,nr(e),e)}uint64String(e){return this.uint64(BigInt(e))}int64(e){return this.uint64(e)}int64Number(e){return this.uint64Number(e)}int64String(e){return this.uint64String(e)}sint64(e){const t=rr.fromBigInt(e).zzEncode();return this._push(Vl,t.length(),t)}sint64Number(e){const t=rr.fromNumber(e).zzEncode();return this._push(Vl,t.length(),t)}sint64String(e){return this.sint64(BigInt(e))}bool(e){return this._push(ed,1,e?1:0)}fixed32(e){return this._push(Na,4,e>>>0)}sfixed32(e){return this.fixed32(e)}fixed64(e){const t=rr.fromBigInt(e);return this._push(Na,4,t.lo)._push(Na,4,t.hi)}fixed64Number(e){const t=rr.fromNumber(e);return this._push(Na,4,t.lo)._push(Na,4,t.hi)}fixed64String(e){return this.fixed64(BigInt(e))}sfixed64(e){return this.fixed64(e)}sfixed64Number(e){return this.fixed64Number(e)}sfixed64String(e){return this.fixed64String(e)}float(e){return this._push(CI,4,e)}double(e){return this._push(TI,8,e)}bytes(e){const t=e.length>>>0;return t===0?this._push(ed,1,0):this.uint32(t)._push(KI,t,e)}string(e){const t=OI(e);return t!==0?this.uint32(t)._push(Im,t,e):this._push(ed,1,0)}fork(){return this.states=new UI(this),this.head=this.tail=new Ua(Jf,0,0),this.len=0,this}reset(){return this.states!=null?(this.head=this.states.head,this.tail=this.states.tail,this.len=this.states.len,this.states=this.states.next):(this.head=this.tail=new Ua(Jf,0,0),this.len=0),this}ldelim(){const e=this.head,t=this.tail,n=this.len;return this.reset().uint32(n),n!==0&&(this.tail.next=e.next,this.tail=t,this.len+=n),this}finish(){let e=this.head.next;const t=$I(this.len);let n=0;for(;e!=null;)e.fn(e.val,t,n),n+=e.len,e=e.next;return t}}function ed(r,e,t){e[t]=r&255}function VI(r,e,t){for(;r>127;)e[t++]=r&127|128,r>>>=7;e[t]=r}class qI extends Ua{constructor(t,n){super(VI,t,n);h(this,"next");this.next=void 0}}function Vl(r,e,t){for(;r.hi!==0;)e[t++]=r.lo&127|128,r.lo=(r.lo>>>7|r.hi<<25)>>>0,r.hi>>>=7;for(;r.lo>127;)e[t++]=r.lo&127|128,r.lo=r.lo>>>7;e[t++]=r.lo}function Na(r,e,t){e[t]=r&255,e[t+1]=r>>>8&255,e[t+2]=r>>>16&255,e[t+3]=r>>>24}function KI(r,e,t){e.set(r,t)}globalThis.Buffer!=null&&(w0.prototype.bytes=function(r){const e=r.length>>>0;return this.uint32(e),e>0&&this._push(HI,e,r),this},w0.prototype.string=function(r){const e=globalThis.Buffer.byteLength(r);return this.uint32(e),e>0&&this._push(jI,e,r),this});function HI(r,e,t){e.set(r,t)}function jI(r,e,t){r.length<40?Im(r,e,t):e.utf8Write!=null?e.utf8Write(r,t):e.set(Ae(r),t)}function zI(){return new w0}function ct(r,e){const t=zI();return e.encode(r,t,{lengthDelimited:!1}),t.finish()}var Gu;(function(r){r[r.VARINT=0]="VARINT",r[r.BIT64=1]="BIT64",r[r.LENGTH_DELIMITED=2]="LENGTH_DELIMITED",r[r.START_GROUP=3]="START_GROUP",r[r.END_GROUP=4]="END_GROUP",r[r.BIT32=5]="BIT32"})(Gu||(Gu={}));function Cm(r,e,t,n){return{name:r,type:e,encode:t,decode:n}}function xh(r){function e(i){if(r[i.toString()]==null)throw new Error("Invalid enum value");return r[i]}const t=function(s,o){const a=e(s);o.int32(a)},n=function(s){const o=s.int32();return e(o)};return Cm("enum",Gu.VARINT,t,n)}function lt(r,e){return Cm("message",Gu.LENGTH_DELIMITED,r,e)}class Dt extends Error{constructor(){super(...arguments);h(this,"code","ERR_MAX_LENGTH");h(this,"name","MaxLengthError")}}class v6 extends Error{constructor(){super(...arguments);h(this,"code","ERR_MAX_SIZE");h(this,"name","MaxSizeError")}}var Ft;(function(r){r.RSA="RSA",r.Ed25519="Ed25519",r.secp256k1="secp256k1",r.ECDSA="ECDSA"})(Ft||(Ft={}));var b0;(function(r){r[r.RSA=0]="RSA",r[r.Ed25519=1]="Ed25519",r[r.secp256k1=2]="secp256k1",r[r.ECDSA=3]="ECDSA"})(b0||(b0={}));(function(r){r.codec=()=>xh(b0)})(Ft||(Ft={}));var _s;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ft.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=Ft.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(_s||(_s={}));var S6;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.Type!=null&&(n.uint32(8),Ft.codec().encode(t.Type,n)),t.Data!=null&&(n.uint32(18),n.bytes(t.Data)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.Type=Ft.codec().decode(t);break}case 2:{s.Data=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(S6||(S6={}));function ol(r){if(isNaN(r)||r<=0)throw new ke("random bytes length must be a Number bigger than 0");return bh(r)}const Xa=im;let km=class{constructor(e,t){h(this,"type","RSA");h(this,"jwk");h(this,"_raw");h(this,"_multihash");this.jwk=e,this._multihash=t}get raw(){return this._raw==null&&(this._raw=Pm(this.jwk)),this._raw}toMultihash(){return this._multihash}toCID(){return it.createV1(114,this._multihash)}toString(){return Rt.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:pt(this.raw,e.raw)}verify(e,t,n){return iC(this.jwk,t,e,n)}},WI=class{constructor(e,t){h(this,"type","RSA");h(this,"jwk");h(this,"_raw");h(this,"publicKey");this.jwk=e,this.publicKey=t}get raw(){return this._raw==null&&(this._raw=ZI(this.jwk)),this._raw}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:pt(this.raw,e.raw)}sign(e,t){return nC(this.jwk,e,t)}};const GI=8192,Tm=18,QI=1062,YI=Uint8Array.from([48,13,6,9,42,134,72,134,247,13,1,1,1,5,0]);function ZI(r){if(r.n==null||r.e==null||r.d==null||r.p==null||r.q==null||r.dp==null||r.dq==null||r.qi==null)throw new ke("JWK was missing components");return ti([Or(Uint8Array.from([0])),Or(Ae(r.n,"base64url")),Or(Ae(r.e,"base64url")),Or(Ae(r.d,"base64url")),Or(Ae(r.p,"base64url")),Or(Ae(r.q,"base64url")),Or(Ae(r.dp,"base64url")),Or(Ae(r.dq,"base64url")),Or(Ae(r.qi,"base64url"))]).subarray()}function XI(r){const e=yh(r[1],{offset:0});return{kty:"RSA",n:Be(e[0],"base64url"),e:Be(e[1],"base64url")}}function Pm(r){if(r.n==null||r.e==null)throw new ke("JWK was missing components");return ti([YI,j3(ti([Or(Ae(r.n,"base64url")),Or(Ae(r.e,"base64url"))]))]).subarray()}function JI(r,e){if(r.byteLength>=QI)throw new yc("Key size is too large");const t=yh(r,{offset:0});return eC(t,r,e)}function eC(r,e,t){const n=XI(r);if(t==null){const i=Xa(_s.encode({Type:Ft.RSA,Data:e}));t=ji(Tm,i)}return new km(n,t)}async function tC(r){if(r>GI)throw new ke("Key size is too large");const e=await rC(r),t=Xa(_s.encode({Type:Ft.RSA,Data:Pm(e.publicKey)})),n=ji(Tm,t);return new WI(e.privateKey,new km(e.publicKey,n))}async function rC(r,e){const t=await en.get().subtle.generateKey({name:"RSASSA-PKCS1-v1_5",modulusLength:r,publicExponent:new Uint8Array([1,0,1]),hash:{name:"SHA-256"}},!0,["sign","verify"]),n=await sC(t);return{privateKey:n[0],publicKey:n[1]}}async function nC(r,e,t){var s,o;const n=await en.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["sign"]);(s=t==null?void 0:t.signal)==null||s.throwIfAborted();const i=await en.get().subtle.sign({name:"RSASSA-PKCS1-v1_5"},n,e instanceof Uint8Array?e:e.subarray());return(o=t==null?void 0:t.signal)==null||o.throwIfAborted(),new Uint8Array(i,0,i.byteLength)}async function iC(r,e,t,n){var o,a;const i=await en.get().subtle.importKey("jwk",r,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!1,["verify"]);(o=n==null?void 0:n.signal)==null||o.throwIfAborted();const s=await en.get().subtle.verify({name:"RSASSA-PKCS1-v1_5"},i,e,t instanceof Uint8Array?t:t.subarray());return(a=n==null?void 0:n.signal)==null||a.throwIfAborted(),s}async function sC(r,e){if(r.privateKey==null||r.publicKey==null)throw new ke("Private and public key are required");return await Promise.all([en.get().subtle.exportKey("jwk",r.privateKey),en.get().subtle.exportKey("jwk",r.publicKey)])}class Bm extends em{constructor(e,t){super(),this.finished=!1,this.destroyed=!1,W3(e);const n=wc(t);if(this.iHash=e.create(),typeof this.iHash.update!="function")throw new Error("Expected instance of class which extends utils.Hash");this.blockLen=this.iHash.blockLen,this.outputLen=this.iHash.outputLen;const i=this.blockLen,s=new Uint8Array(i);s.set(n.length>i?e.create().update(n).digest():n);for(let o=0;o<s.length;o++)s[o]^=54;this.iHash.update(s),this.oHash=e.create();for(let o=0;o<s.length;o++)s[o]^=106;this.oHash.update(s),Es(s)}update(e){return Hu(this),this.iHash.update(e),this}digestInto(e){Hu(this),Un(e,this.outputLen),this.finished=!0,this.iHash.digestInto(e),this.oHash.update(e),this.oHash.digestInto(e),this.destroy()}digest(){const e=new Uint8Array(this.oHash.outputLen);return this.digestInto(e),e}_cloneInto(e){e||(e=Object.create(Object.getPrototypeOf(this),{}));const{oHash:t,iHash:n,finished:i,destroyed:s,blockLen:o,outputLen:a}=this;return e=e,e.finished=i,e.destroyed=s,e.blockLen=o,e.outputLen=a,e.oHash=t._cloneInto(e.oHash),e.iHash=n._cloneInto(e.iHash),e}clone(){return this._cloneInto()}destroy(){this.destroyed=!0,this.oHash.destroy(),this.iHash.destroy()}}const Ah=(r,e,t)=>new Bm(r,e).update(t).digest();Ah.create=(r,e)=>new Bm(r,e);/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function E6(r){r.lowS!==void 0&&xs("lowS",r.lowS),r.prehash!==void 0&&xs("prehash",r.prehash)}class oC extends Error{constructor(e=""){super(e)}}const Yn={Err:oC,_tlv:{encode:(r,e)=>{const{Err:t}=Yn;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length&1)throw new t("tlv.encode: unpadded data");const n=e.length/2,i=Ml(n);if(i.length/2&128)throw new t("tlv.encode: long form length too big");const s=n>127?Ml(i.length/2|128):"";return Ml(r)+s+i+e},decode(r,e){const{Err:t}=Yn;let n=0;if(r<0||r>256)throw new t("tlv.encode: wrong tag");if(e.length<2||e[n++]!==r)throw new t("tlv.decode: wrong tlv");const i=e[n++],s=!!(i&128);let o=0;if(!s)o=i;else{const c=i&127;if(!c)throw new t("tlv.decode(long): indefinite length not supported");if(c>4)throw new t("tlv.decode(long): byte length is too big");const l=e.subarray(n,n+c);if(l.length!==c)throw new t("tlv.decode: length bytes not complete");if(l[0]===0)throw new t("tlv.decode(long): zero leftmost byte");for(const u of l)o=o<<8|u;if(n+=c,o<128)throw new t("tlv.decode(long): not minimal encoding")}const a=e.subarray(n,n+o);if(a.length!==o)throw new t("tlv.decode: wrong value length");return{v:a,l:e.subarray(n+o)}}},_int:{encode(r){const{Err:e}=Yn;if(r<Ja)throw new e("integer: negative integers are not allowed");let t=Ml(r);if(Number.parseInt(t[0],16)&8&&(t="00"+t),t.length&1)throw new e("unexpected DER parsing assertion: unpadded hex");return t},decode(r){const{Err:e}=Yn;if(r[0]&128)throw new e("invalid signature integer: negative");if(r[0]===0&&!(r[1]&128))throw new e("invalid signature integer: unnecessary leading zero");return vh(r)}},toSig(r){const{Err:e,_int:t,_tlv:n}=Yn,i=_t("signature",r),{v:s,l:o}=n.decode(48,i);if(o.length)throw new e("invalid signature: left bytes after parsing");const{v:a,l:c}=n.decode(2,s),{v:l,l:u}=n.decode(2,c);if(u.length)throw new e("invalid signature: left bytes after parsing");return{r:t.decode(a),s:t.decode(l)}},hexFromSig(r){const{_tlv:e,_int:t}=Yn,n=e.encode(2,t.encode(r.r)),i=e.encode(2,t.encode(r.s)),s=n+i;return e.encode(48,s)}},Ja=BigInt(0),ec=BigInt(1),aC=BigInt(2),ql=BigInt(3),cC=BigInt(4);function lC(r,e,t){function n(i){const s=r.sqr(i),o=r.mul(s,i);return r.add(r.add(o,r.mul(i,e)),t)}return n}function Nm(r,e,t){const{BYTES:n}=r;function i(s){let o;if(typeof s=="bigint")o=s;else{let a=_t("private key",s);if(e){if(!e.includes(a.length*2))throw new Error("invalid private key");const c=new Uint8Array(n);c.set(a,c.length-a.length),a=c}try{o=r.fromBytes(a)}catch{throw new Error(`invalid private key: expected ui8a of size ${n}, got ${typeof s}`)}}if(t&&(o=r.create(o)),!r.isValidNot0(o))throw new Error("invalid private key: out of range [1..N-1]");return o}return i}function uC(r,e={}){const{Fp:t,Fn:n}=wm("weierstrass",r,e),{h:i,n:s}=r;ca(e,{},{allowInfinityPoint:"boolean",clearCofactor:"function",isTorsionFree:"function",fromBytes:"function",toBytes:"function",endo:"object",wrapPrivateKey:"boolean"});const{endo:o}=e;if(o&&(!t.is0(r.a)||typeof o.beta!="bigint"||typeof o.splitScalar!="function"))throw new Error('invalid endo: expected "beta": bigint and "splitScalar": function');function a(){if(!t.isOdd)throw new Error("compression is not supported: Field does not have .isOdd()")}function c(H,P,U){const{x:M,y:$}=P.toAffine(),q=t.toBytes(M);if(xs("isCompressed",U),U){a();const G=!t.isOdd($);return Jn(Om(G),q)}else return Jn(Uint8Array.of(4),q,t.toBytes($))}function l(H){Un(H);const P=t.BYTES,U=P+1,M=2*P+1,$=H.length,q=H[0],G=H.subarray(1);if($===U&&(q===2||q===3)){const W=t.fromBytes(G);if(!t.isValid(W))throw new Error("bad point: is not on curve, wrong x");const j=g(W);let Q;try{Q=t.sqrt(j)}catch(Se){const te=Se instanceof Error?": "+Se.message:"";throw new Error("bad point: is not on curve, sqrt error"+te)}a();const Y=t.isOdd(Q);return(q&1)===1!==Y&&(Q=t.neg(Q)),{x:W,y:Q}}else if($===M&&q===4){const W=t.fromBytes(G.subarray(P*0,P*1)),j=t.fromBytes(G.subarray(P*1,P*2));if(!m(W,j))throw new Error("bad point: is not on curve");return{x:W,y:j}}else throw new Error(`bad point: got length ${$}, expected compressed=${U} or uncompressed=${M}`)}const u=e.toBytes||c,f=e.fromBytes||l,g=lC(t,r.a,r.b);function m(H,P){const U=t.sqr(P),M=g(H);return t.eql(U,M)}if(!m(r.Gx,r.Gy))throw new Error("bad curve params: generator point");const w=t.mul(t.pow(r.a,ql),cC),x=t.mul(t.sqr(r.b),BigInt(27));if(t.is0(t.add(w,x)))throw new Error("bad curve params: a or b");function v(H,P,U=!1){if(!t.isValid(P)||U&&t.is0(P))throw new Error(`bad point coordinate ${H}`);return P}function C(H){if(!(H instanceof R))throw new Error("ProjectivePoint expected")}const N=ju((H,P)=>{const{px:U,py:M,pz:$}=H;if(t.eql($,t.ONE))return{x:U,y:M};const q=H.is0();P==null&&(P=q?t.ONE:t.inv($));const G=t.mul(U,P),W=t.mul(M,P),j=t.mul($,P);if(q)return{x:t.ZERO,y:t.ZERO};if(!t.eql(j,t.ONE))throw new Error("invZ was invalid");return{x:G,y:W}}),O=ju(H=>{if(H.is0()){if(e.allowInfinityPoint&&!t.is0(H.py))return;throw new Error("bad point: ZERO")}const{x:P,y:U}=H.toAffine();if(!t.isValid(P)||!t.isValid(U))throw new Error("bad point: x or y not field elements");if(!m(P,U))throw new Error("bad point: equation left != right");if(!H.isTorsionFree())throw new Error("bad point: not in prime-order subgroup");return!0});function L(H,P,U,M,$){return U=new R(t.mul(U.px,H),U.py,U.pz),P=Za(M,P),U=Za($,U),P.add(U)}class R{constructor(P,U,M){this.px=v("x",P),this.py=v("y",U,!0),this.pz=v("z",M),Object.freeze(this)}static fromAffine(P){const{x:U,y:M}=P||{};if(!P||!t.isValid(U)||!t.isValid(M))throw new Error("invalid affine point");if(P instanceof R)throw new Error("projective point not allowed");return t.is0(U)&&t.is0(M)?R.ZERO:new R(U,M,t.ONE)}get x(){return this.toAffine().x}get y(){return this.toAffine().y}static normalizeZ(P){return dm(R,"pz",P)}static fromBytes(P){return Un(P),R.fromHex(P)}static fromHex(P){const U=R.fromAffine(f(_t("pointHex",P)));return U.assertValidity(),U}static fromPrivateKey(P){const U=Nm(n,e.allowedPrivateKeyLengths,e.wrapPrivateKey);return R.BASE.multiply(U(P))}static msm(P,U){return ym(R,n,P,U)}precompute(P=8,U=!0){return K.setWindowSize(this,P),U||this.multiply(ql),this}_setWindowSize(P){this.precompute(P)}assertValidity(){O(this)}hasEvenY(){const{y:P}=this.toAffine();if(!t.isOdd)throw new Error("Field doesn't support isOdd");return!t.isOdd(P)}equals(P){C(P);const{px:U,py:M,pz:$}=this,{px:q,py:G,pz:W}=P,j=t.eql(t.mul(U,W),t.mul(q,$)),Q=t.eql(t.mul(M,W),t.mul(G,$));return j&&Q}negate(){return new R(this.px,t.neg(this.py),this.pz)}double(){const{a:P,b:U}=r,M=t.mul(U,ql),{px:$,py:q,pz:G}=this;let W=t.ZERO,j=t.ZERO,Q=t.ZERO,Y=t.mul($,$),ie=t.mul(q,q),Se=t.mul(G,G),te=t.mul($,q);return te=t.add(te,te),Q=t.mul($,G),Q=t.add(Q,Q),W=t.mul(P,Q),j=t.mul(M,Se),j=t.add(W,j),W=t.sub(ie,j),j=t.add(ie,j),j=t.mul(W,j),W=t.mul(te,W),Q=t.mul(M,Q),Se=t.mul(P,Se),te=t.sub(Y,Se),te=t.mul(P,te),te=t.add(te,Q),Q=t.add(Y,Y),Y=t.add(Q,Y),Y=t.add(Y,Se),Y=t.mul(Y,te),j=t.add(j,Y),Se=t.mul(q,G),Se=t.add(Se,Se),Y=t.mul(Se,te),W=t.sub(W,Y),Q=t.mul(Se,ie),Q=t.add(Q,Q),Q=t.add(Q,Q),new R(W,j,Q)}add(P){C(P);const{px:U,py:M,pz:$}=this,{px:q,py:G,pz:W}=P;let j=t.ZERO,Q=t.ZERO,Y=t.ZERO;const ie=r.a,Se=t.mul(r.b,ql);let te=t.mul(U,q),de=t.mul(M,G),ae=t.mul($,W),Ue=t.add(U,M),Le=t.add(q,G);Ue=t.mul(Ue,Le),Le=t.add(te,de),Ue=t.sub(Ue,Le),Le=t.add(U,$);let Te=t.add(q,W);return Le=t.mul(Le,Te),Te=t.add(te,ae),Le=t.sub(Le,Te),Te=t.add(M,$),j=t.add(G,W),Te=t.mul(Te,j),j=t.add(de,ae),Te=t.sub(Te,j),Y=t.mul(ie,Le),j=t.mul(Se,ae),Y=t.add(j,Y),j=t.sub(de,Y),Y=t.add(de,Y),Q=t.mul(j,Y),de=t.add(te,te),de=t.add(de,te),ae=t.mul(ie,ae),Le=t.mul(Se,Le),de=t.add(de,ae),ae=t.sub(te,ae),ae=t.mul(ie,ae),Le=t.add(Le,ae),te=t.mul(de,Le),Q=t.add(Q,te),te=t.mul(Te,Le),j=t.mul(Ue,j),j=t.sub(j,te),te=t.mul(Ue,de),Y=t.mul(Te,Y),Y=t.add(Y,te),new R(j,Q,Y)}subtract(P){return this.add(P.negate())}is0(){return this.equals(R.ZERO)}multiply(P){const{endo:U}=e;if(!n.isValidNot0(P))throw new Error("invalid scalar: out of range");let M,$;const q=G=>K.wNAFCached(this,G,R.normalizeZ);if(U){const{k1neg:G,k1:W,k2neg:j,k2:Q}=U.splitScalar(P),{p:Y,f:ie}=q(W),{p:Se,f:te}=q(Q);$=ie.add(te),M=L(U.beta,Y,Se,G,j)}else{const{p:G,f:W}=q(P);M=G,$=W}return R.normalizeZ([M,$])[0]}multiplyUnsafe(P){const{endo:U}=e,M=this;if(!n.isValid(P))throw new Error("invalid scalar: out of range");if(P===Ja||M.is0())return R.ZERO;if(P===ec)return M;if(K.hasPrecomputes(this))return this.multiply(P);if(U){const{k1neg:$,k1:q,k2neg:G,k2:W}=U.splitScalar(P),{p1:j,p2:Q}=W_(R,M,q,W);return L(U.beta,j,Q,$,G)}else return K.wNAFCachedUnsafe(M,P)}multiplyAndAddUnsafe(P,U,M){const $=this.multiplyUnsafe(U).add(P.multiplyUnsafe(M));return $.is0()?void 0:$}toAffine(P){return N(this,P)}isTorsionFree(){const{isTorsionFree:P}=e;return i===ec?!0:P?P(R,this):K.wNAFCachedUnsafe(this,s).is0()}clearCofactor(){const{clearCofactor:P}=e;return i===ec?this:P?P(R,this):this.multiplyUnsafe(i)}toBytes(P=!0){return xs("isCompressed",P),this.assertValidity(),u(R,this,P)}toRawBytes(P=!0){return this.toBytes(P)}toHex(P=!0){return Do(this.toBytes(P))}toString(){return`<Point ${this.is0()?"ZERO":this.toHex()}>`}}R.BASE=new R(r.Gx,r.Gy,t.ONE),R.ZERO=new R(t.ZERO,t.ONE,t.ZERO),R.Fp=t,R.Fn=n;const F=n.BITS,K=mm(R,e.endo?Math.ceil(F/2):F);return R}function Om(r){return Uint8Array.of(r?2:3)}function hC(r,e,t={}){ca(e,{hash:"function"},{hmac:"function",lowS:"boolean",randomBytes:"function",bits2int:"function",bits2int_modN:"function"});const n=e.randomBytes||bh,i=e.hmac||((M,...$)=>Ah(e.hash,M,Jn(...$))),{Fp:s,Fn:o}=r,{ORDER:a,BITS:c}=o;function l(M){const $=a>>ec;return M>$}function u(M){return l(M)?o.neg(M):M}function f(M,$){if(!o.isValidNot0($))throw new Error(`invalid signature ${M}: out of range 1..CURVE.n`)}class g{constructor($,q,G){f("r",$),f("s",q),this.r=$,this.s=q,G!=null&&(this.recovery=G),Object.freeze(this)}static fromCompact($){const q=o.BYTES,G=_t("compactSignature",$,q*2);return new g(o.fromBytes(G.subarray(0,q)),o.fromBytes(G.subarray(q,q*2)))}static fromDER($){const{r:q,s:G}=Yn.toSig(_t("DER",$));return new g(q,G)}assertValidity(){}addRecoveryBit($){return new g(this.r,this.s,$)}recoverPublicKey($){const q=s.ORDER,{r:G,s:W,recovery:j}=this;if(j==null||![0,1,2,3].includes(j))throw new Error("recovery id invalid");if(a*aC<q&&j>1)throw new Error("recovery id is ambiguous for h>1 curve");const Y=j===2||j===3?G+a:G;if(!s.isValid(Y))throw new Error("recovery id 2 or 3 invalid");const ie=s.toBytes(Y),Se=r.fromHex(Jn(Om((j&1)===0),ie)),te=o.inv(Y),de=O(_t("msgHash",$)),ae=o.create(-de*te),Ue=o.create(W*te),Le=r.BASE.multiplyUnsafe(ae).add(Se.multiplyUnsafe(Ue));if(Le.is0())throw new Error("point at infinify");return Le.assertValidity(),Le}hasHighS(){return l(this.s)}normalizeS(){return this.hasHighS()?new g(this.r,o.neg(this.s),this.recovery):this}toBytes($){if($==="compact")return Jn(o.toBytes(this.r),o.toBytes(this.s));if($==="der")return G3(Yn.hexFromSig(this));throw new Error("invalid format")}toDERRawBytes(){return this.toBytes("der")}toDERHex(){return Do(this.toBytes("der"))}toCompactRawBytes(){return this.toBytes("compact")}toCompactHex(){return Do(this.toBytes("compact"))}}const m=Nm(o,t.allowedPrivateKeyLengths,t.wrapPrivateKey),w={isValidPrivateKey(M){try{return m(M),!0}catch{return!1}},normPrivateKeyToScalar:m,randomPrivateKey:()=>{const M=a;return H_(n(fm(M)),M)},precompute(M=8,$=r.BASE){return $.precompute(M,!1)}};function x(M,$=!0){return r.fromPrivateKey(M).toBytes($)}function v(M){if(typeof M=="bigint")return!1;if(M instanceof r)return!0;const q=_t("key",M).length,G=s.BYTES,W=G+1,j=2*G+1;if(!(t.allowedPrivateKeyLengths||o.BYTES===W))return q===W||q===j}function C(M,$,q=!0){if(v(M)===!0)throw new Error("first arg must be private key");if(v($)===!1)throw new Error("second arg must be public key");return r.fromHex($).multiply(m(M)).toBytes(q)}const N=e.bits2int||function(M){if(M.length>8192)throw new Error("input is too large");const $=vh(M),q=M.length*8-c;return q>0?$>>BigInt(q):$},O=e.bits2int_modN||function(M){return o.create(N(M))},L=Sh(c);function R(M){return Ni("num < 2^"+c,M,Ja,L),o.toBytes(M)}function F(M,$,q=K){if(["recovered","canonical"].some(Ue=>Ue in q))throw new Error("sign() legacy options not supported");const{hash:G}=e;let{lowS:W,prehash:j,extraEntropy:Q}=q;W==null&&(W=!0),M=_t("msgHash",M),E6(q),j&&(M=_t("prehashed msgHash",G(M)));const Y=O(M),ie=m($),Se=[R(ie),R(Y)];if(Q!=null&&Q!==!1){const Ue=Q===!0?n(s.BYTES):Q;Se.push(_t("extraEntropy",Ue))}const te=Jn(...Se),de=Y;function ae(Ue){const Le=N(Ue);if(!o.isValidNot0(Le))return;const Te=o.inv(Le),wt=r.BASE.multiply(Le).toAffine(),nt=o.create(wt.x);if(nt===Ja)return;const ot=o.create(Te*o.create(de+nt*ie));if(ot===Ja)return;let $t=(wt.x===nt?0:2)|Number(wt.y&ec),Et=ot;return W&&l(ot)&&(Et=u(ot),$t^=1),new g(nt,Et,$t)}return{seed:te,k2sig:ae}}const K={lowS:e.lowS,prehash:!1},H={lowS:e.lowS,prehash:!1};function P(M,$,q=K){const{seed:G,k2sig:W}=F(M,$,q);return R_(e.hash.outputLen,o.BYTES,i)(G,W)}r.BASE.precompute(8);function U(M,$,q,G=H){const W=M;$=_t("msgHash",$),q=_t("publicKey",q),E6(G);const{lowS:j,prehash:Q,format:Y}=G;if("strict"in G)throw new Error("options.strict was renamed to lowS");if(Y!==void 0&&!["compact","der","js"].includes(Y))throw new Error('format must be "compact", "der" or "js"');const ie=typeof W=="string"||z3(W),Se=!ie&&!Y&&typeof W=="object"&&W!==null&&typeof W.r=="bigint"&&typeof W.s=="bigint";if(!ie&&!Se)throw new Error("invalid signature, expected Uint8Array, hex string or Signature instance");let te,de;try{if(Se)if(Y===void 0||Y==="js")te=new g(W.r,W.s);else throw new Error("invalid format");if(ie){try{Y!=="compact"&&(te=g.fromDER(W))}catch(Et){if(!(Et instanceof Yn.Err))throw Et}!te&&Y!=="der"&&(te=g.fromCompact(W))}de=r.fromHex(q)}catch{return!1}if(!te||j&&te.hasHighS())return!1;Q&&($=e.hash($));const{r:ae,s:Ue}=te,Le=O($),Te=o.inv(Ue),wt=o.create(Le*Te),nt=o.create(ae*Te),ot=r.BASE.multiplyUnsafe(wt).add(de.multiplyUnsafe(nt));return ot.is0()?!1:o.create(ot.x)===ae}return Object.freeze({getPublicKey:x,getSharedSecret:C,sign:P,verify:U,utils:w,Point:r,Signature:g})}function fC(r){const e={a:r.a,b:r.b,p:r.Fp.ORDER,n:r.n,h:r.h,Gx:r.Gx,Gy:r.Gy},t=r.Fp,n=la(e.n,r.nBitLength),i={Fp:t,Fn:n,allowedPrivateKeyLengths:r.allowedPrivateKeyLengths,allowInfinityPoint:r.allowInfinityPoint,endo:r.endo,wrapPrivateKey:r.wrapPrivateKey,isTorsionFree:r.isTorsionFree,clearCofactor:r.clearCofactor,fromBytes:r.fromBytes,toBytes:r.toBytes};return{CURVE:e,curveOpts:i}}function dC(r){const{CURVE:e,curveOpts:t}=fC(r),n={hash:r.hash,hmac:r.hmac,randomBytes:r.randomBytes,lowS:r.lowS,bits2int:r.bits2int,bits2int_modN:r.bits2int_modN};return{CURVE:e,curveOpts:t,ecdsaOpts:n}}function pC(r,e){return Object.assign({},e,{ProjectivePoint:e.Point,CURVE:r})}function gC(r){const{CURVE:e,curveOpts:t,ecdsaOpts:n}=dC(r),i=uC(e,t),s=hC(i,n,t);return pC(r,s)}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */function mC(r,e){const t=n=>gC({...r,hash:n});return{...t(e),create:t}}/*! noble-curves - MIT License (c) 2022 Paul Miller (paulmillr.com) */const Qu={p:BigInt("0xfffffffffffffffffffffffffffffffffffffffffffffffffffffffefffffc2f"),n:BigInt("0xfffffffffffffffffffffffffffffffebaaedce6af48a03bbfd25e8cd0364141"),h:BigInt(1),a:BigInt(0),b:BigInt(7),Gx:BigInt("0x79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798"),Gy:BigInt("0x483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8")};BigInt(0);const yC=BigInt(1),v0=BigInt(2),x6=(r,e)=>(r+e/v0)/e;function wC(r){const e=Qu.p,t=BigInt(3),n=BigInt(6),i=BigInt(11),s=BigInt(22),o=BigInt(23),a=BigInt(44),c=BigInt(88),l=r*r*r%e,u=l*l*r%e,f=At(u,t,e)*u%e,g=At(f,t,e)*u%e,m=At(g,v0,e)*l%e,w=At(m,i,e)*m%e,x=At(w,s,e)*w%e,v=At(x,a,e)*x%e,C=At(v,c,e)*v%e,N=At(C,a,e)*x%e,O=At(N,t,e)*u%e,L=At(O,o,e)*w%e,R=At(L,n,e)*l%e,F=At(R,v0,e);if(!S0.eql(S0.sqr(F),r))throw new Error("Cannot find square root");return F}const S0=la(Qu.p,void 0,void 0,{sqrt:wC}),ci=mC({...Qu,Fp:S0,lowS:!0,endo:{beta:BigInt("0x7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee"),splitScalar:r=>{const e=Qu.n,t=BigInt("0x3086d221a7d46bcde86c90e49284eb15"),n=-yC*BigInt("0xe4437ed6010e88286f547fa90abfe4c3"),i=BigInt("0x114ca50f7a8e2f3f657c1108d9d44cfd8"),s=t,o=BigInt("0x100000000000000000000000000000000"),a=x6(s*r,e),c=x6(-n*r,e);let l=It(r-a*t-c*i,e),u=It(-a*n-c*s,e);const f=l>o,g=u>o;if(f&&(l=e-l),g&&(u=e-u),l>o||u>o)throw new Error("splitScalar: Endomorphism failed, k="+r);return{k1neg:f,k1:l,k2neg:g,k2:u}}}},im);function bC(r,e,t){const n=wi.digest(e instanceof Uint8Array?e:e.subarray());if(Eh(n))return n.then(({digest:i})=>{var s;return(s=t==null?void 0:t.signal)==null||s.throwIfAborted(),ci.sign(i,r).toDERRawBytes()}).catch(i=>{throw i.name==="AbortError"?i:new y6(String(i))});try{return ci.sign(n.digest,r).toDERRawBytes()}catch(i){throw new y6(String(i))}}function vC(r,e,t,n){var s;const i=wi.digest(t instanceof Uint8Array?t:t.subarray());if(Eh(i))return i.then(({digest:o})=>{var a;return(a=n==null?void 0:n.signal)==null||a.throwIfAborted(),ci.verify(e,o,r)}).catch(o=>{throw o.name==="AbortError"?o:new w6(String(o))});try{return(s=n==null?void 0:n.signal)==null||s.throwIfAborted(),ci.verify(e,i.digest,r)}catch(o){throw new w6(String(o))}}class Rm{constructor(e){h(this,"type","secp256k1");h(this,"raw");h(this,"_key");this._key=_C(e),this.raw=xC(this._key)}toMultihash(){return el.digest(Yr(this))}toCID(){return it.createV1(114,this.toMultihash())}toString(){return Rt.encode(this.toMultihash().bytes).substring(1)}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:pt(this.raw,e.raw)}verify(e,t,n){return vC(this._key,t,e,n)}}class SC{constructor(e,t){h(this,"type","secp256k1");h(this,"raw");h(this,"publicKey");this.raw=AC(e),this.publicKey=new Rm(t??IC(e))}equals(e){return e==null||!(e.raw instanceof Uint8Array)?!1:pt(this.raw,e.raw)}sign(e,t){return bC(this.raw,e,t)}}function Dm(r){return new Rm(r)}async function EC(){const r=CC();return new SC(r)}function xC(r){return ci.ProjectivePoint.fromHex(r).toRawBytes(!0)}function AC(r){try{return ci.getPublicKey(r,!0),r}catch(e){throw new L3(String(e))}}function _C(r){try{return ci.ProjectivePoint.fromHex(r),r}catch(e){throw new yc(String(e))}}function IC(r){try{return ci.getPublicKey(r,!0)}catch(e){throw new L3(String(e))}}function CC(){return ci.utils.randomPrivateKey()}async function Lm(r,e){if(r==="Ed25519")return SI();if(r==="secp256k1")return EC();if(r==="RSA")return tC(TC(e));if(r==="ECDSA")return u_(PC(e));throw new Xc}function tn(r,e){const{Type:t,Data:n}=_s.decode(r),i=n??new Uint8Array;switch(t){case Ft.RSA:return JI(i,e);case Ft.Ed25519:return Am(i);case Ft.secp256k1:return Dm(i);case Ft.ECDSA:return Z9(i);default:throw new Xc}}function kC(r){const{Type:e,Data:t}=_s.decode(r.digest),n=t??new Uint8Array;switch(e){case Ft.Ed25519:return Am(n);case Ft.secp256k1:return Dm(n);case Ft.ECDSA:return Z9(n);default:throw new Xc}}function Yr(r){return _s.encode({Type:Ft[r.type],Data:r.raw})}function TC(r){return r==null?2048:parseInt(r,10)}function PC(r){if(r==="P-256"||r==null)return"P-256";if(r==="P-384")return"P-384";if(r==="P-521")return"P-521";throw new ke("Unsupported curve, should be P-256, P-384 or P-521")}async function Mm(r){if(r.type==="RSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}},!0,["verify"])};if(r.type==="ECDSA")return{privateKey:await crypto.subtle.importKey("jwk",r.jwk,{name:"ECDSA",namedCurve:r.jwk.crv??"P-256"},!0,["sign"]),publicKey:await crypto.subtle.importKey("jwk",r.publicKey.jwk,{name:"ECDSA",namedCurve:r.publicKey.jwk.crv??"P-256"},!0,["verify"])};throw new ke("Only RSA and ECDSA keys are supported")}const Um=Symbol.for("nodejs.util.inspect.custom"),BC=114;var Lg;class s4{constructor(e){h(this,"type");h(this,"multihash");h(this,"publicKey");h(this,"string");h(this,Lg,!0);this.type=e.type,this.multihash=e.multihash,Object.defineProperty(this,"string",{enumerable:!1,writable:!0})}get[Symbol.toStringTag](){return`PeerId(${this.toString()})`}toString(){return this.string==null&&(this.string=Rt.encode(this.multihash.bytes).slice(1)),this.string}toMultihash(){return this.multihash}toCID(){return it.createV1(BC,this.multihash)}toJSON(){return this.toString()}equals(e){var t;if(e==null)return!1;if(e instanceof Uint8Array)return pt(this.multihash.bytes,e);if(typeof e=="string")return this.toString()===e;if(((t=e==null?void 0:e.toMultihash())==null?void 0:t.bytes)!=null)return pt(this.multihash.bytes,e.toMultihash().bytes);throw new Error("not valid Id")}[(Lg=R3,Um)](){return`PeerId(${this.toString()})`}}class Fm extends s4{constructor(t){super({...t,type:"RSA"});h(this,"type","RSA");h(this,"publicKey");this.publicKey=t.publicKey}}class $m extends s4{constructor(t){super({...t,type:"Ed25519"});h(this,"type","Ed25519");h(this,"publicKey");this.publicKey=t.publicKey}}class Vm extends s4{constructor(t){super({...t,type:"secp256k1"});h(this,"type","secp256k1");h(this,"publicKey");this.publicKey=t.publicKey}}const NC=2336;var Mg,Ug;class qm{constructor(e){h(this,"type","url");h(this,"multihash");h(this,"publicKey");h(this,"url");h(this,Mg,!0);this.url=e.toString(),this.multihash=el.digest(Ae(this.url))}[(Ug=Um,Mg=R3,Ug)](){return`PeerId(${this.url})`}toString(){return this.toCID().toString()}toMultihash(){return this.multihash}toCID(){return it.createV1(NC,this.toMultihash())}toJSON(){return this.toString()}equals(e){return e==null?!1:(e instanceof Uint8Array&&(e=Be(e)),e.toString()===this.toString())}}const OC=114,A6=2336;function li(r,e){let t;if(r.charAt(0)==="1"||r.charAt(0)==="Q")t=$r(Rt.decode(`z${r}`));else{if(r.startsWith("k51qzi5uqu5")||r.startsWith("kzwfwjn5ji4")||r.startsWith("k2k4r8")||r.startsWith("bafz"))return al(it.parse(r));throw new ke('Please pass a multibase decoder for strings that do not start with "1" or "Q"')}return bn(t)}function Is(r){if(r.type==="Ed25519")return new $m({multihash:r.toCID().multihash,publicKey:r});if(r.type==="secp256k1")return new Vm({multihash:r.toCID().multihash,publicKey:r});if(r.type==="RSA")return new Fm({multihash:r.toCID().multihash,publicKey:r});throw new Xc}function Km(r){return Is(r.publicKey)}function bn(r){if(DC(r))return new Fm({multihash:r});if(RC(r))try{const e=kC(r);if(e.type==="Ed25519")return new $m({multihash:r,publicKey:e});if(e.type==="secp256k1")return new Vm({multihash:r,publicKey:e})}catch{const t=Be(r.digest);return new qm(new URL(t))}throw new F9("Supplied PeerID Multihash is invalid")}function al(r){if((r==null?void 0:r.multihash)==null||r.version==null||r.version===1&&r.code!==OC&&r.code!==A6)throw new U9("Supplied PeerID CID is invalid");if(r.code===A6){const e=Be(r.multihash.digest);return new qm(new URL(e))}return bn(r.multihash)}function RC(r){return r.code===el.code}function DC(r){return r.code===wi.code}const LC=8,o4=1024*1024*4;let MC=class extends Error{constructor(){super(...arguments);h(this,"name","InvalidMessageLengthError");h(this,"code","ERR_INVALID_MSG_LENGTH")}},Hm=class extends Error{constructor(){super(...arguments);h(this,"name","InvalidDataLengthError");h(this,"code","ERR_MSG_DATA_TOO_LONG")}},UC=class extends Error{constructor(){super(...arguments);h(this,"name","InvalidDataLengthLengthError");h(this,"code","ERR_MSG_LENGTH_TOO_LONG")}},_6=class extends Error{constructor(){super(...arguments);h(this,"name","UnexpectedEOFError");h(this,"code","ERR_UNEXPECTED_EOF")}};function jm(r){return r[Symbol.asyncIterator]!=null}function zm(r,e){if(r.byteLength>e)throw new Hm("Message length too long")}const _h=r=>{const e=nr(r),t=wn(e);return ms(r,t),_h.bytes=e,t};_h.bytes=0;function bc(r,e){e=e??{};const t=e.lengthEncoder??_h,n=(e==null?void 0:e.maxDataLength)??o4;function*i(s){zm(s,n);const o=t(s.byteLength);o instanceof Uint8Array?yield o:yield*o,s instanceof Uint8Array?yield s:yield*s}return jm(r)?async function*(){for await(const s of r)yield*i(s)}():function*(){for(const s of r)yield*i(s)}()}bc.single=(r,e)=>{e=e??{};const t=e.lengthEncoder??_h,n=(e==null?void 0:e.maxDataLength)??o4;return zm(r,n),new je(t(r.byteLength),r)};var is;(function(r){r[r.LENGTH=0]="LENGTH",r[r.DATA=1]="DATA"})(is||(is={}));const a4=r=>{const e=sl(r);return a4.bytes=nr(e),e};a4.bytes=0;function vc(r,e){const t=new je;let n=is.LENGTH,i=-1;const s=(e==null?void 0:e.lengthDecoder)??a4,o=(e==null?void 0:e.maxLengthLength)??LC,a=(e==null?void 0:e.maxDataLength)??o4;function*c(){for(;t.byteLength>0;){if(n===is.LENGTH)try{if(i=s(t),i<0)throw new MC("Invalid message length");if(i>a)throw new Hm("Message length too long");const l=s.bytes;t.consume(l),(e==null?void 0:e.onLength)!=null&&e.onLength(i),n=is.DATA}catch(l){if(l instanceof RangeError){if(t.byteLength>o)throw new UC("Message length length too long");break}throw l}if(n===is.DATA){if(t.byteLength<i)break;const l=t.sublist(0,i);t.consume(i),(e==null?void 0:e.onData)!=null&&e.onData(l),yield l,n=is.LENGTH}}}return jm(r)?async function*(){for await(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new _6("Unexpected end of input")}():function*(){for(const l of r)t.append(l),yield*c();if(t.byteLength>0)throw new _6("Unexpected end of input")}()}vc.fromReader=(r,e)=>{let t=1;const n=async function*(){for(;;)try{const{done:s,value:o}=await r.next(t);if(s===!0)return;o!=null&&(yield o)}catch(s){if(s.code==="ERR_UNDER_READ")return{done:!0,value:null};throw s}finally{t=1}}();return vc(n,{...e??{},onLength:s=>{t=s}})};function St(){const r={};return r.promise=new Promise((e,t)=>{r.resolve=e,r.reject=t}),r}let I6=class extends Error{constructor(t,n,i){super(t??"The operation was aborted");h(this,"type");h(this,"code");this.type="aborted",this.name=i??"AbortError",this.code=n??"ABORT_ERR"}};async function Ht(r,e,t){if(e==null)return r;if(e.aborted)return r.catch(()=>{}),Promise.reject(new I6(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName));let n;const i=new I6(t==null?void 0:t.errorMessage,t==null?void 0:t.errorCode,t==null?void 0:t.errorName);try{return await Promise.race([r,new Promise((s,o)=>{n=()=>{o(i)},e.addEventListener("abort",n)})])}finally{n!=null&&e.removeEventListener("abort",n)}}class FC{constructor(){h(this,"readNext");h(this,"haveNext");h(this,"ended");h(this,"nextResult");h(this,"error");this.ended=!1,this.readNext=St(),this.haveNext=St()}[Symbol.asyncIterator](){return this}async next(){if(this.nextResult==null&&await this.haveNext.promise,this.nextResult==null)throw new Error("HaveNext promise resolved but nextResult was undefined");const e=this.nextResult;return this.nextResult=void 0,this.readNext.resolve(),this.readNext=St(),e}async throw(e){return this.ended=!0,this.error=e,e!=null&&(this.haveNext.promise.catch(()=>{}),this.haveNext.reject(e)),{done:!0,value:void 0}}async return(){const e={done:!0,value:void 0};return this.ended=!0,this.nextResult=e,this.haveNext.resolve(),e}async push(e,t){await this._push(e,t)}async end(e,t){e!=null?await this.throw(e):await this._push(void 0,t)}async _push(e,t){if(e!=null&&this.ended)throw this.error??new Error("Cannot push value onto an ended pushable");for(;this.nextResult!=null;)await this.readNext.promise;e!=null?this.nextResult={done:!1,value:e}:(this.ended=!0,this.nextResult={done:!0,value:void 0}),this.haveNext.resolve(),this.haveNext=St(),await Ht(this.readNext.promise,t==null?void 0:t.signal,t)}}function Wm(){return new FC}class $C extends Error{constructor(){super(...arguments);h(this,"name","UnexpectedEOFError");h(this,"code","ERR_UNEXPECTED_EOF")}}function Yu(r,e){const t=Wm();r.sink(t).catch(async o=>{await t.end(o)}),r.sink=async o=>{for await(const a of o)await t.push(a);await t.end()};let n=r.source;r.source[Symbol.iterator]!=null?n=r.source[Symbol.iterator]():r.source[Symbol.asyncIterator]!=null&&(n=r.source[Symbol.asyncIterator]());const i=new je;return{read:async o=>{var c;if((c=o==null?void 0:o.signal)==null||c.throwIfAborted(),(o==null?void 0:o.bytes)==null){const{done:l,value:u}=await Ht(n.next(),o==null?void 0:o.signal);return l===!0?null:u}for(;i.byteLength<o.bytes;){const{value:l,done:u}=await Ht(n.next(),o==null?void 0:o.signal);if(u===!0)throw new $C("unexpected end of input");i.append(l)}const a=i.sublist(0,o.bytes);return i.consume(o.bytes),a},write:async(o,a)=>{var c;(c=a==null?void 0:a.signal)==null||c.throwIfAborted(),o instanceof Uint8Array?await t.push(o,a):await t.push(o.subarray(),a)},unwrap:()=>{if(i.byteLength>0){const o=r.source;r.source=async function*(){(e==null?void 0:e.yieldBytes)===!1?yield i:yield*i,yield*o}()}return r}}}class VC extends Error{constructor(){super(...arguments);h(this,"name","InvalidMessageLengthError");h(this,"code","ERR_INVALID_MSG_LENGTH")}}class qC extends Error{constructor(){super(...arguments);h(this,"name","InvalidDataLengthError");h(this,"code","ERR_MSG_DATA_TOO_LONG")}}class KC extends Error{constructor(){super(...arguments);h(this,"name","InvalidDataLengthLengthError");h(this,"code","ERR_MSG_LENGTH_TOO_LONG")}}function Mo(r,e={}){const t=Yu(r,e);e.maxDataLength!=null&&e.maxLengthLength==null&&(e.maxLengthLength=nr(e.maxDataLength));const n=(e==null?void 0:e.lengthDecoder)??sl,i=(e==null?void 0:e.lengthEncoder)??ms;return{read:async o=>{let a=-1;const c=new je;for(;;){c.append(await t.read({...o,bytes:1}));try{a=n(c)}catch(l){if(l instanceof RangeError)continue;throw l}if(a<0)throw new VC("Invalid message length");if((e==null?void 0:e.maxLengthLength)!=null&&c.byteLength>e.maxLengthLength)throw new KC("message length length too long");if(a>-1)break}if((e==null?void 0:e.maxDataLength)!=null&&a>e.maxDataLength)throw new qC("message length too long");return t.read({...o,bytes:a})},write:async(o,a)=>{await t.write(new je(i(o.byteLength),o),a)},writeV:async(o,a)=>{const c=new je(...o.flatMap(l=>[i(l.byteLength),l]));await t.write(c,a)},unwrap:()=>t.unwrap()}}function C6(){const r=St();let e=!1;return{sink:async t=>{if(e)throw new Error("already piped");e=!0,r.resolve(t)},source:async function*(){yield*await r.promise}()}}function HC(){const r=C6(),e=C6();return[{source:r.source,sink:e.sink},{source:e.source,sink:r.sink}]}class k6{constructor(e){h(this,"buffer");h(this,"mask");h(this,"top");h(this,"btm");h(this,"next");if(!(e>0)||(e-1&e)!==0)throw new Error("Max size for a FixedFIFO should be a power of two");this.buffer=new Array(e),this.mask=e-1,this.top=0,this.btm=0,this.next=null}push(e){return this.buffer[this.top]!==void 0?!1:(this.buffer[this.top]=e,this.top=this.top+1&this.mask,!0)}shift(){const e=this.buffer[this.btm];if(e!==void 0)return this.buffer[this.btm]=void 0,this.btm=this.btm+1&this.mask,e}isEmpty(){return this.buffer[this.btm]===void 0}}class td{constructor(e={}){h(this,"size");h(this,"hwm");h(this,"head");h(this,"tail");this.hwm=e.splitLimit??16,this.head=new k6(this.hwm),this.tail=this.head,this.size=0}calculateSize(e){return(e==null?void 0:e.byteLength)!=null?e.byteLength:1}push(e){if((e==null?void 0:e.value)!=null&&(this.size+=this.calculateSize(e.value)),!this.head.push(e)){const t=this.head;this.head=t.next=new k6(2*this.head.buffer.length),this.head.push(e)}}shift(){let e=this.tail.shift();if(e===void 0&&this.tail.next!=null){const t=this.tail.next;this.tail.next=null,this.tail=t,e=this.tail.shift()}return(e==null?void 0:e.value)!=null&&(this.size-=this.calculateSize(e.value)),e}isEmpty(){return this.head.isEmpty()}}let jC=class extends Error{constructor(t,n){super(t??"The operation was aborted");h(this,"type");h(this,"code");this.type="aborted",this.code=n??"ABORT_ERR"}};function bi(r={}){return zC(t=>{const n=t.shift();if(n==null)return{done:!0};if(n.error!=null)throw n.error;return{done:n.done===!0,value:n.value}},r)}function zC(r,e){e=e??{};let t=e.onEnd,n=new td,i,s,o,a=St();const c=async()=>{try{return n.isEmpty()?o?{done:!0}:await new Promise((v,C)=>{s=N=>{s=null,n.push(N);try{v(r(n))}catch(O){C(O)}return i}}):r(n)}finally{n.isEmpty()&&queueMicrotask(()=>{a.resolve(),a=St()})}},l=v=>s!=null?s(v):(n.push(v),i),u=v=>(n=new td,s!=null?s({error:v}):(n.push({error:v}),i)),f=v=>{if(o)return i;if((e==null?void 0:e.objectMode)!==!0&&(v==null?void 0:v.byteLength)==null)throw new Error("objectMode was not true but tried to push non-Uint8Array value");return l({done:!1,value:v})},g=v=>o?i:(o=!0,v!=null?u(v):l({done:!0})),m=()=>(n=new td,g(),{done:!0}),w=v=>(g(v),{done:!0});if(i={[Symbol.asyncIterator](){return this},next:c,return:m,throw:w,push:f,end:g,get readableLength(){return n.size},onEmpty:async v=>{const C=v==null?void 0:v.signal;if(C==null||C.throwIfAborted(),n.isEmpty())return;let N,O;C!=null&&(N=new Promise((L,R)=>{O=()=>{R(new jC)},C.addEventListener("abort",O)}));try{await Promise.race([a.promise,N])}finally{O!=null&&C!=null&&(C==null||C.removeEventListener("abort",O))}}},t==null)return i;const x=i;return i={[Symbol.asyncIterator](){return this},next(){return x.next()},throw(v){return x.throw(v),t!=null&&(t(v),t=void 0),{done:!0}},return(){return x.return(),t!=null&&(t(),t=void 0),{done:!0}},push:f,end(v){return x.end(v),t!=null&&(t(v),t=void 0),i},get readableLength(){return x.readableLength},onEmpty:v=>x.onEmpty(v)},i}function WC(r){return r[Symbol.asyncIterator]!=null}async function GC(r,e,t){try{await Promise.all(r.map(async n=>{for await(const i of n)await e.push(i,{signal:t}),t.throwIfAborted()})),await e.end(void 0,{signal:t})}catch(n){await e.end(n,{signal:t}).catch(()=>{})}}async function*QC(r){const e=new AbortController,t=Wm();GC(r,t,e.signal).catch(()=>{});try{yield*t}finally{e.abort()}}function*YC(r){for(const e of r)yield*e}function Sc(...r){const e=[];for(const t of r)WC(t)||e.push(t);return e.length===r.length?YC(e):QC(r)}function Uo(r,...e){if(r==null)throw new Error("Empty pipeline");if(rd(r)){const n=r;r=()=>n.source}else if(Qm(r)||Gm(r)){const n=r;r=()=>n}const t=[r,...e];if(t.length>1&&rd(t[t.length-1])&&(t[t.length-1]=t[t.length-1].sink),t.length>2)for(let n=1;n<t.length-1;n++)rd(t[n])&&(t[n]=XC(t[n]));return ZC(...t)}const ZC=(...r)=>{let e;for(;r.length>0;)e=r.shift()(e);return e},Gm=r=>(r==null?void 0:r[Symbol.asyncIterator])!=null,Qm=r=>(r==null?void 0:r[Symbol.iterator])!=null,rd=r=>r==null?!1:r.sink!=null&&r.source!=null,XC=r=>e=>{const t=r.sink(e);if((t==null?void 0:t.then)!=null){const n=bi({objectMode:!0});t.then(()=>{n.end()},o=>{n.end(o)});let i;const s=r.source;if(Gm(s))i=async function*(){yield*s,n.end()};else if(Qm(s))i=function*(){yield*s,n.end()};else throw new Error("Unknown duplex source type - must be Iterable or AsyncIterable");return Sc(n,i())}return r.source},Ec=65535,T6=Ec-16;var Fg,$g;const cl=!!(($g=(Fg=globalThis.process)==null?void 0:Fg.env)!=null&&$g.DUMP_SESSION_KEYS);/*! noble-ciphers - MIT License (c) 2023 Paul Miller (paulmillr.com) */function Ym(r){return r instanceof Uint8Array||ArrayBuffer.isView(r)&&r.constructor.name==="Uint8Array"}function E0(r){if(typeof r!="boolean")throw new Error(`boolean expected, not ${r}`)}function nd(r){if(!Number.isSafeInteger(r)||r<0)throw new Error("positive integer expected, got "+r)}function Sr(r,...e){if(!Ym(r))throw new Error("Uint8Array expected");if(e.length>0&&!e.includes(r.length))throw new Error("Uint8Array expected of length "+e+", got length="+r.length)}function P6(r,e=!0){if(r.destroyed)throw new Error("Hash instance has been destroyed");if(e&&r.finished)throw new Error("Hash#digest() has already been called")}function JC(r,e){Sr(r);const t=e.outputLen;if(r.length<t)throw new Error("digestInto() expects output buffer of length at least "+t)}function $i(r){return new Uint32Array(r.buffer,r.byteOffset,Math.floor(r.byteLength/4))}function Fo(...r){for(let e=0;e<r.length;e++)r[e].fill(0)}function ek(r){return new DataView(r.buffer,r.byteOffset,r.byteLength)}const tk=new Uint8Array(new Uint32Array([287454020]).buffer)[0]===68;function rk(r){if(typeof r!="string")throw new Error("string expected");return new Uint8Array(new TextEncoder().encode(r))}function x0(r){if(typeof r=="string")r=rk(r);else if(Ym(r))r=A0(r);else throw new Error("Uint8Array expected, got "+typeof r);return r}function nk(r,e){if(e==null||typeof e!="object")throw new Error("options must be defined");return Object.assign(r,e)}function ik(r,e){if(r.length!==e.length)return!1;let t=0;for(let n=0;n<r.length;n++)t|=r[n]^e[n];return t===0}const sk=(r,e)=>{function t(n,...i){if(Sr(n),!tk)throw new Error("Non little-endian hardware is not yet supported");if(r.nonceLength!==void 0){const u=i[0];if(!u)throw new Error("nonce / iv required");r.varSizeNonce?Sr(u):Sr(u,r.nonceLength)}const s=r.tagLength;s&&i[1]!==void 0&&Sr(i[1]);const o=e(n,...i),a=(u,f)=>{if(f!==void 0){if(u!==2)throw new Error("cipher output not supported");Sr(f)}};let c=!1;return{encrypt(u,f){if(c)throw new Error("cannot encrypt() twice with same key + nonce");return c=!0,Sr(u),a(o.encrypt.length,f),o.encrypt(u,f)},decrypt(u,f){if(Sr(u),s&&u.length<s)throw new Error("invalid ciphertext length: smaller than tagLength="+s);return a(o.decrypt.length,f),o.decrypt(u,f)}}}return Object.assign(t,r),t};function B6(r,e,t=!0){if(e===void 0)return new Uint8Array(r);if(e.length!==r)throw new Error("invalid output length, expected "+r+", got: "+e.length);if(t&&!ak(e))throw new Error("invalid output, must be aligned");return e}function N6(r,e,t,n){if(typeof r.setBigUint64=="function")return r.setBigUint64(e,t,n);const i=BigInt(32),s=BigInt(4294967295),o=Number(t>>i&s),a=Number(t&s),c=4,l=0;r.setUint32(e+c,o,n),r.setUint32(e+l,a,n)}function ok(r,e,t){E0(t);const n=new Uint8Array(16),i=ek(n);return N6(i,0,BigInt(e),t),N6(i,8,BigInt(r),t),n}function ak(r){return r.byteOffset%4===0}function A0(r){return Uint8Array.from(r)}const Zm=r=>Uint8Array.from(r.split("").map(e=>e.charCodeAt(0))),ck=Zm("expand 16-byte k"),lk=Zm("expand 32-byte k"),uk=$i(ck),hk=$i(lk);function Ge(r,e){return r<<e|r>>>32-e}function _0(r){return r.byteOffset%4===0}const Kl=64,fk=16,Xm=2**32-1,O6=new Uint32Array;function dk(r,e,t,n,i,s,o,a){const c=i.length,l=new Uint8Array(Kl),u=$i(l),f=_0(i)&&_0(s),g=f?$i(i):O6,m=f?$i(s):O6;for(let w=0;w<c;o++){if(r(e,t,n,u,o,a),o>=Xm)throw new Error("arx: counter overflow");const x=Math.min(Kl,c-w);if(f&&x===Kl){const v=w/4;if(w%4!==0)throw new Error("arx: invalid block position");for(let C=0,N;C<fk;C++)N=v+C,m[N]=g[N]^u[C];w+=Kl;continue}for(let v=0,C;v<x;v++)C=w+v,s[C]=i[C]^l[v];w+=x}}function pk(r,e){const{allowShortKeys:t,extendNonceFn:n,counterLength:i,counterRight:s,rounds:o}=nk({allowShortKeys:!1,counterLength:8,counterRight:!1,rounds:20},e);if(typeof r!="function")throw new Error("core must be a function");return nd(i),nd(o),E0(s),E0(t),(a,c,l,u,f=0)=>{Sr(a),Sr(c),Sr(l);const g=l.length;if(u===void 0&&(u=new Uint8Array(g)),Sr(u),nd(f),f<0||f>=Xm)throw new Error("arx: counter overflow");if(u.length<g)throw new Error(`arx: output (${u.length}) is shorter than data (${g})`);const m=[];let w=a.length,x,v;if(w===32)m.push(x=A0(a)),v=hk;else if(w===16&&t)x=new Uint8Array(32),x.set(a),x.set(a,16),v=uk,m.push(x);else throw new Error(`arx: invalid 32-byte key, got length=${w}`);_0(c)||m.push(c=A0(c));const C=$i(x);if(n){if(c.length!==24)throw new Error("arx: extended nonce must be 24 bytes");n(v,C,$i(c.subarray(0,16)),C),c=c.subarray(16)}const N=16-i;if(N!==c.length)throw new Error(`arx: nonce must be ${N} or 16 bytes`);if(N!==12){const L=new Uint8Array(12);L.set(c,s?0:12-c.length),c=L,m.push(c)}const O=$i(c);return dk(r,v,C,O,l,u,f,o),Fo(...m),u}}const Vt=(r,e)=>r[e++]&255|(r[e++]&255)<<8;class gk{constructor(e){this.blockLen=16,this.outputLen=16,this.buffer=new Uint8Array(16),this.r=new Uint16Array(10),this.h=new Uint16Array(10),this.pad=new Uint16Array(8),this.pos=0,this.finished=!1,e=x0(e),Sr(e,32);const t=Vt(e,0),n=Vt(e,2),i=Vt(e,4),s=Vt(e,6),o=Vt(e,8),a=Vt(e,10),c=Vt(e,12),l=Vt(e,14);this.r[0]=t&8191,this.r[1]=(t>>>13|n<<3)&8191,this.r[2]=(n>>>10|i<<6)&7939,this.r[3]=(i>>>7|s<<9)&8191,this.r[4]=(s>>>4|o<<12)&255,this.r[5]=o>>>1&8190,this.r[6]=(o>>>14|a<<2)&8191,this.r[7]=(a>>>11|c<<5)&8065,this.r[8]=(c>>>8|l<<8)&8191,this.r[9]=l>>>5&127;for(let u=0;u<8;u++)this.pad[u]=Vt(e,16+2*u)}process(e,t,n=!1){const i=n?0:2048,{h:s,r:o}=this,a=o[0],c=o[1],l=o[2],u=o[3],f=o[4],g=o[5],m=o[6],w=o[7],x=o[8],v=o[9],C=Vt(e,t+0),N=Vt(e,t+2),O=Vt(e,t+4),L=Vt(e,t+6),R=Vt(e,t+8),F=Vt(e,t+10),K=Vt(e,t+12),H=Vt(e,t+14);let P=s[0]+(C&8191),U=s[1]+((C>>>13|N<<3)&8191),M=s[2]+((N>>>10|O<<6)&8191),$=s[3]+((O>>>7|L<<9)&8191),q=s[4]+((L>>>4|R<<12)&8191),G=s[5]+(R>>>1&8191),W=s[6]+((R>>>14|F<<2)&8191),j=s[7]+((F>>>11|K<<5)&8191),Q=s[8]+((K>>>8|H<<8)&8191),Y=s[9]+(H>>>5|i),ie=0,Se=ie+P*a+U*(5*v)+M*(5*x)+$*(5*w)+q*(5*m);ie=Se>>>13,Se&=8191,Se+=G*(5*g)+W*(5*f)+j*(5*u)+Q*(5*l)+Y*(5*c),ie+=Se>>>13,Se&=8191;let te=ie+P*c+U*a+M*(5*v)+$*(5*x)+q*(5*w);ie=te>>>13,te&=8191,te+=G*(5*m)+W*(5*g)+j*(5*f)+Q*(5*u)+Y*(5*l),ie+=te>>>13,te&=8191;let de=ie+P*l+U*c+M*a+$*(5*v)+q*(5*x);ie=de>>>13,de&=8191,de+=G*(5*w)+W*(5*m)+j*(5*g)+Q*(5*f)+Y*(5*u),ie+=de>>>13,de&=8191;let ae=ie+P*u+U*l+M*c+$*a+q*(5*v);ie=ae>>>13,ae&=8191,ae+=G*(5*x)+W*(5*w)+j*(5*m)+Q*(5*g)+Y*(5*f),ie+=ae>>>13,ae&=8191;let Ue=ie+P*f+U*u+M*l+$*c+q*a;ie=Ue>>>13,Ue&=8191,Ue+=G*(5*v)+W*(5*x)+j*(5*w)+Q*(5*m)+Y*(5*g),ie+=Ue>>>13,Ue&=8191;let Le=ie+P*g+U*f+M*u+$*l+q*c;ie=Le>>>13,Le&=8191,Le+=G*a+W*(5*v)+j*(5*x)+Q*(5*w)+Y*(5*m),ie+=Le>>>13,Le&=8191;let Te=ie+P*m+U*g+M*f+$*u+q*l;ie=Te>>>13,Te&=8191,Te+=G*c+W*a+j*(5*v)+Q*(5*x)+Y*(5*w),ie+=Te>>>13,Te&=8191;let wt=ie+P*w+U*m+M*g+$*f+q*u;ie=wt>>>13,wt&=8191,wt+=G*l+W*c+j*a+Q*(5*v)+Y*(5*x),ie+=wt>>>13,wt&=8191;let nt=ie+P*x+U*w+M*m+$*g+q*f;ie=nt>>>13,nt&=8191,nt+=G*u+W*l+j*c+Q*a+Y*(5*v),ie+=nt>>>13,nt&=8191;let ot=ie+P*v+U*x+M*w+$*m+q*g;ie=ot>>>13,ot&=8191,ot+=G*f+W*u+j*l+Q*c+Y*a,ie+=ot>>>13,ot&=8191,ie=(ie<<2)+ie|0,ie=ie+Se|0,Se=ie&8191,ie=ie>>>13,te+=ie,s[0]=Se,s[1]=te,s[2]=de,s[3]=ae,s[4]=Ue,s[5]=Le,s[6]=Te,s[7]=wt,s[8]=nt,s[9]=ot}finalize(){const{h:e,pad:t}=this,n=new Uint16Array(10);let i=e[1]>>>13;e[1]&=8191;for(let a=2;a<10;a++)e[a]+=i,i=e[a]>>>13,e[a]&=8191;e[0]+=i*5,i=e[0]>>>13,e[0]&=8191,e[1]+=i,i=e[1]>>>13,e[1]&=8191,e[2]+=i,n[0]=e[0]+5,i=n[0]>>>13,n[0]&=8191;for(let a=1;a<10;a++)n[a]=e[a]+i,i=n[a]>>>13,n[a]&=8191;n[9]-=8192;let s=(i^1)-1;for(let a=0;a<10;a++)n[a]&=s;s=~s;for(let a=0;a<10;a++)e[a]=e[a]&s|n[a];e[0]=(e[0]|e[1]<<13)&65535,e[1]=(e[1]>>>3|e[2]<<10)&65535,e[2]=(e[2]>>>6|e[3]<<7)&65535,e[3]=(e[3]>>>9|e[4]<<4)&65535,e[4]=(e[4]>>>12|e[5]<<1|e[6]<<14)&65535,e[5]=(e[6]>>>2|e[7]<<11)&65535,e[6]=(e[7]>>>5|e[8]<<8)&65535,e[7]=(e[8]>>>8|e[9]<<5)&65535;let o=e[0]+t[0];e[0]=o&65535;for(let a=1;a<8;a++)o=(e[a]+t[a]|0)+(o>>>16)|0,e[a]=o&65535;Fo(n)}update(e){P6(this),e=x0(e),Sr(e);const{buffer:t,blockLen:n}=this,i=e.length;for(let s=0;s<i;){const o=Math.min(n-this.pos,i-s);if(o===n){for(;n<=i-s;s+=n)this.process(e,s);continue}t.set(e.subarray(s,s+o),this.pos),this.pos+=o,s+=o,this.pos===n&&(this.process(t,0,!1),this.pos=0)}return this}destroy(){Fo(this.h,this.r,this.buffer,this.pad)}digestInto(e){P6(this),JC(e,this),this.finished=!0;const{buffer:t,h:n}=this;let{pos:i}=this;if(i){for(t[i++]=1;i<16;i++)t[i]=0;this.process(t,0,!0)}this.finalize();let s=0;for(let o=0;o<8;o++)e[s++]=n[o]>>>0,e[s++]=n[o]>>>8;return e}digest(){const{buffer:e,outputLen:t}=this;this.digestInto(e);const n=e.slice(0,t);return this.destroy(),n}}function mk(r){const e=(n,i)=>r(i).update(x0(n)).digest(),t=r(new Uint8Array(32));return e.outputLen=t.outputLen,e.blockLen=t.blockLen,e.create=n=>r(n),e}const yk=mk(r=>new gk(r));function wk(r,e,t,n,i,s=20){let o=r[0],a=r[1],c=r[2],l=r[3],u=e[0],f=e[1],g=e[2],m=e[3],w=e[4],x=e[5],v=e[6],C=e[7],N=i,O=t[0],L=t[1],R=t[2],F=o,K=a,H=c,P=l,U=u,M=f,$=g,q=m,G=w,W=x,j=v,Q=C,Y=N,ie=O,Se=L,te=R;for(let ae=0;ae<s;ae+=2)F=F+U|0,Y=Ge(Y^F,16),G=G+Y|0,U=Ge(U^G,12),F=F+U|0,Y=Ge(Y^F,8),G=G+Y|0,U=Ge(U^G,7),K=K+M|0,ie=Ge(ie^K,16),W=W+ie|0,M=Ge(M^W,12),K=K+M|0,ie=Ge(ie^K,8),W=W+ie|0,M=Ge(M^W,7),H=H+$|0,Se=Ge(Se^H,16),j=j+Se|0,$=Ge($^j,12),H=H+$|0,Se=Ge(Se^H,8),j=j+Se|0,$=Ge($^j,7),P=P+q|0,te=Ge(te^P,16),Q=Q+te|0,q=Ge(q^Q,12),P=P+q|0,te=Ge(te^P,8),Q=Q+te|0,q=Ge(q^Q,7),F=F+M|0,te=Ge(te^F,16),j=j+te|0,M=Ge(M^j,12),F=F+M|0,te=Ge(te^F,8),j=j+te|0,M=Ge(M^j,7),K=K+$|0,Y=Ge(Y^K,16),Q=Q+Y|0,$=Ge($^Q,12),K=K+$|0,Y=Ge(Y^K,8),Q=Q+Y|0,$=Ge($^Q,7),H=H+q|0,ie=Ge(ie^H,16),G=G+ie|0,q=Ge(q^G,12),H=H+q|0,ie=Ge(ie^H,8),G=G+ie|0,q=Ge(q^G,7),P=P+U|0,Se=Ge(Se^P,16),W=W+Se|0,U=Ge(U^W,12),P=P+U|0,Se=Ge(Se^P,8),W=W+Se|0,U=Ge(U^W,7);let de=0;n[de++]=o+F|0,n[de++]=a+K|0,n[de++]=c+H|0,n[de++]=l+P|0,n[de++]=u+U|0,n[de++]=f+M|0,n[de++]=g+$|0,n[de++]=m+q|0,n[de++]=w+G|0,n[de++]=x+W|0,n[de++]=v+j|0,n[de++]=C+Q|0,n[de++]=N+Y|0,n[de++]=O+ie|0,n[de++]=L+Se|0,n[de++]=R+te|0}const bk=pk(wk,{counterRight:!1,counterLength:4,allowShortKeys:!1}),vk=new Uint8Array(16),R6=(r,e)=>{r.update(e);const t=e.length%16;t&&r.update(vk.subarray(t))},Sk=new Uint8Array(32);function D6(r,e,t,n,i){const s=r(e,t,Sk),o=yk.create(s);i&&R6(o,i),R6(o,n);const a=ok(n.length,i?i.length:0,!0);o.update(a);const c=o.digest();return Fo(s,a),c}const Ek=r=>(e,t,n)=>({encrypt(s,o){const a=s.length;o=B6(a+16,o,!1),o.set(s);const c=o.subarray(0,-16);r(e,t,c,c,1);const l=D6(r,e,t,c,n);return o.set(l,a),Fo(l),o},decrypt(s,o){o=B6(s.length-16,o,!1);const a=s.subarray(0,-16),c=s.subarray(-16),l=D6(r,e,t,a,n);if(!ik(c,l))throw new Error("invalid tag");return o.set(s.subarray(0,-16)),r(e,t,o,o,1),Fo(l),o}}),L6=sk({blockSize:64,nonceLength:12,tagLength:16},Ek(bk));function xk(r,e,t){return W3(r),t===void 0&&(t=new Uint8Array(r.outputLen)),Ah(r,wc(t),wc(e))}const id=Uint8Array.from([0]),M6=Uint8Array.of();function Ak(r,e,t,n=32){W3(r),Ku(n);const i=r.outputLen;if(n>255*i)throw new Error("Length should be <= 255*HashLen");const s=Math.ceil(n/i);t===void 0&&(t=M6);const o=new Uint8Array(s*i),a=Ah.create(r,e),c=a._cloneInto(),l=new Uint8Array(a.outputLen);for(let u=0;u<s;u++)id[0]=u+1,c.update(u===0?M6:l).update(t).update(id).digestInto(l),o.set(l,i*u),a._cloneInto(c);return a.destroy(),c.destroy(),Es(l,id),o.slice(0,n)}const _k={hashSHA256(r){return Xa(r.subarray())},getHKDF(r,e){const t=xk(Xa,e,r),i=Ak(Xa,t,void 0,96),s=i.subarray(0,32),o=i.subarray(32,64),a=i.subarray(64,96);return[s,o,a]},generateX25519KeyPair(){const r=Fl.utils.randomPrivateKey();return{publicKey:Fl.getPublicKey(r),privateKey:r}},generateX25519KeyPairFromSeed(r){return{publicKey:Fl.getPublicKey(r),privateKey:r}},generateX25519SharedKey(r,e){return Fl.getSharedSecret(r.subarray(),e.subarray())},chaCha20Poly1305Encrypt(r,e,t,n){return L6(n,e,t).encrypt(r.subarray())},chaCha20Poly1305Decrypt(r,e,t,n,i){return L6(n,e,t).decrypt(r.subarray(),i)}},Ik=_k;function Ck(r){return{generateKeypair:r.generateX25519KeyPair,dh:(e,t)=>r.generateX25519SharedKey(e.privateKey,t).subarray(0,32),encrypt:r.chaCha20Poly1305Encrypt,decrypt:r.chaCha20Poly1305Decrypt,hash:r.hashSHA256,hkdf:r.getHKDF}}const Zu=r=>{const e=wn(2);return e[0]=r>>8,e[1]=r,e};Zu.bytes=2;const gu=r=>{if(r.length<2)throw RangeError("Could not decode int16BE");if(r instanceof Uint8Array){let e=0;return e+=r[0]<<8,e+=r[1],e}return r.getUint16(0)};gu.bytes=2;function kk(r){return{xxHandshakeSuccesses:r.registerCounter("libp2p_noise_xxhandshake_successes_total",{help:"Total count of noise xxHandshakes successes_"}),xxHandshakeErrors:r.registerCounter("libp2p_noise_xxhandshake_error_total",{help:"Total count of noise xxHandshakes errors"}),encryptedPackets:r.registerCounter("libp2p_noise_encrypted_packets_total",{help:"Total count of noise encrypted packets successfully"}),decryptedPackets:r.registerCounter("libp2p_noise_decrypted_packets_total",{help:"Total count of noise decrypted packets"}),decryptErrors:r.registerCounter("libp2p_noise_decrypt_errors_total",{help:"Total count of noise decrypt errors"})}}function Jm(r,e){!e.enabled||!cl||(r?(e(`LOCAL_STATIC_PUBLIC_KEY ${Be(r.publicKey,"hex")}`),e(`LOCAL_STATIC_PRIVATE_KEY ${Be(r.privateKey,"hex")}`)):e("Missing local static keys."))}function ey(r,e){!e.enabled||!cl||(r?(e(`LOCAL_PUBLIC_EPHEMERAL_KEY ${Be(r.publicKey,"hex")}`),e(`LOCAL_PRIVATE_EPHEMERAL_KEY ${Be(r.privateKey,"hex")}`)):e("Missing local ephemeral keys."))}function Tk(r,e){!e.enabled||!cl||e(r?`REMOTE_STATIC_PUBLIC_KEY ${Be(r.subarray(),"hex")}`:"Missing remote static public key.")}function ty(r,e){!e.enabled||!cl||e(r?`REMOTE_EPHEMERAL_PUBLIC_KEY ${Be(r.subarray(),"hex")}`:"Missing remote ephemeral keys.")}function ry(r,e,t){!t.enabled||!cl||(t(`CIPHER_STATE_1 ${r.n.getUint64()} ${r.k&&Be(r.k,"hex")}`),t(`CIPHER_STATE_2 ${e.n.getUint64()} ${e.k&&Be(e.k,"hex")}`))}function $o(r,e){if(r.length!==e.length)throw new Error("Inputs should have the same length");const t=wn(r.length);for(let n=0;n<r.length;n++)t[n]=r[n]^e[n];return t}const nh=class nh extends Error{constructor(t="Invalid crypto exchange"){super(t);h(this,"code");this.code=nh.code}};h(nh,"code","ERR_INVALID_CRYPTO_EXCHANGE");let tc=nh;const Pk=0,Bk=4294967295,Nk="Cipherstate has reached maximum n, a new handshake must be performed";class Ok{constructor(e=Pk){h(this,"n");h(this,"bytes");h(this,"view");this.n=e,this.bytes=dt(12),this.view=new DataView(this.bytes.buffer,this.bytes.byteOffset,this.bytes.byteLength),this.view.setUint32(4,e,!0)}increment(){this.n++,this.view.setUint32(4,this.n,!0)}getBytes(){return this.bytes}getUint64(){return this.n}assertValue(){if(this.n>Bk)throw new Error(Nk)}}const bo=dt(0);class Hl{constructor(e,t=void 0,n=0){h(this,"k");h(this,"n");h(this,"crypto");this.crypto=e,this.k=t,this.n=new Ok(n)}hasKey(){return!!this.k}encryptWithAd(e,t){if(!this.hasKey())return t;this.n.assertValue();const n=this.crypto.encrypt(t,this.n.getBytes(),e,this.k);return this.n.increment(),n}decryptWithAd(e,t,n){if(!this.hasKey())return t;this.n.assertValue();const i=this.crypto.decrypt(t,this.n.getBytes(),e,this.k,n);return this.n.increment(),i}}class Rk{constructor(e,t){h(this,"cs");h(this,"ck");h(this,"h");h(this,"crypto");this.crypto=e;const n=Ae(t,"utf-8");this.h=Lk(e,n),this.ck=this.h,this.cs=new Hl(e)}mixKey(e){const[t,n]=this.crypto.hkdf(this.ck,e);this.ck=t,this.cs=new Hl(this.crypto,n)}mixHash(e){this.h=this.crypto.hash(new je(this.h,e))}encryptAndHash(e){const t=this.cs.encryptWithAd(this.h,e);return this.mixHash(t),t}decryptAndHash(e){const t=this.cs.decryptWithAd(this.h,e);return this.mixHash(e),t}split(){const[e,t]=this.crypto.hkdf(this.ck,bo);return[new Hl(this.crypto,e),new Hl(this.crypto,t)]}}class Dk{constructor(e){h(this,"ss");h(this,"s");h(this,"e");h(this,"rs");h(this,"re");h(this,"initiator");h(this,"crypto");const{crypto:t,protocolName:n,prologue:i,initiator:s,s:o,e:a,rs:c,re:l}=e;this.crypto=t,this.ss=new Rk(t,n),this.ss.mixHash(i),this.initiator=s,this.s=o,this.e=a,this.rs=c,this.re=l}writeE(){if(this.e)throw new Error("ephemeral keypair is already set");const e=this.crypto.generateKeypair();return this.ss.mixHash(e.publicKey),this.e=e,e.publicKey}writeS(){if(!this.s)throw new Error("static keypair is not set");return this.ss.encryptAndHash(this.s.publicKey)}writeEE(){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.re))}writeES(){if(this.initiator){if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}else{if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}}writeSE(){if(this.initiator){if(!this.s)throw new Error("static keypair is not set");if(!this.re)throw new Error("remote ephemeral public key is not set");this.ss.mixKey(this.crypto.dh(this.s,this.re))}else{if(!this.e)throw new Error("ephemeral keypair is not set");if(!this.rs)throw new Error("remote static public key is not set");this.ss.mixKey(this.crypto.dh(this.e,this.rs))}}readE(e,t=0){if(this.re)throw new Error("remote ephemeral public key is already set");if(e.byteLength<t+32)throw new Error("message is not long enough");this.re=e.sublist(t,t+32),this.ss.mixHash(this.re)}readS(e,t=0){if(this.rs)throw new Error("remote static public key is already set");const n=32+(this.ss.cs.hasKey()?16:0);if(e.byteLength<t+n)throw new Error("message is not long enough");const i=e.sublist(t,t+n);return this.rs=this.ss.decryptAndHash(i),n}readEE(){this.writeEE()}readES(){this.writeES()}readSE(){this.writeSE()}}class ny extends Dk{writeMessageA(e){return new je(this.writeE(),this.ss.encryptAndHash(e))}writeMessageB(e){const t=this.writeE();this.writeEE();const n=this.writeS();return this.writeES(),new je(t,n,this.ss.encryptAndHash(e))}writeMessageC(e){const t=this.writeS();return this.writeSE(),new je(t,this.ss.encryptAndHash(e))}readMessageA(e){try{return this.readE(e),this.ss.decryptAndHash(e.sublist(32))}catch(t){throw new tc(`handshake stage 0 validation fail: ${t.message}`)}}readMessageB(e){try{this.readE(e),this.readEE();const t=this.readS(e,32);return this.readES(),this.ss.decryptAndHash(e.sublist(32+t))}catch(t){throw new tc(`handshake stage 1 validation fail: ${t.message}`)}}readMessageC(e){try{const t=this.readS(e);return this.readSE(),this.ss.decryptAndHash(e.sublist(t))}catch(t){throw new tc(`handshake stage 2 validation fail: ${t.message}`)}}}function Lk(r,e){if(e.length<=32){const t=dt(32);return t.set(e),t}else return r.hash(e)}var Xu;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.webtransportCerthashes!=null)for(const s of t.webtransportCerthashes)n.uint32(10),n.bytes(s);if(t.streamMuxers!=null)for(const s of t.streamMuxers)n.uint32(18),n.string(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={webtransportCerthashes:[],streamMuxers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{if(((a=i.limits)==null?void 0:a.webtransportCerthashes)!=null&&s.webtransportCerthashes.length===i.limits.webtransportCerthashes)throw new Dt('Decode error - map field "webtransportCerthashes" had too many elements');s.webtransportCerthashes.push(t.bytes());break}case 2:{if(((c=i.limits)==null?void 0:c.streamMuxers)!=null&&s.streamMuxers.length===i.limits.streamMuxers)throw new Dt('Decode error - map field "streamMuxers" had too many elements');s.streamMuxers.push(t.string());break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(Xu||(Xu={}));var Ju;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.identityKey!=null&&t.identityKey.byteLength>0&&(n.uint32(10),n.bytes(t.identityKey)),t.identitySig!=null&&t.identitySig.byteLength>0&&(n.uint32(18),n.bytes(t.identitySig)),t.extensions!=null&&(n.uint32(34),Xu.codec().encode(t.extensions,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={identityKey:dt(0),identitySig:dt(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.identityKey=t.bytes();break}case 2:{s.identitySig=t.bytes();break}case 4:{s.extensions=Xu.codec().decode(t,t.uint32(),{limits:(a=i.limits)==null?void 0:a.extensions});break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(Ju||(Ju={}));async function iy(r,e,t){const n=await r.sign(oy(e));return Ju.encode({identityKey:Yr(r.publicKey),identitySig:n,extensions:t})}async function sy(r,e,t){try{const n=Ju.decode(r),i=tn(n.identityKey);if((t==null?void 0:t.equals(i))===!1)throw new Error(`Payload identity key ${i} does not match expected remote identity key ${t}`);if(!e)throw new Error("Remote static does not exist");const s=oy(e);if(!await i.verify(s,n.identitySig))throw new Error("Invalid payload signature");return n}catch(n){throw new R9(n.message)}}function oy(r){const e=Ae("noise-libp2p-static-key:");return r instanceof Uint8Array?Jr([e,r],e.length+r.length):(r.prepend(e),r)}async function Mk(r,e){const{log:t,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,u=await iy(s,a.publicKey,l),f=new ny({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!0,prologue:o,s:a});Jm(f.s,t),t.trace("Stage 0 - Initiator starting to send first message."),await n.write(f.writeMessageA(bo),e),t.trace("Stage 0 - Initiator finished sending first message."),ey(f.e,t),t.trace("Stage 1 - Initiator waiting to receive first message from responder...");const g=f.readMessageB(await n.read(e));t.trace("Stage 1 - Initiator received the message."),ty(f.re,t),Tk(f.rs,t),t.trace("Initiator going to check remote's signature...");const m=await sy(g,f.rs,c);t.trace("All good with the signature!"),t.trace("Stage 2 - Initiator sending third handshake message."),await n.write(f.writeMessageC(u),e),t.trace("Stage 2 - Initiator sent message with signed payload.");const[w,x]=f.ss.split();return ry(w,x,t),{payload:m,encrypt:v=>w.encryptWithAd(bo,v),decrypt:(v,C)=>x.decryptWithAd(bo,v,C)}}async function Uk(r,e){const{log:t,connection:n,crypto:i,privateKey:s,prologue:o,s:a,remoteIdentityKey:c,extensions:l}=r,u=await iy(s,a.publicKey,l),f=new ny({crypto:i,protocolName:"Noise_XX_25519_ChaChaPoly_SHA256",initiator:!1,prologue:o,s:a});Jm(f.s,t),t.trace("Stage 0 - Responder waiting to receive first message."),f.readMessageA(await n.read(e)),t.trace("Stage 0 - Responder received first message."),ty(f.re,t),t.trace("Stage 1 - Responder sending out first message with signed payload and static key."),await n.write(f.writeMessageB(u),e),t.trace("Stage 1 - Responder sent the second handshake message with signed payload."),ey(f.e,t),t.trace("Stage 2 - Responder waiting for third handshake message...");const g=f.readMessageC(await n.read(e));t.trace("Stage 2 - Responder received the message, finished handshake.");const m=await sy(g,f.rs,c),[w,x]=f.ss.split();return ry(w,x,t),{payload:m,encrypt:v=>x.encryptWithAd(bo,v),decrypt:(v,C)=>w.decryptWithAd(bo,v,C)}}const U6=16;function Fk(r,e){return async function*(t){for await(const n of t)for(let i=0;i<n.length;i+=T6){let s=i+T6;s>n.length&&(s=n.length);let o;n instanceof Uint8Array?o=r.encrypt(n.subarray(i,s)):o=r.encrypt(n.sublist(i,s)),e==null||e.encryptedPackets.increment(),yield new je(Zu(o.byteLength),o)}}}function $k(r,e){return async function*(t){for await(const n of t)for(let i=0;i<n.length;i+=Ec){let s=i+Ec;if(s>n.length&&(s=n.length),s-U6<i)throw new Error("Invalid chunk");const o=n.sublist(i,s),a=n.subarray(i,s-U6);try{const c=r.decrypt(o,a);e==null||e.decryptedPackets.increment(),yield c}catch(c){throw e==null||e.decryptErrors.increment(),c}}}}var Vg,qg;qg=Symbol.toStringTag,Vg=Xr;class Vk{constructor(e,t={}){h(this,"protocol","/noise");h(this,"crypto");h(this,"prologue");h(this,"staticKey");h(this,"extensions");h(this,"metrics");h(this,"components");h(this,qg,"@chainsafe/libp2p-noise");h(this,Vg,["@libp2p/connection-encryption","@chainsafe/libp2p-noise"]);const{staticNoiseKey:n,extensions:i,crypto:s,prologueBytes:o}=t,{metrics:a}=e;this.components=e;const c=s??Ik;this.crypto=Ck(c),this.extensions={webtransportCerthashes:[],...i},this.metrics=a?kk(a):void 0,n?this.staticKey=c.generateX25519KeyPairFromSeed(n):this.staticKey=c.generateX25519KeyPair(),this.prologue=o??dt(0)}async secureOutbound(e,t){var a,c;const n=Mo(e,{lengthEncoder:Zu,lengthDecoder:gu,maxDataLength:Ec}),i=await this.performHandshakeInitiator(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(n,i);e.source=s.source,e.sink=s.sink;const o=tn(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:Is(o),streamMuxer:(t==null?void 0:t.skipStreamMuxerNegotiation)===!0?void 0:this.getStreamMuxer((c=i.payload.extensions)==null?void 0:c.streamMuxers)}}getStreamMuxer(e){if(e==null||e.length===0)return;const t=this.components.upgrader.getStreamMuxers();if(t!=null)for(const n of e){const i=t.get(n);if(i!=null)return i}if(e.length)throw new Ex("Early muxer negotiation was requested but the initiator and responder had no common muxers")}async secureInbound(e,t){var a,c;const n=Mo(e,{lengthEncoder:Zu,lengthDecoder:gu,maxDataLength:Ec}),i=await this.performHandshakeResponder(n,this.components.privateKey,(a=t==null?void 0:t.remotePeer)==null?void 0:a.publicKey,t),s=await this.createSecureConnection(n,i);e.source=s.source,e.sink=s.sink;const o=tn(i.payload.identityKey);return{conn:e,remoteExtensions:i.payload.extensions,remotePeer:Is(o),streamMuxer:(t==null?void 0:t.skipStreamMuxerNegotiation)===!0?void 0:this.getStreamMuxer((c=i.payload.extensions)==null?void 0:c.streamMuxers)}}async performHandshakeInitiator(e,t,n,i){var a,c;let s;const o=(i==null?void 0:i.skipStreamMuxerNegotiation)===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{s=await Mk({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:o,webtransportCerthashes:[],...this.extensions}},i),(a=this.metrics)==null||a.xxHandshakeSuccesses.increment()}catch(l){throw(c=this.metrics)==null||c.xxHandshakeErrors.increment(),l}return s}async performHandshakeResponder(e,t,n,i){var a,c;let s;const o=(i==null?void 0:i.skipStreamMuxerNegotiation)===!0?[]:[...this.components.upgrader.getStreamMuxers().keys()];try{s=await Uk({connection:e,privateKey:t,remoteIdentityKey:n,log:this.components.logger.forComponent("libp2p:noise:xxhandshake"),crypto:this.crypto,prologue:this.prologue,s:this.staticKey,extensions:{streamMuxers:o,webtransportCerthashes:[],...this.extensions}},i),(a=this.metrics)==null||a.xxHandshakeSuccesses.increment()}catch(l){throw(c=this.metrics)==null||c.xxHandshakeErrors.increment(),l}return s}async createSecureConnection(e,t){const[n,i]=HC(),s=e.unwrap();return await Uo(n,Fk(t,this.metrics),s,o=>vc(o,{lengthDecoder:gu}),$k(t,this.metrics),n),i}}function ay(r={}){return e=>new Vk(e,r)}function cy(r){if(r!=null){if(typeof r[Symbol.iterator]=="function")return r[Symbol.iterator]();if(typeof r[Symbol.asyncIterator]=="function")return r[Symbol.asyncIterator]();if(typeof r.next=="function")return r}throw new Error("argument is not an iterator or iterable")}class ls extends Error{constructor(e="The frame was invalid"){super(e),this.name="InvalidFrameError"}}h(ls,"name","InvalidFrameError");class c4 extends Error{constructor(e="Unrequested ping error"){super(e),this.name="UnrequestedPingError"}}h(c4,"name","UnrequestedPingError");class l4 extends Error{constructor(e="Unrequested ping error"){super(e),this.name="NotMatchingPingError"}}h(l4,"name","NotMatchingPingError");class ly extends Error{constructor(e="Invalid state"){super(e),this.name="InvalidStateError"}}h(ly,"name","InvalidStateError");class uy extends Error{constructor(e="Strean already exists"){super(e),this.name="StreamAlreadyExistsError"}}h(uy,"name","StreamAlreadyExistsError");class hy extends Error{constructor(e="Decode invalid version"){super(e),this.name="DecodeInvalidVersionError"}}h(hy,"name","DecodeInvalidVersionError");class fy extends Error{constructor(e="Both clients"){super(e),this.name="BothClientsError"}}h(fy,"name","BothClientsError");class u4 extends Error{constructor(e="Receive window exceeded"){super(e),this.name="ReceiveWindowExceededError"}}h(u4,"name","ReceiveWindowExceededError");const qk=new Set([ls.name,c4.name,l4.name,uy.name,hy.name,fy.name,u4.name]),h4=256*1024,Kk=16*1024*1024,Hk={enableKeepAlive:!0,keepAliveInterval:3e4,maxInboundStreams:1e3,maxOutboundStreams:1e3,initialStreamWindowSize:h4,maxStreamWindowSize:Kk,maxMessageSize:64*1024};function jk(r){if(r.keepAliveInterval<=0)throw new ke("keep-alive interval must be positive");if(r.maxInboundStreams<0)throw new ke("max inbound streams must be larger or equal 0");if(r.maxOutboundStreams<0)throw new ke("max outbound streams must be larger or equal 0");if(r.initialStreamWindowSize<h4)throw new ke("InitialStreamWindowSize must be larger or equal 256 kB");if(r.maxStreamWindowSize<r.initialStreamWindowSize)throw new ke("MaxStreamWindowSize must be larger than the InitialStreamWindowSize");if(r.maxStreamWindowSize>2**32-1)throw new ke("MaxStreamWindowSize must be less than equal MAX_UINT32");if(r.maxMessageSize<1024)throw new ke("MaxMessageSize must be greater than a kilobyte")}var Ot;(function(r){r[r.Data=0]="Data",r[r.WindowUpdate=1]="WindowUpdate",r[r.Ping=2]="Ping",r[r.GoAway=3]="GoAway"})(Ot||(Ot={}));var kt;(function(r){r[r.SYN=1]="SYN",r[r.ACK=2]="ACK",r[r.FIN=4]="FIN",r[r.RST=8]="RST"})(kt||(kt={}));Object.values(kt).filter(r=>typeof r!="string");const zk=0;var Cn;(function(r){r[r.NormalTermination=0]="NormalTermination",r[r.ProtocolError=1]="ProtocolError",r[r.InternalError=2]="InternalError"})(Cn||(Cn={}));const rc=12,F6=2**24;function Wk(r){if(r[0]!==zk)throw new ls("Invalid frame version");return{type:r[1],flag:(r[2]<<8)+r[3],streamID:r[4]*F6+(r[5]<<16)+(r[6]<<8)+r[7],length:r[8]*F6+(r[9]<<16)+(r[10]<<8)+r[11]}}class Gk{constructor(e){h(this,"source");h(this,"buffer");h(this,"frameInProgress");this.source=Qk(e),this.buffer=new je,this.frameInProgress=!1}async*emitFrames(){for await(const e of this.source)for(this.buffer.append(e);;){const t=this.readHeader();if(t===void 0)break;const{type:n,length:i}=t;n===Ot.Data?(this.frameInProgress=!0,yield{header:t,readData:this.readBytes.bind(this,i)}):yield{header:t}}}readHeader(){if(this.frameInProgress)throw new ly("decoding frame already in progress");if(this.buffer.length<rc)return;const e=Wk(this.buffer.subarray(0,rc));return this.buffer.consume(rc),e}async readBytes(e){if(this.buffer.length<e){for await(const n of this.source)if(this.buffer.append(n),this.buffer.length>=e)break}const t=this.buffer.sublist(0,e);return this.buffer.consume(e),this.frameInProgress=!1,t}}function Qk(r){if(r[Symbol.iterator]!==void 0){const e=r[Symbol.iterator]();return e.return=void 0,{[Symbol.iterator](){return e}}}else if(r[Symbol.asyncIterator]!==void 0){const e=r[Symbol.asyncIterator]();return e.return=void 0,{[Symbol.asyncIterator](){return e}}}else throw new Error("a source must be either an iterable or an async iterable")}function $6(r){const e=new Uint8Array(rc);return e[1]=r.type,e[2]=r.flag>>>8,e[3]=r.flag,e[4]=r.streamID>>>24,e[5]=r.streamID>>>16,e[6]=r.streamID>>>8,e[7]=r.streamID,e[8]=r.length>>>24,e[9]=r.length>>>16,e[10]=r.length>>>8,e[11]=r.length,e}function Yk(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}function dy(r,e){var n,i;const t=(i=(n=cy(r)).return)==null?void 0:i.call(n);Yk(t)&&t.catch(s=>{e.error("could not cause iterator to return",s)})}const Zk=5e3;function sd(r){return r==null?!1:typeof r.then=="function"&&typeof r.catch=="function"&&typeof r.finally=="function"}class py{constructor(e){h(this,"id");h(this,"direction");h(this,"timeline");h(this,"protocol");h(this,"metadata");h(this,"source");h(this,"status");h(this,"readStatus");h(this,"writeStatus");h(this,"log");h(this,"sinkController");h(this,"sinkEnd");h(this,"closed");h(this,"endErr");h(this,"streamSource");h(this,"onEnd");h(this,"onCloseRead");h(this,"onCloseWrite");h(this,"onReset");h(this,"onAbort");h(this,"sendCloseWriteTimeout");h(this,"sendingData");this.sinkController=new AbortController,this.sinkEnd=St(),this.closed=St(),this.log=e.log,this.status="open",this.readStatus="ready",this.writeStatus="ready",this.id=e.id,this.metadata=e.metadata??{},this.direction=e.direction,this.timeline={open:Date.now()},this.sendCloseWriteTimeout=e.sendCloseWriteTimeout??Zk,this.onEnd=e.onEnd,this.onCloseRead=e.onCloseRead,this.onCloseWrite=e.onCloseWrite,this.onReset=e.onReset,this.onAbort=e.onAbort,this.source=this.streamSource=bi({onEnd:t=>{t!=null?this.log.trace("source ended with error",t):this.log.trace("source ended"),this.onSourceEnd(t)}}),this.sink=this.sink.bind(this)}async sink(e){if(this.writeStatus!=="ready")throw new Lu(`writable end state is "${this.writeStatus}" not "ready"`);try{this.writeStatus="writing";const t={signal:this.sinkController.signal};if(this.direction==="outbound"){const i=this.sendNewStream(t);sd(i)&&await i}const n=()=>{dy(e,this.log)};try{this.sinkController.signal.addEventListener("abort",n),this.log.trace("sink reading from source");for await(let i of e){i=i instanceof Uint8Array?new je(i):i;const s=this.sendData(i,t);sd(s)&&(this.sendingData=St(),await s,this.sendingData.resolve(),this.sendingData=void 0)}}finally{this.sinkController.signal.removeEventListener("abort",n)}this.log.trace('sink finished reading from source, write status is "%s"',this.writeStatus),this.writeStatus==="writing"&&(this.writeStatus="closing",this.log.trace("send close write to remote"),await this.sendCloseWrite({signal:AbortSignal.timeout(this.sendCloseWriteTimeout)}),this.writeStatus="closed"),this.onSinkEnd()}catch(t){throw this.log.trace("sink ended with error, calling abort with error",t),this.abort(t),t}finally{this.log.trace("resolve sink end"),this.sinkEnd.resolve()}}onSourceEnd(e){var t;this.timeline.closeRead==null&&(this.timeline.closeRead=Date.now(),this.readStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseRead)==null||t.call(this),this.timeline.closeWrite!=null?(this.log.trace("source and sink ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("source ended, waiting for sink to end"))}onSinkEnd(e){var t;this.timeline.closeWrite==null&&(this.timeline.closeWrite=Date.now(),this.writeStatus="closed",e!=null&&this.endErr==null&&(this.endErr=e),(t=this.onCloseWrite)==null||t.call(this),this.timeline.closeRead!=null?(this.log.trace("sink and source ended"),this.timeline.close=Date.now(),this.status!=="aborted"&&this.status!=="reset"&&(this.status="closed"),this.onEnd!=null&&this.onEnd(this.endErr),this.closed.resolve()):this.log.trace("sink ended, waiting for source to end"))}async close(e){this.status==="open"&&(this.log.trace("closing gracefully"),this.status="closing",await Ht(Promise.all([this.closeWrite(e),this.closeRead(e),this.closed.promise]),e==null?void 0:e.signal),this.status="closed",this.log.trace("closed gracefully"))}async closeRead(e={}){if(this.readStatus==="closing"||this.readStatus==="closed")return;this.log.trace('closing readable end of stream with starting read status "%s"',this.readStatus);const t=this.readStatus;this.readStatus="closing",this.status!=="reset"&&this.status!=="aborted"&&this.timeline.closeRead==null&&(this.log.trace("send close read to remote"),await this.sendCloseRead(e)),t==="ready"&&(this.log.trace("ending internal source queue with %d queued bytes",this.streamSource.readableLength),this.streamSource.end()),this.log.trace("closed readable end of stream")}async closeWrite(e={}){this.writeStatus==="closing"||this.writeStatus==="closed"||(this.log.trace('closing writable end of stream with starting write status "%s"',this.writeStatus),this.writeStatus==="ready"&&(this.log.trace("sink was never sunk, sink an empty array"),await Ht(this.sink([]),e.signal)),this.writeStatus==="writing"&&(this.sendingData!=null&&await Ht(this.sendingData.promise,e.signal),this.log.trace("aborting source passed to .sink"),this.sinkController.abort(),await Ht(this.sinkEnd.promise,e.signal)),this.writeStatus="closed",this.log.trace("closed writable end of stream"))}abort(e){var n;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;this.log("abort with error",e),this.log("try to send reset to remote");const t=this.sendReset();sd(t)&&t.catch(i=>{this.log.error("error sending reset message",i)}),this.status="aborted",this.timeline.abort=Date.now(),this._closeSinkAndSource(e),(n=this.onAbort)==null||n.call(this,e)}reset(){var t;if(this.status==="closed"||this.status==="aborted"||this.status==="reset")return;const e=new M9("stream reset");this.status="reset",this.timeline.reset=Date.now(),this._closeSinkAndSource(e),(t=this.onReset)==null||t.call(this)}_closeSinkAndSource(e){this._closeSink(e),this._closeSource(e)}_closeSink(e){this.writeStatus==="writing"&&(this.log.trace("end sink source"),this.sinkController.abort()),this.onSinkEnd(e)}_closeSource(e){this.readStatus!=="closing"&&this.readStatus!=="closed"&&(this.log.trace("ending source with %d bytes to be read by consumer",this.streamSource.readableLength),this.readStatus="closing",this.streamSource.end(e))}remoteCloseWrite(){if(this.readStatus==="closing"||this.readStatus==="closed"){this.log("received remote close write but local source is already closed");return}this.log.trace("remote close write"),this._closeSource()}remoteCloseRead(){if(this.writeStatus==="closing"||this.writeStatus==="closed"){this.log("received remote close read but local sink is already closed");return}this.log.trace("remote close read"),this._closeSink()}destroy(){if(this.status==="closed"||this.status==="aborted"||this.status==="reset"){this.log("received destroy but we are already closed");return}this.log.trace("stream destroyed"),this._closeSinkAndSource()}sourcePush(e){this.streamSource.push(e)}sourceReadableLength(){return this.streamSource.readableLength}}function f4(r){const[e,t]=r[Symbol.asyncIterator]!=null?[r[Symbol.asyncIterator](),Symbol.asyncIterator]:[r[Symbol.iterator](),Symbol.iterator],n=[];return{peek:()=>e.next(),push:i=>{n.push(i)},next:()=>n.length>0?{done:!1,value:n.shift()}:e.next(),[t](){return this}}}function Xk(r){return r[Symbol.asyncIterator]!=null}function V6(r){return(r==null?void 0:r.then)!=null}function Jk(r,e){let t=0;if(Xk(r))return async function*(){for await(const c of r){const l=e(c,t++);V6(l)&&await l,yield c}}();const n=f4(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof(o==null?void 0:o.then)=="function")return async function*(){yield i;for(const c of n){const l=e(c,t++);V6(l)&&await l,yield c}}();const a=e;return function*(){yield i;for(const c of n)a(c,t++),yield c}()}var fn;(function(r){r[r.Init=0]="Init",r[r.SYNSent=1]="SYNSent",r[r.SYNReceived=2]="SYNReceived",r[r.Established=3]="Established",r[r.Finished=4]="Finished"})(fn||(fn={}));class eT extends py{constructor(t){super({...t,onEnd:n=>{var i;this.state=fn.Finished,(i=t.onEnd)==null||i.call(t,n)}});h(this,"name");h(this,"state");h(this,"config");h(this,"_id");h(this,"sendWindowCapacity");h(this,"sendWindowCapacityUpdate");h(this,"recvWindow");h(this,"recvWindowCapacity");h(this,"epochStart");h(this,"getRTT");h(this,"sendFrame");this.config=t.config,this._id=parseInt(t.id,10),this.name=t.name,this.state=t.state,this.sendWindowCapacity=h4,this.recvWindow=this.config.initialStreamWindowSize,this.recvWindowCapacity=this.recvWindow,this.epochStart=Date.now(),this.getRTT=t.getRTT,this.sendFrame=t.sendFrame,this.source=Jk(this.source,()=>{this.sendWindowUpdate()})}async sendNewStream(){}async sendData(t,n={}){var i,s;for(t=t.sublist();t.byteLength!==0;){if(this.sendWindowCapacity===0&&((i=this.log)==null||i.trace("wait for send window capacity, status %s",this.status),await this.waitForSendWindowCapacity(n),this.status==="closed"||this.status==="aborted"||this.status==="reset")){(s=this.log)==null||s.trace("%s while waiting for send window capacity",this.status);return}const o=Math.min(this.sendWindowCapacity,this.config.maxMessageSize-rc,t.length),a=this.getSendFlags();this.sendFrame({type:Ot.Data,flag:a,streamID:this._id,length:o},t.sublist(0,o)),this.sendWindowCapacity-=o,t.consume(o)}}async sendReset(){this.sendFrame({type:Ot.WindowUpdate,flag:kt.RST,streamID:this._id,length:0})}async sendCloseWrite(){const t=this.getSendFlags()|kt.FIN;this.sendFrame({type:Ot.WindowUpdate,flag:t,streamID:this._id,length:0})}async sendCloseRead(){}async waitForSendWindowCapacity(t={}){var o,a;if(this.sendWindowCapacity>0)return;let n,i;const s=()=>{this.status==="open"||this.status==="closing"?i(new Hi("Stream aborted")):n()};(o=t.signal)==null||o.addEventListener("abort",s);try{await new Promise((c,l)=>{this.sendWindowCapacityUpdate=()=>{c()},i=l,n=c})}finally{(a=t.signal)==null||a.removeEventListener("abort",s)}}handleWindowUpdate(t){var i,s;(i=this.log)==null||i.trace("stream received window update id=%s",this._id),this.processFlags(t.flag);const n=this.sendWindowCapacity;this.sendWindowCapacity+=t.length,n===0&&t.length>0&&((s=this.sendWindowCapacityUpdate)==null||s.call(this))}async handleData(t,n){var s;if((s=this.log)==null||s.trace("stream received data id=%s",this._id),this.processFlags(t.flag),this.recvWindowCapacity<t.length)throw new u4("Receive window exceeded");const i=await n();this.recvWindowCapacity-=t.length,this.sourcePush(i)}processFlags(t){(t&kt.ACK)===kt.ACK&&this.state===fn.SYNSent&&(this.state=fn.Established),(t&kt.FIN)===kt.FIN&&this.remoteCloseWrite(),(t&kt.RST)===kt.RST&&this.reset()}getSendFlags(){switch(this.state){case fn.Init:return this.state=fn.SYNSent,kt.SYN;case fn.SYNReceived:return this.state=fn.Established,kt.ACK;default:return 0}}sendWindowUpdate(){const t=this.getSendFlags(),n=Date.now(),i=this.getRTT();if(t===0&&i>-1&&n-this.epochStart<i*4&&(this.recvWindow=Math.min(this.recvWindow*2,this.config.maxStreamWindowSize)),this.recvWindowCapacity>=this.recvWindow&&t===0)return;const s=this.recvWindow-this.recvWindowCapacity;this.recvWindowCapacity=this.recvWindow,this.epochStart=n,this.sendFrame({type:Ot.WindowUpdate,flag:t,streamID:this._id,length:s})}}const gy="/yamux/1.0.0",tT=500;var Kg,Hg;Hg=Symbol.toStringTag,Kg=Xr;class rT{constructor(e,t={}){h(this,"protocol",gy);h(this,"_components");h(this,"_init");h(this,Hg,"@chainsafe/libp2p-yamux");h(this,Kg,["@libp2p/stream-multiplexing"]);this._components=e,this._init=t}createStreamMuxer(e){return new nT(this._components,{...this._init,...e})}}class nT{constructor(e,t){h(this,"protocol",gy);h(this,"source");h(this,"sink");h(this,"config");h(this,"log");h(this,"logger");h(this,"closeController");h(this,"nextStreamID");h(this,"_streams");h(this,"nextPingID");h(this,"activePing");h(this,"rtt");h(this,"client");h(this,"localGoAway");h(this,"remoteGoAway");h(this,"numInboundStreams");h(this,"numOutboundStreams");h(this,"onIncomingStream");h(this,"onStreamEnd");var n;this.client=t.direction==="outbound",this.config={...Hk,...t},this.logger=e.logger,this.log=this.logger.forComponent("libp2p:yamux"),jk(this.config),this.closeController=new AbortController,this.closeController.signal,this.onIncomingStream=t.onIncomingStream,this.onStreamEnd=t.onStreamEnd,this._streams=new Map,this.source=bi({onEnd:()=>{var i;(i=this.log)==null||i.trace("muxer source ended"),this._streams.forEach(s=>{s.destroy()})}}),this.sink=async i=>{var c,l,u;const s=()=>{const f=cy(i);if(f.return!=null){const g=f.return();iT(g)&&g.catch(m=>{var w;(w=this.log)==null||w.call(this,"could not cause sink source to return",m)})}};let o,a;try{const f=new Gk(i);try{this.closeController.signal.addEventListener("abort",s);for await(const g of f.emitFrames())await this.handleFrame(g.header,g.readData)}finally{this.closeController.signal.removeEventListener("abort",s)}o=Cn.NormalTermination}catch(f){qk.has(f.name)?((c=this.log)==null||c.error("protocol error in sink",f),o=Cn.ProtocolError):((l=this.log)==null||l.error("internal error in sink",f),o=Cn.InternalError),a=f}(u=this.log)==null||u.trace("muxer sink ended"),a!=null?this.abort(a,o):await this.close({reason:o})},this.numInboundStreams=0,this.numOutboundStreams=0,this.nextStreamID=this.client?1:2,this.nextPingID=0,this.rtt=-1,(n=this.log)==null||n.trace("muxer created"),this.config.enableKeepAlive&&this.keepAliveLoop().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("keepalive error: %s",i)}),this.ping().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("ping error: %s",i)})}get streams(){return Array.from(this._streams.values())}newStream(e){var i;if(this.remoteGoAway!==void 0)throw new oo("Muxer closed remotely");if(this.localGoAway!==void 0)throw new oo("Muxer closed locally");const t=this.nextStreamID;if(this.nextStreamID+=2,this.numOutboundStreams>=this.config.maxOutboundStreams)throw new V3("max outbound streams exceeded");(i=this.log)==null||i.trace("new outgoing stream id=%s",t);const n=this._newStream(t,e,fn.Init,"outbound");return this._streams.set(t,n),this.numOutboundStreams++,n.sendWindowUpdate(),n}async ping(){if(this.remoteGoAway!==void 0)throw new oo("Muxer closed remotely");if(this.localGoAway!==void 0)throw new oo("Muxer closed locally");if(this.activePing===void 0){let e=()=>{};this.activePing={id:this.nextPingID++,promise:new Promise((i,s)=>{const o=()=>{s(new oo("Muxer closed locally"))};this.closeController.signal.addEventListener("abort",o,{once:!0}),e=()=>{this.closeController.signal.removeEventListener("abort",o),i()}}),resolve:e};const t=Date.now();this.sendPing(this.activePing.id);try{await this.activePing.promise}finally{delete this.activePing}const n=Date.now();this.rtt=n-t}else await this.activePing.promise;return this.rtt}getRTT(){return this.rtt}async close(e={}){var n;if(this.closeController.signal.aborted)return;const t=(e==null?void 0:e.reason)??Cn.NormalTermination;if((n=this.log)==null||n.trace("muxer close reason=%s",t),e.signal==null){const i=AbortSignal.timeout(tT);e={...e,signal:i}}try{await Promise.all([...this._streams.values()].map(async i=>i.close(e))),this.sendGoAway(t),this._closeMuxer()}catch(i){this.abort(i)}}abort(e,t){var n;if(!this.closeController.signal.aborted){t=t??Cn.InternalError,(n=this.log)==null||n.error("muxer abort reason=%s error=%s",t,e);for(const i of this._streams.values())i.abort(e);this.sendGoAway(t),this._closeMuxer()}}isClosed(){return this.closeController.signal.aborted}_closeMuxer(){this.closeController.abort(),this.source.end()}_newStream(e,t,n,i){if(this._streams.get(e)!=null)throw new ke("Stream already exists with that id");const s=new eT({id:e.toString(),name:t,state:n,direction:i,sendFrame:this.sendFrame.bind(this),onEnd:()=>{var o;this.closeStream(e),(o=this.onStreamEnd)==null||o.call(this,s)},log:this.logger.forComponent(`libp2p:yamux:${i}:${e}`),config:this.config,getRTT:this.getRTT.bind(this)});return s}closeStream(e){this.client===(e%2===0)?this.numInboundStreams--:this.numOutboundStreams--,this._streams.delete(e)}async keepAliveLoop(){var t;const e=new Promise((n,i)=>{this.closeController.signal.addEventListener("abort",i,{once:!0})});for((t=this.log)==null||t.trace("muxer keepalive enabled interval=%s",this.config.keepAliveInterval);;){let n;try{await Promise.race([e,new Promise(i=>{n=setTimeout(i,this.config.keepAliveInterval)})]),this.ping().catch(i=>{var s;return(s=this.log)==null?void 0:s.error("ping error: %s",i)})}catch{clearInterval(n);return}}}async handleFrame(e,t){var o;const{streamID:n,type:i,length:s}=e;if((o=this.log)==null||o.trace("received frame %o",e),n===0)switch(i){case Ot.Ping:{this.handlePing(e);return}case Ot.GoAway:{this.handleGoAway(s);return}default:throw new ls("Invalid frame type")}else switch(e.type){case Ot.Data:case Ot.WindowUpdate:{await this.handleStreamMessage(e,t);return}default:throw new ls("Invalid frame type")}}handlePing(e){var t,n;if(e.flag===kt.SYN)(t=this.log)==null||t.trace("received ping request pingId=%s",e.length),this.sendPing(e.length,kt.ACK);else if(e.flag===kt.ACK)(n=this.log)==null||n.trace("received ping response pingId=%s",e.length),this.handlePingResponse(e.length);else throw new ls("Invalid frame flag")}handlePingResponse(e){if(this.activePing===void 0)throw new c4("ping not requested");if(this.activePing.id!==e)throw new l4("ping doesn't match our id");this.activePing.resolve()}handleGoAway(e){var t;(t=this.log)==null||t.trace("received GoAway reason=%s",Cn[e]??"unknown"),this.remoteGoAway=e;for(const n of this._streams.values())n.reset();this._closeMuxer()}async handleStreamMessage(e,t){var a,c;const{streamID:n,flag:i,type:s}=e;(i&kt.SYN)===kt.SYN&&this.incomingStream(n);const o=this._streams.get(n);if(o===void 0){if(s===Ot.Data){if((a=this.log)==null||a.call(this,"discarding data for stream id=%s",n),t===void 0)throw new Error("unreachable");await t()}else(c=this.log)==null||c.trace("frame for missing stream id=%s",n);return}switch(s){case Ot.WindowUpdate:{o.handleWindowUpdate(e);return}case Ot.Data:{if(t===void 0)throw new Error("unreachable");await o.handleData(e,t);return}default:throw new Error("unreachable")}}incomingStream(e){var n,i,s;if(this.client!==(e%2===0))throw new ke("Both endpoints are clients");if(this._streams.has(e))return;if((n=this.log)==null||n.trace("new incoming stream id=%s",e),this.localGoAway!==void 0){this.sendFrame({type:Ot.WindowUpdate,flag:kt.RST,streamID:e,length:0});return}if(this.numInboundStreams>=this.config.maxInboundStreams){(i=this.log)==null||i.call(this,"maxIncomingStreams exceeded, forcing stream reset"),this.sendFrame({type:Ot.WindowUpdate,flag:kt.RST,streamID:e,length:0});return}const t=this._newStream(e,void 0,fn.SYNReceived,"inbound");this.numInboundStreams++,this._streams.set(e,t),(s=this.onIncomingStream)==null||s.call(this,t)}sendFrame(e,t){var n;if((n=this.log)==null||n.trace("sending frame %o",e),e.type===Ot.Data){if(t===void 0)throw new ls("Invalid frame");this.source.push(new je($6(e),t))}else this.source.push($6(e))}sendPing(e,t=kt.SYN){var n,i;t===kt.SYN?(n=this.log)==null||n.trace("sending ping request pingId=%s",e):(i=this.log)==null||i.trace("sending ping response pingId=%s",e),this.sendFrame({type:Ot.Ping,flag:t,streamID:0,length:e})}sendGoAway(e=Cn.NormalTermination){var t;(t=this.log)==null||t.call(this,"sending GoAway reason=%s",Cn[e]),this.localGoAway=e,this.sendFrame({type:Ot.GoAway,flag:0,streamID:0,length:e})}}function iT(r){return r!=null&&typeof r.then=="function"}function sT(r={}){return e=>new rT(e,r)}class Ur extends Error{constructor(){super(...arguments);h(this,"name","InvalidMultiaddrError")}}h(Ur,"name","InvalidMultiaddrError");class Vo extends Error{constructor(){super(...arguments);h(this,"name","ValidationError")}}h(Vo,"name","ValidationError");class my extends Error{constructor(){super(...arguments);h(this,"name","InvalidParametersError")}}h(my,"name","InvalidParametersError");class yy extends Error{constructor(){super(...arguments);h(this,"name","UnknownProtocolError")}}h(yy,"name","UnknownProtocolError");class oT{constructor(){h(this,"index",0);h(this,"input","")}new(e){return this.index=0,this.input=e,this}readAtomically(e){const t=this.index,n=e();return n===void 0&&(this.index=t),n}parseWith(e){const t=e();if(this.index===this.input.length)return t}peekChar(){if(!(this.index>=this.input.length))return this.input[this.index]}readChar(){if(!(this.index>=this.input.length))return this.input[this.index++]}readGivenChar(e){return this.readAtomically(()=>{const t=this.readChar();if(t===e)return t})}readSeparator(e,t,n){return this.readAtomically(()=>{if(!(t>0&&this.readGivenChar(e)===void 0))return n()})}readNumber(e,t,n,i){return this.readAtomically(()=>{let s=0,o=0;const a=this.peekChar();if(a===void 0)return;const c=a==="0",l=2**(8*i)-1;for(;;){const u=this.readAtomically(()=>{const f=this.readChar();if(f===void 0)return;const g=Number.parseInt(f,e);if(!Number.isNaN(g))return g});if(u===void 0)break;if(s*=e,s+=u,s>l||(o+=1,t!==void 0&&o>t))return}if(o!==0)return!n&&c&&o>1?void 0:s})}readIPv4Addr(){return this.readAtomically(()=>{const e=new Uint8Array(4);for(let t=0;t<e.length;t++){const n=this.readSeparator(".",t,()=>this.readNumber(10,3,!1,1));if(n===void 0)return;e[t]=n}return e})}readIPv6Addr(){const e=t=>{for(let n=0;n<t.length/2;n++){const i=n*2;if(n<t.length-3){const o=this.readSeparator(":",n,()=>this.readIPv4Addr());if(o!==void 0)return t[i]=o[0],t[i+1]=o[1],t[i+2]=o[2],t[i+3]=o[3],[i+4,!0]}const s=this.readSeparator(":",n,()=>this.readNumber(16,4,!0,2));if(s===void 0)return[i,!1];t[i]=s>>8,t[i+1]=s&255}return[t.length,!1]};return this.readAtomically(()=>{const t=new Uint8Array(16),[n,i]=e(t);if(n===16)return t;if(i||this.readGivenChar(":")===void 0||this.readGivenChar(":")===void 0)return;const s=new Uint8Array(14),o=16-(n+2),[a]=e(s.subarray(0,o));return t.set(s.subarray(0,a),16-a),t})}readIPAddr(){return this.readIPv4Addr()??this.readIPv6Addr()}}const wy=45,aT=15,qo=new oT;function by(r){if(!(r.length>aT))return qo.new(r).parseWith(()=>qo.readIPv4Addr())}function vy(r){if(r.includes("%")&&(r=r.split("%")[0]),!(r.length>wy))return qo.new(r).parseWith(()=>qo.readIPv6Addr())}function I0(r,e=!1){if(r.includes("%")&&(r=r.split("%")[0]),r.length>wy)return;const t=qo.new(r).parseWith(()=>qo.readIPAddr());if(t)return e&&t.length===4?Uint8Array.from([0,0,0,0,0,0,0,0,0,0,255,255,t[0],t[1],t[2],t[3]]):t}function Cs(r){return!!by(r)}function d4(r){return!!vy(r)}const Ko=4,C0=6,k0=273,cT=33,On=41,ua=42,lT=43,p4=53,g4=54,Ih=55,m4=56,uT=132,hT=301,fT=302,dT=400,Sy=421,pT=444,gT=445,mT=446,yT=447,wT=448,bT=449,vT=454,ST=460,ET=461,xT=465,AT=466,_T=480,IT=481,CT=443,kT=477,TT=478,PT=479,BT=277,NT=275,OT=276,RT=280,DT=281,Ey=290,LT=777;function q6(r){return e=>Be(e,r)}function K6(r){return e=>Ae(e,r)}function Fa(r){return new DataView(r.buffer).getUint16(r.byteOffset).toString()}function ao(r){const e=new ArrayBuffer(2);return new DataView(e).setUint16(0,typeof r=="string"?parseInt(r):r),new Uint8Array(e)}function MT(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==16)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion address.`);const t=Ae(e[0],"base32"),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=ao(n);return Jr([t,i],t.length+i.length)}function UT(r){const e=r.split(":");if(e.length!==2)throw new Error(`failed to parse onion addr: ["'${e.join('", "')}'"]' does not contain a port number`);if(e[0].length!==56)throw new Error(`failed to parse onion addr: ${e[0]} not a Tor onion3 address.`);const t=Fi.decode(`b${e[0]}`),n=parseInt(e[1],10);if(n<1||n>65536)throw new Error("Port number is not in range(1, 65536)");const i=ao(n);return Jr([t,i],t.length+i.length)}function H6(r){const e=r.subarray(0,r.length-2),t=r.subarray(r.length-2),n=Be(e,"base32"),i=Fa(t);return`${n}:${i}`}const xy=function(r){r=r.toString().trim();const e=new Uint8Array(4);return r.split(/\./g).forEach((t,n)=>{const i=parseInt(t,10);if(isNaN(i)||i<0||i>255)throw new Ur("Invalid byte value in IP address");e[n]=i}),e},FT=function(r){let e=0;r=r.toString().trim();const t=r.split(":",8);let n;for(n=0;n<t.length;n++){const s=Cs(t[n]);let o;s&&(o=xy(t[n]),t[n]=Be(o.subarray(0,2),"base16")),o!=null&&++n<8&&t.splice(n,0,Be(o.subarray(2,4),"base16"))}if(t[0]==="")for(;t.length<8;)t.unshift("0");else if(t[t.length-1]==="")for(;t.length<8;)t.push("0");else if(t.length<8){for(n=0;n<t.length&&t[n]!=="";n++);const s=[n,1];for(n=9-t.length;n>0;n--)s.push("0");t.splice.apply(t,s)}const i=new Uint8Array(e+16);for(n=0;n<t.length;n++){t[n]===""&&(t[n]="0");const s=parseInt(t[n],16);if(isNaN(s)||s<0||s>65535)throw new Ur("Invalid byte value in IP address");i[e++]=s>>8&255,i[e++]=s&255}return i},$T=function(r){if(r.byteLength!==4)throw new Ur("IPv4 address was incorrect length");const e=[];for(let t=0;t<r.byteLength;t++)e.push(r[t]);return e.join(".")},VT=function(r){if(r.byteLength!==16)throw new Ur("IPv6 address was incorrect length");const e=[];for(let n=0;n<r.byteLength;n+=2){const i=r[n],s=r[n+1],o=`${i.toString(16).padStart(2,"0")}${s.toString(16).padStart(2,"0")}`;e.push(o)}const t=e.join(":");try{const n=new URL(`http://[${t}]`);return n.hostname.substring(1,n.hostname.length-1)}catch{throw new Ur(`Invalid IPv6 address "${t}"`)}};function qT(r){try{const e=new URL(`http://[${r}]`);return e.hostname.substring(1,e.hostname.length-1)}catch{throw new Ur(`Invalid IPv6 address "${r}"`)}}const od=Object.values(qu).map(r=>r.decoder),KT=function(){let r=od[0].or(od[1]);return od.slice(2).forEach(e=>r=r.or(e)),r}();function HT(r){return KT.decode(r)}function jT(r){return e=>r.encoder.encode(e)}function zT(r){if(parseInt(r).toString()!==r)throw new Vo("Value must be an integer")}function WT(r){if(r<0)throw new Vo("Value must be a positive integer, or zero")}function GT(r){return e=>{if(e>r)throw new Vo(`Value must be smaller than or equal to ${r}`)}}function QT(...r){return e=>{for(const t of r)t(e)}}const jl=QT(zT,WT,GT(65535)),Xt=-1;let YT=class{constructor(){h(this,"protocolsByCode",new Map);h(this,"protocolsByName",new Map)}getProtocol(e){let t;if(typeof e=="string"?t=this.protocolsByName.get(e):t=this.protocolsByCode.get(e),t==null)throw new yy(`Protocol ${e} was unknown`);return t}addProtocol(e){var t;this.protocolsByCode.set(e.code,e),this.protocolsByName.set(e.name,e),(t=e.aliases)==null||t.forEach(n=>{this.protocolsByName.set(n,e)})}removeProtocol(e){var n;const t=this.protocolsByCode.get(e);t!=null&&(this.protocolsByCode.delete(t.code),this.protocolsByName.delete(t.name),(n=t.aliases)==null||n.forEach(i=>{this.protocolsByName.delete(i)}))}};const Rn=new YT,ZT=[{code:Ko,name:"ip4",size:32,valueToBytes:xy,bytesToValue:$T,validate:r=>{if(!Cs(r))throw new Vo(`Invalid IPv4 address "${r}"`)}},{code:C0,name:"tcp",size:16,valueToBytes:ao,bytesToValue:Fa,validate:jl},{code:k0,name:"udp",size:16,valueToBytes:ao,bytesToValue:Fa,validate:jl},{code:cT,name:"dccp",size:16,valueToBytes:ao,bytesToValue:Fa,validate:jl},{code:On,name:"ip6",size:128,valueToBytes:FT,bytesToValue:VT,stringToValue:qT,validate:r=>{if(!d4(r))throw new Vo(`Invalid IPv6 address "${r}"`)}},{code:ua,name:"ip6zone",size:Xt},{code:lT,name:"ipcidr",size:8,bytesToValue:q6("base10"),valueToBytes:K6("base10")},{code:p4,name:"dns",size:Xt,resolvable:!0},{code:g4,name:"dns4",size:Xt,resolvable:!0},{code:Ih,name:"dns6",size:Xt,resolvable:!0},{code:m4,name:"dnsaddr",size:Xt,resolvable:!0},{code:uT,name:"sctp",size:16,valueToBytes:ao,bytesToValue:Fa,validate:jl},{code:hT,name:"udt"},{code:fT,name:"utp"},{code:dT,name:"unix",size:Xt,path:!0,stringToValue:r=>decodeURIComponent(r),valueToString:r=>encodeURIComponent(r)},{code:Sy,name:"p2p",aliases:["ipfs"],size:Xt,bytesToValue:q6("base58btc"),valueToBytes:r=>r.startsWith("Q")||r.startsWith("1")?K6("base58btc")(r):it.parse(r).multihash.bytes},{code:pT,name:"onion",size:96,bytesToValue:H6,valueToBytes:MT},{code:gT,name:"onion3",size:296,bytesToValue:H6,valueToBytes:UT},{code:mT,name:"garlic64",size:Xt},{code:yT,name:"garlic32",size:Xt},{code:wT,name:"tls"},{code:bT,name:"sni",size:Xt},{code:vT,name:"noise"},{code:ST,name:"quic"},{code:ET,name:"quic-v1"},{code:xT,name:"webtransport"},{code:AT,name:"certhash",size:Xt,bytesToValue:jT(tl),valueToBytes:HT},{code:_T,name:"http"},{code:IT,name:"http-path",size:Xt,stringToValue:r=>`/${decodeURIComponent(r)}`,valueToString:r=>encodeURIComponent(r.substring(1))},{code:CT,name:"https"},{code:kT,name:"ws"},{code:TT,name:"wss"},{code:PT,name:"p2p-websocket-star"},{code:BT,name:"p2p-stardust"},{code:NT,name:"p2p-webrtc-star"},{code:OT,name:"p2p-webrtc-direct"},{code:RT,name:"webrtc-direct"},{code:DT,name:"webrtc"},{code:Ey,name:"p2p-circuit"},{code:LT,name:"memory",size:Xt}];ZT.forEach(r=>{Rn.addProtocol(r)});function XT(r){var n;const e=[];let t=0;for(;t<r.length;){const i=sl(r,t),s=Rn.getProtocol(i),o=nr(i),a=rP(s,r,t+o);let c=0;a>0&&s.size===Xt&&(c=nr(a));const l=o+c+a,u={code:i,name:s.name,bytes:r.subarray(t,t+l)};if(a>0){const f=t+o+c,g=r.subarray(f,f+a);u.value=((n=s.bytesToValue)==null?void 0:n.call(s,g))??Be(g)}e.push(u),t+=l}return e}function JT(r){var n;let e=0;const t=[];for(const i of r){if(i.bytes==null){const s=Rn.getProtocol(i.code),o=nr(i.code);let a,c=0,l=0;i.value!=null&&(a=((n=s.valueToBytes)==null?void 0:n.call(s,i.value))??Ae(i.value),c=a.byteLength,s.size===Xt&&(l=nr(c)));const u=new Uint8Array(o+l+c);let f=0;Wu(i.code,u,f),f+=o,a!=null&&(s.size===Xt&&(Wu(c,u,f),f+=l),u.set(a,f)),i.bytes=u}t.push(i.bytes),e+=i.bytes.byteLength}return Jr(t,e)}function eP(r){var s;if(r.charAt(0)!=="/")throw new Ur('String multiaddr must start with "/"');const e=[];let t="protocol",n="",i="";for(let o=1;o<r.length;o++){const a=r.charAt(o);a!=="/"&&(t==="protocol"?i+=r.charAt(o):n+=r.charAt(o));const c=o===r.length-1;if(a==="/"||c){const l=Rn.getProtocol(i);if(t==="protocol"){if(l.size==null||l.size===0){e.push({code:l.code,name:l.name}),n="",i="",t="protocol";continue}else if(c)throw new Ur(`Component ${i} was missing value`);t="value"}else if(t==="value"){const u={code:l.code,name:l.name};if(l.size!=null&&l.size!==0){if(n==="")throw new Ur(`Component ${i} was missing value`);u.value=((s=l.stringToValue)==null?void 0:s.call(l,n))??n}e.push(u),n="",i="",t="protocol"}}}if(i!==""&&n!=="")throw new Ur("Incomplete multiaddr");return e}function tP(r){return`/${r.flatMap(e=>{var n;if(e.value==null)return e.name;const t=Rn.getProtocol(e.code);if(t==null)throw new Ur(`Unknown protocol code ${e.code}`);return[e.name,((n=t.valueToString)==null?void 0:n.call(t,e.value))??e.value]}).join("/")}`}function rP(r,e,t){return r.size==null||r.size===0?0:r.size>0?r.size/8:sl(e,t)}const nP=Symbol.for("nodejs.util.inspect.custom"),Ay=Symbol.for("@multiformats/multiaddr"),iP=[p4,g4,Ih,m4];class sP extends Error{constructor(e="No available resolver"){super(e),this.name="NoAvailableResolverError"}}function oP(r){if(r==null&&(r="/"),Ch(r))return r.getComponents();if(r instanceof Uint8Array)return XT(r);if(typeof r=="string")return r=r.replace(/\/(\/)+/,"/").replace(/(\/)+$/,""),r===""&&(r="/"),eP(r);if(Array.isArray(r))return r;throw new Ur("Must be a string, Uint8Array, Component[], or another Multiaddr")}var jg,bt,Ao,_o;const ho=class ho{constructor(e="/",t={}){h(this,jg,!0);ut(this,bt);ut(this,Ao);ut(this,_o);mt(this,bt,oP(e)),t.validate!==!1&&aP(this)}get bytes(){return oe(this,_o)==null&&mt(this,_o,JT(oe(this,bt))),oe(this,_o)}toString(){return oe(this,Ao)==null&&mt(this,Ao,tP(oe(this,bt))),oe(this,Ao)}toJSON(){return this.toString()}toOptions(){let e,t,n,i,s="";for(const{code:a,name:c,value:l}of oe(this,bt))a===ua&&(s=`%${l??""}`),iP.includes(a)&&(t="tcp",i=443,n=`${l??""}${s}`,e=a===Ih?6:4),(a===C0||a===k0)&&(t=c==="tcp"?"tcp":"udp",i=parseInt(l??"")),(a===Ko||a===On)&&(t="tcp",n=`${l??""}${s}`,e=a===On?6:4);if(e==null||t==null||n==null||i==null)throw new Error('multiaddr must have a valid format: "/{ip4, ip6, dns4, dns6, dnsaddr}/{address}/{tcp, udp}/{port}".');return{family:e,host:n,transport:t,port:i}}getComponents(){return[...oe(this,bt)]}protos(){return oe(this,bt).map(({code:e,value:t})=>{const n=Rn.getProtocol(e);return{code:e,size:n.size??0,name:n.name,resolvable:!!n.resolvable,path:!!n.path}})}protoCodes(){return oe(this,bt).map(({code:e})=>e)}protoNames(){return oe(this,bt).map(({name:e})=>e)}tuples(){return oe(this,bt).map(({code:e,value:t})=>{var s;if(t==null)return[e];const n=Rn.getProtocol(e),i=[e];return t!=null&&i.push(((s=n.valueToBytes)==null?void 0:s.call(n,t))??Ae(t)),i})}stringTuples(){return oe(this,bt).map(({code:e,value:t})=>t==null?[e]:[e,t])}encapsulate(e){const t=new ho(e);return new ho([...oe(this,bt),...t.getComponents()],{validate:!1})}decapsulate(e){const t=e.toString(),n=this.toString(),i=n.lastIndexOf(t);if(i<0)throw new my(`Address ${this.toString()} does not contain subaddress: ${e.toString()}`);return new ho(n.slice(0,i),{validate:!1})}decapsulateCode(e){let t;for(let n=oe(this,bt).length-1;n>-1;n--)if(oe(this,bt)[n].code===e){t=n;break}return new ho(oe(this,bt).slice(0,t),{validate:!1})}getPeerId(){try{let e=[];oe(this,bt).forEach(({code:n,value:i})=>{n===Sy&&e.push([n,i]),n===Ey&&(e=[])});const t=e.pop();if((t==null?void 0:t[1])!=null){const n=t[1];return n[0]==="Q"||n[0]==="1"?Be(Rt.decode(`z${n}`),"base58btc"):Be(it.parse(n).multihash.bytes,"base58btc")}return null}catch{return null}}getPath(){for(const e of oe(this,bt))if(Rn.getProtocol(e.code).path)return e.value??null;return null}equals(e){return pt(this.bytes,e.bytes)}async resolve(e){const t=this.protos().find(s=>s.resolvable);if(t==null)return[this];const n=y4.get(t.name);if(n==null)throw new sP(`no available resolver for ${t.name}`);return(await n(this,e)).map(s=>Ze(s))}nodeAddress(){const e=this.toOptions();if(e.transport!=="tcp"&&e.transport!=="udp")throw new Error(`multiaddr must have a valid format - no protocol with name: "${e.transport}". Must have a valid transport protocol: "{tcp, udp}"`);return{family:e.family,address:e.host,port:e.port}}isThinWaistAddress(){return!(oe(this,bt).length!==2||oe(this,bt)[0].code!==Ko&&oe(this,bt)[0].code!==On||oe(this,bt)[1].code!==C0&&oe(this,bt)[1].code!==k0)}[(jg=Ay,nP)](){return`Multiaddr(${this.toString()})`}};bt=new WeakMap,Ao=new WeakMap,_o=new WeakMap;let T0=ho;function aP(r){r.getComponents().forEach(e=>{var n;const t=Rn.getProtocol(e.code);e.value!=null&&((n=t.validate)==null||n.call(t,e.value))})}function cP(r,e,t){let n=0;for(const i of r)if(!(n<e)){if(n>t)break;if(i!==255)return!1;n++}return!0}function lP(r,e,t,n){let i=0;for(const s of r)if(!(i<t)){if(i>n)break;if(s!==e[i])return!1;i++}return!0}function uP(r){switch(r.length){case xc:return r.join(".");case Ac:{const e=[];for(let t=0;t<r.length;t++)t%2===0&&e.push(r[t].toString(16).padStart(2,"0")+r[t+1].toString(16).padStart(2,"0"));return e.join(":")}default:throw new Error("Invalid ip length")}}function hP(r){let e=0;for(let[t,n]of r.entries()){if(n===255){e+=8;continue}for(;(n&128)!=0;)e++,n=n<<1;if((n&128)!=0)return-1;for(let i=t+1;i<r.length;i++)if(r[i]!=0)return-1;break}return e}function fP(r){let e="0x";for(const t of r)e+=(t>>4).toString(16)+(t&15).toString(16);return e}const xc=4,Ac=16,dP=new Uint8Array([0,0,0,0,0,0,0,0,0,0,255,255]);function _y(r,e){e.length===Ac&&r.length===xc&&cP(e,0,11)&&(e=e.slice(12)),e.length===xc&&r.length===Ac&&lP(r,dP,0,11)&&(r=r.slice(12));const t=r.length;if(t!=e.length)throw new Error("Failed to mask ip");const n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=r[i]&e[i];return n}function pP(r,e){if(typeof e=="string"&&(e=I0(e)),e==null)throw new Error("Invalid ip");if(e.length!==r.network.length)return!1;for(let t=0;t<e.length;t++)if((r.network[t]&r.mask[t])!==(e[t]&r.mask[t]))return!1;return!0}function gP(r){const[e,t]=r.split("/");if(!e||!t)throw new Error("Failed to parse given CIDR: "+r);let n=xc,i=by(e);if(i==null&&(n=Ac,i=vy(e),i==null))throw new Error("Failed to parse given CIDR: "+r);const s=parseInt(t,10);if(Number.isNaN(s)||String(s).length!==t.length||s<0||s>n*8)throw new Error("Failed to parse given CIDR: "+r);const o=Iy(s,8*n);return{network:_y(i,o),mask:o}}function Iy(r,e){if(e!==8*xc&&e!==8*Ac)throw new Error("Invalid CIDR mask");if(r<0||r>e)throw new Error("Invalid CIDR mask");const t=e/8,n=new Uint8Array(t);for(let i=0;i<t;i++){if(r>=8){n[i]=255,r-=8;continue}n[i]=255-(255>>r),r=0}return n}class Cy{constructor(e,t){if(t==null)({network:this.network,mask:this.mask}=gP(e));else{const n=I0(e);if(n==null)throw new Error("Failed to parse network");t=String(t);const i=parseInt(t,10);if(Number.isNaN(i)||String(i).length!==t.length||i<0||i>n.length*8){const s=I0(t);if(s==null)throw new Error("Failed to parse mask");this.mask=s}else this.mask=Iy(i,8*n.length);this.network=_y(n,this.mask)}}contains(e){return pP({network:this.network,mask:this.mask},e)}toString(){const e=hP(this.mask),t=e!==-1?String(e):fP(this.mask);return uP(this.network)+"/"+t}}function mP(r,e){return new Cy(r).contains(e)}function yP(r){let e,t;if(r.getComponents().forEach(n=>{(n.name==="ip4"||n.name==="ip6")&&(t=n.value),n.name==="ipcidr"&&(e=n.value)}),e==null||t==null)throw new Error("Invalid multiaddr");return new Cy(t,e)}const y4=new Map;function Ch(r){return!!(r!=null&&r[Ay])}function Ze(r){return new T0(r)}function dr(r){const e=Rn.getProtocol(r);return{code:e.code,size:e.size??0,name:e.name,resolvable:!!e.resolvable,path:!!e.path}}const wP=me("dns4"),bP=me("dns6"),vP=me("dnsaddr"),ks=Nt(me("dns"),vP,wP,bP),kh=Nt(me("ip4"),me("ip6")),Ho=Nt(Pe(kh,me("tcp")),Pe(ks,me("tcp"))),Th=Pe(kh,me("udp")),SP=Pe(Th,me("utp")),EP=Pe(Th,me("quic")),xP=Pe(Th,me("quic-v1")),P0=Nt(Pe(Ho,me("ws")),Pe(ks,me("ws"))),e1=Nt(Pe(P0,me("p2p")),P0),B0=Nt(Pe(Ho,me("wss")),Pe(ks,me("wss")),Pe(Ho,me("tls"),me("ws")),Pe(ks,me("tls"),me("ws"))),t1=Nt(Pe(B0,me("p2p")),B0),N0=Nt(Pe(Ho,me("http")),Pe(kh,me("http")),Pe(ks,me("http"))),O0=Nt(Pe(Ho,me("https")),Pe(kh,me("https")),Pe(ks,me("https"))),j6=Pe(Th,me("webrtc-direct"),me("certhash")),ky=Nt(Pe(j6,me("p2p")),j6),z6=Pe(xP,me("webtransport"),me("certhash"),me("certhash")),Ty=Nt(Pe(z6,me("p2p")),z6),Py=Nt(Pe(e1,me("p2p-webrtc-star"),me("p2p")),Pe(t1,me("p2p-webrtc-star"),me("p2p")),Pe(e1,me("p2p-webrtc-star")),Pe(t1,me("p2p-webrtc-star")));Nt(Pe(e1,me("p2p-websocket-star"),me("p2p")),Pe(t1,me("p2p-websocket-star"),me("p2p")),Pe(e1,me("p2p-websocket-star")),Pe(t1,me("p2p-websocket-star")));const By=Nt(Pe(N0,me("p2p-webrtc-direct"),me("p2p")),Pe(O0,me("p2p-webrtc-direct"),me("p2p")),Pe(N0,me("p2p-webrtc-direct")),Pe(O0,me("p2p-webrtc-direct"))),Ts=Nt(P0,B0,N0,O0,Py,By,Ho,SP,EP,ks,ky,Ty);Nt(Pe(Ts,me("p2p-stardust"),me("p2p")),Pe(Ts,me("p2p-stardust")));const Ri=Nt(Pe(Ts,me("p2p")),Py,By,ky,Ty,me("p2p")),W6=Nt(Pe(Ri,me("p2p-circuit"),Ri),Pe(Ri,me("p2p-circuit")),Pe(me("p2p-circuit"),Ri),Pe(Ts,me("p2p-circuit")),Pe(me("p2p-circuit"),Ts),me("p2p-circuit")),Ny=()=>Nt(Pe(W6,Ny),W6),ss=Ny(),AP=Nt(Pe(ss,Ri,ss),Pe(Ri,ss),Pe(ss,Ri),ss,Ri);Nt(Pe(ss,me("webrtc"),me("p2p")),Pe(ss,me("webrtc")),Pe(Ts,me("webrtc"),me("p2p")),Pe(Ts,me("webrtc")),me("webrtc"));function Oy(r){function e(t){let n;try{n=Ze(t)}catch{return!1}const i=r(n.protoNames());return i===null?!1:i===!0||i===!1?i:i.length===0}return e}function Pe(...r){function e(t){if(t.length<r.length)return null;let n=t;return r.some(i=>(n=typeof i=="function"?i().partialMatch(t):i.partialMatch(t),Array.isArray(n)&&(t=n),n===null)),n}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:Oy(e),partialMatch:e}}function Nt(...r){function e(n){let i=null;return r.some(s=>{const o=typeof s=="function"?s().partialMatch(n):s.partialMatch(n);return o!=null?(i=o,!0):!1}),i}return{toString:function(){return"{ "+r.join(" ")+" }"},input:r,matches:Oy(e),partialMatch:e}}function me(r){const e=r;function t(i){let s;try{s=Ze(i)}catch{return!1}const o=s.protoNames();return o.length===1&&o[0]===e}function n(i){return i.length===0?null:i[0]===e?i.slice(1):null}return{toString:function(){return e},matches:t,partialMatch:n}}const _P="bootstrap",IP=50,CP=1e3;var zg,Wg,Gg,Qg;class Ry extends(Qg=or,Gg=Ru,Wg=Symbol.toStringTag,zg=Xr,Qg){constructor(t,n={list:[]}){if(n.list==null||n.list.length===0)throw new Error("Bootstrap requires a list of peer addresses");super();h(this,"log");h(this,"timer");h(this,"list");h(this,"timeout");h(this,"components");h(this,"_init");h(this,Gg,this);h(this,Wg,"@libp2p/bootstrap");h(this,zg,["@libp2p/peer-discovery"]);this.components=t,this.log=t.logger.forComponent("libp2p:bootstrap"),this.timeout=n.timeout??CP,this.list=[];for(const i of n.list){if(!AP.matches(i)){this.log.error("Invalid multiaddr");continue}const s=Ze(i),o=s.getPeerId();if(o==null){this.log.error("Invalid bootstrap multiaddr without peer id");continue}const a={id:li(o),multiaddrs:[s]};this.list.push(a)}this._init=n}isStarted(){return!!this.timer}start(){this.isStarted()||(this.log("Starting bootstrap node discovery, discovering peers after %s ms",this.timeout),this.timer=setTimeout(()=>{this._discoverBootstrapPeers().catch(t=>{this.log.error(t)})},this.timeout))}async _discoverBootstrapPeers(){if(this.timer!=null)for(const t of this.list){if(await this.components.peerStore.merge(t.id,{tags:{[this._init.tagName??_P]:{value:this._init.tagValue??IP,ttl:this._init.tagTTL}},multiaddrs:t.multiaddrs}),this.timer==null)return;this.safeDispatchEvent("peer",{detail:t}),this.components.connectionManager.openConnection(t.id).catch(n=>{this.log.error("could not dial bootstrap peer %p",t.id,n)})}}stop(){this.timer!=null&&clearTimeout(this.timer),this.timer=void 0}}h(Ry,"tag","bootstrap");function kP(r){return e=>new Ry(e,r)}function nc(r,e){const t={[Symbol.iterator]:()=>t,next:()=>{const n=r.next(),i=n.value;return n.done===!0||i==null?{done:!0,value:void 0}:{done:!1,value:e(i)}}};return t}function ad(r){const e=$r(Rt.decode(`z${r}`));return bn(e)}class js{constructor(e){h(this,"map");if(this.map=new Map,e!=null)for(const[t,n]of e.entries())this.map.set(t.toString(),{key:t,value:n})}[Symbol.iterator](){return this.entries()}clear(){this.map.clear()}delete(e){return this.map.delete(e.toString())}entries(){return nc(this.map.entries(),e=>[e[1].key,e[1].value])}forEach(e){this.map.forEach((t,n)=>{e(t.value,t.key,this)})}get(e){var t;return(t=this.map.get(e.toString()))==null?void 0:t.value}has(e){return this.map.has(e.toString())}set(e,t){this.map.set(e.toString(),{key:e,value:t})}keys(){return nc(this.map.values(),e=>e.key)}values(){return nc(this.map.values(),e=>e.value)}get size(){return this.map.size}}class Dn{constructor(e){h(this,"set");if(this.set=new Set,e!=null)for(const t of e)this.set.add(t.toString())}get size(){return this.set.size}[Symbol.iterator](){return this.values()}add(e){this.set.add(e.toString())}clear(){this.set.clear()}delete(e){this.set.delete(e.toString())}entries(){return nc(this.set.entries(),e=>{const t=ad(e[0]);return[t,t]})}forEach(e){this.set.forEach(t=>{const n=ad(t);e(n,n,this)})}has(e){return this.set.has(e.toString())}values(){return nc(this.set.values(),e=>ad(e))}intersection(e){const t=new Dn;for(const n of e)this.has(n)&&t.add(n);return t}difference(e){const t=new Dn;for(const n of this)e.has(n)||t.add(n);return t}union(e){const t=new Dn;for(const n of e)t.add(n);for(const n of this)t.add(n);return t}}const w4={32:16777619n,64:1099511628211n,128:309485009821345068724781371n,256:374144419156711147060143317175368453031918731002211n,512:35835915874844867368919076489095108449946327955754392558399825615420669938882575126094039892345713852759n,1024:5016456510113118655434598811035278955030765345404790744303017523831112055108147451509157692220295382716162651878526895249385292291816524375083746691371804094271873160484737966720260389217684476157468082573n},Dy={32:2166136261n,64:14695981039346656037n,128:144066263297769815596495629667062367629n,256:100029257958052580907070968620625704837092796014241193945225284501741471925557n,512:9659303129496669498009435400716310466090418745672637896108374329434462657994582932197716438449813051892206539805784495328239340083876191928701583869517785n,1024:14197795064947621068722070641403218320880622795441933960878474914617582723252296732303717722150864096521202355549365628174669108571814760471015076148029755969804077320157692458563003215304957150157403644460363550505412711285966361610267868082893823963790439336411086884584107735010676915n},Ly=new globalThis.TextEncoder;function TP(r,e){const t=w4[e];let n=Dy[e];for(let i=0;i<r.length;i++)n^=BigInt(r[i]),n=BigInt.asUintN(e,n*t);return n}function PP(r,e,t){if(t.length===0)throw new Error("The `utf8Buffer` option must have a length greater than zero");const n=w4[e];let i=Dy[e],s=r;for(;s.length>0;){const o=Ly.encodeInto(s,t);s=s.slice(o.read);for(let a=0;a<o.written;a++)i^=BigInt(t[a]),i=BigInt.asUintN(e,i*n)}return i}function BP(r,{size:e=32,utf8Buffer:t}={}){if(!w4[e])throw new Error("The `size` option must be one of 32, 64, 128, 256, 512, or 1024");if(typeof r=="string"){if(t)return PP(r,e,t);r=Ly.encode(r)}return TP(r,e)}const b4={hash:r=>Number(BP(r,{size:32})),hashV:(r,e)=>NP(b4.hash(r,e))};function NP(r){let e=r.toString(16);return e.length%2===1&&(e=`0${e}`),Ae(e,"base16")}const My=64;class us{constructor(e,t,n,i=2){h(this,"fp");h(this,"h");h(this,"seed");if(i>My)throw new TypeError("Invalid Fingerprint Size");const s=t.hashV(e,n),o=dt(i);for(let a=0;a<o.length;a++)o[a]=s[a];o.length===0&&(o[0]=7),this.fp=o,this.h=t,this.seed=n}hash(){return this.h.hash(this.fp,this.seed)}equals(e){return(e==null?void 0:e.fp)instanceof Uint8Array?pt(this.fp,e.fp):!1}}function r1(r,e){return Math.floor(Math.random()*(e-r))+r}class zl{constructor(e){h(this,"contents");this.contents=new Array(e).fill(null)}has(e){if(!(e instanceof us))throw new TypeError("Invalid Fingerprint");return this.contents.some(t=>e.equals(t))}add(e){if(!(e instanceof us))throw new TypeError("Invalid Fingerprint");for(let t=0;t<this.contents.length;t++)if(this.contents[t]==null)return this.contents[t]=e,!0;return!0}swap(e){if(!(e instanceof us))throw new TypeError("Invalid Fingerprint");const t=r1(0,this.contents.length-1),n=this.contents[t];return this.contents[t]=e,n}remove(e){if(!(e instanceof us))throw new TypeError("Invalid Fingerprint");const t=this.contents.findIndex(n=>e.equals(n));return t>-1?(this.contents[t]=null,!0):!1}}const OP=500;class G6{constructor(e){h(this,"bucketSize");h(this,"filterSize");h(this,"fingerprintSize");h(this,"buckets");h(this,"count");h(this,"hash");h(this,"seed");this.filterSize=e.filterSize,this.bucketSize=e.bucketSize??4,this.fingerprintSize=e.fingerprintSize??2,this.count=0,this.buckets=[],this.hash=e.hash??b4,this.seed=e.seed??r1(0,Math.pow(2,10))}add(e){typeof e=="string"&&(e=Ae(e));const t=new us(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=(n^t.hash())%this.filterSize;if(this.buckets[n]==null&&(this.buckets[n]=new zl(this.bucketSize)),this.buckets[i]==null&&(this.buckets[i]=new zl(this.bucketSize)),this.buckets[n].add(t)||this.buckets[i].add(t))return this.count++,!0;const s=[n,i];let o=s[r1(0,s.length-1)];this.buckets[o]==null&&(this.buckets[o]=new zl(this.bucketSize));for(let a=0;a<OP;a++){const c=this.buckets[o].swap(t);if(c!=null&&(o=(o^c.hash())%this.filterSize,this.buckets[o]==null&&(this.buckets[o]=new zl(this.bucketSize)),this.buckets[o].add(c)))return this.count++,!0}return!1}has(e){var o,a;typeof e=="string"&&(e=Ae(e));const t=new us(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=((o=this.buckets[n])==null?void 0:o.has(t))??!1;if(i)return i;const s=(n^t.hash())%this.filterSize;return((a=this.buckets[s])==null?void 0:a.has(t))??!1}remove(e){var a,c;typeof e=="string"&&(e=Ae(e));const t=new us(e,this.hash,this.seed,this.fingerprintSize),n=this.hash.hash(e,this.seed)%this.filterSize,i=((a=this.buckets[n])==null?void 0:a.remove(t))??!1;if(i)return this.count--,i;const s=(n^t.hash())%this.filterSize,o=((c=this.buckets[s])==null?void 0:c.remove(t))??!1;return o&&this.count--,o}get reliable(){return Math.floor(100*(this.count/this.filterSize))<=90}}const RP={1:.5,2:.84,4:.95,8:.98};function DP(r=.001){return r>.002?2:r>1e-5?4:8}function LP(r,e=.001){const t=DP(e),n=RP[t],i=Math.round(r/n),s=Math.min(Math.ceil(Math.log2(1/e)+Math.log2(2*t)),My);return{filterSize:i,bucketSize:t,fingerprintSize:s}}class MP{constructor(e){h(this,"filterSize");h(this,"bucketSize");h(this,"fingerprintSize");h(this,"scale");h(this,"filterSeries");h(this,"hash");h(this,"seed");this.bucketSize=e.bucketSize??4,this.filterSize=e.filterSize??(1<<18)/this.bucketSize,this.fingerprintSize=e.fingerprintSize??2,this.scale=e.scale??2,this.hash=e.hash??b4,this.seed=e.seed??r1(0,Math.pow(2,10)),this.filterSeries=[new G6({filterSize:this.filterSize,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed})]}add(e){if(typeof e=="string"&&(e=Ae(e)),this.has(e))return!0;let t=this.filterSeries.find(n=>n.reliable);if(t==null){const n=this.filterSize*Math.pow(this.scale,this.filterSeries.length);t=new G6({filterSize:n,bucketSize:this.bucketSize,fingerprintSize:this.fingerprintSize,hash:this.hash,seed:this.seed}),this.filterSeries.push(t)}return t.add(e)}has(e){typeof e=="string"&&(e=Ae(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].has(e))return!0;return!1}remove(e){typeof e=="string"&&(e=Ae(e));for(let t=0;t<this.filterSeries.length;t++)if(this.filterSeries[t].remove(e))return!0;return!1}get count(){return this.filterSeries.reduce((e,t)=>e+t.count,0)}}function v4(r,e=.001,t){return new MP({...LP(r,e)})}class UP extends js{constructor(t){super();h(this,"metric");const{name:n,metrics:i}=t;this.metric=i.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function Uy(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new UP({name:e,metrics:t}):n=new js,n}var Q6=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function S4(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var cd={exports:{}},Y6;function FP(){return Y6||(Y6=1,function(r){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function i(c,l,u){this.fn=c,this.context=l,this.once=u||!1}function s(c,l,u,f,g){if(typeof u!="function")throw new TypeError("The listener must be a function");var m=new i(u,f||c,g),w=t?t+l:l;return c._events[w]?c._events[w].fn?c._events[w]=[c._events[w],m]:c._events[w].push(m):(c._events[w]=m,c._eventsCount++),c}function o(c,l){--c._eventsCount===0?c._events=new n:delete c._events[l]}function a(){this._events=new n,this._eventsCount=0}a.prototype.eventNames=function(){var l=[],u,f;if(this._eventsCount===0)return l;for(f in u=this._events)e.call(u,f)&&l.push(t?f.slice(1):f);return Object.getOwnPropertySymbols?l.concat(Object.getOwnPropertySymbols(u)):l},a.prototype.listeners=function(l){var u=t?t+l:l,f=this._events[u];if(!f)return[];if(f.fn)return[f.fn];for(var g=0,m=f.length,w=new Array(m);g<m;g++)w[g]=f[g].fn;return w},a.prototype.listenerCount=function(l){var u=t?t+l:l,f=this._events[u];return f?f.fn?1:f.length:0},a.prototype.emit=function(l,u,f,g,m,w){var x=t?t+l:l;if(!this._events[x])return!1;var v=this._events[x],C=arguments.length,N,O;if(v.fn){switch(v.once&&this.removeListener(l,v.fn,void 0,!0),C){case 1:return v.fn.call(v.context),!0;case 2:return v.fn.call(v.context,u),!0;case 3:return v.fn.call(v.context,u,f),!0;case 4:return v.fn.call(v.context,u,f,g),!0;case 5:return v.fn.call(v.context,u,f,g,m),!0;case 6:return v.fn.call(v.context,u,f,g,m,w),!0}for(O=1,N=new Array(C-1);O<C;O++)N[O-1]=arguments[O];v.fn.apply(v.context,N)}else{var L=v.length,R;for(O=0;O<L;O++)switch(v[O].once&&this.removeListener(l,v[O].fn,void 0,!0),C){case 1:v[O].fn.call(v[O].context);break;case 2:v[O].fn.call(v[O].context,u);break;case 3:v[O].fn.call(v[O].context,u,f);break;case 4:v[O].fn.call(v[O].context,u,f,g);break;default:if(!N)for(R=1,N=new Array(C-1);R<C;R++)N[R-1]=arguments[R];v[O].fn.apply(v[O].context,N)}}return!0},a.prototype.on=function(l,u,f){return s(this,l,u,f,!1)},a.prototype.once=function(l,u,f){return s(this,l,u,f,!0)},a.prototype.removeListener=function(l,u,f,g){var m=t?t+l:l;if(!this._events[m])return this;if(!u)return o(this,m),this;var w=this._events[m];if(w.fn)w.fn===u&&(!g||w.once)&&(!f||w.context===f)&&o(this,m);else{for(var x=0,v=[],C=w.length;x<C;x++)(w[x].fn!==u||g&&!w[x].once||f&&w[x].context!==f)&&v.push(w[x]);v.length?this._events[m]=v.length===1?v[0]:v:o(this,m)}return this},a.prototype.removeAllListeners=function(l){var u;return l?(u=t?t+l:l,this._events[u]&&o(this,u)):(this._events=new n,this._eventsCount=0),this},a.prototype.off=a.prototype.removeListener,a.prototype.addListener=a.prototype.on,a.prefixed=t,a.EventEmitter=a,r.exports=a}(cd)),cd.exports}var $P=FP();const VP=S4($P);class Fy extends Error{constructor(e){super(e),this.name="TimeoutError"}}let qP=class extends Error{constructor(e){super(),this.name="AbortError",this.message=e}};const Z6=r=>globalThis.DOMException===void 0?new qP(r):new DOMException(r),X6=r=>{const e=r.reason===void 0?Z6("This operation was aborted."):r.reason;return e instanceof Error?e:Z6(e)};function Ph(r,e){const{milliseconds:t,fallback:n,message:i,customTimers:s={setTimeout,clearTimeout}}=e;let o,a;const l=new Promise((u,f)=>{if(typeof t!="number"||Math.sign(t)!==1)throw new TypeError(`Expected \`milliseconds\` to be a positive number, got \`${t}\``);if(e.signal){const{signal:m}=e;m.aborted&&f(X6(m)),a=()=>{f(X6(m))},m.addEventListener("abort",a,{once:!0})}if(t===Number.POSITIVE_INFINITY){r.then(u,f);return}const g=new Fy;o=s.setTimeout.call(void 0,()=>{if(n){try{u(n())}catch(m){f(m)}return}typeof r.cancel=="function"&&r.cancel(),i===!1?u():i instanceof Error?f(i):(g.message=i??`Promise timed out after ${t} milliseconds`,f(g))},t),(async()=>{try{u(await r)}catch(m){f(m)}})()}).finally(()=>{l.clear(),a&&e.signal&&e.signal.removeEventListener("abort",a)});return l.clear=()=>{s.clearTimeout.call(void 0,o),o=void 0},l}function KP(r,e,t){let n=0,i=r.length;for(;i>0;){const s=Math.trunc(i/2);let o=n+s;t(r[o],e)<=0?(n=++o,i-=s+1):i=s}return n}var Kr,Yg;let HP=(Yg=class{constructor(){ut(this,Kr,[])}enqueue(e,t){t={priority:0,...t};const n={priority:t.priority,id:t.id,run:e};if(this.size===0||oe(this,Kr)[this.size-1].priority>=t.priority){oe(this,Kr).push(n);return}const i=KP(oe(this,Kr),n,(s,o)=>o.priority-s.priority);oe(this,Kr).splice(i,0,n)}setPriority(e,t){const n=oe(this,Kr).findIndex(s=>s.id===e);if(n===-1)throw new ReferenceError(`No promise function with the id "${e}" exists in the queue.`);const[i]=oe(this,Kr).splice(n,1);this.enqueue(i.run,{priority:t,id:e})}dequeue(){const e=oe(this,Kr).shift();return e==null?void 0:e.run}filter(e){return oe(this,Kr).filter(t=>t.priority===e.priority).map(t=>t.run)}get size(){return oe(this,Kr).length}},Kr=new WeakMap,Yg);var Io,Co,Bi,jc,ko,zc,Hr,To,lr,Wc,jr,Po,Zn,Gc,ih,Ye,Vy,qy,Ky,Hy,jy,mu,R0,D0,yu,zy,wu;class $y extends VP{constructor(t){var n,i;super();ut(this,Ye);ut(this,Io);ut(this,Co);ut(this,Bi,0);ut(this,jc);ut(this,ko);ut(this,zc,0);ut(this,Hr);ut(this,To);ut(this,lr);ut(this,Wc);ut(this,jr,0);ut(this,Po);ut(this,Zn);ut(this,Gc);ut(this,ih,1n);h(this,"timeout");if(t={carryoverConcurrencyCount:!1,intervalCap:Number.POSITIVE_INFINITY,interval:0,concurrency:Number.POSITIVE_INFINITY,autoStart:!0,queueClass:HP,...t},!(typeof t.intervalCap=="number"&&t.intervalCap>=1))throw new TypeError(`Expected \`intervalCap\` to be a number from 1 and up, got \`${((n=t.intervalCap)==null?void 0:n.toString())??""}\` (${typeof t.intervalCap})`);if(t.interval===void 0||!(Number.isFinite(t.interval)&&t.interval>=0))throw new TypeError(`Expected \`interval\` to be a finite number >= 0, got \`${((i=t.interval)==null?void 0:i.toString())??""}\` (${typeof t.interval})`);mt(this,Io,t.carryoverConcurrencyCount),mt(this,Co,t.intervalCap===Number.POSITIVE_INFINITY||t.interval===0),mt(this,jc,t.intervalCap),mt(this,ko,t.interval),mt(this,lr,new t.queueClass),mt(this,Wc,t.queueClass),this.concurrency=t.concurrency,this.timeout=t.timeout,mt(this,Gc,t.throwOnTimeout===!0),mt(this,Zn,t.autoStart===!1)}get concurrency(){return oe(this,Po)}set concurrency(t){if(!(typeof t=="number"&&t>=1))throw new TypeError(`Expected \`concurrency\` to be a number from 1 and up, got \`${t}\` (${typeof t})`);mt(this,Po,t),Ke(this,Ye,yu).call(this)}setPriority(t,n){oe(this,lr).setPriority(t,n)}async add(t,n={}){return n.id??(n.id=(Ia(this,ih)._++).toString()),n={timeout:this.timeout,throwOnTimeout:oe(this,Gc),...n},new Promise((i,s)=>{oe(this,lr).enqueue(async()=>{var o;Ia(this,jr)._++,Ia(this,Bi)._++;try{(o=n.signal)==null||o.throwIfAborted();let a=t({signal:n.signal});n.timeout&&(a=Ph(Promise.resolve(a),{milliseconds:n.timeout})),n.signal&&(a=Promise.race([a,Ke(this,Ye,zy).call(this,n.signal)]));const c=await a;i(c),this.emit("completed",c)}catch(a){if(a instanceof Fy&&!n.throwOnTimeout){i();return}s(a),this.emit("error",a)}finally{Ke(this,Ye,Ky).call(this)}},n),this.emit("add"),Ke(this,Ye,mu).call(this)})}async addAll(t,n){return Promise.all(t.map(async i=>this.add(i,n)))}start(){return oe(this,Zn)?(mt(this,Zn,!1),Ke(this,Ye,yu).call(this),this):this}pause(){mt(this,Zn,!0)}clear(){mt(this,lr,new(oe(this,Wc)))}async onEmpty(){oe(this,lr).size!==0&&await Ke(this,Ye,wu).call(this,"empty")}async onSizeLessThan(t){oe(this,lr).size<t||await Ke(this,Ye,wu).call(this,"next",()=>oe(this,lr).size<t)}async onIdle(){oe(this,jr)===0&&oe(this,lr).size===0||await Ke(this,Ye,wu).call(this,"idle")}get size(){return oe(this,lr).size}sizeBy(t){return oe(this,lr).filter(t).length}get pending(){return oe(this,jr)}get isPaused(){return oe(this,Zn)}}Io=new WeakMap,Co=new WeakMap,Bi=new WeakMap,jc=new WeakMap,ko=new WeakMap,zc=new WeakMap,Hr=new WeakMap,To=new WeakMap,lr=new WeakMap,Wc=new WeakMap,jr=new WeakMap,Po=new WeakMap,Zn=new WeakMap,Gc=new WeakMap,ih=new WeakMap,Ye=new WeakSet,Vy=function(){return oe(this,Co)||oe(this,Bi)<oe(this,jc)},qy=function(){return oe(this,jr)<oe(this,Po)},Ky=function(){Ia(this,jr)._--,Ke(this,Ye,mu).call(this),this.emit("next")},Hy=function(){Ke(this,Ye,D0).call(this),Ke(this,Ye,R0).call(this),mt(this,To,void 0)},jy=function(){const t=Date.now();if(oe(this,Hr)===void 0){const n=oe(this,zc)-t;if(n<0)mt(this,Bi,oe(this,Io)?oe(this,jr):0);else return oe(this,To)===void 0&&mt(this,To,setTimeout(()=>{Ke(this,Ye,Hy).call(this)},n)),!0}return!1},mu=function(){if(oe(this,lr).size===0)return oe(this,Hr)&&clearInterval(oe(this,Hr)),mt(this,Hr,void 0),this.emit("empty"),oe(this,jr)===0&&this.emit("idle"),!1;if(!oe(this,Zn)){const t=!oe(this,Ye,jy);if(oe(this,Ye,Vy)&&oe(this,Ye,qy)){const n=oe(this,lr).dequeue();return n?(this.emit("active"),n(),t&&Ke(this,Ye,R0).call(this),!0):!1}}return!1},R0=function(){oe(this,Co)||oe(this,Hr)!==void 0||(mt(this,Hr,setInterval(()=>{Ke(this,Ye,D0).call(this)},oe(this,ko))),mt(this,zc,Date.now()+oe(this,ko)))},D0=function(){oe(this,Bi)===0&&oe(this,jr)===0&&oe(this,Hr)&&(clearInterval(oe(this,Hr)),mt(this,Hr,void 0)),mt(this,Bi,oe(this,Io)?oe(this,jr):0),Ke(this,Ye,yu).call(this)},yu=function(){for(;Ke(this,Ye,mu).call(this););},zy=async function(t){return new Promise((n,i)=>{t.addEventListener("abort",()=>{i(t.reason)},{once:!0})})},wu=async function(t,n){return new Promise(i=>{const s=()=>{n&&!n()||(this.off(t,s),i())};this.on(t,s)})};class jP extends or{constructor(t,n){super();h(this,"id");h(this,"protocol");h(this,"outboundStream");h(this,"inboundStream");h(this,"_rawOutboundStream");h(this,"_rawInboundStream");h(this,"_inboundAbortController");h(this,"closed");h(this,"log");this.log=t.logger.forComponent("libp2p-pubsub:peer-streams"),this.id=n.id,this.protocol=n.protocol,this._inboundAbortController=new AbortController,this.closed=!1}get isReadable(){return!!this.inboundStream}get isWritable(){return!!this.outboundStream}write(t){if(this.outboundStream==null){const n=this.id.toString();throw new Error("No writable connection to "+n)}this.outboundStream.push(t instanceof Uint8Array?new je(t):t)}attachInboundStream(t,n){const i=()=>{dy(t.source,this.log)};return this._inboundAbortController.signal.addEventListener("abort",i,{once:!0}),this._rawInboundStream=t,this.inboundStream=Uo(this._rawInboundStream,s=>vc(s,n)),this.dispatchEvent(new CustomEvent("stream:inbound")),this.inboundStream}async attachOutboundStream(t){const n=this.outboundStream;return this.outboundStream!=null&&this.outboundStream.end(),this._rawOutboundStream=t,this.outboundStream=bi({onEnd:i=>{var s;(s=this._rawOutboundStream)==null||s.closeWrite().catch(o=>{this.log("error closing outbound stream",o)}),this._rawOutboundStream=void 0,this.outboundStream=void 0,i!=null&&this.dispatchEvent(new CustomEvent("close"))}}),Uo(this.outboundStream,i=>bc(i),this._rawOutboundStream).catch(i=>{this.log.error(i)}),n==null&&this.dispatchEvent(new CustomEvent("stream:outbound")),this.outboundStream}close(){this.closed||(this.closed=!0,this.outboundStream!=null&&this.outboundStream.end(),this.inboundStream!=null&&this._inboundAbortController.abort(),this._rawOutboundStream=void 0,this.outboundStream=void 0,this._rawInboundStream=void 0,this.inboundStream=void 0,this.dispatchEvent(new CustomEvent("close")))}}function zP(){return BigInt(`0x${Be(ol(8),"base16")}`)}const WP=(r,e)=>{const t=Ae(e.toString(16).padStart(16,"0"),"base16"),n=Yr(r),i=new Uint8Array(n.byteLength+t.length);return i.set(n,0),i.set(t,n.byteLength),i},GP=r=>wi.encode(r),QP=function(r){return Array.isArray(r)?r:[r]},YP=async r=>{if(r.sequenceNumber==null||r.from==null||r.signature==null)return!1;const e=bn($r(r.from));if(e.publicKey!=null)return!0;if(r.key!=null){const t=r.key;return Is(tn(t)).equals(e)}return!1},ZP=async r=>{if(r.from==null)throw new We("RPC message was missing from");if(!await YP(r))return{type:"unsigned",topic:r.topic??"",data:r.data??new Uint8Array(0)};const e=bn($r(r.from)),t=r.key??e.publicKey;if(t==null)throw new We("RPC message was missing public key");return{type:"signed",from:e,topic:r.topic??"",sequenceNumber:JP(r.sequenceNumber??new Uint8Array(0)),data:r.data??new Uint8Array(0),signature:r.signature??new Uint8Array(0),key:t instanceof Uint8Array?tn(t):t}},E4=r=>r.type==="signed"?{from:r.from.toMultihash().bytes,data:r.data,sequenceNumber:XP(r.sequenceNumber),topic:r.topic,signature:r.signature,key:r.key?Yr(r.key):void 0}:{data:r.data,topic:r.topic},XP=r=>{let e=r.toString(16);return e.length%2!==0&&(e=`0${e}`),Ae(e,"base16")},JP=r=>BigInt(`0x${Be(r,"base16")}`),Wy=Ae("libp2p-pubsub:");async function eB(r,e,t){const n={type:"signed",topic:e.topic,data:e.data,sequenceNumber:e.sequenceNumber,from:Km(r)},i=Jr([Wy,t(E4(n)).subarray()]);return n.signature=await r.sign(i),n.key=r.publicKey,n}async function tB(r,e){if(r.type!=="signed")throw new Error('Message type must be "signed" to be verified');if(r.signature==null)throw new Error("Message must contain a signature to be verified");if(r.from==null)throw new Error("Message must contain a from property to be verified");const t=Jr([Wy,e({...E4(r),signature:void 0,key:void 0}).subarray()]);return rB(r).verify(t,r.signature)}function rB(r){if(r.type!=="signed")throw new Error('Message type must be "signed" to have a public key');if(r.from==null)throw new Error("Could not get the public key from the originator id");if(r.key!=null)return r.key;if(r.from.publicKey!=null)return r.from.publicKey;throw new Error("Could not get the public key from the originator id")}class nB extends or{constructor(t,n){super();h(this,"log");h(this,"started");h(this,"topics");h(this,"subscriptions");h(this,"peers");h(this,"globalSignaturePolicy");h(this,"canRelayMessage");h(this,"emitSelf");h(this,"topicValidators");h(this,"queue");h(this,"multicodecs");h(this,"components");h(this,"_registrarTopologyIds");h(this,"enabled");h(this,"maxInboundStreams");h(this,"maxOutboundStreams");const{multicodecs:i=[],globalSignaturePolicy:s="StrictSign",canRelayMessage:o=!1,emitSelf:a=!1,messageProcessingConcurrency:c=10,maxInboundStreams:l=1,maxOutboundStreams:u=1}=n;this.log=t.logger.forComponent("libp2p:pubsub"),this.components=t,this.multicodecs=QP(i),this.enabled=n.enabled!==!1,this.started=!1,this.topics=new Map,this.subscriptions=new Set,this.peers=new js,this.globalSignaturePolicy=s==="StrictNoSign"?"StrictNoSign":"StrictSign",this.canRelayMessage=o,this.emitSelf=a,this.topicValidators=new Map,this.queue=new $y({concurrency:c}),this.maxInboundStreams=l,this.maxOutboundStreams=u,this._onIncomingStream=this._onIncomingStream.bind(this),this._onPeerConnected=this._onPeerConnected.bind(this),this._onPeerDisconnected=this._onPeerDisconnected.bind(this)}async start(){if(this.started||!this.enabled)return;this.log("starting");const t=this.components.registrar;await Promise.all(this.multicodecs.map(async i=>{await t.handle(i,this._onIncomingStream,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams})}));const n={onConnect:this._onPeerConnected,onDisconnect:this._onPeerDisconnected};this._registrarTopologyIds=await Promise.all(this.multicodecs.map(async i=>t.register(i,n))),this.log("started"),this.started=!0}async stop(){var n;if(!this.started||!this.enabled)return;const t=this.components.registrar;this._registrarTopologyIds!=null&&((n=this._registrarTopologyIds)==null||n.forEach(i=>{t.unregister(i)})),await Promise.all(this.multicodecs.map(async i=>{await t.unhandle(i)})),this.log("stopping");for(const i of this.peers.values())i.close();this.peers.clear(),this.subscriptions=new Set,this.started=!1,this.log("stopped")}isStarted(){return this.started}_onIncomingStream(t){const{stream:n,connection:i}=t,s=i.remotePeer;if(n.protocol==null){n.abort(new Error("Stream was not multiplexed"));return}const o=this.addPeer(s,n.protocol),a=o.attachInboundStream(n);this.processMessages(s,a,o).catch(c=>{this.log(c)})}_onPeerConnected(t,n){if(this.log("connected %p",t),n.streams.find(i=>i.direction==="outbound"&&i.protocol!=null&&this.multicodecs.includes(i.protocol))!=null){this.log("outbound pubsub streams already present on connection from %p",t);return}Promise.resolve().then(async()=>{try{const i=await n.newStream(this.multicodecs);if(i.protocol==null){i.abort(new Error("Stream was not multiplexed"));return}await this.addPeer(t,i.protocol).attachOutboundStream(i)}catch(i){this.log.error(i)}this.send(t,{subscriptions:Array.from(this.subscriptions).map(i=>i.toString()),subscribe:!0})}).catch(i=>{this.log.error(i)})}_onPeerDisconnected(t,n){this.log("connection ended %p",t),this._removePeer(t)}addPeer(t,n){const i=this.peers.get(t);if(i!=null)return i;this.log("new peer %p",t);const s=new jP(this.components,{id:t,protocol:n});return this.peers.set(t,s),s.addEventListener("close",()=>this._removePeer(t),{once:!0}),s}_removePeer(t){const n=this.peers.get(t);if(n!=null){n.close(),this.log("delete peer %p",t),this.peers.delete(t);for(const i of this.topics.values())i.delete(t);return n}}async processMessages(t,n,i){try{await Uo(n,async s=>{for await(const o of s){const a=this.decodeRpc(o),c=[];for(const l of a.messages??[]){if(l.from==null||l.data==null||l.topic==null){this.log("message from %p was missing from, data or topic fields, dropping",t);continue}c.push({from:l.from,data:l.data,topic:l.topic,sequenceNumber:l.sequenceNumber??void 0,signature:l.signature??void 0,key:l.key??void 0})}this.processRpc(t,i,{subscriptions:(a.subscriptions??[]).map(l=>({subscribe:!!l.subscribe,topic:l.topic??""})),messages:c}).catch(l=>{this.log(l)})}})}catch(s){this._onPeerDisconnected(i.id,s)}}async processRpc(t,n,i){if(!this.acceptFrom(t))return this.log("received message from unacceptable peer %p",t),!1;this.log("rpc from %p",t);const{subscriptions:s,messages:o}=i;return s!=null&&s.length>0&&(this.log("subscription update from %p",t),s.forEach(a=>{this.processRpcSubOpt(t,a)}),super.dispatchEvent(new CustomEvent("subscription-change",{detail:{peerId:n.id,subscriptions:s.map(({topic:a,subscribe:c})=>({topic:`${a??""}`,subscribe:!!c}))}}))),o!=null&&o.length>0&&(this.log("messages from %p",t),this.queue.addAll(o.map(a=>async()=>{if(a.topic==null||!this.subscriptions.has(a.topic)&&!this.canRelayMessage)return this.log("received message we didn't subscribe to. Dropping."),!1;try{const c=await ZP(a);await this.processMessage(t,c)}catch(c){this.log.error(c)}})).catch(a=>{this.log(a)})),!0}processRpcSubOpt(t,n){const i=n.topic;if(i==null)return;let s=this.topics.get(i);s==null&&(s=new Dn,this.topics.set(i,s)),n.subscribe===!0?s.add(t):s.delete(t)}async processMessage(t,n){if(!(this.components.peerId.equals(t)&&!this.emitSelf)){try{await this.validate(t,n)}catch(i){this.log("Message is invalid, dropping it. %O",i);return}this.subscriptions.has(n.topic)&&(!this.components.peerId.equals(t)||this.emitSelf)&&super.dispatchEvent(new CustomEvent("message",{detail:n})),await this.publishMessage(t,n)}}getMsgId(t){switch(this.globalSignaturePolicy){case"StrictSign":if(t.type!=="signed")throw new We('Message type should be "signed" when signature policy is StrictSign but it was not');if(t.sequenceNumber==null)throw new We("Need sequence number when signature policy is StrictSign but it was missing");if(t.key==null)throw new We("Need key when signature policy is StrictSign but it was missing");return WP(t.key,t.sequenceNumber);case"StrictNoSign":return GP(t.data);default:throw new We("Cannot get message id: unhandled signature policy")}}acceptFrom(t){return!0}send(t,n){const{messages:i,subscriptions:s,subscribe:o}=n;this.sendRpc(t,{subscriptions:(s??[]).map(a=>({topic:a,subscribe:!!o})),messages:(i??[]).map(E4)})}sendRpc(t,n){const i=this.peers.get(t);if(i==null){this.log.error("Cannot send RPC to %p as there are no streams to it available",t);return}if(!i.isWritable){this.log.error("Cannot send RPC to %p as there is no outbound stream to it available",t);return}i.write(this.encodeRpc(n))}async validate(t,n){switch(this.globalSignaturePolicy){case"StrictNoSign":if(n.type!=="unsigned")throw new We('Message type should be "unsigned" when signature policy is StrictNoSign but it was not');if(n.signature!=null)throw new We("StrictNoSigning: signature should not be present");if(n.key!=null)throw new We("StrictNoSigning: key should not be present");if(n.sequenceNumber!=null)throw new We("StrictNoSigning: seqno should not be present");break;case"StrictSign":if(n.type!=="signed")throw new We('Message type should be "signed" when signature policy is StrictSign but it was not');if(n.signature==null)throw new We("StrictSigning: Signing required and no signature was present");if(n.sequenceNumber==null)throw new We("StrictSigning: Signing required and no sequenceNumber was present");if(!await tB(n,this.encodeMessage.bind(this)))throw new We("StrictSigning: Invalid message signature");break;default:throw new We("Cannot validate message: unhandled signature policy")}const s=this.topicValidators.get(n.topic);if(s!=null){const o=await s(t,n);if(o===Du.Reject||o===Du.Ignore)throw new We("Message validation failed")}}async buildMessage(t){switch(this.globalSignaturePolicy){case"StrictSign":return eB(this.components.privateKey,t,this.encodeMessage.bind(this));case"StrictNoSign":return Promise.resolve({type:"unsigned",...t});default:throw new We("Cannot build message: unhandled signature policy")}}getSubscribers(t){if(!this.started)throw new Ss("not started yet");if(t==null)throw new ke("Topic is required");const n=this.topics.get(t.toString());return n==null?[]:Array.from(n.values())}async publish(t,n){if(!this.started)throw new Error("Pubsub has not started");const i={from:this.components.peerId,topic:t,data:n??new Uint8Array(0),sequenceNumber:zP()};this.log("publish topic: %s from: %p data: %m",t,i.from,i.data);const s=await this.buildMessage(i);let o=!1;this.emitSelf&&this.subscriptions.has(t)&&(o=!0,super.dispatchEvent(new CustomEvent("message",{detail:s})));const a=await this.publishMessage(this.components.peerId,s);return o&&(a.recipients=[...a.recipients,this.components.peerId]),a}subscribe(t){if(!this.started)throw new Error("Pubsub has not started");if(this.log("subscribe to topic: %s",t),!this.subscriptions.has(t)){this.subscriptions.add(t);for(const n of this.peers.keys())this.send(n,{subscriptions:[t],subscribe:!0})}}unsubscribe(t){if(!this.started)throw new Error("Pubsub is not started");super.removeEventListener(t);const n=this.subscriptions.has(t);if(this.log("unsubscribe from %s - am subscribed %s",t,n),n){this.subscriptions.delete(t);for(const i of this.peers.keys())this.send(i,{subscriptions:[t],subscribe:!1})}}getTopics(){if(!this.started)throw new Error("Pubsub is not started");return Array.from(this.subscriptions)}getPeers(){if(!this.started)throw new Error("Pubsub is not started");return Array.from(this.peers.keys())}}class iB{constructor(e){h(this,"entries");h(this,"validityMs");h(this,"lastPruneTime",0);this.entries=new Map,this.validityMs=e.validityMs}put(e,t){this.entries.set(e,{value:t,validUntilMs:Date.now()+this.validityMs}),this.prune()}prune(){const e=Date.now();if(!(e-this.lastPruneTime<200)){this.lastPruneTime=e;for(const[t,n]of this.entries.entries())if(n.validUntilMs<e)this.entries.delete(t);else break}}has(e){return this.entries.has(e)}get(e){const t=this.entries.get(e);return t!=null&&t.validUntilMs>=Date.now()?t.value:void 0}clear(){this.entries=new Map,this.lastPruneTime=0}}const sB="/floodsub/1.0.0";var co;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=lt((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.subscribe!=null&&(s.uint32(8),s.bool(i.subscribe)),i.topic!=null&&(s.uint32(18),s.string(i.topic)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.subscribe=i.bool();break}case 2:{a.topic=i.string();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>ct(i,t.codec()),t.decode=(i,s)=>at(i,t.codec(),s)})(r.SubOpts||(r.SubOpts={})),function(t){let n;t.codec=()=>(n==null&&(n=lt((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.from!=null&&(s.uint32(10),s.bytes(i.from)),i.data!=null&&(s.uint32(18),s.bytes(i.data)),i.sequenceNumber!=null&&(s.uint32(26),s.bytes(i.sequenceNumber)),i.topic!=null&&(s.uint32(34),s.string(i.topic)),i.signature!=null&&(s.uint32(42),s.bytes(i.signature)),i.key!=null&&(s.uint32(50),s.bytes(i.key)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.from=i.bytes();break}case 2:{a.data=i.bytes();break}case 3:{a.sequenceNumber=i.bytes();break}case 4:{a.topic=i.string();break}case 5:{a.signature=i.bytes();break}case 6:{a.key=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>ct(i,t.codec()),t.decode=(i,s)=>at(i,t.codec(),s)}(r.Message||(r.Message={}));let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.subscriptions!=null)for(const s of t.subscriptions)n.uint32(10),r.SubOpts.codec().encode(s,n);if(t.messages!=null)for(const s of t.messages)n.uint32(18),r.Message.codec().encode(s,n);t.control!=null&&(n.uint32(26),n1.codec().encode(t.control,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,u,f;const s={subscriptions:[],messages:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const g=t.uint32();switch(g>>>3){case 1:{if(((a=i.limits)==null?void 0:a.subscriptions)!=null&&s.subscriptions.length===i.limits.subscriptions)throw new Dt('Decode error - map field "subscriptions" had too many elements');s.subscriptions.push(r.SubOpts.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.subscriptions$}));break}case 2:{if(((l=i.limits)==null?void 0:l.messages)!=null&&s.messages.length===i.limits.messages)throw new Dt('Decode error - map field "messages" had too many elements');s.messages.push(r.Message.codec().decode(t,t.uint32(),{limits:(u=i.limits)==null?void 0:u.messages$}));break}case 3:{s.control=n1.codec().decode(t,t.uint32(),{limits:(f=i.limits)==null?void 0:f.control});break}default:{t.skipType(g&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(co||(co={}));var n1;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.ihave!=null)for(const s of t.ihave)n.uint32(10),i1.codec().encode(s,n);if(t.iwant!=null)for(const s of t.iwant)n.uint32(18),s1.codec().encode(s,n);if(t.graft!=null)for(const s of t.graft)n.uint32(26),o1.codec().encode(s,n);if(t.prune!=null)for(const s of t.prune)n.uint32(34),a1.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,u,f,g,m,w;const s={ihave:[],iwant:[],graft:[],prune:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const x=t.uint32();switch(x>>>3){case 1:{if(((a=i.limits)==null?void 0:a.ihave)!=null&&s.ihave.length===i.limits.ihave)throw new Dt('Decode error - map field "ihave" had too many elements');s.ihave.push(i1.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.ihave$}));break}case 2:{if(((l=i.limits)==null?void 0:l.iwant)!=null&&s.iwant.length===i.limits.iwant)throw new Dt('Decode error - map field "iwant" had too many elements');s.iwant.push(s1.codec().decode(t,t.uint32(),{limits:(u=i.limits)==null?void 0:u.iwant$}));break}case 3:{if(((f=i.limits)==null?void 0:f.graft)!=null&&s.graft.length===i.limits.graft)throw new Dt('Decode error - map field "graft" had too many elements');s.graft.push(o1.codec().decode(t,t.uint32(),{limits:(g=i.limits)==null?void 0:g.graft$}));break}case 4:{if(((m=i.limits)==null?void 0:m.prune)!=null&&s.prune.length===i.limits.prune)throw new Dt('Decode error - map field "prune" had too many elements');s.prune.push(a1.codec().decode(t,t.uint32(),{limits:(w=i.limits)==null?void 0:w.prune$}));break}default:{t.skipType(x&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(n1||(n1={}));var i1;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.topic!=null&&(n.uint32(10),n.string(t.topic)),t.messageIDs!=null)for(const s of t.messageIDs)n.uint32(18),n.bytes(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={messageIDs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.topic=t.string();break}case 2:{if(((a=i.limits)==null?void 0:a.messageIDs)!=null&&s.messageIDs.length===i.limits.messageIDs)throw new Dt('Decode error - map field "messageIDs" had too many elements');s.messageIDs.push(t.bytes());break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(i1||(i1={}));var s1;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.messageIDs!=null)for(const s of t.messageIDs)n.uint32(10),n.bytes(s);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={messageIDs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{if(((a=i.limits)==null?void 0:a.messageIDs)!=null&&s.messageIDs.length===i.limits.messageIDs)throw new Dt('Decode error - map field "messageIDs" had too many elements');s.messageIDs.push(t.bytes());break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(s1||(s1={}));var o1;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.topic!=null&&(n.uint32(10),n.string(t.topic)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.topic=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(o1||(o1={}));var a1;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.topic!=null&&(n.uint32(10),n.string(t.topic)),t.peers!=null)for(const s of t.peers)n.uint32(18),c1.codec().encode(s,n);t.backoff!=null&&(n.uint32(24),n.uint64(t.backoff)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={peers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.topic=t.string();break}case 2:{if(((a=i.limits)==null?void 0:a.peers)!=null&&s.peers.length===i.limits.peers)throw new Dt('Decode error - map field "peers" had too many elements');s.peers.push(c1.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.peers$}));break}case 3:{s.backoff=t.uint64();break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(a1||(a1={}));var c1;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.peerID!=null&&(n.uint32(10),n.bytes(t.peerID)),t.signedPeerRecord!=null&&(n.uint32(18),n.bytes(t.signedPeerRecord)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.peerID=t.bytes();break}case 2:{s.signedPeerRecord=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(c1||(c1={}));var Zg,Xg,Jg,e7,t7;class oB extends(t7=nB,e7=Sx,Jg=Symbol.toStringTag,Xg=Xr,Zg=Uu,t7){constructor(t,n){super(t,{...n,canRelayMessage:!0,multicodecs:[sB]});h(this,"seenCache");h(this,e7,!0);h(this,Jg,"@libp2p/floodsub");h(this,Xg,["@libp2p/pubsub"]);h(this,Zg,["@libp2p/identify"]);this.log=t.logger.forComponent("libp2p:floodsub"),this.seenCache=new iB({validityMs:(n==null?void 0:n.seenTTL)??3e4})}decodeRpc(t){return co.decode(t)}encodeRpc(t){return co.encode(t)}decodeMessage(t){return co.Message.decode(t)}encodeMessage(t){return co.Message.encode(t)}async processMessage(t,n){const i=await super.getMsgId(n),s=Be(i,"base64");this.seenCache.has(s)||(this.seenCache.put(s,!0),await super.processMessage(t,n))}async publishMessage(t,n){const i=this.getSubscribers(n.topic),s=[];return i==null||i.length===0?(this.log("no peers are subscribed to topic %s",n.topic),{recipients:s}):(i.forEach(o=>{if(this.components.peerId.equals(o)){this.log("not sending message on topic %s to myself",n.topic);return}if(o.equals(t)){this.log("not sending message on topic %s to sender %p",n.topic,o);return}this.log("publish msgs on topics %s %p",n.topic,o),s.push(o),this.send(o,{messages:[n]})}),{recipients:s})}}function aB(r={}){return e=>new oB(e,r)}var l1;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.publicKey!=null&&t.publicKey.byteLength>0&&(n.uint32(10),n.bytes(t.publicKey)),t.payloadType!=null&&t.payloadType.byteLength>0&&(n.uint32(18),n.bytes(t.payloadType)),t.payload!=null&&t.payload.byteLength>0&&(n.uint32(26),n.bytes(t.payload)),t.signature!=null&&t.signature.byteLength>0&&(n.uint32(42),n.bytes(t.signature)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={publicKey:dt(0),payloadType:dt(0),payload:dt(0),signature:dt(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.publicKey=t.bytes();break}case 2:{s.payloadType=t.bytes();break}case 3:{s.payload=t.bytes();break}case 5:{s.signature=t.bytes();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(l1||(l1={}));class cB extends Error{constructor(e="Invalid signature"){super(e),this.name="InvalidSignatureError"}}const Ti=class Ti{constructor(e){h(this,"publicKey");h(this,"payloadType");h(this,"payload");h(this,"signature");h(this,"marshaled");const{publicKey:t,payloadType:n,payload:i,signature:s}=e;this.publicKey=t,this.payloadType=n,this.payload=i,this.signature=s}marshal(){return this.marshaled==null&&(this.marshaled=l1.encode({publicKey:Yr(this.publicKey),payloadType:this.payloadType,payload:this.payload.subarray(),signature:this.signature})),this.marshaled}equals(e){return e==null?!1:pt(this.marshal(),e.marshal())}async validate(e,t){const n=J6(e,this.payloadType,this.payload);return this.publicKey.verify(n.subarray(),this.signature,t)}};h(Ti,"createFromProtobuf",e=>{const t=l1.decode(e),n=tn(t.publicKey);return new Ti({publicKey:n,payloadType:t.payloadType,payload:t.payload,signature:t.signature})}),h(Ti,"seal",async(e,t,n)=>{if(t==null)throw new Error("Missing private key");const i=e.domain,s=e.codec,o=e.marshal(),a=J6(i,s,o),c=await t.sign(a.subarray(),n);return new Ti({publicKey:t.publicKey,payloadType:s,payload:o,signature:c})}),h(Ti,"openAndCertify",async(e,t,n)=>{const i=Ti.createFromProtobuf(e);if(!await i.validate(t,n))throw new cB("Envelope signature is not valid for the given domain");return i});let Ps=Ti;const J6=(r,e,t)=>{const n=Ae(r),i=ms(n.byteLength),s=ms(e.length),o=ms(t.length);return new je(i,n,s,e,o,t)};function lB(r,e){const t=(n,i)=>n.toString().localeCompare(i.toString());return r.length!==e.length?!1:(e.sort(t),r.sort(t).every((n,i)=>e[i].equals(n)))}const uB="libp2p-peer-record",hB=Uint8Array.from([3,1]);var u1;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=lt((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.multiaddr!=null&&i.multiaddr.byteLength>0&&(s.uint32(10),s.bytes(i.multiaddr)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={multiaddr:dt(0)},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.multiaddr=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>ct(i,t.codec()),t.decode=(i,s)=>at(i,t.codec(),s)})(r.AddressInfo||(r.AddressInfo={}));let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.peerId!=null&&t.peerId.byteLength>0&&(n.uint32(10),n.bytes(t.peerId)),t.seq!=null&&t.seq!==0n&&(n.uint32(16),n.uint64(t.seq)),t.addresses!=null)for(const s of t.addresses)n.uint32(26),r.AddressInfo.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={peerId:dt(0),seq:0n,addresses:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 1:{s.peerId=t.bytes();break}case 2:{s.seq=t.uint64();break}case 3:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new Dt('Decode error - map field "addresses" had too many elements');s.addresses.push(r.AddressInfo.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.addresses$}));break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(u1||(u1={}));const Qn=class Qn{constructor(e){h(this,"peerId");h(this,"multiaddrs");h(this,"seqNumber");h(this,"domain",Qn.DOMAIN);h(this,"codec",Qn.CODEC);h(this,"marshaled");const{peerId:t,multiaddrs:n,seqNumber:i}=e;this.peerId=t,this.multiaddrs=n??[],this.seqNumber=i??BigInt(Date.now())}marshal(){return this.marshaled==null&&(this.marshaled=u1.encode({peerId:this.peerId.toMultihash().bytes,seq:BigInt(this.seqNumber),addresses:this.multiaddrs.map(e=>({multiaddr:e.bytes}))})),this.marshaled}equals(e){return!(!(e instanceof Qn)||!this.peerId.equals(e.peerId)||this.seqNumber!==e.seqNumber||!lB(this.multiaddrs,e.multiaddrs))}};h(Qn,"createFromProtobuf",e=>{const t=u1.decode(e),n=bn($r(t.peerId)),i=(t.addresses??[]).map(o=>Ze(o.multiaddr)),s=t.seq;return new Qn({peerId:n,multiaddrs:i,seqNumber:s})}),h(Qn,"DOMAIN",uB),h(Qn,"CODEC",hB);let ri=Qn;function L0(r,e){let t;const n=function(){const i=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(i,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}function fB(r){return r[Symbol.asyncIterator]!=null}function _c(r){if(fB(r))return(async()=>{for await(const e of r);})();for(const e of r);}const Wl=globalThis.CustomEvent??Event;async function*x4(r,e={}){let t=e.concurrency??1/0;t<1&&(t=1/0);const n=e.ordered??!1,i=new EventTarget,s=[];let o=St(),a=St(),c=!1,l,u=!1;i.addEventListener("task-complete",()=>{a.resolve()}),Promise.resolve().then(async()=>{try{for await(const w of r){if(s.length===t&&(o=St(),await o.promise),u)break;const x={done:!1};s.push(x),w().then(v=>{x.done=!0,x.ok=!0,x.value=v,i.dispatchEvent(new Wl("task-complete"))},v=>{x.done=!0,x.err=v,i.dispatchEvent(new Wl("task-complete"))})}c=!0,i.dispatchEvent(new Wl("task-complete"))}catch(w){l=w,i.dispatchEvent(new Wl("task-complete"))}});function f(){var w;return n?(w=s[0])==null?void 0:w.done:!!s.find(x=>x.done)}function*g(){for(;s.length>0&&s[0].done;){const w=s[0];if(s.shift(),w.ok)yield w.value;else throw u=!0,o.resolve(),w.err;o.resolve()}}function*m(){for(;f();)for(let w=0;w<s.length;w++)if(s[w].done){const x=s[w];if(s.splice(w,1),w--,x.ok)yield x.value;else throw u=!0,o.resolve(),x.err;o.resolve()}}for(;;){if(f()||(a=St(),await a.promise),l!=null||(n?yield*g():yield*m(),l!=null))throw l;if(c&&s.length===0)break}}function Ic(r,e){const t=Mo(r,e),n={read:async(i,s)=>{const o=await t.read(s);return i.decode(o)},write:async(i,s,o)=>{await t.write(s.encode(i),o)},writeV:async(i,s,o)=>{await t.writeV(i.map(a=>s.encode(a)),o)},pb:i=>({read:async s=>n.read(i,s),write:async(s,o)=>n.write(s,i,o),writeV:async(s,o)=>n.writeV(s,i,o),unwrap:()=>n}),unwrap:()=>t.unwrap()};return n}const dB="0.1.0",pB="id",gB="1.0.0",mB=1024*8;var h1;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.protocolVersion!=null&&(n.uint32(42),n.string(t.protocolVersion)),t.agentVersion!=null&&(n.uint32(50),n.string(t.agentVersion)),t.publicKey!=null&&(n.uint32(10),n.bytes(t.publicKey)),t.listenAddrs!=null)for(const s of t.listenAddrs)n.uint32(18),n.bytes(s);if(t.observedAddr!=null&&(n.uint32(34),n.bytes(t.observedAddr)),t.protocols!=null)for(const s of t.protocols)n.uint32(26),n.string(s);t.signedPeerRecord!=null&&(n.uint32(66),n.bytes(t.signedPeerRecord)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c;const s={listenAddrs:[],protocols:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const l=t.uint32();switch(l>>>3){case 5:{s.protocolVersion=t.string();break}case 6:{s.agentVersion=t.string();break}case 1:{s.publicKey=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.listenAddrs)!=null&&s.listenAddrs.length===i.limits.listenAddrs)throw new Dt('Decode error - map field "listenAddrs" had too many elements');s.listenAddrs.push(t.bytes());break}case 4:{s.observedAddr=t.bytes();break}case 3:{if(((c=i.limits)==null?void 0:c.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new Dt('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 8:{s.signedPeerRecord=t.bytes();break}default:{t.skipType(l&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(h1||(h1={}));const Gn={protocolPrefix:"ipfs",timeout:5e3,maxInboundStreams:1,maxOutboundStreams:1,maxObservedAddresses:10,maxMessageSize:mB,runOnConnectionOpen:!0,runOnLimitedConnection:!0};function yB(r){if(r!=null&&r.length>0)try{return Ze(r)}catch{}}function wB(r,e){return e??r.userAgent}async function bB(r,e,t,n,i){if(t("received identify from %p",n.remotePeer),i==null)throw new We("message was null or undefined");const s={};if(i.listenAddrs.length>0&&(s.addresses=i.listenAddrs.map(c=>({isCertified:!1,multiaddr:Ze(c)}))),i.protocols.length>0&&(s.protocols=i.protocols),i.publicKey!=null){const c=tn(i.publicKey);if(!Is(c).equals(n.remotePeer))throw new We("public key did not match remote PeerId");s.publicKey=c}let o;if(i.signedPeerRecord!=null){t.trace("received signedPeerRecord from %p",n.remotePeer);let c=i.signedPeerRecord;const l=await Ps.openAndCertify(c,ri.DOMAIN);let u=ri.createFromProtobuf(l.payload);const f=al(l.publicKey.toCID());if(!u.peerId.equals(f))throw new We("signing key does not match PeerId in the PeerRecord");if(!n.remotePeer.equals(u.peerId))throw new We("signing key does not match remote PeerId");let g;try{g=await r.get(u.peerId)}catch(m){if(m.name!=="NotFoundError")throw m}if(g!=null&&(s.metadata=g.metadata,g.peerRecordEnvelope!=null)){const m=Ps.createFromProtobuf(g.peerRecordEnvelope),w=ri.createFromProtobuf(m.payload);w.seqNumber>=u.seqNumber&&(t("sequence number was lower or equal to existing sequence number - stored: %d received: %d",w.seqNumber,u.seqNumber),u=w,c=g.peerRecordEnvelope)}s.peerRecordEnvelope=c,s.addresses=u.multiaddrs.map(m=>({isCertified:!0,multiaddr:m})),o={seq:u.seqNumber,addresses:u.multiaddrs}}else t("%p did not send a signed peer record",n.remotePeer);if(t.trace("patching %p with",n.remotePeer,s),await r.patch(n.remotePeer,s),i.agentVersion!=null||i.protocolVersion!=null){const c={};i.agentVersion!=null&&(c.AgentVersion=Ae(i.agentVersion)),i.protocolVersion!=null&&(c.ProtocolVersion=Ae(i.protocolVersion)),t.trace("merging %p metadata",n.remotePeer,c),await r.merge(n.remotePeer,{metadata:c})}const a={peerId:n.remotePeer,protocolVersion:i.protocolVersion,agentVersion:i.agentVersion,publicKey:i.publicKey,listenAddrs:i.listenAddrs.map(c=>Ze(c)),observedAddr:i.observedAddr==null?void 0:Ze(i.observedAddr),protocols:i.protocols,signedPeerRecord:o,connection:n};return e.safeDispatchEvent("peer:identify",{detail:a}),a}class vB{constructor(e,t){h(this,"host");h(this,"protocol");h(this,"started");h(this,"timeout");h(this,"peerId");h(this,"privateKey");h(this,"peerStore");h(this,"registrar");h(this,"addressManager");h(this,"maxInboundStreams");h(this,"maxOutboundStreams");h(this,"maxMessageSize");h(this,"maxObservedAddresses");h(this,"events");h(this,"runOnLimitedConnection");h(this,"log");this.protocol=t.protocol,this.started=!1,this.peerId=e.peerId,this.privateKey=e.privateKey,this.peerStore=e.peerStore,this.registrar=e.registrar,this.addressManager=e.addressManager,this.events=e.events,this.log=t.log,this.timeout=t.timeout??Gn.timeout,this.maxInboundStreams=t.maxInboundStreams??Gn.maxInboundStreams,this.maxOutboundStreams=t.maxOutboundStreams??Gn.maxOutboundStreams,this.maxMessageSize=t.maxMessageSize??Gn.maxMessageSize,this.maxObservedAddresses=t.maxObservedAddresses??Gn.maxObservedAddresses,this.runOnLimitedConnection=t.runOnLimitedConnection??Gn.runOnLimitedConnection,this.host={protocolVersion:`${t.protocolPrefix??Gn.protocolPrefix}/${dB}`,agentVersion:wB(e.nodeInfo,t.agentVersion)}}isStarted(){return this.started}async start(){this.started||(await this.peerStore.merge(this.peerId,{metadata:{AgentVersion:Ae(this.host.agentVersion),ProtocolVersion:Ae(this.host.protocolVersion)}}),await this.registrar.handle(this.protocol,e=>{this.handleProtocol(e).catch(t=>{this.log.error(t)})},{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0)}async stop(){await this.registrar.unhandle(this.protocol),this.started=!1}}function SB(r){try{for(const{code:e,value:t}of r.getComponents())if(t!=null&&e===On)return mP("2000::/3",t)}catch{}return!1}var eo={},e5;function EB(){return e5||(e5=1,(function(){var r,e,t,n,i,s,o,a;a=function(c){var l,u,f,g;return l=(c&255<<24)>>>24,u=(c&255<<16)>>>16,f=(c&65280)>>>8,g=c&255,[l,u,f,g].join(".")},o=function(c){var l,u,f,g,m,w;for(l=[],f=g=0;g<=3&&c.length!==0;f=++g){if(f>0){if(c[0]!==".")throw new Error("Invalid IP");c=c.substring(1)}w=e(c),m=w[0],u=w[1],c=c.substring(u),l.push(m)}if(c.length!==0)throw new Error("Invalid IP");switch(l.length){case 1:if(l[0]>4294967295)throw new Error("Invalid IP");return l[0]>>>0;case 2:if(l[0]>255||l[1]>16777215)throw new Error("Invalid IP");return(l[0]<<24|l[1])>>>0;case 3:if(l[0]>255||l[1]>255||l[2]>65535)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2])>>>0;case 4:if(l[0]>255||l[1]>255||l[2]>255||l[3]>255)throw new Error("Invalid IP");return(l[0]<<24|l[1]<<16|l[2]<<8|l[3])>>>0;default:throw new Error("Invalid IP")}},t=function(c){return c.charCodeAt(0)},n=t("0"),s=t("a"),i=t("A"),e=function(c){var l,u,f,g,m;for(g=0,l=10,u="9",f=0,c.length>1&&c[f]==="0"&&(c[f+1]==="x"||c[f+1]==="X"?(f+=2,l=16):"0"<=c[f+1]&&c[f+1]<="9"&&(f++,l=8,u="7")),m=f;f<c.length;){if("0"<=c[f]&&c[f]<=u)g=g*l+(t(c[f])-n)>>>0;else if(l===16)if("a"<=c[f]&&c[f]<="f")g=g*l+(10+t(c[f])-s)>>>0;else if("A"<=c[f]&&c[f]<="F")g=g*l+(10+t(c[f])-i)>>>0;else break;else break;if(g>4294967295)throw new Error("too large");f++}if(f===m)throw new Error("empty octet");return[g,f]},r=function(){function c(l,u){var f,g,m;if(typeof l!="string")throw new Error("Missing `net' parameter");if(u||(m=l.split("/",2),l=m[0],u=m[1]),u||(u=32),typeof u=="string"&&u.indexOf(".")>-1){try{this.maskLong=o(u)}catch{throw new Error("Invalid mask: "+u)}for(f=g=32;g>=0;f=--g)if(this.maskLong===4294967295<<32-f>>>0){this.bitmask=f;break}}else if(u||u===0)this.bitmask=parseInt(u,10),this.maskLong=0,this.bitmask>0&&(this.maskLong=4294967295<<32-this.bitmask>>>0);else throw new Error("Invalid mask: empty");try{this.netLong=(o(l)&this.maskLong)>>>0}catch{throw new Error("Invalid net address: "+l)}if(!(this.bitmask<=32))throw new Error("Invalid mask for ip4: "+u);this.size=Math.pow(2,32-this.bitmask),this.base=a(this.netLong),this.mask=a(this.maskLong),this.hostmask=a(~this.maskLong),this.first=this.bitmask<=30?a(this.netLong+1):this.base,this.last=this.bitmask<=30?a(this.netLong+this.size-2):a(this.netLong+this.size-1),this.broadcast=this.bitmask<=30?a(this.netLong+this.size-1):void 0}return c.prototype.contains=function(l){return typeof l=="string"&&(l.indexOf("/")>0||l.split(".").length!==4)&&(l=new c(l)),l instanceof c?this.contains(l.base)&&this.contains(l.broadcast||l.last):(o(l)&this.maskLong)>>>0===(this.netLong&this.maskLong)>>>0},c.prototype.next=function(l){return l==null&&(l=1),new c(a(this.netLong+this.size*l),this.mask)},c.prototype.forEach=function(l){var u,f,g;for(g=o(this.first),f=o(this.last),u=0;g<=f;)l(a(g),g,u),u++,g++},c.prototype.toString=function(){return this.base+"/"+this.bitmask},c}(),eo.ip2long=o,eo.long2ip=a,eo.Netmask=r}).call(eo)),eo}var xB=EB();const AB=["0.0.0.0/8","10.0.0.0/8","100.64.0.0/10","127.0.0.0/8","169.254.0.0/16","172.16.0.0/12","192.0.0.0/24","192.0.0.0/29","192.0.0.8/32","192.0.0.9/32","192.0.0.10/32","192.0.0.170/32","192.0.0.171/32","192.0.2.0/24","192.31.196.0/24","192.52.193.0/24","192.88.99.0/24","192.168.0.0/16","192.175.48.0/24","198.18.0.0/15","198.51.100.0/24","203.0.113.0/24","240.0.0.0/4","255.255.255.255/32"],_B=AB.map(r=>new xB.Netmask(r));function A4(r){for(const e of _B)if(e.contains(r))return!0;return!1}function IB(r){return/^::ffff:([0-9a-fA-F]{1,4}):([0-9a-fA-F]{1,4})$/.test(r)}function CB(r){const e=r.split(":");if(e.length<2)return!1;const t=e[e.length-1].padStart(4,"0"),n=e[e.length-2].padStart(4,"0"),i=`${parseInt(n.substring(0,2),16)}.${parseInt(n.substring(2),16)}.${parseInt(t.substring(0,2),16)}.${parseInt(t.substring(2),16)}`;return A4(i)}function kB(r){return/^::ffff:([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)}function TB(r){const e=r.split(":"),t=e[e.length-1];return A4(t)}function PB(r){return/^::$/.test(r)||/^::1$/.test(r)||/^64:ff9b::([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/.test(r)||/^100::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001::([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:2[0-9a-fA-F]:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2001:db8:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^2002:([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4}):?([0-9a-fA-F]{0,4})$/.test(r)||/^f[c-d]([0-9a-fA-F]{2,2}):/i.test(r)||/^fe[8-9a-bA-B][0-9a-fA-F]:/i.test(r)||/^ff([0-9a-fA-F]{2,2}):/i.test(r)}function ha(r){if(Cs(r))return A4(r);if(IB(r))return CB(r);if(kB(r))return TB(r);if(d4(r))return PB(r)}function Gy(r){try{for(const{code:e}of r.getComponents())if(e!==ua)return e===Ko||e===On}catch{}return!1}function Cc(r){try{if(!Gy(r))return!1;const[[,e]]=r.stringTuples();return e==null?!1:ha(e)??!1}catch{}return!0}const BB=r=>r.toString().split("/").slice(1),ll=r=>({match:e=>e.length<1?!1:r(e[0])?e.slice(1):!1,pattern:"fn"}),qe=r=>({match:e=>ll(t=>t===r).match(e),pattern:r}),fa=()=>({match:r=>ll(e=>typeof e=="string").match(r),pattern:"{string}"}),kc=()=>({match:r=>ll(e=>!isNaN(parseInt(e))).match(r),pattern:"{number}"}),st=()=>({match:r=>{if(r.length<2||r[0]!=="p2p"&&r[0]!=="ipfs")return!1;if(r[1].startsWith("Q")||r[1].startsWith("1"))try{Rt.decode(`z${r[1]}`)}catch{return!1}else return!1;return r.slice(2)},pattern:"/p2p/{peerid}"}),f1=()=>({match:r=>{if(r.length<2||r[0]!=="certhash")return!1;try{tl.decode(r[1])}catch{return!1}return r.slice(2)},pattern:"/certhash/{certhash}"}),tt=r=>({match:e=>{const t=r.match(e);return t===!1?e:t},pattern:`optional(${r.pattern})`}),mr=(...r)=>({match:e=>{let t;for(const n of r){const i=n.match(e);i!==!1&&(t==null||i.length<t.length)&&(t=i)}return t??!1},pattern:`or(${r.map(e=>e.pattern).join(", ")})`}),He=(...r)=>({match:e=>{for(const t of r){const n=t.match(e);if(n===!1)return!1;e=n}return e},pattern:`and(${r.map(e=>e.pattern).join(", ")})`});function Ct(...r){function e(i){let s=BB(i);for(const o of r){const a=o.match(s);if(a===!1)return!1;s=a}return s}function t(i){return e(i)!==!1}function n(i){const s=e(i);return s===!1?!1:s.length===0}return{matchers:r,matches:t,exactMatch:n}}const NB=st(),OB=Ct(NB),Bh=He(qe("dns4"),fa()),Nh=He(qe("dns6"),fa()),Oh=He(qe("dnsaddr"),fa()),_4=He(qe("dns"),fa());Ct(Bh,tt(st()));Ct(Nh,tt(st()));Ct(Oh,tt(st()));Ct(mr(_4,Oh,Bh,Nh),tt(st()));const Qy=He(qe("ip4"),ll(Cs)),Yy=He(qe("ip6"),ll(d4)),I4=mr(Qy,Yy),ni=mr(I4,_4,Bh,Nh,Oh),RB=Ct(mr(I4,He(mr(_4,Oh,Bh,Nh),tt(st())))),t5=Ct(Qy),r5=Ct(Yy);Ct(I4);const C4=He(ni,qe("tcp"),kc()),ul=He(ni,qe("udp"),kc()),d1=Ct(He(C4,tt(st())));Ct(ul);const k4=He(ul,qe("quic"),tt(st())),Rh=He(ul,qe("quic-v1"),tt(st())),DB=mr(k4,Rh);Ct(k4);const LB=Ct(Rh),M0=mr(ni,C4,ul,k4,Rh),Zy=mr(He(M0,qe("ws"),tt(st()))),Tc=Ct(Zy),Xy=mr(He(M0,qe("wss"),tt(st())),He(M0,qe("tls"),tt(He(qe("sni"),fa())),qe("ws"),tt(st()))),p1=Ct(Xy),Jy=He(ul,qe("webrtc-direct"),tt(f1()),tt(f1()),tt(st())),U0=Ct(Jy),ew=He(Rh,qe("webtransport"),tt(f1()),tt(f1()),tt(st())),n5=Ct(ew),g1=mr(Zy,Xy,He(C4,tt(st())),He(DB,tt(st())),He(ni,tt(st())),Jy,ew,st());Ct(g1);const MB=He(g1,qe("p2p-circuit"),st()),F0=Ct(MB),UB=mr(He(g1,qe("p2p-circuit"),qe("webrtc"),tt(st())),He(g1,qe("webrtc"),tt(st())),He(qe("webrtc"),tt(st()))),i5=Ct(UB),FB=mr(He(ni,qe("tcp"),kc(),qe("http"),tt(st())),He(ni,qe("http"),tt(st())));Ct(FB);const $B=mr(He(ni,qe("tcp"),mr(He(qe("443"),qe("http")),He(kc(),qe("https")),He(kc(),qe("tls"),qe("http"))),tt(st())),He(ni,qe("tls"),qe("http"),tt(st())),He(ni,qe("https"),tt(st())));Ct($B);const VB=mr(He(qe("memory"),fa(),tt(st())));Ct(VB);var r7,n7;class qB extends(n7=vB,r7=Xr,n7){constructor(t,n={}){super(t,{...n,protocol:`/${n.protocolPrefix??Gn.protocolPrefix}/${pB}/${gB}`,log:t.logger.forComponent("libp2p:identify")});h(this,r7,["@libp2p/identify"]);(n.runOnConnectionOpen??Gn.runOnConnectionOpen)&&t.events.addEventListener("connection:open",i=>{const s=i.detail;this.identify(s).catch(o=>{o.name!==dh.name&&this.log.error("error during identify trigged by connection:open",o)})})}async _identify(t,n={}){let i;if(n.signal==null){const s=AbortSignal.timeout(this.timeout);n={...n,signal:s}}try{i=await t.newStream(this.protocol,{...n,runOnLimitedConnection:this.runOnLimitedConnection});const o=await Ic(i,{maxDataLength:this.maxMessageSize}).pb(h1).read(n);return await i.close(n),o}catch(s){throw i==null||i.abort(s),s}}async identify(t,n={}){const i=await this._identify(t,n),{publicKey:s,protocols:o,observedAddr:a}=i;if(s==null)throw new We("public key was missing from identify message");const c=tn(s),l=al(c.toCID());if(!t.remotePeer.equals(l))throw new We("identified peer does not match the expected peer");if(this.peerId.equals(l))throw new We("identified peer is our own peer id?");return this.maybeAddObservedAddress(a),this.log("identify completed for peer %p and protocols %o",l,o),bB(this.peerStore,this.events,this.log,t,i)}maybeAddObservedAddress(t){const n=yB(t);if(n==null)return;if(this.log.trace("our observed address was %a",n),Cc(n)){this.log.trace("our observed address was private");return}const i=n.getComponents();if((i[0].code===On||i[0].code===ua&&i[1].code===On)&&!SB(n)){this.log.trace("our observed address was IPv6 but not a global unicast address");return}d1.exactMatch(n)||(this.log.trace("storing the observed address"),this.addressManager.addObservedAddr(n))}async handleProtocol(t){const{connection:n,stream:i}=t,s=AbortSignal.timeout(this.timeout);try{const o=await this.peerStore.get(this.peerId),a=this.addressManager.getAddresses().map(f=>f.decapsulateCode(dr("p2p").code));let c=o.peerRecordEnvelope;if(a.length>0&&c==null){const f=new ri({peerId:this.peerId,multiaddrs:a});c=(await Ps.seal(f,this.privateKey)).marshal().subarray()}let l=n.remoteAddr.bytes;RB.matches(n.remoteAddr)||(l=void 0),await Ic(i).pb(h1).write({protocolVersion:this.host.protocolVersion,agentVersion:this.host.agentVersion,publicKey:Yr(this.privateKey.publicKey),listenAddrs:a.map(f=>f.bytes),signedPeerRecord:c,observedAddr:l,protocols:o.protocols},{signal:s}),await i.close({signal:s})}catch(o){this.log.error("could not respond to identify request",o),i.abort(o)}}}function KB(r={}){return e=>new qB(e,r)}const da=1e3,T4=60*da,hl=60*T4,HB=36*hl,jB="/ipfs/kad/1.0.0",zB=48*hl,WB=24*hl,GB=10,QB=16384,YB=hl,s5=hl,ZB=10*da,tw=20,Dh=10,XB=5*T4,JB=da,eN=5*da,tN=5*T4,rN=30*da,nN=180*da,o5=`${D3}-kad-dht`;var m1;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&t.key.byteLength>0&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&t.value.byteLength>0&&(n.uint32(18),n.bytes(t.value)),t.timeReceived!=null&&t.timeReceived!==""&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={key:dt(0),value:dt(0),timeReceived:""},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.key=t.bytes();break}case 2:{s.value=t.bytes();break}case 5:{s.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(m1||(m1={}));function iN(r){const e=r.getUTCFullYear(),t=String(r.getUTCMonth()+1).padStart(2,"0"),n=String(r.getUTCDate()).padStart(2,"0"),i=String(r.getUTCHours()).padStart(2,"0"),s=String(r.getUTCMinutes()).padStart(2,"0"),o=String(r.getUTCSeconds()).padStart(2,"0"),a=r.getUTCMilliseconds(),c=String(a*1e3*1e3).padStart(9,"0");return`${e}-${t}-${n}T${i}:${s}:${o}.${c}Z`}function sN(r){const e=new RegExp("(\\d{4})-(\\d{2})-(\\d{2})T(\\d{2}):(\\d{2}):(\\d{2})\\.(\\d+)Z"),t=String(r).trim().match(e);if(t==null)throw new Error("Invalid format");const n=parseInt(t[1],10),i=parseInt(t[2],10)-1,s=parseInt(t[3],10),o=parseInt(t[4],10),a=parseInt(t[5],10),c=parseInt(t[6],10),l=parseInt(t[7].slice(0,-6),10);return new Date(Date.UTC(n,i,s,o,a,c,l))}class Zr{constructor(e,t,n){h(this,"key");h(this,"value");h(this,"timeReceived");if(!(e instanceof Uint8Array))throw new Error("key must be a Uint8Array");if(!(t instanceof Uint8Array))throw new Error("value must be a Uint8Array");this.key=e,this.value=t,this.timeReceived=n}serialize(){return m1.encode(this.prepareSerialize())}prepareSerialize(){return{key:this.key,value:this.value,timeReceived:iN(this.timeReceived)}}static deserialize(e){const t=m1.decode(e);return new Zr(t.key,t.value,new Date(t.timeReceived))}static fromDeserialized(e){const t=sN(e.timeReceived);if(e.key==null)throw new Error("key missing from deserialized object");if(e.value==null)throw new Error("value missing from deserialized object");return new Zr(e.key,e.value,t)}}function oN(r){return r[Symbol.asyncIterator]!=null}function P4(r,e){let t=0;if(oN(r))return async function*(){for await(const c of r)yield e(c,t++)}();const n=f4(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof o.then=="function")return async function*(){yield await o;for(const c of n)yield e(c,t++)}();const a=e;return function*(){yield o;for(const c of n)yield a(c,t++)}()}class y1 extends Error{constructor(e="Query error"){super(e),this.name="QueryError"}}class aN extends Error{constructor(e="Invalid record"){super(e),this.name="InvalidRecordError"}}class cN extends Error{constructor(e="No selector function configured for prefix"){super(e),this.name="MissingSelectorError"}}var a5;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.key!=null&&(n.uint32(10),n.bytes(t.key)),t.value!=null&&(n.uint32(18),n.bytes(t.value)),t.author!=null&&(n.uint32(26),n.bytes(t.author)),t.signature!=null&&(n.uint32(34),n.bytes(t.signature)),t.timeReceived!=null&&(n.uint32(42),n.string(t.timeReceived)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.key=t.bytes();break}case 2:{s.value=t.bytes();break}case 3:{s.author=t.bytes();break}case 4:{s.signature=t.bytes();break}case 5:{s.timeReceived=t.string();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(a5||(a5={}));var vt;(function(r){r.PUT_VALUE="PUT_VALUE",r.GET_VALUE="GET_VALUE",r.ADD_PROVIDER="ADD_PROVIDER",r.GET_PROVIDERS="GET_PROVIDERS",r.FIND_NODE="FIND_NODE",r.PING="PING"})(vt||(vt={}));var w1;(function(r){r[r.PUT_VALUE=0]="PUT_VALUE",r[r.GET_VALUE=1]="GET_VALUE",r[r.ADD_PROVIDER=2]="ADD_PROVIDER",r[r.GET_PROVIDERS=3]="GET_PROVIDERS",r[r.FIND_NODE=4]="FIND_NODE",r[r.PING=5]="PING"})(w1||(w1={}));(function(r){r.codec=()=>xh(w1)})(vt||(vt={}));var jo;(function(r){r.NOT_CONNECTED="NOT_CONNECTED",r.CONNECTED="CONNECTED",r.CAN_CONNECT="CAN_CONNECT",r.CANNOT_CONNECT="CANNOT_CONNECT"})(jo||(jo={}));var $0;(function(r){r[r.NOT_CONNECTED=0]="NOT_CONNECTED",r[r.CONNECTED=1]="CONNECTED",r[r.CAN_CONNECT=2]="CAN_CONNECT",r[r.CANNOT_CONNECT=3]="CANNOT_CONNECT"})($0||($0={}));(function(r){r.codec=()=>xh($0)})(jo||(jo={}));var lo;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.id!=null&&t.id.byteLength>0&&(n.uint32(10),n.bytes(t.id)),t.multiaddrs!=null)for(const s of t.multiaddrs)n.uint32(18),n.bytes(s);t.connection!=null&&(n.uint32(24),jo.codec().encode(t.connection,n)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a;const s={id:dt(0),multiaddrs:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const c=t.uint32();switch(c>>>3){case 1:{s.id=t.bytes();break}case 2:{if(((a=i.limits)==null?void 0:a.multiaddrs)!=null&&s.multiaddrs.length===i.limits.multiaddrs)throw new Dt('Decode error - map field "multiaddrs" had too many elements');s.multiaddrs.push(t.bytes());break}case 3:{s.connection=jo.codec().decode(t);break}default:{t.skipType(c&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(lo||(lo={}));var vo;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.type!=null&&w1[t.type]!==0&&(n.uint32(8),vt.codec().encode(t.type,n)),t.clusterLevel!=null&&(n.uint32(80),n.int32(t.clusterLevel)),t.key!=null&&(n.uint32(18),n.bytes(t.key)),t.record!=null&&(n.uint32(26),n.bytes(t.record)),t.closer!=null)for(const s of t.closer)n.uint32(66),lo.codec().encode(s,n);if(t.providers!=null)for(const s of t.providers)n.uint32(74),lo.codec().encode(s,n);i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,u;const s={type:vt.PUT_VALUE,closer:[],providers:[]},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const f=t.uint32();switch(f>>>3){case 1:{s.type=vt.codec().decode(t);break}case 10:{s.clusterLevel=t.int32();break}case 2:{s.key=t.bytes();break}case 3:{s.record=t.bytes();break}case 8:{if(((a=i.limits)==null?void 0:a.closer)!=null&&s.closer.length===i.limits.closer)throw new Dt('Decode error - map field "closer" had too many elements');s.closer.push(lo.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.closer$}));break}case 9:{if(((l=i.limits)==null?void 0:l.providers)!=null&&s.providers.length===i.limits.providers)throw new Dt('Decode error - map field "providers" had too many elements');s.providers.push(lo.codec().decode(t,t.uint32(),{limits:(u=i.limits)==null?void 0:u.providers$}));break}default:{t.skipType(f&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(vo||(vo={}));function c5(r,e={}){var n;const t={...r,name:"SEND_QUERY",type:0,messageName:r.type,messageType:r.type};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:send-query",{detail:t})),t}function V0(r,e={}){var n;const t={...r,name:"PEER_RESPONSE",type:1,messageName:r.messageType,closer:r.closer??[],providers:r.providers??[]};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:peer-response",{detail:t})),t}function ld(r,e={}){var n;const t={...r,name:"FINAL_PEER",type:2};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:final-peer",{detail:t})),t}function zo(r,e={}){var n;const t={...r,name:"QUERY_ERROR",type:3};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:query-error",{detail:t})),t}function l5(r,e={}){var n;const t={...r,name:"PROVIDER",type:4};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:provider",{detail:t})),t}function q0(r,e={}){var n;const t={...r,name:"VALUE",type:5};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:value",{detail:t})),t}function u5(r,e={}){var n;const t={...r,name:"DIAL_PEER",type:7};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:dial-peer",{detail:t})),t}function lN(r,e={}){var n;const t={...r,name:"PATH_ENDED",type:8};return(n=e.onProgress)==null||n.call(e,new CustomEvent("kad-dht:query:path-ended",{detail:t})),t}function uN(r,e,t){if(t.length===0)throw new ke("No records given");const i=Be(e).split("/");if(i.length<3)throw new ke("Record key does not have a selector function");const s=r[i[1].toString()];if(s==null)throw new cN(`No selector function configured for key type "${i[1]}"`);return t.length===1?0:s(e,t)}function hN(r,e){return 0}const fN={pk:hN};async function B4(r,e,t){const n=e.key,s=Be(n).split("/");if(s.length<3)return;const o=r[s[1].toString()];if(o==null)throw new ke(`No validator available for key type "${s[1]}"`);await o(n,e.value,t)}const dN=async(r,e,t)=>{if(!(r instanceof Uint8Array))throw new ke('"key" must be a Uint8Array');if(r.byteLength<5)throw new ke("Invalid public key record");if(Be(r.subarray(0,4))!=="/pk/")throw new ke("key was not prefixed with /pk/");const i=tn(e),s=r.slice(4);if(!pt(s,i.toMultihash().bytes))throw new ke("public key does not match passed in key")},pN={pk:dN},zn="/",rw=new TextEncoder().encode(zn),Gl=rw[0];class Ut{constructor(e,t){h(this,"_buf");if(typeof e=="string")this._buf=Ae(e);else if(e instanceof Uint8Array)this._buf=e;else throw new Error("Invalid key, should be String of Uint8Array");if(t==null&&(t=!0),t&&this.clean(),this._buf.byteLength===0||this._buf[0]!==Gl)throw new Error("Invalid key")}toString(e="utf8"){return Be(this._buf,e)}uint8Array(){return this._buf}get[Symbol.toStringTag](){return`Key(${this.toString()})`}static withNamespaces(e){return new Ut(e.join(zn))}static random(){return new Ut(Math.random().toString().substring(2))}static asKey(e){return e instanceof Uint8Array||typeof e=="string"?new Ut(e):typeof e.uint8Array=="function"?new Ut(e.uint8Array()):null}clean(){if((this._buf==null||this._buf.byteLength===0)&&(this._buf=rw),this._buf[0]!==Gl){const e=new Uint8Array(this._buf.byteLength+1);e.fill(Gl,0,1),e.set(this._buf,1),this._buf=e}for(;this._buf.byteLength>1&&this._buf[this._buf.byteLength-1]===Gl;)this._buf=this._buf.subarray(0,-1)}less(e){const t=this.list(),n=e.list();for(let i=0;i<t.length;i++){if(n.length<i+1)return!1;const s=t[i],o=n[i];if(s<o)return!0;if(s>o)return!1}return t.length<n.length}reverse(){return Ut.withNamespaces(this.list().slice().reverse())}namespaces(){return this.list()}baseNamespace(){const e=this.namespaces();return e[e.length-1]}list(){return this.toString().split(zn).slice(1)}type(){return gN(this.baseNamespace())}name(){return mN(this.baseNamespace())}instance(e){return new Ut(this.toString()+":"+e)}path(){let e=this.parent().toString();return e.endsWith(zn)||(e+=zn),e+=this.type(),new Ut(e)}parent(){const e=this.list();return e.length===1?new Ut(zn):new Ut(e.slice(0,-1).join(zn))}child(e){return this.toString()===zn?e:e.toString()===zn?this:new Ut(this.toString()+e.toString(),!1)}isAncestorOf(e){return e.toString()===this.toString()?!1:e.toString().startsWith(this.toString())}isDecendantOf(e){return e.toString()===this.toString()?!1:this.toString().startsWith(e.toString())}isTopLevel(){return this.list().length===1}concat(...e){return Ut.withNamespaces([...this.namespaces(),...yN(e.map(t=>t.namespaces()))])}}function gN(r){const e=r.split(":");return e.length<2?"":e.slice(0,-1).join(":")}function mN(r){const e=r.split(":");return e[e.length-1]}function yN(r){return[].concat(...r)}const wN=Ae("/pk/");function bN(r){return{...r,multiaddrs:r.multiaddrs.filter(e=>{const[[t,n]]=e.stringTuples();if(t===53||t===54||t===55)return n!=="localhost";if(t!==4&&t!==6||n==null)return!1;const i=ha(n);return i==null?!0:!i})}}async function Pc(r,e){var n;const t=await wi.digest(r);return(n=e==null?void 0:e.signal)==null||n.throwIfAborted(),t.digest}async function ui(r,e){return Pc(r.toMultihash().bytes,e)}function ic(r,e){return new Ut(`${r}/${Be(e,"base32")}`,!1)}function vN(r){return Jr([wN,r.toMultihash().bytes])}function SN(r){return Be(r.subarray(0,4))==="/pk/"}function EN(r){const e=$r(r.subarray(4));return bn(e)}function h5(r,e){const t=new Date;return new Zr(r,e,t).serialize()}const xN=290,AN=54,_N=55,IN=56,CN=4,kN=41;function TN(r){const e=r.stringTuples();for(const t of e)if(t[0]===xN)return!1;if(e[0][0]===AN||e[0][0]===_N||e[0][0]===IN)return!0;if(e[0][0]===CN||e[0][0]===kN){const t=ha(`${e[0][1]}`);return t==null||!t}return!1}function nw(r){const e=r.toString().split("/"),t=e.pop(),n=e.pop();if(t==null||n==null)throw new Error(`incorrectly formatted provider entry key in datastore: ${r.toString()}`);return{cid:it.createV1(FA,$r(Ae(n,"base32"))),peerId:li(t)}}function ud(r,e,t){const n=typeof e=="string"?e:Be(e.multihash.bytes,"base32"),i=[r,n];return t!=null&&i.push(t.toString()),new Ut(i.join("/"))}function iw(r){return new Date(sl(r))}function to(r,e,t){return async function*(...n){var a,c,l,u,f;const i=(a=e.queryTime)==null?void 0:a.timer(t),s=(c=e.errorTime)==null?void 0:c.timer(t);let o=!1;try{(l=e.queries)==null||l.increment({[t]:!0}),yield*r(...n)}catch(g){throw o=!0,s==null||s(),(u=e.errors)==null||u.increment({[t]:!0}),g}finally{(f=e.queries)==null||f.decrement({[t]:!0}),o||i==null||i()}}}function sw(r,e,t){return async function(...n){var a,c,l,u,f;const i=(a=e==null?void 0:e.queryTime)==null?void 0:a.timer(t),s=(c=e==null?void 0:e.errorTime)==null?void 0:c.timer(t);let o=!1;try{return(l=e.queries)==null||l.increment({[t]:!0}),await r(...n)}catch(g){throw o=!0,s==null||s(),(u=e.errors)==null||u.increment({[t]:!0}),g}finally{(f=e.queries)==null||f.decrement({[t]:!0}),o||i==null||i()}}}class PN{constructor(e,t){h(this,"log");h(this,"components");h(this,"validators");h(this,"selectors");h(this,"peerRouting");h(this,"queryManager");h(this,"network");h(this,"datastorePrefix");var l,u;const{validators:n,selectors:i,peerRouting:s,queryManager:o,network:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-fetching`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n,this.selectors=i,this.peerRouting=s,this.queryManager=o,this.network=a,this.get=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.get",this.get.bind(this),{optionsIndex:1}))??this.get,this.put=((u=e.metrics)==null?void 0:u.traceFunction("libp2p.kadDHT.put",this.put.bind(this),{optionsIndex:2}))??this.put}async getLocal(e,t){this.log("getLocal %b",e);const n=ic(this.datastorePrefix,e);this.log("fetching record for key %k",n);const i=await this.components.datastore.get(n,t);this.log("found %k in local datastore",n);const s=Zr.deserialize(i);return await B4(this.validators,s,t),s}async*sendCorrectionRecord(e,t,n,i){this.log("sendCorrection for %b",e);const s=h5(e,n);for(const{value:o,from:a}of t){if(pt(o,n)){this.log("record was ok");continue}if(this.components.peerId.equals(a)){try{const u=ic(this.datastorePrefix,e);this.log(`Storing corrected record for key ${u.toString()}`),await this.components.datastore.put(u,s.subarray(),i)}catch(u){this.log.error("Failed error correcting self",u)}continue}let c=!1;const l={type:vt.PUT_VALUE,key:e,record:s};for await(const u of this.network.sendRequest(a,l,i))u.name==="PEER_RESPONSE"&&u.record!=null&&pt(u.record.value,Zr.deserialize(s).value)&&(c=!0),yield u;if(!c)throw new y1("Could not send correction");this.log.error("Failed error correcting entry")}}async*put(e,t,n){this.log("put key %b value %b",e,t);const i=h5(e,t),s=ic(this.datastorePrefix,e);this.log(`storing record for key ${s.toString()}`),await this.components.datastore.put(s,i.subarray(),n),yield*Uo(this.peerRouting.getClosestPeers(e,{...n,signal:n.signal}),o=>P4(o,a=>async()=>{if(a.name!=="FINAL_PEER")return[a];const c=[],l={type:vt.PUT_VALUE,key:e,record:i};this.log("send put to %p",a.peer.id);for await(const u of this.network.sendRequest(a.peer.id,l,{...n,path:a.path}))c.push(u),u.name==="PEER_RESPONSE"&&(u.record!=null&&pt(u.record.value,Zr.deserialize(i).value)||c.push(zo({from:a.peer.id,error:new y1("Value not put correctly"),path:u.path},n)));return c}),o=>x4(o,{ordered:!1,concurrency:Dh}),async function*(o){for await(const a of o)yield*a})}async*get(e,t){this.log("get %b",e);const n=[];for await(const a of this.getMany(e,t)){if(a.name==="VALUE"){n.push(a);continue}yield a}if(n.length===0)return;const i=n.map(a=>a.value);let s=0;try{s=uN(this.selectors,e,i)}catch(a){if(a.name!=="InvalidParametersError")throw a}const o=i[s];if(this.log("GetValue %b %b",e,o),o==null)throw new zr("Best value was not found");yield*this.sendCorrectionRecord(e,n,o,{...t,path:{index:-1,queued:0,running:0,total:0}}),yield n[s]}async*getMany(e,t={}){this.log("getMany values for %b",e);try{const s=await this.getLocal(e,t);yield q0({value:s.value,from:this.components.peerId,path:{index:-1,running:0,queued:0,total:0}},t)}catch(s){this.log("error getting local value for %b",e,s)}const n=this,i=async function*({peer:s,signal:o,path:a}){for await(const c of n.peerRouting.getValueOrPeers(s.id,e,{...t,signal:o,path:a}))yield c,c.name==="PEER_RESPONSE"&&c.record!=null&&(yield q0({from:s.id,value:c.record.value,path:a},t))};yield*this.queryManager.run(e,i,t)}}let BN=class extends Error{constructor(t,n){super(t??"The operation was aborted");h(this,"type");h(this,"code");this.type="aborted",this.name="AbortError",this.code=n??"ABORT_ERR"}};async function Ln(r,e,t,n){const i=new BN(n==null?void 0:n.errorMessage,n==null?void 0:n.errorCode);return(t==null?void 0:t.aborted)===!0?Promise.reject(i):new Promise((s,o)=>{function a(){t==null||t.removeEventListener("abort",u),r.removeEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.removeEventListener(n.errorEvent,l)}const c=f=>{var g;try{if(((g=n==null?void 0:n.filter)==null?void 0:g.call(n,f))===!1)return}catch(m){a(),o(m);return}a(),s(f)},l=f=>{a(),o(f.detail)},u=()=>{a(),o(i)};t==null||t.addEventListener("abort",u),r.addEventListener(e,c),(n==null?void 0:n.errorEvent)!=null&&r.addEventListener(n.errorEvent,l)})}class NN extends Error{constructor(t="Rate limit exceeded",n){super(t);h(this,"remainingPoints");h(this,"msBeforeNext");h(this,"consumedPoints");h(this,"isFirstInDuration");this.name="RateLimitError",this.remainingPoints=n.remainingPoints,this.msBeforeNext=n.msBeforeNext,this.consumedPoints=n.consumedPoints,this.isFirstInDuration=n.isFirstInDuration}}var Qd;let ON=(Qd=class extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}},h(Qd,"name","QueueFullError"),Qd),RN=class{constructor(e){h(this,"deferred");h(this,"signal");var t;this.signal=e,this.deferred=St(),this.onAbort=this.onAbort.bind(this),(t=this.signal)==null||t.addEventListener("abort",this.onAbort)}onAbort(){var e;this.deferred.reject(((e=this.signal)==null?void 0:e.reason)??new Hi)}cleanup(){var e;(e=this.signal)==null||e.removeEventListener("abort",this.onAbort)}};function DN(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}let LN=class{constructor(e,t){h(this,"id");h(this,"fn");h(this,"options");h(this,"recipients");h(this,"status");h(this,"timeline");h(this,"controller");this.id=DN(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>{var i;return t&&((i=n.signal)==null?void 0:i.aborted)===!0},!0)&&(this.controller.abort(new Hi),this.cleanup())}async join(e={}){var n;const t=new RN(e.signal);return this.recipients.push(t),(n=e.signal)==null||n.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await Ht(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{var t;e.cleanup(),(t=e.signal)==null||t.removeEventListener("abort",this.onAbort)})}},fl=class extends or{constructor(t={}){var n;super();h(this,"concurrency");h(this,"maxSize");h(this,"queue");h(this,"pending");h(this,"sort");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,t.metricName!=null&&((n=t.metrics)==null||n.registerMetricGroup(t.metricName,{calculate:()=>({size:this.queue.length,running:this.pending,queued:this.queue.length-this.pending})})),this.sort=t.sort,this.queue=[],this.emitEmpty=L0(this.emitEmpty.bind(this),1),this.emitIdle=L0(this.emitIdle.bind(this),1)}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let t;for(const n of this.queue)if(n.status==="queued"){t=n;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let n=0;n<this.queue.length;n++)if(this.queue[n]===t){this.queue.splice(n,1);break}this.pending--,this.tryToStartAnother(),this.safeDispatchEvent("next")}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}async add(t,n){var s;if((s=n==null?void 0:n.signal)==null||s.throwIfAborted(),this.size===this.maxSize)throw new ON;const i=new LN(t,n);return this.enqueue(i),this.safeDispatchEvent("add"),this.tryToStartAnother(),i.join(n).then(o=>(this.safeDispatchEvent("completed",{detail:o}),this.safeDispatchEvent("success",{detail:{job:i,result:o}}),o)).catch(o=>{if(i.status==="queued"){for(let a=0;a<this.queue.length;a++)if(this.queue[a]===i){this.queue.splice(a,1);break}}throw this.safeDispatchEvent("error",{detail:o}),this.safeDispatchEvent("failure",{detail:{job:i,error:o}}),o})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new Hi)}),this.clear()}async onEmpty(t){this.size!==0&&await Ln(this,"empty",t==null?void 0:t.signal)}async onSizeLessThan(t,n){this.size<t||await Ln(this,"next",n==null?void 0:n.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await Ln(this,"idle",t==null?void 0:t.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){var l,u,f;(l=t==null?void 0:t.signal)==null||l.throwIfAborted();const n=bi({objectMode:!0}),i=g=>{g!=null?this.abort():this.clear(),n.end(g)},s=g=>{g.detail!=null&&n.push(g.detail)},o=g=>{i(g.detail)},a=()=>{i()},c=()=>{i(new Hi("Queue aborted"))};this.addEventListener("completed",s),this.addEventListener("error",o),this.addEventListener("idle",a),(u=t==null?void 0:t.signal)==null||u.addEventListener("abort",c);try{yield*n}finally{this.removeEventListener("completed",s),this.removeEventListener("error",o),this.removeEventListener("idle",a),(f=t==null?void 0:t.signal)==null||f.removeEventListener("abort",c),i()}}};function MN(r,e){return{id:r.id.toMultihash().bytes,multiaddrs:(r.multiaddrs??[]).map(n=>n.bytes),connection:e}}function Ql(r){if(r.id==null)throw new Error("Invalid peer in message");const e=$r(r.id);return{id:bn(e),multiaddrs:(r.multiaddrs??[]).map(t=>Ze(t))}}class UN{constructor(e,t){h(this,"log");h(this,"components");h(this,"network");h(this,"peerRouting");h(this,"queryManager");h(this,"routingTable");h(this,"providers");var l,u;const{network:n,peerRouting:i,queryManager:s,routingTable:o,providers:a,logPrefix:c}=t;this.components=e,this.log=e.logger.forComponent(`${c}:content-routing`),this.network=n,this.peerRouting=i,this.queryManager=s,this.routingTable=o,this.providers=a,this.findProviders=((l=e.metrics)==null?void 0:l.traceFunction("libp2p.kadDHT.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(f,g)=>(f.name==="PROVIDER"&&(g.providers??(g.providers=[]),g.providers.push(...f.providers.map(m=>m.id.toString()))),g)}))??this.findProviders,this.provide=((u=e.metrics)==null?void 0:u.traceFunction("libp2p.kadDHT.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromYieldedValue:(f,g)=>(f.name==="PEER_RESPONSE"&&f.messageName==="ADD_PROVIDER"&&(g.providers??(g.providers=[]),g.providers.push(f.from.toString())),g)}))??this.provide}async*provide(e,t,n={}){this.log("provide %s",e);const i=e.multihash.bytes;await this.providers.addProvider(e,this.components.peerId,n);const s={type:vt.ADD_PROVIDER,key:i,providers:[MN({id:this.components.peerId,multiaddrs:t})]};let o=0;const a=this;async function*c(f){try{a.log("sending provider record for %s to %p",e,f.peer.id);for await(const g of a.network.sendMessage(f.peer.id,s,{...n,path:f.path}))g.name==="PEER_RESPONSE"&&(a.log("sent provider record for %s to %p",e,f.peer.id),o++),yield g}catch(g){a.log.error("error sending provide record to peer %p",f.peer.id,g),yield zo({from:f.peer.id,error:g,path:f.path},n)}}const l=bi({objectMode:!0}),u=new fl({concurrency:Dh});u.addEventListener("idle",()=>{l.end()}),u.addEventListener("error",f=>{this.log.error("error publishing provider record to peer - %e",f)}),u.add(async()=>{const f=[];for await(const g of this.peerRouting.getClosestPeers(i,n))l.push(g),g.name==="FINAL_PEER"&&f.push(g);f.forEach(g=>{u.add(async()=>{for await(const m of c(g))l.push(m)}).catch(m=>{this.log.error("error publishing provider record to peer - %e",m)})})}).catch(f=>{l.end(f)}),yield*l,this.log("sent provider records to %d peers",o)}async*findProviders(e,t){const n=this.routingTable.kBucketSize;let i=0;const s=e.multihash.bytes,o=this;this.log("findProviders %c",e);const a=await this.providers.getProviders(e,t);if(a.length>0){const u=[];for(const f of a.slice(0,n))try{const g=await this.components.peerStore.get(f,t);u.push({id:f,multiaddrs:g.addresses.map(({multiaddr:m})=>m)})}catch(g){if(g.name!=="NotFoundError")throw g;this.log("no peer store entry for %p",f)}if(yield V0({from:this.components.peerId,messageType:vt.GET_PROVIDERS,providers:u,path:{index:-1,queued:0,running:0,total:0}},t),yield l5({from:this.components.peerId,providers:u,path:{index:-1,queued:0,running:0,total:0}},t),i+=u.length,i>=n)return}const c=async function*({peer:u,signal:f,path:g}){const m={type:vt.GET_PROVIDERS,key:s};yield*o.network.sendRequest(u.id,m,{...t,signal:f,path:g})},l=new Dn(a);for await(const u of this.queryManager.run(s,c,t))if(yield u,u.name==="PEER_RESPONSE"){this.log("Found %d provider entries for %c and %d closer peers",u.providers.length,e,u.closer.length);const f=[];for(const g of u.providers)l.has(g.id)||(l.add(g.id),f.push(g));if(f.length>0&&(yield l5({from:u.from,providers:f,path:u.path},t),i+=f.length,i>=n))return}}}function Fr(r){const e=new globalThis.AbortController;function t(){e.abort();for(const s of r)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}for(const s of r){if((s==null?void 0:s.aborted)===!0){t();break}(s==null?void 0:s.addEventListener)!=null&&s.addEventListener("abort",t)}function n(){for(const s of r)(s==null?void 0:s.removeEventListener)!=null&&s.removeEventListener("abort",t)}const i=e.signal;return i.clear=n,i}class hd{constructor(e){h(this,"movingAverage");h(this,"variance");h(this,"deviation");h(this,"forecast");h(this,"timeSpan");h(this,"previousTime");this.timeSpan=e,this.movingAverage=0,this.variance=0,this.deviation=0,this.forecast=0}alpha(e,t){return 1-Math.exp(-(e-t)/this.timeSpan)}push(e,t=Date.now()){if(this.previousTime!=null){const n=this.alpha(t,this.previousTime),i=e-this.movingAverage,s=n*i;this.movingAverage=n*e+(1-n)*this.movingAverage,this.variance=(1-n)*(this.variance+i*s),this.deviation=Math.sqrt(this.variance),this.forecast=this.movingAverage+n*i}else this.movingAverage=e;this.previousTime=t}}const FN=1.2,$N=2,VN=5e3,qN=6e4,KN=5e3;class Bc{constructor(e={}){h(this,"success");h(this,"failure");h(this,"next");h(this,"metric");h(this,"timeoutMultiplier");h(this,"failureMultiplier");h(this,"minTimeout");h(this,"maxTimeout");var n;const t=e.interval??KN;this.success=new hd(t),this.failure=new hd(t),this.next=new hd(t),this.failureMultiplier=e.failureMultiplier??$N,this.timeoutMultiplier=e.timeoutMultiplier??FN,this.minTimeout=e.minTimeout??VN,this.maxTimeout=e.maxTimeout??qN,e.metricName!=null&&(this.metric=(n=e.metrics)==null?void 0:n.registerMetricGroup(e.metricName))}getTimeoutSignal(e={}){let t=Math.round(this.next.movingAverage*(e.timeoutFactor??this.timeoutMultiplier));t<this.minTimeout&&(t=this.minTimeout),t>this.maxTimeout&&(t=this.maxTimeout);const n=AbortSignal.timeout(t),i=Fr([e.signal,n]);return i.start=Date.now(),i.timeout=t,i}cleanUp(e){var n,i;const t=Date.now()-e.start;e.aborted?(this.failure.push(t),this.next.push(t*this.failureMultiplier),(n=this.metric)==null||n.update({failureMovingAverage:this.failure.movingAverage,failureDeviation:this.failure.deviation,failureForecast:this.failure.forecast,failureVariance:this.failure.variance,failure:t})):(this.success.push(t),this.next.push(t),(i=this.metric)==null||i.update({successMovingAverage:this.success.movingAverage,successDeviation:this.success.deviation,successForecast:this.success.forecast,successVariance:this.success.variance,success:t}))}}class HN extends or{constructor(t,n){var i,s,o,a;super();h(this,"log");h(this,"protocol");h(this,"running");h(this,"components");h(this,"timeout");h(this,"metrics");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:network`),this.running=!1,this.protocol=n.protocol,this.timeout=new Bc({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_network_message_send_times_milliseconds`}),this.metrics={operations:(i=t.metrics)==null?void 0:i.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_requests_total`),errors:(s=t.metrics)==null?void 0:s.registerCounterGroup(`${n.metricsPrefix}_outbound_rpc_errors_total`)},this.sendRequest=((o=t.metrics)==null?void 0:o.traceFunction("libp2p.kadDHT.sendRequest",this.sendRequest.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],u){return{...u,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((u,f)=>{l[`providers-${f}`]=u.id.toString()}),c.closer.length>0&&c.closer.forEach((u,f)=>{l[`closer-${f}`]=u.id.toString()})),l)}))??this.sendRequest,this.sendMessage=((a=t.metrics)==null?void 0:a.traceFunction("libp2p.kadDHT.sendMessage",this.sendMessage.bind(this),{optionsIndex:2,getAttributesFromArgs([c,l],u){return{...u,to:c.toString(),"message type":`${l.type}`}},getAttributesFromYieldedValue:(c,l)=>(c.name==="PEER_RESPONSE"&&(c.providers.length>0&&c.providers.forEach((u,f)=>{l[`providers-${f}`]=u.id.toString()}),c.closer.length>0&&c.closer.forEach((u,f)=>{l[`closer-${f}`]=u.id.toString()})),l)}))??this.sendMessage}async start(){this.running||(this.running=!0)}async stop(){this.running=!1}isStarted(){return this.running}async*sendRequest(t,n,i){var c,l,u;if(!this.running)return;const s=n.type;if(s==null)throw new ke("Message type was missing");let o;const a=this.timeout.getTimeoutSignal(i);i={...i,signal:a};try{(c=this.metrics.operations)==null||c.increment({[s]:!0}),this.log("dialling %p",t),yield u5({peer:t,path:i.path},i),o=await(await this.components.connectionManager.openConnection(t,i)).newStream(this.protocol,i),this.log("sending %s to %p",n.type,t),yield c5({to:t,type:s,path:i.path},i);const g=await this._writeReadMessage(o,n,i);o.close(i).catch(m=>{this.log.error("error closing stream to %p",t,m),o==null||o.abort(m)}),yield V0({from:t,messageType:g.type,closer:g.closer.map(Ql),providers:g.providers.map(Ql),record:g.record==null?void 0:Zr.deserialize(g.record),path:i.path},i)}catch(f){(l=this.metrics.errors)==null||l.increment({[s]:!0}),o==null||o.abort(f),((u=i.signal)==null?void 0:u.aborted)!==!0&&this.log.error("could not send %s to %p - %e",n.type,t,f),yield zo({from:t,error:f,path:i.path},i)}finally{this.timeout.cleanUp(a)}}async*sendMessage(t,n,i){var c,l;if(!this.running)return;const s=n.type;if(s==null)throw new ke("Message type was missing");let o;const a=this.timeout.getTimeoutSignal(i);i={...i,signal:a};try{(c=this.metrics.operations)==null||c.increment({[s]:!0}),this.log("dialling %p",t),yield u5({peer:t,path:i.path},i),o=await(await this.components.connectionManager.openConnection(t,i)).newStream(this.protocol,i),this.log("sending %s to %p",n.type,t),yield c5({to:t,type:s,path:i.path},i),await this._writeMessage(o,n,i),o.close(i).catch(f=>{this.log.error("error closing stream to %p",t,f),o==null||o.abort(f)}),yield V0({from:t,messageType:s,path:i.path},i)}catch(u){(l=this.metrics.errors)==null||l.increment({[s]:!0}),o==null||o.abort(u),yield zo({from:t,error:u,path:i.path},i)}finally{this.timeout.cleanUp(a)}}async _writeMessage(t,n,i){await Ic(t).write(n,vo,i)}async _writeReadMessage(t,n,i){const s=Ic(t);await s.write(n,vo,i);const o=await s.read(vo,i);return o.closer.forEach(a=>{this.safeDispatchEvent("peer",{detail:Ql(a)})}),o.providers.forEach(a=>{this.safeDispatchEvent("peer",{detail:Ql(a)})}),o}}function sc(r,e){if(r.byteLength!==e.byteLength)throw new Error("Inputs should have the same length");for(let t=0;t<r.byteLength;t++)if(r[t]!==e[t])return r[t]<e[t]?-1:1;return 0}class N4{constructor(e,t){h(this,"originDhtKey");h(this,"capacity");h(this,"peerDistances");this.originDhtKey=e,this.capacity=t,this.peerDistances=[]}get length(){return this.peerDistances.length}get peers(){return[...this.peerDistances]}async add(e,t={index:-1,queued:0,running:0,total:0},n){const i=await ui(e.id,n);this.addWithKadId(e,i,t)}addWithKadId(e,t,n={index:-1,queued:0,running:0,total:0}){if(this.peerDistances.find(o=>o.peer.id.equals(e.id))!=null)return;const i={peer:e,distance:$o(this.originDhtKey,t),path:n};if(this.peerDistances.length===this.capacity){const o=this.peerDistances[this.peerDistances.length-1];if(o!=null&&sc(i.distance,o.distance)!==-1)return}let s=!1;for(let o=0;o<this.peerDistances.length;o++){const a=sc(this.peerDistances[o].distance,i.distance);if(a===0||a===1){s=!0,this.peerDistances.splice(o,0,i);break}}s||this.peerDistances.push(i),this.peerDistances=this.peerDistances.slice(0,this.capacity)}async isCloser(e,t){if(this.length===0)return!0;const n=await ui(e,t),i=$o(n,this.originDhtKey),s=this.peerDistances[this.peerDistances.length-1].distance;return sc(i,s)===-1}async anyCloser(e,t){return e.length===0?!1:Promise.any(e.map(async n=>this.isCloser(n,t)))}}class jN{constructor(e,t){h(this,"log");h(this,"routingTable");h(this,"network");h(this,"validators");h(this,"queryManager");h(this,"components");var n,i;this.routingTable=t.routingTable,this.network=t.network,this.validators=t.validators,this.queryManager=t.queryManager,this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:peer-routing`),this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.kadDHT.findPeer",this.findPeer.bind(this),{optionsIndex:1}))??this.findPeer,this.getClosestPeers=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.kadDHT.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1}))??this.getClosestPeers}async findPeerLocal(e,t){let n;const i=await this.routingTable.find(e,t);if(i!=null){this.log("findPeerLocal found %p in routing table",e);try{n=await this.components.peerStore.get(i,t)}catch(s){if(s.name!=="NotFoundError")throw s}}if(n==null)try{n=await this.components.peerStore.get(e,t)}catch(s){if(s.name!=="NotFoundError")throw s}if(n!=null)return this.log("findPeerLocal found %p in peer store",e),{id:n.id,multiaddrs:n.addresses.map(s=>s.multiaddr)}}async*_getValueSingle(e,t,n){const i={type:vt.GET_VALUE,key:t};yield*this.network.sendRequest(e,i,n)}async*getPublicKeyFromNode(e,t={}){const n=vN(e),i={index:-1,queued:0,running:0,total:0};for await(const s of this._getValueSingle(e,n,{...t,path:i}))if(yield s,s.name==="PEER_RESPONSE"&&s.record!=null){const o=tn(s.record.value),a=Is(o);if(!a.equals(e))throw new yc("public key does not match id");if(a.publicKey==null)throw new yc("public key missing");yield q0({from:e,value:s.record.value,path:i},t)}throw new y1(`Node not responding with its public key: ${e.toString()}`)}async*findPeer(e,t={}){if(this.log("findPeer %p",e),t.useCache!==!1){const i=await this.findPeerLocal(e,t);if(i!=null){this.log("found local"),yield ld({from:this.components.peerId,peer:i,path:{index:-1,queued:0,running:0,total:0}},t);return}}let n=!1;if(t.useNetwork!==!1){const i=this,s=async function*({peer:o,signal:a,path:c}){const l={type:vt.FIND_NODE,key:e.toMultihash().bytes};for await(const u of i.network.sendRequest(o.id,l,{...t,signal:a,path:c}))if(yield u,u.name==="PEER_RESPONSE"){const f=u.closer.find(g=>g.id.equals(e));f!=null&&(yield ld({from:u.from,peer:f,path:u.path},t))}};for await(const o of this.queryManager.run(e.toMultihash().bytes,s,t))o.name==="FINAL_PEER"&&(n=!0),yield o}if(!n)throw new zr("Not found")}async*getClosestPeers(e,t={}){this.log("getClosestPeers to %b",e);const n=await Pc(e,t),i=new N4(n,this.routingTable.kBucketSize),s=this,o=async function*({peer:a,path:c,peerKadId:l,signal:u}){s.log("getClosestPeers asking %p",a.id);const f={type:vt.FIND_NODE,key:e};yield*s.network.sendRequest(a.id,f,{...t,signal:u,path:c}),i.addWithKadId(a,l,c)};yield*this.queryManager.run(e,o,t),this.log("found %d peers close to %b",i.length,e);for(let{peer:a,path:c}of i.peers)try{if(a.multiaddrs.length===0&&(a=await s.components.peerStore.getInfo(a.id,t)),a.multiaddrs.length===0)continue;yield ld({from:this.components.peerId,peer:await s.components.peerStore.getInfo(a.id,t),path:{index:c.index,queued:0,running:0,total:0}},t)}catch{continue}}async*getValueOrPeers(e,t,n){for await(const i of this._getValueSingle(e,t,n)){if(i.name==="PEER_RESPONSE"&&i.record!=null)try{await this._verifyRecordOnline(i.record,n)}catch{const o="invalid record received, discarded";this.log(o),yield zo({from:i.from,error:new y1(o),path:n.path},n);continue}yield i}}async _verifyRecordOnline(e,t){if(e.timeReceived==null)throw new aN("invalid record received");await B4(this.validators,new Zr(e.key,e.value,e.timeReceived),t)}async getClosestPeersOffline(e,t){const n=[];try{const o=$r(e),a=bn(o),c=await this.components.peerStore.get(a,t);n.push({id:c.id,multiaddrs:c.addresses.map(({multiaddr:l})=>l)})}catch{}const i=await Pc(e,t),s=this.routingTable.closestPeers(i,t);for(const o of s)try{n.push(await this.components.peerStore.getInfo(o,t))}catch(a){if(a.name!=="NotFoundError")throw a}return n.length>0?this.log("getClosestPeersOffline returning the %d closest peer(s) %b we know",n.length,e):this.log("getClosestPeersOffline could not any peers close to %b with %d peers in the routing table",e,this.routingTable.size),n}}class zN{constructor(e,t){h(this,"log");h(this,"datastore");h(this,"datastorePrefix");this.log=e.logger.forComponent(`${t.logPrefix}:providers`),this.datastorePrefix=`${t.datastorePrefix}/provider`,this.datastore=e.datastore}async addProvider(e,t,n){this.log.trace("%p provides %s",t,e),await this.writeProviderEntry(e,t,n)}async removeProvider(e,t,n){const i=ud(this.datastorePrefix,e,t);this.log.trace("%p no longer provides %s",t,e),await this.datastore.delete(i,n)}async getProviders(e,t){this.log.trace("get providers for %c",e);const n=await this.loadProviders(e,t);return this.log.trace("got %d providers for %c",n.size,e),[...n.keys()]}async writeProviderEntry(e,t,n){var o;const i=ud(this.datastorePrefix,e,t),s=ms(((o=n==null?void 0:n.time)==null?void 0:o.getTime())??Date.now());await this.datastore.put(i,s,n)}async loadProviders(e,t){const n=new js,i=ud(this.datastorePrefix,e);for await(const s of this.datastore.query({prefix:i.toString()},t)){const{peerId:o}=nw(s.key);n.set(o,iw(s.value))}return n}}const WN=r=>{const e=r.addEventListener||r.on||r.addListener,t=r.removeEventListener||r.off||r.removeListener;if(!e||!t)throw new TypeError("Emitter is not compatible");return{addListener:e.bind(r),removeListener:t.bind(r)}};function GN(r,e,t){let n;const i=new Promise((s,o)=>{var m;if(t={rejectionEvents:["error"],multiArgs:!1,resolveImmediately:!1,...t},!(t.count>=0&&(t.count===Number.POSITIVE_INFINITY||Number.isInteger(t.count))))throw new TypeError("The `count` option should be at least 0 or more");(m=t.signal)==null||m.throwIfAborted();const a=[e].flat(),c=[],{addListener:l,removeListener:u}=WN(r),f=(...w)=>{const x=t.multiArgs?w:w[0];t.filter&&!t.filter(x)||(c.push(x),t.count===c.length&&(n(),s(c)))},g=w=>{n(),o(w)};n=()=>{for(const w of a)u(w,f);for(const w of t.rejectionEvents)u(w,g)};for(const w of a)l(w,f);for(const w of t.rejectionEvents)l(w,g);t.signal&&t.signal.addEventListener("abort",()=>{g(t.signal.reason)},{once:!0}),t.resolveImmediately&&s(c)});if(i.cancel=n,typeof t.timeout=="number"){const s=Ph(i,{milliseconds:t.timeout});return s.cancel=n,s}return i}function QN(r,e,t){typeof t=="function"&&(t={filter:t}),t={...t,count:1,resolveImmediately:!1};const n=GN(r,e,t),i=n.then(s=>s[0]);return i.cancel=n.cancel,i}async function*YN(r){const{key:e,startingPeers:t,ourPeerId:n,query:i,alpha:s,path:o,numPaths:a,log:c,peersSeen:l,connectionManager:u,signal:f}=r,g=bi({objectMode:!0}),m=new fl({concurrency:s,sort:(v,C)=>sc(v.options.distance,C.options.distance)});m.addEventListener("idle",()=>{g.push(lN({path:{index:o,queued:m.queued,running:m.running,total:m.size}},r)),g.end()}),m.addEventListener("error",v=>{c.error("error during query - %e",v.detail)}),f.addEventListener("abort",()=>{m.abort(),g.end(new Hi)});const w=await Pc(e,{signal:f});function x(v,C){if(v==null)return;l.add(v.id.toMultihash().bytes);const N=$o(C,w);m.add(async()=>{try{for await(const O of i({...r,key:e,peer:v,path:{index:o,queued:m.queued,running:m.running,total:m.size},numPaths:a,peerKadId:C,signal:f})){if(O.name==="PEER_RESPONSE")for(const L of O.closer){if(l.has(L.id.toMultihash().bytes)){c("already seen %p in query",L.id);continue}if(n.equals(L.id)){c("not querying ourselves");continue}if(!await u.isDialable(L.multiaddrs)){c("not querying undialable peer");continue}const R=await ui(L.id,{signal:f}),F=$o(R,w);if(sc(F,N)!==-1){c("skipping %p as they are not closer to %b than %p",L.id,e,v);continue}c("querying closer peer %p",L.id),x(L,R)}g.push({...O,path:{index:o,queued:m.queued,running:m.running,total:m.size}})}}catch(O){g.push(zo({from:v.id,error:O,path:{index:o,queued:m.queued,running:m.running-1,total:m.size-1}},r))}},{distance:N}).catch(O=>{c.error("error during query - %e",O)})}await Promise.all(t.map(async v=>{x({id:v,multiaddrs:[]},await ui(v,{signal:f}))})),yield*g}class ZN{constructor(e,t){h(this,"disjointPaths");h(this,"alpha");h(this,"shutDownController");h(this,"running");h(this,"logger");h(this,"peerId");h(this,"connectionManager");h(this,"routingTable");h(this,"initialQuerySelfHasRun");h(this,"logPrefix");h(this,"allowQueryWithZeroPeers");this.logPrefix=t.logPrefix,this.disjointPaths=t.disjointPaths??tw,this.alpha=t.alpha??Dh,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.routingTable=t.routingTable,this.logger=e.logger,this.peerId=e.peerId,this.connectionManager=e.connectionManager,this.allowQueryWithZeroPeers=t.allowQueryWithZeroPeers??!1,this.shutDownController=new AbortController,this.shutDownController.signal,this.running=!1}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutDownController=new AbortController,this.shutDownController.signal,void 0)}async stop(){this.running=!1,this.shutDownController.abort()}async*run(e,t,n={}){if(!this.running)throw new Error("QueryManager not started");if(n.signal==null){const c=AbortSignal.timeout(nN);n={...n,signal:c}}const i=new AbortController,s=Fr([this.shutDownController.signal,i.signal,n.signal]);i.signal;const o=this.logger.forComponent(`${this.logPrefix}:query:`+Be(e,"base58btc"));let a=!1;try{this.routingTable.size===0&&!this.allowQueryWithZeroPeers&&(o("routing table was empty, waiting for some peers before running%s query",n.isSelfQuery===!0?" self":""),await QN(this.routingTable,"peer:add",{signal:s,filter:m=>!this.peerId.equals(m.detail)}),o("routing table has peers, continuing with%s query",n.isSelfQuery===!0?" self":"")),n.isSelfQuery!==!0&&this.initialQuerySelfHasRun!=null&&(o("waiting for initial self query before continuing"),await Ht(this.initialQuerySelfHasRun.promise,s),this.initialQuerySelfHasRun=void 0),o("query:start");const c=await Pc(e,{signal:s}),l=this.routingTable.closestPeers(c,{count:this.routingTable.kBucketSize}),u=l.sort(()=>Math.random()>.5?1:-1).reduce((m,w,x)=>(m[x%this.disjointPaths].push(w),m),new Array(this.disjointPaths).fill(0).map(()=>[])).filter(m=>m.length>0);if(l.length===0){o.error("running query with no peers");return}const f=v4(1024),g=u.map((m,w)=>YN({...n,key:e,startingPeers:m,ourPeerId:this.peerId,signal:s,query:t,path:w,numPaths:u.length,alpha:this.alpha,log:o,peersSeen:f,onProgress:n.onProgress,connectionManager:this.connectionManager}));for await(const m of Sc(...g)){if(m.name==="QUERY_ERROR"&&o.error("query error",m.error),m.name==="PEER_RESPONSE")for(const w of[...m.closer,...m.providers])await this.connectionManager.isDialable(w.multiaddrs,{signal:s})&&await this.routingTable.add(w.id,{signal:s});s.throwIfAborted(),yield m}a=!0}catch(c){if(this.running)throw c}finally{a||(o("query exited early"),i.abort()),s.clear(),o("query finished")}}}function XN(r){return r[Symbol.asyncIterator]!=null}function ow(r){if(XN(r))return(async()=>{let e=0;for await(const t of r)e++;return e})();{let e=0;for(const t of r)e++;return e}}function JN(r){return r[Symbol.asyncIterator]!=null}function K0(r,e){return JN(r)?async function*(){let t=0;if(!(e<1)){for await(const n of r)if(yield n,t++,t===e)return}}():function*(){let t=0;if(!(e<1)){for(const n of r)if(yield n,t++,t===e)return}}()}class eO{constructor(e,t){h(this,"log");h(this,"peerId");h(this,"peerRouting");h(this,"events");h(this,"count");h(this,"interval");h(this,"initialInterval");h(this,"queryTimeout");h(this,"running");h(this,"timeoutId");h(this,"controller");h(this,"initialQuerySelfHasRun");h(this,"querySelfPromise");this.peerId=e.peerId,this.log=e.logger.forComponent(`${t.logPrefix}:query-self`),this.events=e.events,this.running=!1,this.peerRouting=t.peerRouting,this.count=t.count??tw,this.interval=t.interval??XB,this.initialInterval=t.initialInterval??JB,this.queryTimeout=t.queryTimeout??eN,this.initialQuerySelfHasRun=t.initialQuerySelfHasRun,this.querySelf=sw(this.querySelf.bind(this),t.operationMetrics,"SELF_QUERY")}isStarted(){return this.running}start(){this.running||(this.running=!0,clearTimeout(this.timeoutId),this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.initialInterval))}stop(){this.running=!1,this.timeoutId!=null&&clearTimeout(this.timeoutId),this.controller!=null&&this.controller.abort()}async querySelf(){if(!this.running){this.log("skip self-query because we are not started");return}if(this.querySelfPromise!=null)return this.log("joining existing self query"),this.querySelfPromise.promise;if(this.querySelfPromise=St(),this.running){this.controller=new AbortController;const e=[this.controller.signal];if(this.initialQuerySelfHasRun==null){const n=AbortSignal.timeout(this.queryTimeout);e.push(n)}const t=Fr(e);this.controller.signal;try{this.log("run self-query, look for %d peers timing out after %dms",this.count,this.queryTimeout);const n=Date.now(),i=await Uo(this.peerRouting.getClosestPeers(this.peerId.toMultihash().bytes,{signal:t,isSelfQuery:!0}),o=>K0(o,this.count),async o=>ow(o));t==null||t.throwIfAborted();const s=Date.now()-n;this.log("self-query found %d peers in %dms",i,s),this.events.dispatchEvent(new CustomEvent("kad-dht:query:self",{detail:{peers:i,duration:s}}))}catch(n){this.log.error("self-query error",n)}finally{t.clear(),this.initialQuerySelfHasRun!=null&&(this.initialQuerySelfHasRun.resolve(),this.initialQuerySelfHasRun=void 0)}}this.querySelfPromise.resolve(),this.querySelfPromise=void 0,this.running&&(this.timeoutId=setTimeout(()=>{this.querySelf().catch(e=>{this.log.error("error running self-query",e)})},this.interval))}}class tO extends or{constructor(t,n){super();h(this,"log");h(this,"reprovideQueue");h(this,"maxQueueSize");h(this,"datastore");h(this,"timeout");h(this,"reprovideTimeout");h(this,"running");h(this,"shutdownController");h(this,"reprovideThreshold");h(this,"contentRouting");h(this,"datastorePrefix");h(this,"addressManager");h(this,"validity");h(this,"interval");h(this,"peerId");this.log=t.logger.forComponent(`${n.logPrefix}:reprovider`),this.peerId=t.peerId,this.reprovideQueue=new fl({concurrency:n.concurrency??GB,metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_queue`}),this.reprovideTimeout=new Bc({...n.timeout??{},metrics:t.metrics,metricName:`${n.metricsPrefix}_reprovide_timeout_milliseconds`}),this.datastore=t.datastore,this.addressManager=t.addressManager,this.datastorePrefix=`${n.datastorePrefix}/provider`,this.reprovideThreshold=n.threshold??WB,this.maxQueueSize=n.maxQueueSize??QB,this.validity=n.validity??zB,this.interval=n.interval??YB,this.contentRouting=n.contentRouting,this.running=!1,this.reprovide=sw(this.reprovide.bind(this),n.operationMetrics,"PROVIDE")}start(){this.running||(this.running=!0,this.shutdownController=new AbortController,this.shutdownController.signal,this.timeout=setTimeout(()=>{this.cleanUp({signal:AbortSignal.timeout(s5)}).catch(t=>{this.log.error("error running reprovide/cleanup - %e",t)})},this.interval))}stop(){var t;this.running=!1,this.reprovideQueue.clear(),clearTimeout(this.timeout),(t=this.shutdownController)==null||t.abort()}async cleanUp(t){try{this.safeDispatchEvent("reprovide:start");for await(const n of this.datastore.query({prefix:this.datastorePrefix},t))try{const{cid:i,peerId:s}=nw(n.key),o=iw(n.value).getTime(),a=o+this.validity,c=Date.now(),l=c>a;this.log.trace("comparing: %d < %d = %s %s",o,c-this.validity,l,l?"(expired)":""),l&&await this.datastore.delete(n.key,t),this.peerId.equals(s)&&c-a<this.reprovideThreshold&&this.queueReprovide(i).catch(u=>{this.log.error("could not reprovide %c - %e",i,u)})}catch(i){this.log.error("error processing datastore key %s - %e",n.key,i.message)}this.log("reprovide/cleanup successful")}finally{this.safeDispatchEvent("reprovide:end"),this.running&&(this.timeout=setTimeout(()=>{this.cleanUp({signal:AbortSignal.timeout(s5)}).catch(n=>{this.log.error("error running re-provide - %e",n)})},this.interval))}}async queueReprovide(t,n){var s;if(!this.running)return;this.log.trace("waiting for queue capacity before adding %c to re-provide queue",t),await this.reprovideQueue.onSizeLessThan(this.maxQueueSize,n);const i=this.reprovideQueue.queue.find(o=>o.options.cid.equals(t));if(i!=null)return this.log.trace("not adding %c to re-provide queue - already in queue",t),i.join();this.log.trace("adding %c to re-provide queue",t),this.reprovideQueue.add(async o=>{var c;if((c=o.signal)==null||c.throwIfAborted(),!this.running)return;this.log.trace("re-providing %c",t);const a=this.reprovideTimeout.getTimeoutSignal(o);try{await this.reprovide(o.cid,o)}finally{this.reprovideTimeout.cleanUp(a)}this.log.trace("re-provided %c",t)},{signal:(s=this.shutdownController)==null?void 0:s.signal,cid:t}).catch(o=>{this.log.error("could not re-provide key %c - %e",t,o)})}async reprovide(t,n){await _c(this.contentRouting.provide(t,this.addressManager.getAddresses(),n))}}class H0 extends fl{has(e){return this.find(e)!=null}find(e){return this.queue.find(t=>e.equals(t.options.peerId))}}const rO=20,nO=5e3,iO="kad-close",sO=50;class oO{constructor(e,t){h(this,"routingTable");h(this,"components");h(this,"closestPeers");h(this,"newPeers");h(this,"refreshInterval");h(this,"peerSetSize");h(this,"timeout");h(this,"closeTagName");h(this,"closeTagValue");h(this,"log");h(this,"running");this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:routing-table`),this.routingTable=t.routingTable,this.refreshInterval=t.refreshInterval??nO,this.peerSetSize=t.peerSetSize??rO,this.closeTagName=t.closeTagName??iO,this.closeTagValue=t.closeTagValue??sO,this.closestPeers=new Dn,this.onPeerPing=this.onPeerPing.bind(this),this.running=!1}async start(){if(this.running)return;this.running=!0;const e=await ui(this.components.peerId);this.newPeers=new N4(e,this.peerSetSize),this.routingTable.addEventListener("peer:ping",this.onPeerPing),this.timeout=setInterval(()=>{this.updatePeerTags().catch(t=>{this.log.error("error updating peer tags - %e",t)})},this.refreshInterval)}stop(){this.running=!1,this.routingTable.removeEventListener("peer:ping",this.onPeerPing),clearTimeout(this.timeout)}onPeerPing(e){var t;(t=this.newPeers)==null||t.add({id:e.detail,multiaddrs:[]}).catch(n=>{this.log.error("error adding peer to distance list - %e",n)})}async updatePeerTags(){var i;const e=new Dn((i=this.newPeers)==null?void 0:i.peers.map(({peer:s})=>s.id)),t=e.difference(this.closestPeers),n=this.closestPeers.difference(e);this.closestPeers=e,await Promise.all([...[...t].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:{value:this.closeTagValue},[o5]:{value:1}}})}),...[...n].map(async s=>{await this.components.peerStore.merge(s,{tags:{[this.closeTagName]:void 0,[o5]:void 0}})})])}}function bu(r){return Array.isArray(r==null?void 0:r.peers)}class aO{constructor(e,t){h(this,"peerId");h(this,"root");h(this,"localPeer");h(this,"prefixLength");h(this,"splitThreshold");h(this,"kBucketSize");h(this,"numberOfNodesToPing");h(this,"lastPingThreshold");h(this,"ping");h(this,"verify");h(this,"onAdd");h(this,"onRemove");h(this,"onMove");h(this,"addingPeerMap");this.peerId=e.peerId,this.prefixLength=t.prefixLength??uO,this.kBucketSize=t.kBucketSize??O4,this.splitThreshold=t.splitThreshold??this.kBucketSize,this.numberOfNodesToPing=t.numberOfOldContactsToPing??dO,this.lastPingThreshold=t.lastPingThreshold??yO,this.ping=t.ping,this.verify=t.verify,this.onAdd=t.onAdd,this.onRemove=t.onRemove,this.addingPeerMap=Uy({name:`${t.metricsPrefix}_adding_peer_map`,metrics:e.metrics}),this.root={prefix:"",depth:0,peers:[]}}async start(){await this.addSelfPeer(this.peerId)}stop(){this.addingPeerMap.clear(),this.root={prefix:"",depth:0,peers:[]}}async addSelfPeer(e,t){this.localPeer={peerId:e,kadId:await ui(e,t),lastPing:Date.now()}}async add(e,t){const n={peerId:e,kadId:await ui(e,t),lastPing:0},i=this.addingPeerMap.get(e);if(i!=null)return i;try{const s=this._add(n,t);this.addingPeerMap.set(e,s),await s}finally{this.addingPeerMap.delete(e)}}async _add(e,t){var o;const n=this._determineBucket(e.kadId);if(this._indexOf(n,e.kadId)>-1)return;if(n.peers.length===this.splitThreshold&&n.depth<this.prefixLength){await this._split(n,t),await this._add(e,t);return}if(n.peers.length<this.kBucketSize){if(!lO(e,this.lastPingThreshold)){n.peers.push(e),await((o=this.onAdd)==null?void 0:o.call(this,e,n,t));return}await this.verify(e,t)&&(e.lastPing=Date.now(),await this._add(e,t));return}const i=n.peers.filter(a=>{var c;return!(a.peerId.equals((c=this.localPeer)==null?void 0:c.peerId)||a.lastPing>Date.now()-this.lastPingThreshold)}).sort((a,c)=>a.lastPing<c.lastPing?-1:a.lastPing>c.lastPing?1:0).slice(0,this.numberOfNodesToPing);let s=!1;for await(const a of this.ping(i,t))s=!0,await this.remove(a.kadId,t);s&&await this._add(e,t)}*closest(e,t){var i;const n=new N4(e,(t==null?void 0:t.count)??this.kBucketSize);for(const s of this.toIterable())((i=t==null?void 0:t.exclude)==null?void 0:i.some(o=>o.equals(s.peerId)))!==!0&&n.addWithKadId({id:s.peerId,multiaddrs:[]},s.kadId);yield*P4(n.peers,({peer:s})=>s.id)}count(){function e(t){if(bu(t))return t.peers.length;let n=0;return t.left!=null&&(n+=e(t.left)),t.right!=null&&(n+=e(t.right)),n}return e(this.root)}get(e){const t=this._determineBucket(e),n=this._indexOf(t,e);return t.peers[n]}async remove(e,t){var s;const n=this._determineBucket(e),i=this._indexOf(n,e);if(i>-1){const o=n.peers.splice(i,1)[0];await((s=this.onRemove)==null?void 0:s.call(this,o,n,t))}}*toIterable(){function*e(t){if(bu(t)){yield*t.peers;return}yield*e(t.left),yield*e(t.right)}yield*e(this.root)}distance(e,t){return BigInt("0x"+Be($o(e,t),"base16"))}_determineBucket(e){const t=Be(e,"base2");function n(i,s=0){return bu(i)?i:t[s]==="0"?n(i.left,s+1):n(i.right,s+1)}return n(this.root)}_indexOf(e,t){return e.peers.findIndex(n=>pt(n.kadId,t))}async _split(e,t){var s,o;const n={prefix:"0",depth:e.depth+1,peers:[]},i={prefix:"1",depth:e.depth+1,peers:[]};for(const a of e.peers)Be(a.kadId,"base2")[e.depth]==="0"?(n.peers.push(a),await((s=this.onMove)==null?void 0:s.call(this,a,e,n,t))):(i.peers.push(a),await((o=this.onMove)==null?void 0:o.call(this,a,e,i,t)));cO(e,n,i)}}function cO(r,e,t){return delete r.peers,r.left=e,r.right=t,r.prefix===""&&(delete r.depth,delete r.prefix),!0}function lO(r,e){return r.lastPing<Date.now()-e}const O4=20,uO=6,hO=20,fO=100,dO=3,pO=20,gO=100,f5="kad-peer",mO=1,yO=6e5,wO=!0,bO=1e3;class vO extends or{constructor(t,n){super();h(this,"kBucketSize");h(this,"kb");h(this,"network");h(this,"closestPeerTagger");h(this,"log");h(this,"components");h(this,"running");h(this,"pingNewContactTimeout");h(this,"pingNewContactQueue");h(this,"pingOldContactTimeout");h(this,"pingOldContactQueue");h(this,"populateFromDatastoreOnStart");h(this,"populateFromDatastoreLimit");h(this,"protocol");h(this,"peerTagName");h(this,"peerTagValue");h(this,"metrics");h(this,"shutdownController");this.components=t,this.log=t.logger.forComponent(`${n.logPrefix}:routing-table`),this.kBucketSize=n.kBucketSize??O4,this.running=!1,this.protocol=n.protocol,this.network=n.network,this.peerTagName=n.peerTagName??f5,this.peerTagValue=n.peerTagValue??mO,this.pingOldContacts=this.pingOldContacts.bind(this),this.verifyNewContact=this.verifyNewContact.bind(this),this.peerAdded=this.peerAdded.bind(this),this.peerRemoved=this.peerRemoved.bind(this),this.populateFromDatastoreOnStart=n.populateFromDatastoreOnStart??wO,this.populateFromDatastoreLimit=n.populateFromDatastoreLimit??bO,this.shutdownController=new AbortController,this.pingOldContactQueue=new H0({concurrency:n.pingOldContactConcurrency??pO,metricName:`${n.metricsPrefix}_ping_old_contact_queue`,metrics:this.components.metrics,maxSize:n.pingOldContactMaxQueueSize??gO}),this.pingOldContactTimeout=new Bc({...n.pingOldContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_old_contact_time_milliseconds`}),this.pingNewContactQueue=new H0({concurrency:n.pingNewContactConcurrency??hO,metricName:`${n.metricsPrefix}_ping_new_contact_queue`,metrics:this.components.metrics,maxSize:n.pingNewContactMaxQueueSize??fO}),this.pingNewContactTimeout=new Bc({...n.pingNewContactTimeout??{},metrics:this.components.metrics,metricName:`${n.metricsPrefix}_routing_table_ping_new_contact_time_milliseconds`}),this.kb=new aO(t,{kBucketSize:n.kBucketSize,prefixLength:n.prefixLength,splitThreshold:n.splitThreshold,numberOfOldContactsToPing:n.numberOfOldContactsToPing,lastPingThreshold:n.lastPingThreshold,ping:this.pingOldContacts,verify:this.verifyNewContact,onAdd:this.peerAdded,onRemove:this.peerRemoved,metricsPrefix:n.metricsPrefix}),this.closestPeerTagger=new oO(this.components,{logPrefix:n.logPrefix,routingTable:this,peerSetSize:n.closestPeerSetSize,refreshInterval:n.closestPeerSetRefreshInterval,closeTagName:n.closeTagName,closeTagValue:n.closeTagValue}),this.components.metrics!=null&&(this.metrics={routingTableSize:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_size`),routingTableKadBucketTotal:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_total`),routingTableKadBucketAverageOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_average_occupancy`),routingTableKadBucketMinOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_min_occupancy`),routingTableKadBucketMaxOccupancy:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_occupancy`),routingTableKadBucketMaxDepth:this.components.metrics.registerMetric(`${n.metricsPrefix}_routing_table_kad_bucket_max_depth`),kadBucketEvents:this.components.metrics.registerCounterGroup(`${n.metricsPrefix}_kad_bucket_events_total`)})}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.shutdownController=new AbortController,await Mu(this.closestPeerTagger,this.kb))}async afterStart(){let t=0;Promise.resolve().then(async()=>{if(!this.populateFromDatastoreOnStart)return;const n=Fr([this.shutdownController.signal,AbortSignal.timeout(2e4)]);try{for(const i of await this.components.peerStore.all({filters:[s=>s.protocols.includes(this.protocol)&&s.tags.has(f5)],limit:this.populateFromDatastoreLimit,signal:n})){if(!this.running)return;try{await this.add(i.id,{signal:n}),t++}catch{this.log("failed to add peer %p to routing table, removing kad-dht peer tags - %e"),await this.components.peerStore.merge(i.id,{tags:{[this.peerTagName]:void 0}})}}}finally{n.clear()}this.log("added %d peer store peers to the routing table",t)}).catch(n=>{this.log.error("error adding %d, peer store peers to the routing table - %e",t,n)})}async stop(){this.running=!1,await K3(this.closestPeerTagger,this.kb),this.pingOldContactQueue.abort(),this.pingNewContactQueue.abort(),this.shutdownController.abort()}async peerAdded(t,n,i){var s;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:{value:this.peerTagValue}}},i),this.updateMetrics(),(s=this.metrics)==null||s.kadBucketEvents.increment({peer_added:!0}),this.safeDispatchEvent("peer:add",{detail:t.peerId})}async peerRemoved(t,n,i){var s;this.components.peerId.equals(t.peerId)||await this.components.peerStore.merge(t.peerId,{tags:{[this.peerTagName]:void 0}},i),this.updateMetrics(),(s=this.metrics)==null||s.kadBucketEvents.increment({peer_removed:!0}),this.safeDispatchEvent("peer:remove",{detail:t.peerId})}async*pingOldContacts(t,n){var s;if(!this.running)return;const i=[];for(const o of t){if(this.kb.get(o.kadId)==null){this.log("asked to ping contact %p that was not in routing table",o.peerId);continue}(s=this.metrics)==null||s.kadBucketEvents.increment({ping_old_contact:!0}),i.push(async()=>{const a=this.pingOldContactQueue.find(o.peerId);if(a!=null)return this.log("asked to ping contact %p was already being pinged",o.peerId),await a.join(n)?void 0:o;if(!await this.pingOldContactQueue.add(async l=>{var g;const u=this.pingOldContactTimeout.getTimeoutSignal(),f=Fr([u,this.shutdownController.signal,l==null?void 0:l.signal]);try{return await this.pingContact(o,l)}catch{return(g=this.metrics)==null||g.kadBucketEvents.increment({ping_old_contact_error:!0}),!0}finally{this.pingOldContactTimeout.cleanUp(u),f.clear()}},{peerId:o.peerId,signal:n==null?void 0:n.signal}))return o})}for await(const o of x4(i))o!=null&&(yield o)}async verifyNewContact(t,n){var o;const i=this.pingNewContactTimeout.getTimeoutSignal(),s=Fr([i,this.shutdownController.signal,n==null?void 0:n.signal]);try{const a=this.pingNewContactQueue.find(t.peerId);return a!=null?(this.log("joining existing ping to add new peer %p to routing table",t.peerId),await a.join({signal:s})):await this.pingNewContactQueue.add(async c=>{var l;return(l=this.metrics)==null||l.kadBucketEvents.increment({ping_new_contact:!0}),this.log("pinging new peer %p before adding to routing table",t.peerId),this.pingContact(t,c)},{peerId:t.peerId,signal:s})}catch{return this.log.trace("tried to add peer %p but they were not online",t.peerId),(o=this.metrics)==null||o.kadBucketEvents.increment({ping_new_contact_error:!0}),!1}finally{this.pingNewContactTimeout.cleanUp(i),s.clear()}}async pingContact(t,n){try{return this.log("pinging contact %p",t.peerId),await this.components.ping.ping(t.peerId,n),this.log("contact %p ping ok",t.peerId),this.safeDispatchEvent("peer:ping",{detail:t.peerId}),!0}catch(i){return this.log("error pinging old contact %p - %e",t.peerId,i),!1}}get size(){return this.kb==null?0:this.kb.count()}async find(t,n){var s;const i=await ui(t,n);return(s=this.kb.get(i))==null?void 0:s.peerId}closestPeer(t){const n=this.closestPeers(t,{count:1});if(n.length>0)return n[0]}closestPeers(t,n){return this.kb==null?[]:[...this.kb.closest(t,n)]}async add(t,n){if(this.kb==null)throw new Error("RoutingTable is not started");await this.kb.add(t,n)}async remove(t,n){if(this.kb==null)throw new Error("RoutingTable is not started");const i=await ui(t,n);await this.kb.remove(i,n)}updateMetrics(){if(this.metrics==null||this.kb==null)return;let t=0,n=0,i=0,s=20,o=0;function a(c){if(bu(c)){c.depth>i&&(i=c.depth),n++,t+=c.peers.length,c.peers.length<s&&(s=c.peers.length),c.peers.length>o&&(o=c.peers.length);return}a(c.left),a(c.right)}a(this.kb.root),this.metrics.routingTableSize.update(t),this.metrics.routingTableKadBucketTotal.update(n),this.metrics.routingTableKadBucketAverageOccupancy.update(Math.round(t/n)),this.metrics.routingTableKadBucketMinOccupancy.update(s),this.metrics.routingTableKadBucketMaxOccupancy.update(o),this.metrics.routingTableKadBucketMaxDepth.update(i)}}const SO=[77591,22417,43971,28421,740,29829,71467,228973,196661,78537,27689,36431,44415,14362,19456,106025,96308,2882,49509,21149,87173,131409,75844,23676,121838,30291,17492,2953,7564,110620,129477,127283,53113,72417,165166,109690,21200,102125,24049,71504,90342,25307,72039,26812,26715,32264,133800,71161,88956,171987,51779,24425,16671,30251,186294,247761,14202,2121,8465,35024,4876,85917,169730,3638,256836,96184,943,18678,6583,52907,35807,112254,214097,18796,11595,9243,23554,887,268203,382004,24590,111335,11625,16619,29039,102425,69006,97976,92362,32552,63717,41433,128974,137630,59943,10019,13986,35430,33665,108037,43799,43280,38195,29078,58629,18265,14425,46832,235538,40830,77881,110717,58937,3463,325358,51300,47623,117252,19007,10170,20540,91237,294813,4951,79841,56232,36270,128547,69209,66275,100156,32063,73531,34439,80937,28892,44466,88595,216307,32583,49620,16605,82127,45807,21630,78726,20235,40163,111007,96926,5567,72083,21665,58844,39419,179767,48328,42662,51550,5251,37811,49608,81056,50854,55513,20922,18891,197409,164656,32593,71449,220474,58919,85682,67854,13758,35066,3565,61905,214793,119572,141419,21504,10302,27354,67003,46131,32668,15165,64871,34450,17821,2757,11452,34189,5160,12257,85523,560,53385,65887,119549,135620,312353,115979,122356,10867,193231,124537,54783,90675,120791,4715,142253,50943,17271,43358,25331,4917,120566,34580,12878,33786,160528,32523,4869,301307,104817,81491,23276,8832,97911,31265,52065,7998,49622,9715,43998,34091,84587,20664,69041,29419,53205,10838,58288,116145,6185,5154,141795,35924,21307,144738,43730,12085,8279,10002,119,133779,199668,72938,31768,39176,67875,38453,9700,44144,4121,116048,41733,12868,82669,92308,128,34262,11332,7712,90764,36141,13553,71312,77470,117314,96549,49135,23602,54468,28605,6327,62308,17171,67531,21319,14105,894,107722,46157,8503,51069,100472,45138,15246,14577,35609,191464,1757,13364,161349,32067,91705,81144,52339,5408,91066,21983,14157,100545,4372,26630,129112,1423,29676,213626,4397,88436,99190,6877,49958,26122,114348,60661,29818,293118,50042,179738,16400,163423,89627,31040,43973,36638,45952,5153,1894,109322,1898,134021,12402,112077,68309,190269,69866,31938,107383,11522,105232,11248,14868,39852,71707,186525,16530,38162,106212,11700,5130,16608,26998,59586,108399,230033,43683,48135,82179,2073,5015,196684,189293,16378,23452,8301,35640,11632,214551,29240,57644,33137,91949,55157,52384,117313,5090,17717,89668,49363,82238,241035,66216,29066,184088,97206,62820,26595,4241,135635,173672,8202,459,71355,146294,29587,3008,135385,141203,14803,6634,45094,69362,50925,546,51884,62011,83296,234584,44515,56050,89476,87751,19373,12691,149923,19794,13833,35846,87557,58339,2884,19145,25647,12224,11024,77338,64608,122297,53025,7205,36189,36294,170779,21750,7739,173883,75192,35664,224240,113121,30181,26267,27036,117827,92015,106516,55628,203549,67949,60462,60844,35911,20457,1820,920,19773,8738,73173,181993,38521,98254,76257,46008,92796,5384,26868,151566,22124,2411,15919,186872,180021,28099,152961,78811,80237,62352,102653,74259,184890,16792,123702,224945,29940,19512,75283,14059,112691,92811,233329,20411,138569,53341,109802,50600,134528,66747,5529,166531,31578,64732,67189,1596,126357,967,167999,206598,109752,119431,207825,78791,91938,10301,27311,24233,252343,28831,32812,66002,112267,90895,8786,8095,16824,22866,21813,60507,174833,19549,130985,117051,52110,6938,81923,123864,38061,919,18680,53534,46739,112893,161529,85429,26761,11900,81121,91968,15390,217947,56524,1713,6654,37089,85630,138866,61850,16491,75577,16884,98296,73523,6140,44645,6062,36366,29844,57946,37932,42472,5266,20834,19309,33753,127182,134259,35810,41805,45878,312001,14881,47757,49251,120050,44252,3708,25856,107864,120347,1228,36550,41682,34496,47025,8393,173365,246526,12894,161607,35670,90785,126572,2095,124731,157033,58694,554,12786,9642,4817,16136,47864,174698,66992,4639,69284,10625,40710,27763,51738,30404,264105,137904,109882,52487,42824,57514,2740,10479,146799,107390,16586,88038,174951,9410,16185,44158,5568,40658,46108,12763,97385,26175,108859,664,230732,67470,46663,14395,50750,141320,93140,15361,47997,55784,6791,307840,118569,107326,18056,58281,260415,54691,8790,73332,45633,7511,45674,143373,14031,11799,94491,35646,96544,14560,26049,32983,25791,83814,42094,231370,63955,139212,2359,169908,3108,183486,105867,28197,32941,124968,26402,88267,149768,23053,3078,19091,52924,25383,19209,111548,97361,3959,24880,235061,9099,24921,161254,151405,20508,7159,34381,20133,11434,74036,19974,34769,36585,1076,22454,17354,38727,235160,111547,96454,117448,156940,91330,37299,7310,26915,117060,51369,22620,61861,322264,106850,111694,15091,2624,40345,300446,177064,1707,27389,54792,327783,132669,183543,59003,17744,20603,151134,106923,53084,71803,279424,319816,11579,21946,16728,38274,72711,5085,83391,88646,40159,25027,34680,10752,12988,54126,30365,18338,100445,230674,44874,84974,143877,123253,139372,28082,91477,144002,13096,219729,46016,50029,42377,14601,6660,58244,58978,23918,88206,113611,64452,17541,41032,10942,12021,49189,10978,40175,37156,10947,71709,106894,112538,57007,137486,150608,152719,40615,7746,279716,13101,19524,28708,40578,72320,1096,182051,94527,51275,22833,45164,81917,77519,48508,5421,140302,37845,149830,5587,27579,5357,428725,248187,6326,206760,39814,32585,89923,44341,288753,284443,96368,31201,94189,119504,20359,52073,103216,179,27934,32801,96035,34111,34309,101326,18198,20704,210266,37643,27880,141873,106e3,19414,56614,167714,66483,107885,86602,4379,20796,75467,4987,5017,118857,26003,34308,114428,29198,6686,29697,73632,3739,69795,16798,41504,7207,30722,21436,36735,28067,28545,3239,11221,36031,41889,100010,19247,317673,29495,174554,6424,129725,53845,94986,7955,59676,2604,191497,19735,102214,62954,23844,11872,179525,261436,34492,428,78404,142035,16747,17246,27578,37021,33672,57944,26056,135760,2369,61674,122066,31327,19374,157065,40553,130982,69619,71290,38855,72100,92903,95940,51422,165999,65713,57873,50726,7288,20272,2081,42326,22624,81120,57914,79352,19447,1684,72302,11774,302559,161481,96396,13692,414988,3721,79066,56627,46883,21150,11747,12184,5856,113458,176117,84416,52079,27933,3354,59765,141359,2212,216309,2555,23458,196722,142463,45701,44548,28798,19418,215,29916,9396,10574,114226,84475,13520,18694,34056,4524,90302,62930,13539,19407,77209,7728,38088,9535,2263,23875,183945,17750,26274,67172,10585,28042,22199,7478,51331,66030,26774,192929,31434,25850,50197,52926,178158,4679,181256,70184,229600,9959,105594,72158,73974,2726,35085,78087,23284,35568,51713,155676,5401,27254,11966,17569,223253,71993,103357,111477,55722,30504,26034,46774,35392,36285,214814,41143,163465,1051,16094,81044,6636,76489,179102,20712,39178,35683,125177,54219,30617,52994,25324,50123,2543,87529,58995,10688,125199,12388,60158,125481,131646,7642,133350,65874,3438,97277,101450,10075,56344,116821,50778,60547,98016,106135,13859,14255,16300,77373,173521,8285,45932,37426,4054,114295,55947,7703,39114,52,51119,128135,19714,60715,9554,50492,88180,2823,118271,52993,122625,97919,23859,37895,25040,33614,32102,20431,3577,9275,15686,43031,157741,110358,1884,40291,125391,13736,5008,64881,87336,77381,70711,43032,49155,118587,70494,4318,10168,30126,12580,10524,280104,104001,145413,2862,84140,6603,106005,13566,12780,11251,42830,571,179910,82443,13146,469,42714,32591,265217,424024,92553,54721,134100,6007,15242,114681,59030,16718,85465,200214,85982,55174,165013,23493,56964,82529,109150,32706,27568,82442,5350,14976,13165,44890,60021,21343,33978,17264,4655,22328,27819,75730,16567,55483,14510,17926,45827,150609,3704,7385,272531,161543,76904,122163,52405,2039,19165,41623,14423,228354,3369,176360,85491,7122,35789,303724,4465,13628,2233,55311,118771,20713,10006,221519,45115,71021,35650,29775,7337,10864,20665,21142,1746,15080,1624,32449,10905,105743,229797,7701,3940,22997,178467,57208,389057,39683,59403,63344,63125,54847,69691,18336,56448,3362,37202,18282,29648,138224,35867,10495,5911,28814,26653,31514,176702,26550,45621,11734,4525,40543,73944,121080,27858,155561,14887,44670,30742,8796,107455,113472,56369,75581,183777,240095,133699,153299,8768,160464,26058,49078,103971,21875,71486,44888,17156,9678,89541,123019,102337,3972,83930,21245,87852,109660,287918,183019,686,10100,39177,283941,11274,24736,26793,26214,25995,77011,141580,4070,23742,46285,46632,30700,26669,19056,35951,115575,174034,56097,35463,87425,24575,44245,38701,82317,85922,281616,100333,147697,61503,7730,84330,8530,59917,61597,17173,9092,32658,90288,193136,39023,20381,56654,31132,7779,1919,1375,117128,30819,11169,40938,23935,115201,101155,151034,4835,11231,74550,89388,59951,91704,107312,167882,115062,12732,72738,88703,464019,158267,57995,60496,737,14371,123867,4174,243339,159946,7568,16025,134556,110916,38103,191,80226,88794,29688,27230,10454,76308,57647,77409,113483,66864,14745,19808,12023,46583,84805,16015,17102,2231,20611,3547,95740,250131,34559,108894,8498,15853,159169,148920,20942,2813,93160,45188,210613,45531,52587,149062,39782,28194,57849,60965,84954,89766,84453,100927,16501,27658,165311,103841,54192,207341,19558,20084,319622,5672,205467,98462,61849,36279,13609,147177,24726,165015,209489,59591,31157,6551,117580,75060,141146,277310,21072,22023,106474,63041,137443,122965,68371,5383,42146,98961,113467,30863,23794,4843,99630,30392,82679,13699,241612,33601,93146,24319,18643,32155,95669,40440,15333,34089,67799,142144,58245,38633,114531,117400,77861,188726,5507,2568,8853,10987,107222,2663,2421,11530,13345,30075,41785,118661,104786,17459,12490,16281,71936,193555,17431,5944,71758,26485,77317,20803,367167,158,7362,93430,11735,172445,46002,11532,54482,930,62911,2235,23004,179236,4764,101859,208113,22477,55163,95579,14098,67320,162556,90709,156949,3826,57492,4025,34092,87442,104565,6718,186015,28214,14209,10039,107186,233912,58877,81637,55265,39828,6194,145813,50831,105849,4974,88319,122296,10272,197216,95714,51540,72418,23324,91555,8743,140452,250249,51666,34124,7229,38592,129641,78169,174242,22464,149964,51450,14034,10026,95376,26190,120062,14401,8700,265,31386,143573,7203,229889,61567,4227,140981,2466,72052,10787,10062,30958,6099,38471,30103,23202,208101,70847,467,58934,32271,32984,36637,24107,30771,17109,73353,13650,2098,157040,67366,66904,106018,265380,107238,18535,44025,32681,144983,62505,91295,56120,3082,77508,10322,63023,36700,81885,224127,16721,45023,239261,111272,13852,7866,149243,204199,32309,22084,42029,38316,126644,104973,14406,43454,67322,61310,15789,40285,24026,181047,6301,70927,23319,115823,27248,66693,115875,278566,63007,146844,56841,59007,87368,180001,22370,42114,80605,12022,10374,308,25079,14689,12618,63368,7936,264973,212291,136713,95999,105801,18965,32075,48700,52230,35119,96912,32992,8586,16606,101333,101812,14969,39930,759,193090,27387,42914,12937,5058,62646,64528,38624,25743,37502,3716,4435,30352,178687,26461,132611,42002,138442,35833,59582,16345,8048,60319,49349,309,47800,49739,90482,26405,34470,63786,32479,85028,39866,47846,11649,23934,29466,2816,42864,31828,7410,74885,49632,47629,111801,90749,19536,18767,105764,59606,21223,10746,76298,22220,39408,7190,79654,64856,11602,82156,272765,17079,70089,245473,51813,184407,384678,1576,122249,5064,27481,6188,25790,74361,27541,318284,45430,31488,620,93579,45723,192118,22670,51913,4162,70244,35966,26397,16199,50899,209613,121702,287507,2993,36101,132229,67345,33062,76295,118628,78705,52316,34375,107083,107454,44863,127561,33964,3073,154010,190914,55967,39074,6272,31047,5550,41123,26154,98638,47110,19998,148091,50229,31329,59900,195442,19106,61347,73497,70015,682,45850,25776,38022,148951,6288,37411,232526,109277,27286,32342,9262,5220,16651,23175,46740,129438,78614,121925,66914,88710,127952,5563,21500,34521,10739,14863,191006,62956,17359,16749,67027,56284,69134,43301,35039,58883,54466,60823,404451,75743,59856,86979,7923,34273,83785,32142,7693,268986,197428,282681,17049,22346,22990,92245,107180,3357,37104,96724,49153,7683,31197,43267,82231,164276,23696,20848,188364,22309,24821,158707,1018,22514,70922,27792,45589,59709,10765,736,35218,63479,51987,24275,63588,55361,92929,81964,4658,20122,12330,44058,13065,311456,72224,8337,211229,38979,22590,138478,52757,32595,133600,8838,31549,94412,43391,90056,1585,94802,127271,6223,31889,137038,132910,2165,57616,230152,6080,10748,36737,74579,134062,50525,180532,119270,34556,76155,82394,52595,29258,31435,87820,67996,26943,183878,38007,2410,13526,180297,69856,3503,187396,167700,7838,16701,9199,56267,3661,37407,65994,23767,5708,62508,221700,67088,86978,46776,84434,32088,5612,9149,88244,21685,95151,46750,189612,2979,506311,2594,3628,40074,105039,78243,28523,6651,38058,71999,30992,12764,68261,108991,6165,26450,61961,13400,22426,7490,60890,109623,2070,12958,50355,67979,257096,7213,42578,52121,35716,65461,7516,124758,39268,302,64712,14977,1467,219452,2840,34229,11121,21602,19270,63574,8024,1532,17331,79839,78885,52029,180767,57957,6069,91265,61380,55767,8927,32881,287603,22149,35029,68876,6428,199567,46926,13412,104132,21434,366616,45060,110046,81924,128910,45886,52821,130416,29416,77342,21762,67329,121432,79924,11724,38625,81006,102033,28338,13326,3250,82056,82526,38212,21112,12382,111495,3263,7414,86274,93490,40844,30224,45212,24019,48411,71367,24941,76729,57776,3769,38114,202019,197745,31953,237533,33270,201580,255648,100798,44741,32241,98468,106931,10085,15090,170358,33154,66787,18819,69760,25061,234005,82660,6295,131975,16874,9076,4094,25005,17740,40908,19533,220019,44330,99792,50040,19619,13950,55228,24423,31253,95308,103177,184795,28590,82285,5059,3210,75525,49894,70007,56178,10580,36051,139681,21617,98736,3555,106306,164189,37352,63915,47824,24883,145530,61904,28444,11483,19837,145446,30420,112972,85939,11835,191233,2262,20705,58630,1753,148334,1197,144714,6887,11223,107667,60879,77914,4151,57417,81594,96681,169430,1784,20444,95138,254041,27038,596,7117,72808,13759,3353,126776,21074,55322,27081,36942,39547,139830,179275,4453,713,8722,71399,19204,25785,22794,23923,104114,11291,25458,102309,88396,75288,230440,206396,104551,58447,130857,37247,94734,31548,176529,226077,65159,20104,10096,66881,94191,237909,27109,37404,1520,27421,25220,113003,23423,24884,50585,6286,231877,150800,11789,3226,90004,60642,5053,202400,61442,132531,175329,57138,30116,103847,9973,75367,16452,32360,59119,21246,10191,164804,23305,61051,37348,154530,13214,5468,50403,66754,130976,50559,80515,14436,155492,84017,5472,43107,41240,2890,90431,70188,382,76234,48040,50211,281038,237007,32115,142178,1536,22761,96429,1811,31243,1679,49143,55209,17402,235054,61494,7462,77030,34925,87609,78002,9499,9027,73289,201078,101379,63544,27666,5469,10642,30029,49816,132979,95620,58086,351930,116300,2110,2043,30845,6154,11279,16727,4122,2277,27281,4971,3650,39060,61970,65951,39674,75686,38151,11370,130809,177895,32665,63725,122267,7857,39618,118483,44792,157755,178624,136994,24260,41308,22471,12404,21707,12486,30473,52781,50246,20247,39065,909,56825,103158,128603,31542,1089,41935,32744,12428,37963,84420,33134,72921,208449,42622,168151,127335,147107,46699,38216,12591,94342,85814,31423,24944,2605,87542,67473,192551,4496,56321,91819,17630,6300,256183,114569,202090,33209,35289,34897,24967,40520,43470,5344,10199,34810,14283,10381,10017,62923,49924,23233,64539,13051,35686,19698,11570,135555,120868,44924,87065,52318,52335,47586,140906,245885,109834,78668,9065,46990,25258,72022,61243,40838,4545,146387,10537,11557,17470,36930,68104,46711,24264,79401,81043,18225,120488,24746,84338,81652,28266,13776,21878,46973,1047,230465,73357,95777,24973,210160,62210,58404,110633,169651,6937,41870,9909,26822,191062,76553,27519,96256,239070,2478,205678,67955,58532,20601,50120,19148,78501,195724,110740,8249,109665,27446,30568,57631,31425,49752,32820,65504,50079,3663,102256,219898,23849,211315,14645,4359,91767,9528,12449,49366,7941,49763,107848,8930,27086,50686,9744,10447,81935,39513,46514,1670,29229,6172,22312,137280,97759,9806,14445,22976,56458,73391,34983,93760,174219,52573,33149,59747,2429,136277,75123,165263,91040,7446,57632,48633,97140,246081,84766,151684,79918,93268,120346,54059,54875,77858,32996,103590,45276,11968,19600,25849,17159,132907,42828,16817,4913,99462,103303,27395,5737,74184,20749,21160,14377,77062,131403,158735,10999,27799,77785,9320,34366,51593,61070,33746,47048,29268,36675,30262,53297,9832,82e3,20188,122292,39917,7331,18160,68301,185935,134830,15031,4935,10004,165845,185534,46923,30109,44134,122631,18874,22903,112790,26561,18549,348902,82871,140345,255565,135390,63556,103747,145055,179600,145662,296111,61661,211987,23952,52342,126343,48450,32919,44277,82185,9591,62139,205363,376969,394874,108461,18040,120885,14798,39863,16571,16794,58271,81025,55206,14640,118656,6361,44092,85970,6262,153863,108244,180200,72264,79947,38044,10050,5735,61221,80712,5471,115689,11391,11661,184257,20010,60116,30320,19327,134598,45455,27542,18004,125092,452272,1549,91523,46567,180063,156026,2608,11174,58848,37788,65907,80194,30490,5786,40775,119519,106241,11323,156297,8425,61495,2617,29675,2425,59886,112582,49142,59618,4863,50597,86710,50650,168632,27693,85641,83643,18993,25768,84284,28090,93592,36627,312804,43381,9887,9402,100931,97165,3311,173330,66805,28935,4963,184460,3201,78102,19126,21607,37496,24938,22615,16153,32862,134792,153318,61120,6067,2812,12826,12792,23825,37559,64662,202250,102694,155488,85881,149193,46233,65383,15521,106982,11358,176786,25752,39717,34208,24510,32464,77742,39371,72028,138229,60688,71386,102834,132477,2208,11548,63670,271279,28351,30338,38620,32491,99845,143885,152266,13252,2825,178663,108097,1775,78201,14897,113573,163346,62292,171129,22183,96598,38733,64971,166776,117445,9968,146393,44677,74867,20908,97328,12761,25656,26785,9148,112344,26115,99176,110121,22437,49547,6180,79320,5835,31392,43328,33377,75870,119860,69497,80273,7325,155219,43167,111173,28347,20222,3763,71752,55041,47252,14618,28088,15012,97805,194698,54636,2036,41349,6173,96604,61530,51859,43782,13361,24334,22668,24792,7070,23441,16789,3209,36211,208475,26242,32880,122181,182407,21444,31060,88459,29929,77907,12716,10934,97005,20599,31690,8403,58445,30303,22700,10336,86731,103115,337709,72556,46788,112566,47684,67089,53548,36874,56487,41387,125985,26893,40071,106683,73712,18787,40105,72992,67246,137276,50802,36790,70328,138827,22466,39263,183295,29858,50975,9322,57397,10654,24364,30383,55799,41600,23584,127295,296610,129078,143558,244131,86397,36049,1085,80677,3820,108139,5476,34767,24683,7758,13060,7239,131671,250593,59556,103392,29810,4188,252323,39404,116877,7651,43600,40338,13554,157253,39196,25978,144387,61211,234,50104,6129,10449,93777,9240,356378,274148,4439,72970,3724,147770,78680,62570,115877,40027,40547,36817,224392,64609,34795,165027,67440,2477,37206,23431,50754,164797,46018,94995,170982,27051,7957,22767,3674,27900,56419,18930,60701,41302,2692,84749,339721,61996,111094,80221,50129,1045,8153,62945,19202,8250,37208,37418,32560,79477,41106,88569,33963,36693,5892,30570,1581,66471,49647,11922,160717,29442,5643,114865,82962,95982,132098,22633,22838,94726,54556,28566,205039,162340,33216,16849,35847,221339,94851,26533,71469,1805,3804,12935,45483,71020,36310,65381,192960,34240,35165,59773,1248,46954,155332,96864,4246,388800,16129,57133,74592,44807,442014,38203,42574,80818,91592,26377,36424,65760,977,77387,22628,147610,28018,30561,98454,6969,119628,63648,18170,36854,26601,64018,22027,37279,51395,152934,21153,9430,58760,194742,5330,55115,34158,28917,174111,13171,122326,1526,43896,66094,25325,4234,148354,11450,275,18999,112191,44365,22723,68409,8733,57746,96565,75007,14196,108844,29475,88599,177563,100792,106156,86323,93726,14248,135341,194131,40126,47099,14779,8272,39597,95983,171398,65882,28052,10393,47213,40689,22120,72212,106829,34964,109146,753,648,21660,30047,17527,181025,5619,145357,4085,216883,9359,186951,24779,53931,24545,36197,223296,62628,168101,4243,107313,30321,26642,13049,51059,31027,107912,807,73550,26551,84369,122422,165872,49754,74213,234264,33151,52014,33100,87183,22365,52500,40013,23302,5652,72723,21404,26107,48434,587,94049,168493,96418,32871,70860,31709,25128,443,71597,166253,15670,70994,26341,133675,28280,75491,54756,47955,56028,26182,11952,113272,472197,64640,110753,17919,337,50642,22576,142,87371,53391,93210,126694,15285,19642,85667,14148,1506,42092,52962,33243,11970,20734,135843,57044,58880,13002,219134,22876,64754,232519,4257,43120,321573,24799,64526,124728,52579,81472,70831,276848,17403,74359,23021,182101,74597,23744,148267,12055,7976,5349,11772,67540,167347,65318,18720,127832,108238,22828,90233,9987,259080,118185,73209,79270,13775,90100,137742,90799,70569,15699,19961,9087,67475,57872,39731,8810,134897,131868,146849,19898,3334,2281,167061,91073,60356,467742,74712,188,53179,137679,92769,29241,9537,132595,80119,1041,88962,5976,40171,44911,102859,139059,104558,98987,47761,19272,71472,113864,175377,73338,10857,23402,23758,1591,139864,5644,4076,118760,16427,134198,18853,20291,100849,37423,22038,36677,19071,195521,57445,11069,31869,55718,66882,148490,44,41296,75242,49704,166810,9906,20943,122258,49112,105667,15969,10344,6408,187694,21399,72742,58970,14867,14376,81889,41856,23225,15042,56993,16074,131389,74276,72407,53875,383108,53597,37363,68993,44854,122548,430927,198279,38430,80409,12245,2981,628,2818,17760,37437,238229,7968,46892,2200,3730,34190,65983,37959,112291,87850,70827,6522,20750,73913,111621,41652,19587,2780,58668,25916,85259,18200,168962,95781,42445,102050,7776,57662,103313,47742,96358,41964,66174,100396,29069,204735,19679,27978,7479,40264,22534,61183,36081,107436,58223,14680,23002,101311,24716,124108,12908,5646,31750,40380,14215,232799,102772,14122,96775,61398,50917,12096,149880,67833,598749,124194,155871,49216,790,14677,65319,56917,7440,145744,95701,12206,49405,129269,76199,45732,9767,11058,9047,210885,11051,7392,26307,2130,8132,147526,20802,232698,115660,50060,59789,57344,107623,80343,112676,23291,9866,160971,34032,118291,15719,59730,164911,28975,2659,58046,78480,21854,66209,53863,109085,116045,29021,46481,107552,22130,18764,70254,31272,11300,52460,43933,84738,20721,53869,190840,79673,105300,7561,321817,66924,13940,33281,101046,183181,32176,71878,5678,62924,79535,56646,40303,19559,27703,93042,73368,42187,3670,37376,46440,7023,36816,109628,20680,5940,276440,275233,170848,112093,136996,14984,20226,111441,77693,112960,48577,39370,55707,50314,123404,26570,54281,61372,123391,4857,35928,246740,132507,106646,44241,7196,92258,9825,37688,51197,303141,5590,15476,132986,10955,85782,34486,26696,7991,28813,18858,39546,11703,11365,38185,5716,93555,11925,40121,60002,6985,10976,171384,3887,43394,13337,56346,6381,252336,39573,75042,53711,1028,31781,44295,95925,131713,7214,68125,43571,70954,213234,1628,8760,13391,65485,17320,56038,1710,25248,60803,57399,19839,3870,326,281556,50945,72400,21460,316244,75619,56246,98775,481,13513,55765,50427,7388,123519,32929,57908,27124,61316,101097,57467,30228,48792,10788,20402,37318,50526,155730,34456,158065,145305,17832,43733,64052,4506,35072,205355,177028,184004,187081,68616,35938,83703,10367,36892,93186,260137,51934,89970,4985,23445,26755,21558,7948,78741,23376,124405,85594,68596,57536,49351,12619,56593,132668,99924,109728,71844,71935,196018,65464,17617,14987,89701,143773,33997,8687,22701,33258,2914,4436,72108,85610,9671,49067,2327,82988,1361,1672,44033,35777,30269,24057,10605,82236,616,15793,13919,47249,112086,116698,9484,80207,90574,33304,68624,93127,56101,42210,160929,4827,38995,38095,4701,125119,5027,33680,9236,231236,14135,87837,23318,70261,78893,30151,81482,14332,1084,74256,27532,46644,79185,3148,62615,6981,55672,31668,36825,1849,14536,37446,14738,23779,43058,162749,72199,1168,21346,5592,85932,85302,9668,18351,57135,150360,2080,228015,77953,34670,119302,151751,31009,106725,84265,45214,59289,74178,113071,263206,111009,4021,44449,188119,192629,123592,392506,292847,114487,12831,205858,9852,20780,79648,75767,357014,97721,18166,21005,67950,33226,204009,16536,2987,11335,66717,144910,47950,17262,55060,15063,2934,51038,26775,178497,66008,3427,49433,128592,20036,157553,63861,3089,23015,51210,28696,35933,49942,71135,231518,99620,17248,21835,176536,20676,16944,38700,165831,233253,295625,36723,13023,52745,10907,19423,67972,125868,95473,82875,1183,108455,52685,33417,64095,21433,52438,33191,127809,44505,211823,7810,2752,95548,162031,7185,91196,47563,61721,33359,17897,23682,42806,178101,22874,49707,199897,75419,82456,8618,11171,79712,116847,18783,44190,46564,5346,59046,95032,7893,14916,3214,26800,24172,121453,34362,10250,17408,18888,4840,68696,22831,13162,36005,32512,14800,62357,41723,45046,27247,37486,5372,2564,34261,298500,66509,133920,89138,31305,117697,19097,108304,81386,84106,23802,46411,63304,946,51417,41777,41041,19501,115864,60743,294354,37955,94165,18116,1156,17937,20645,57114,90804,58042,48643,92288,9861,2557,88546,61333,101008,12853,5148,87856,4152,144503,73841,18718,9789,147565,10846,42085,12789,30223,8993,56352,67203,2448,28215,6052,23540,126319,75933,36689,80235,23231,23561,21383,38800,77548,102798,21234,31468,158608,46188,63960,191679,8051,67014,11185,170078,42186,28827,34777,41930,212079,12421,34750,24111,110344,73918,45171,70826,141949,40063,23979,24254,37309,26724,27179,24718,83648,54938,14591,17425,29525,102675,48975,48654,12316,8929,60640,41709,50168,63264,89812,50716,48632,38755,138583,160123,55579,71829,24230,233277,46322,39650,166388,34718,24108,98252,7031,106695,62498,18258,35062,217827,78731,34824,33354,19520,60852,2432,60224,8587,2836,62955,702,20227,42285,40560,95592,62486,11094,53035,143291,18842,46177,77994,1770,9657,107422,172915,32655,128716,25886,25164,156740,119928,165875,85817,11007,89110,33956,12652,65156,180266,8494,36889,19958,20955,96,1264,118288,135769,44754,86671,5632,19026,168220,289120,33569,93821,66144,70635,7687,5642,2714,55445,56636,71545,184182,93133,7332,37389,12643,52315,22729,11014,158742,17050,152889,50178,34601,41945,52136,9948,26914,63548,95721,115951,40759,8960,158258,38938,49232,48325,42234,81523,253019,66128,40978,20048,238048,38760,62928,122560,118532,43687,137472,163689,26680,9878,17448,51035,16211,60834,36749,29178,14241,59868,150086,2305,26477,42422,34342,165341,83279,33894,14257,29928,12743,13957,125571,89134,66712,10952,16507,147839,30146,7249,16565,45399,39874,114565,215780,31990,230881,171477,102,196546,44538,10880,84948,281705,86651,10617,31395,2342,453658,43569,60561,132901,21845,17727,58556,258242,22262,58728,4008,77997,11806,37431,30599,81375,109137,185787,114085,217292,97453,169085,30593,60212,11544,102056,65580,2384,91655,4855,95725,7295,157994,16228,20669,53276,141590,105246,17334,25440,76067,17967,39321,38911,11362,28559,63807,21627,26468,85816,40120,1025,15234,58319,69516,66512,124548,75845,78873,22137,46681,51242,85683,32909,76747,35555,43396,101465,1765,73094,1077,2962,39028,66777,57831,42048,15828,13962,36041,63657,52412,5242,58846,2141,5506,219012,134451,3936,182230,17558,17153,152237,22621,49377,170216,35257,68233,65374,6510,11126,212151,7184,2480,22517,3437,33073,30156,16557,3768,55067,86829,91e3,12350,148650,66017,79424,70885,49066,28250,21369,51213,34533,11510,3258,18176,18465,84413,6315,36411,163765,4346,356,107618,598,13727,285026,162695,8749,14583,7132,63521,184253,32378,25991,5604,30961,53675,4874,84693,5086,34811,26978,56564,7904,33519,51221,113942,69253,6664,125563,22055,220680,102008,742,51930,19494,176108,44424,35123,13025,75685,11759,74335,22250,181453,131147,16984,132115,154311,11991,76452,52609,85351,196,30969,9198,74919,2529,56838,71779,29187,116304,3504,62330,41190,86153,28393,254926,104228,105189,13264,84359,3574,12415,8534,57147,10175,188174,59504,60932,66318,16407,107921,17638,99103,49278,28403,39786,145865,8462,3558,43406,142271,29139,21989,36552,93955,72365,7176,13556,106185,37957,321774,17782,129017,51154,27938,24952,1935,39366,2791,33489,41582,56078,24558,9311,5449,218786,27808,190429,68013,36020,86003,29735,3404,87348,119357,115714,2324,86796,81973,40992,43376,93621,28784,16808,36367,2517,2909,191926,24978,55303,53308,205724,60068,3098,21375,64784,23949,26579,63121,12319,80145,39967,97861,6757,70143,67642,37082,34698,69140,122883,46151,62187,80934,429,19437,135071,137885,222647,13331,154065,327,61778,74257,40116,37493,14855,85079,237641,42342,102164,199965,71204,4662,29368,5042,113914,122214,8955,13149,102503,43173,5659,163787,69003,307084,63392,171080,21390,81918,86666,36622,24126,28887,5736,28054,207170,163428,79891,346467,95363,38980,111806,80828,9200,19288,294896,114468,87405,111715,141705,7015,72754,68463,48738,243147,33397,101210,37051,98801,82847,20397,4940,185559,18716,54718,83491,11725,40803,1128,12128,23060,5174,7745,67007,46701,1571,27807,180186,256996,18975,16837,7877,212758,250379,15440,87954,57755,24719,124057,83461,258,50864,8874,29038,71289,31627,15429,9005,4061,113851,107716,82819,13651,79656,117851,17539,111446,12938,39724,190787,4352,15402,21070,62708,8539,23777,73853,13552,38810,86117,16285,56400,1718,75342,142863,29033,378,110113,180321,32586,23606,26393,160984,207987,23783,8406,16904,24596,47274,11693,46539,60524,78595,48423,31718,20170,9009,146268,15183,191060,172765,1349,138436,37365,10970,40509,225817,20021,70394,152138,21541,66559,66544,89352,2725,17258,91345,7313,3815,115868,8660,40362,4071,103524,39388,118275,21950,6549,38226,32754,209574,29201,43495,18028,20296,40597,18370,47520,202450,24134,2219,8195,69545,38041,136934,46374,19041,159811,84865,58620,846,98749,13569,30714,97246,32186,4479,27355,92973,35214,151491,75963,37631,1561,27200,238083,23182,60756,12291,25766,39355,102333,87362,65741,59906,19538,201575,48772,102938,24438,292580,39964,66366,9004,61379,50548,37622,38732,28379,68180,76622,17488,69849,5963,7219,48143,43413,55358,540,58691,29506,19245,52193,48621,5518,13048,118625,44755,191081,42061,89197,2259,60665,66994,71210,51232,3585,142096,55024,7892,8345,58653,463307,65658,64319,137941,136323,53499,12746,43492,6978,95163,29925,60175,5128,7352,41463,184756,121146,20473,18426,4598,5309,54580,14277,121151,10691,56711,43880,63409,76682,11830,172218,264898,32632,66536,81062,31649,25788,92774,60222,11100,63159,9432,224657,25240,53613,152,138620,163829,2397,85345,12501,37507,64932,38575,43522,65789,80198,78796,35226,3851,108891,73311,3060,28391,93671,39663,46142,30982,66041,37281,68157,26553,71872,81142,211527,39747,118119,22695,2859,11066,20232,168911,7933,197005,17066,111071,44434,133994,120798,12766,227798,45756,132852,29917,36076,55352,65281,129800,41958,18944,84678,18580,168093,132621,39997,54092,27740,32354,3770,114118,103242,43918,15899,18574,145944,3190,123469,219903,24169,100571,62403,16776,92779,14535,17168,16475,14304,37231,1712,28218,242754,61688,28980,1318,51359,222657,99200,67989,31772,23932,35351,201251,49041,27306,19128,40135,3986,77333,19649,120683,151927,21081,7076,78375,77501,101599,8011,89585,96715,58179,5378,102138,106793,26051,217276,4197,16297,27014,46721,13322,22806,5278,29629,70632,9647,71519,58818,40603,128530,8903,36770,56900,31483,26935,43845,34265,34920,87658,6114,84767,64250,47318,50720,19264,162514,33357,13117,6705,46696,75032,71054,87004,42035,69138,11903,99854,102328,19611,34525,69312,6431,49842,101600,133178,108751,41829,89939,225664,48916,99556,9195,130387,5960,36857,116724,53518,94002,39077,53996,6945,22261,64291,8314,152785,57588,16522,9091,5048,87671,35441,39509,1945,12423,158923,178413,37549,14095,1475,73188,62878,4819,24012,68534,42606,4010,120809,57497,59564,101758,103718,32701,80116,12345,95834,46918,21468,53213,15665,31200,3867,5140,96013,250744,21016,10069,13968,35449,180829,27683,39704,59956,22893,3115,26293,32785,75934,62445,141162,62720,2018,83638,19949,114012,95006,3330,99829,130935,309272,9565,55874,121727,37017,23586,319858,40970,27602,8625,112329,61060,100088,118525,25922,16232,1907,60671,51583,44553,80993,5262,94679,8676,940,20736,11823,3020,16476,12340,152600,97416,3703,25744,66826,16245,16876,46446,84798,74227,176020,45192,61955,75496,23946,23626,40372,26036,6149,11822,30582,16541,41914,82385,232823,40921,80773,14930,3631,7517,39619,4348,36180,126106,138939,62611,1477,113512,47321,25052,14546,118881,29060,23589,128322,36795,18401,137921,104699,267929,36194,172791,18113,4766,188215,30083,332586,94089,5805,77909,22194,68234,154976,43220,40660,70001,184893,138095,11128,103010,22663,5108,212615,8485,5565,49222,54614,26530,42639,16319,55062,152662,105595,21114,22216,10294,68158,10436,86950,7206,62115,3977,3657,59874,456,118617,18156,106663,112229,80992,17442,8217,55551,5133,34344,251927,51153,39364,201321,7816,66803,23057,156724,145664,14276,95705,979,2796,6875,13429,212525,50602,26276,28284,3424,19465,52397,46963,31420,51399,206476,92317,48851,637,100820,83349,10317,60227,21972,6908,282439,32857,224767,95629,83882,42106,87338,69757,29840,68709,37665,45244,114577,49188,175943,54009,186746,106158,70168,3358,234002,50555,9221,129338,9562,20118,32923,78479,118280,65752,4977,10474,102174,60947,129006,10570,83451,8598,8078,159367,123785,80438,16742,5905,5281,181513,42402,6977,163136,93179,42191,14968,50421,112401,105440,33456,57347,121611,4221,94954,36517,24046,27796,6255,33394,72990,135408,116627,1233,57874,25654,95419,68156,401399,313338,55208,45573,93124,119251,47200,38196,11909,130667,45391,73904,64964,167846,4137,115606,52036,62214,7969,160925,7187,1132,134835,40309,73195,64494,80472,444841,61111,26500,45323,40743,53625,52797,22659,15631,29739,36706,28841,39147,102836,26794,10536,14845,87305,45874,12241,127587,83833,57183,79722,30844,41304,84655,20825,92500,3722,25655,27811,10157,81634,31362,34088,92487,70123,22190,185100,72658,139035,192523,88241,2078,230490,44528,85638,100198,22088,29982,291233,241062,13865,4445,137791,37835,107218,31726,19718,38234,72528,23046,19177,66695,5109,17251,28077,5617,21554,47839,72425,133825,1486,73065,181275,141508,21768,62971,63082,2512,34200,9904,120309,6392,91243,68416,268253,41199,116757,138551,185526,41246,28986,4093,19057,17295,4148,245766,122360,35356,112075,20301,75441,10998,7977,19769,62922,937,63547,100196,26427,157820,20983,236696,22935,8140,90315,156004,47204,140973,7726,45097,52725,22636,23436,257282,105247,522,88389,216031,202204,46812,211666,19693,68828,81691,45925,11256,30292,372,5236,167826,88328,232776,151611,5360,82104,18841,80393,25465,18285,20320,72377,31730,33160,45803,38715,27705,37379,24163,18360,103586,4015,32305,269494,91252,20080,36567,54650,7797,57073,12650,31164,42209,6375,261663,105528,81661,106002,2800,5375,17247,43151,4442,15727,194619,100855,144898,62320,78465,39929,16454,1967,28311,61363,17219,9395,8745,121445,76939,80385,162380,22009,54191,44248,16299,122830,48151,74429,78291,64755,14238,44966,2511,17712,67954,93583,829,105899,49935,84750,11591,33185,85447,42717,27409,208542,28965,62052,52525,5597,25694,65594,16343,63224,276188,12475,9331,127507,38522,57287,24128,133161,79723,105548,133695,48917,27558,43278,46520,13778,141954,110785,83366,17715,46317,105763,66298,147013,41086,94180,16478,220447,44611,730,19722,78975,117889,125643,26254,16574,18480,65006,15806,38549,246418,46052,36056,8440,34984,30170,3163,59800,4458,115442,4283,41970,33507,104078,1653,22,121158,276486,3655,6338,24048,133421,23641,2161,24422,36006,8086,10675,181474,12307,29514,59143,14729,52509,87128,122470,19446,80852,33314,24573,119864,14237,9652,57779,6612,51851,15284,98871,90581,124466,156831,21190,22015,71380,161906,87247,69201,18392,17908,108470,72962,40719,14338,17911,95260,43339,20610,78916,20710,72451,11315,31448,17263,58853,178878,48111,116002,45497,80506,82605,85880,36300,121755,25215,36118,301929,88728,405223,276136,553,34704,212438,49970,78329,922,20711,25036,257130,38295,145369,18128,15385,30829,55656,48345,8012,3561,28004,122041,192900,58338,112508,41085,29976,87040,47117,23905,4336,92061,138880,97407,42083,172121,6256,25192,172671,5,93568,1420,12677,31605,56743,40620,6015,78415,231077,31298,80026,13902,19048,24924,170586,32955,176119,87859,36731,6773,27711,24658,26475,115216,133207,93250,95820,88522,8317,5714,124047,55219,86860,19677,23961,22928,162209,8904,225992,359835,56084,96201,29392,96558,86071,93643,55114,13347,8183,95129,82012,2017,123336,34219,115554,157159,47747,101684,41008,18735,193781,104151,226906,7552,179874,124113,31159,21162,44010,14771,51268,166128,31382,73124,77438,92830,205709,12113,1292,38937,13114,1334,2118,15597,69581,14449,21934,76618,48728,67038,14967,51495,24243,87736,147249,26720,11119,46063,43749,5843,44147,152629,133428,65703,14269,45604,57982,28672,55616,45957,8438,95433,37698,220862,132034,39456,61870,4161,26501,73560,56418,9845,4654,20916,10456,88920,119358,9015,65931,96507,48029,38534,21676,109081,43078,34943,25089,6131,28766,23665,5477,10255,16695,67,45778,42443,42770,29534,23733,100513,62617,42630,48746,14191,43753,50295,26007,8792,57243,43119,54725,164253,58250,112304,131796,25165,4651,3188,24831,47748,3705,19540,13211,102095,5593,18699,23666,32005,117571,33541,60584,74573,86311,99443,25172,27222,168938,7143,11853,53560,18834,19960,86522,28217,53266,117700,72989,34323,18721,66450,34346,74056,47217,202002,46269,9429,68582,75458,37823,82843,96652,32549,145144,27958,19820,158086,31955,201406,135379,31207,192545,12950,51704,9094,248263,76147,64028,110009,79407,89345,99284,223492,47966,26848,15359,201137,2861,110507,71231,72297,31851,118777,71039,151051,240855,16333,50766,14727,7939,4149,80908,418780,88378,59276,1327,7284,38576,79814,65820,42199,84860,49574,62596,12396,70598,40117,8648,7994,16836,7630,14047,359699,106878,525,29037,28064,13380,11675,50669,74216,103539,180314,27449,56299,172344,19274,7301,246099,32043,19422,36506,129317,6806,30140,4614,46639,66926,932,86600,6322,27847,233103,10541,39025,34887,3517,12972,26220,2031,66561,115015,48658,47596,12714,33845,3893,16165,35237,89983,14769,11962,147224,47018,29977,27979,5552,82338,86023,131368,1218,24853,237840,132193,15455,40873,3668,65351,53388,15229,59889,272245,47934,11858,34347,18038,90853,86981,300602,19343,114181,29362,84921,6095,106059,79472,38015,1206,48741,6208,8e4,21916,17423,6002,108083,24479,34931,56661,9511,26995,100694,163853,35997,81254,58321,18919,171890,86877,91341,74503,70477,53412,7027,59281,39892,131302,5864,15947,61301,67466,162369,47956,27874,35624,282324,21270,111847,102548,41482,30955,116737,28264,8592,55458,22301,75090,29821,30697,51709,3041,19208,8038,24634,30467,87509,126428,19389,18814,152686,20701,83474,45832,80891,105808,11378,153223,120770,98186,150633,49838,9141,12755,30962,5260,74490,21256,31678,65062,33326,289838,187831,20595,89768,2805,58535,10844,70085,12090,2451,138068,98544,24461,4511,6754,41684,28203,3383,65355,82833,30161,83924,234361,128424,28921,222594,33975,125491,34069,11508,67464,144226,41850,98703,34371,7901,21254,38398,65651,23549,53883,213340,123269,12028,71764,177701,28758,2623,68395,11549,15232,68603,9660,63116,36079,57093,31198,20475,48467,89984,35619,186847,107469,31389,43631,73867,41949,68841,114250,1605,30564,63403,17588,27680,99533,12641,70325,50428,73426,78379,11855,91651,72081,91720,60198,15743,12065,83398,140046,6761,46598,45900,5068,886,62448,148968,37347,19405,9680,15819,43496,63370,75667,163700,37639,3633,22774,34341,183131,134335,37200,23915,7054,14194,12970,26438,13350,285521,25594,8219,104410,91039,168804,138480,149734,15907,33818,61132,60082,4622,110187,56736,13551,73571,3945,73463,65498,17758,263266,17593,2710,27585,54469,38200,45367,63754,28881,3473,12791,98287,31895,65787,4463,94536,24951,36332,59901,28803,52130,86403,7668,181822,74831,18977,9850,177206,145485,109798,7292,31421,26280,77211,58511,12507,127004,11113,147,8729,56208,43066,79926,129937,31345,83947,39915,46146,98763,42566,1337,13192,18323,105163,80570,117753,16555,72883,11077,159438,40764,70933,83329,26066,12276,72059,21655,173836,126713,69454,153482,91585,70644,102558,110483,6764,127864,190133,3961,101798,20945,71138,82402,90884,69669,44753,923,16939,59700,164258,25969,27082,31399,43846,6306,246093,51342,6153,151581,202801,182731,56475,162188,89426,141356,14355,121815,27536,28023,65257,77523,106668,127314,24947,12790,38796,169698,23555,10725,44573,183083,42088,62716,43265,105958,32050,44067,50118,1668,3874,6243,318411,16599,1691,94999,52378,28671,216728,123258,2059,34969,69225,5913,136280,171443,141515,91662,22175,135282,80020,92270,1663,4808,4482,3495,34691,5226,109830,108512,17342,107488,11606,123190,100247,29666,146527,113014,15794,30894,13224,39585,243192,22351,9903,7836,47699,11078,25468,122291,48821,26780,122679,75521,81450,630,4895,92900,55074,74293,17441,3563,111657,103102,51613,12318,52370,36191,68245,34269,40445,41354,122901,168604,182500,62012,42557,11259,24428,115113,86345,12362,3909,78430,86852,134602,20459,47853,93879,22577,7659,3688,38555,13349,17381,56715,91639,12493,10895,92438,3142,37057,28928,2004,36427,32268,34222,209974,10432,67436,41989,173518,107930,27079,62729,30908,55558,5828,45031,14902,53546,8204,144263,60255,14520,88212,86582,109589,69356,8064,47449,8505,66558,16886,4844,52817,111260,215129,12941,91118,650,20770,6273,73089,40618,62790,2873,35002,14023,97208,19386,102646,36993,143736,135457,35385,113601,17893,32627,84439,100619,56016,6581,57264,172160,45452,111710,203627,70131,24100,322787,1996,35665,70078,22358,90922,83658,4097,63200,58499,14542,99153,52159,6615,12414,63415,31986,16823,1579,65405,137809,8841,16898,48082,259,33014,42375,12260,179850,73667,91389,98882,29532,17311,326251,41092,5928,20742,44964,48019,43505,9317,49265,6643,192712,48424,163487,19861,20113,70848,31928,105333,23685,78563,14638,54755,7158,24142,44018,20774,125255,20331,24280,10163,1285,2336,39851,4299,117269,46714,63816,87779,159624,11731,9971,990,137317,108831,50994,74554,162680,23640,131597,146962,170620,34829,91205,21184,1913,63616,18427,93136,156592,17519,67565,115882,138220,78622,88535,18115,2711,33554,109492,54298,971,24914,25863,36363,45715,27099,194995,14299,178181,111488,72395,322385,157719,130787,11897,81843,83999,11369,49280,118604,40922,61332,110343,53407,75639,40582,300440,54722,25637,13694,48248,48278,194521,56203,52779,48783,72627,10953,376,16733,280238,26351,230789,15132,25168,137270,3588,63704,73376,94031,74284,19443,159557,9697,39901,13351,119050,15406,146455,3460,29556,75195,37673,102524,92329,47289,98413,15311,100684,56345,7116,95480,11590,7200,167,23610,58426,17730,136656,27944,53151,2701,8824,103124,3017,90744,113588,53216,79736,65940,26931,498,29568,80540,143543,21292,1740,59268,16561,180816,42323,50174,40890,52866,10703,57169,4700,17191,4424,93511,49698,166650,26972,48631,165169,82879,69326,202970,4007,2376,231325,139592,22119,62851,37504,68816,58345,67398,186643,43331,277416,53749,15746,23102,17432,4793,151138,48822,54265,48203,198688,14305,54287,2291,18018,113378,123260,7180,97549,87027,120085,2920,76080,8190,102005,5641,64580,14955,59802,54028,58884,19367,81779,412567,85957,97053,103637,78871,29364,27637,141728,4767,30686,112738,130146,42745,12730,105040,14844,232,210944,36581,152317,135543,29744,3129,55647,58149,46319,27265,17499,28005,59948,7170,34138,5702,293047,110892,408,91760,218674,18469,46095,81403,14389,4610,35672,73060,11006,74848,104820,118143,190357,20043,105358,141735,5115,27093,45924,123073,52599,29433,9616,238350,78610,24851,58858,26769,31969,24613,18294,4982,32735,39639,143563,112073,202205,12567,4873,88601,44897,81503,101648,81362,34662,85277,17574,48173,21435,221188,40215,39576,80786,26544,64668,81841,10731,37733,247986,149188,127703,495,18382,54388,72446,43071,30974,198723,89608,41360,190,33045,8386,31658,19992,237838,119015,137622,50890,100913,6460,116233,267230,26621,104129,65114,14190,41542,14888,85962,23342,23041,26453,43725,71809,45186,4770,46452,53894,56616,221286,18973,9038,109299,55365,19366,26863,18808,60909,69353,41738,83463,12100,68561,72860,3980,13796,49340,12332,31311,27418,4255,53430,18976,45523,510,14224,30477,26581,4530,3651,101663,139840,22709,150861,31996,63923,120623,262522,3076,10528,2929,14672,130238,18087,9816,121894,100308,25085,55111,14565,18952,53293,2042,369988,23674,61789,133529,28783,108293,35477,47119,36448,71049,40015,33055,78598,198442,1833,159937,40654,77444,189245,113153,8621,18599,38553,35223,166072,2375,11659,21786,89523,6032,12116,63046,159398,18454,3678,32521,47626,11411,103527,38896,42946,15696,26370,10185,8413,37080,165583,4331,63555,14907,72220,50056,6623,62236,36565,49783,10049,17503,100581,55951,146244,24724,9626,17969,25524,109300,173965,99994,101056,46459,43647,53737,277968,8347,123521,74858,33829,44762,77574,877,81377,222525,123532,30602,43881,53145,2973,16284,81940,61281,127044,63620,9875,14756,114829,19032,9202,52759,119141,23928,120551,19607,3599,33401,76821,73233,117430,39968,36539,7071,5446,121735,194059,15206,45283,6706,15603,65615,1207,165723,92275,34773,104447,8396,32353,205240,164323,13600,60555,79205,25532,22907,33410,57480,107111,69630,32137,47832,70913,33161,20321,2371,117348,10714,86246,1625,11763,17900,268,78457,99175,97940,101092,86660,32221,14041,128504,125080,53744,124263,31017,13897,403,31859,21964,5633,111630,5547,77329,17961,18241,84995,25984,12983,67491,62168,47262,5241,297,51191,7351,8967,147212,82060,16821,782,11033,82431,62957,5026,43459,77963,203477,53528,6247,191852,87774,74164,215654,13467,1522,219964,28589,244104,16242,117821,67725,72570,156792,17186,15979,26990,44128,193014,35276,57125,16212,166451,68017,6905,77608,16364,53777,75921,76426,37975,26203,269296,64099,84122,12077,38533,830,4407,20139,963,43028,38902,42911,37503,83343,85045,16979,1165,60835,137387,58380,86990,110066,134540,56331,193845,81238,17922,163093,38744,110641,12502,56404,34862,26865,125964,12965,111648,25547,7771,27196,136980,9555,29551,107158,57885,18831,37705,35505,101742,13970,102109,62548,124657,23328,11124,89592,146376,248050,6241,22033,18337,80685,29898,11908,216623,67721,106162,146610,21377,15085,91552,42041,62560,122532,125336,102365,121537,142559,29693,223919,11515,110495,18776,22494,5895,185059,103592,229351,51220,100102,37027,257855,29359,54123,36066,106493,12244,79258,32002,432,56205,94836,90182,6726,14762,29391,48938,26864,38083,60364,3310,60192,14766,205567,57504,110760,22649,24666,46333,21517,3430,13135,28873,27052,158809,11597,20529,6695,23138,22960,37137,45574,6545,305877,43423,26153,24769,59844,14501,10430,134352,56169,13213,103432,49523,35181,13435,12408,129475,64620,230854,77390,51990,15653,83248,33466,44571,117828,51481,2187,10559,68019,18021,54895,48247,18354,33737,4554,108595,37288,39767,116707,9175,3726,108877,21616,83684,49862,1938,8543,276466,20134,108498,48770,102254,31914,131520,185291,100559,51890,209,19526,76471,50544,71814,99351,8172,198526,28816,20419,9109,98389,136777,76479,75596,30635,165417,48216,120220,25955,211071,39314,24308,32164,2559,146280,43403,9233,17947,90585,1786,86920,125662,2457,64741,32152,32918,122882,78538,44001,31723,56426,23375,103172,88177,145697,52506,49319,68016,31664,41488,18486,110400,7030,28241,986,109199,19900,42147,56864,65287,49183,7858,24e3,30453,840,16673,25907,68916,89927,6309,158335,36407,199737,130464,13137,59603,201778,195292,21015,42466,179062,172561,89492,11075,180407,31868,72493,20998,60217,9865,19530,39274,130266,54539,21623,12535,13505,40641,73375,4087,85633,2153,3117,70680,55788,92096,47509,98493,37490,271936,151475,3032,16171,96642,34106,78425,125761,19591,3366,19316,54508,24183,50786,194248,91528,33253,34622,108355,41741,705,3814,3883,108929,13203,67831,10142,59754,68208,29128,84820,56880,38794,24972,48571,40821,40476,18137,164254,24064,236309,79181,11282,395,39169,2013,51587,28551,9645,701,109513,115899,113566,12762,62045,58322,103726,41343,40866,244102,143816,2490,70346,40973,52618,15412,30720,104315,38917,42027,93676,17513,107418,20706,123890,13399,97727,24044,87962,65606,44250,98044,65276,74790,101473,19350,91570,1326,87790,172042,7577,100813,86896,85891,41512,108130,27794,14875,71431,12835,156250,58135,3759,22476,42176,115873,34686,56523,73643,108505,51491,20838,12721,32863,45700,29496,13700,34294,55360,29206,155942,123812,7706,163234,203,132720,49358,144431,8130,175788,35818,3270,76832,25710,54095,97274,28779,94621,74396,19092,128242,58067,20885,14670,93255,15107,63291,23654,126900,129421,59294,262659,9798,3251,67344,28600,44629,50672,29072,26999,31526,23183,49175,165843,175455,17282,175411,32022,45989,30298,90690,78118,83156,23749,35636,31317,7069,80381,94561,133756,14960,97404,6138,41065,78041,32843,16601,34123,9559,146529,123377,96395,54441,42012,84257,123541,10745,22139,106459,11720,150883,172651,154996,110538,4728,53447,25704,2009,71152,119354,21166,66604,1429,216162,8637,122250,63520,27180,29172,36124,276428,107787,77184,4680,14952,104903,24418,14793,51561,52931,8371,26342,48526,7118,92066,67280,40653,8847,34597,105438,14198,50163,61188,146286,50315,41205,170829,161496,585,197359,95056,1687,365794,91349,48507,5804,49263,5146,104902,96365,117343,132222,46084,96919,16875,8073,262381,79982,52663,13928,16056,153908,15145,109256,132308,18763,24904,167644,13618,40750,18686,147124,114709,150038,52849,2938,12568,48617,8778,5459,44202,44591,74914,17183,248689,13878,7822,80060,23116,194037,18487,2067,7798,43077,33678,244028,31320,74273,2794,19466,8218,36280,183997,48124,19416,29656,19280,98734,7715,18311,30701,133602,150307,126956,7378,2933,79903,13178,12593,86571,26604,92446,13574,44205,65699,427599,21118,8245,14407,27877,47936,33542,7916,26460,117762,21596,37818,2249,127359,209394,60044,47677,308089,36791,154971,31417,6998,150042,174360,12255,43009,29335,48739,3912,101398,53340,2580,146939,151295,45360,125275,15273,45383,27456,48761,23314,8750,60801,85823,104759,27894,123685,66968,39480,26917,55290,83305,2696,98390,57569,145853,340733,4919,20024,52268,30884,7413,203685,70989,112855,4129,50536,349518,68205,332641,159581,135361,236026,37563,176404,64899,6578,122033,63871,1850,85234,82089,66124,74145,121098,107351,12687,36881,117334,13136,14698,85933,93866,18047,32620,310,15094,46e3,88451,23632,36645,27940,87618,80520,58892,20976,27702,140090,96075,67841,103292,238964,87778,107338,17019,83427,67522,7302,8261,47570,116787,8730,80484,61772,174422,56005,131193,52875,14588,28471,59817,9586,15720,158155,51307,109734,15196,11025,59331,3884,52626,102602,84797,25158,27314,4437,20488,76214,189248,35023,114952,157376,2827,62439,102878,129749,36405,10329,109339,108633,36662,1254,13267,5470,87105,58004,15397,10434,159667,21864,52022,179464,3013,32147,31496,116832,18494,105502,129227,107267,50033,13481,9954,24267,22141,16257,116154,36185,950,115685,11305,176708,2048,178671,112573,287867,162328,497663,95170,50979,193861,50987,30368,136257,31830,46549,15119,169876,23788,17462,249887,57377,1949,35448,14791,43769,210091,3783,34612,282103,88380,245190,5457,20491,98908,11402,86899,117916,16028,162584,60644,320177,156096,31065,55876,22e3,77655,9992,23397,13757,317623,63978,215255,2443,17648,93231,27388,104529,93807,55505,140477,12046,112040,70887,40152,94365,112353,25063,114679,266061,71248,119555,15589,2244,617,14129,211431,70110,100652,7777,4383,85911,89221,21010,120615,58357,86405,37554,41647,18,15143,69662,60491,14714,186134,148344,42347,5410,168175,44535,42449,343894,129417,99682,20659,27272,140483,63455,222159,17536,13722,42637,62324,11976,114691,148109,2283,32057,182393,4295,147364,33705,2075,44303,30274,28331,63740,69740,29148,10346,44862,33716,73937,153333,12930,38784,247159,2515,41053,20256,83368,256189,54639,115240,5096,24661,175419,153552,26516,141,138176,63885,34115,47222,55709,2765,28479,38875,236608,12229,22921,77291,54426,45388,2860,57787,114579,295139,105782,17826,71066,19119,54364,69385,16568,12323,28057,33346,34919,124763,155533,101386,31644,8627,49001,303600,29868,63213,9103,77280,71333,9696,138789,37059,24823,5057,21352,32368,114208,56803,19424,10445,58514,8661,209508,26187,171838,10460,63454,14016,122504,41328,21329,46618,32493,38225,7855,31763,7945,29876,8734,6438,24205,97490,139977,130740,47323,33195,85390,57194,13813,60600,21313,96251,7699,27584,170521,139271,1363,4402,336738,129223,84983,69150,13147,3590,163929,207225,155260,55916,20288,4503,8398,98490,11773,27512,37113,84976,86558,28365,11756,116005,182148,13733,115313,47644,67208,85069,9347,14995,226141,14704,101835,41159,35314,13113,63526,214039,29978,50446,83339,17440,129441,72522,118641,97816,24907,73844,15717,118884,167255,96509,162793,30847,36849,51297,78974,77793,10427,1873,2972,9999,35074,28190,64297,146836,46298,60038,163007,108919,61219,2403,75022,127339,4233,110389,69022,9833,128097,88016,79390,222936,22570,94657,28462,56956,38803,81536,30474,152794,19566,16481,147408,74574,81895,20731,1918,1366,76367,187321,54494,24366,21690,61696,33283,107477,77499,31112,414383,74362,18463,218441,120929,59848,258629,201924,69269,454,19989,13054,59894,3623,58908,20681,35723,78523,102680,38988,184112,108087,50944,132704,52966,21699,18860,96349,201411,82697,85395,95658,5093,6427,177894,44191,32755,26961,155739,6249,31310,81030,26574,84311,120155,86730,113535,7424,48888,13516,45747,98098,20077,183995,81945,43210,26704,40420,75831,45648,11180,6855,57927,65528,124096,34851,2598,156633,107572,127352,38169,123845,60142,62722,105584,232364,23211,68120,1601,22169,89299,747,258039,80572,7258,152249,11862,101204,8834,121434,33761,19175,133142,46343,40178,48723,3589,41977,30210,38868,62257,10087,82658,87827,90646,16415,47552,351723,28298,72225,91146,272760,1701,11295,1652,109651,300747,51863,198800,29446,11794,32345,37538,22356,33102,37590,113544,37970,11478,179743,25454,103417,59905,221970,105196,145604,7817,164809,102360,16974,75840,255333,56902,6659,1954,645,59400,67769,7689,18675,5215,13793,20536,27852,3387,29523,259718,16860,94625,43143,29245,15848,233581,22685,63631,78557,22836,133302,84513,1348,51826,47129,98836,58284,1830,1749,94642,10933,6145,12506,10975,13879,103781,144434,10268,28409,32346,52968,121567,107374,77268,23686,35097,10501,155275,15303,47136,21102,168741,55332,90385,15996,84817,681,137803,25054,142275,6163,38175,8056,124296,240642,65621,4934,178205,16101,62803,60964,18230,100622,76465,44689,14545,9543,47514,16852,93380,28048,12047,107106,37575,101485,77047,57326,34819,96137,76916,6469,46264,115983,75768,87668,69942,13027,165,8373,114231,26434,52844,42799,182044,23580,146254,38081,43236,33883,146220,382894,14606,46035,36481,166621,35417,95382,2957,59384,60428,36358,66343,75378,22267,22950,83528,17577,56474,25285,4619,179691,75355,95836,53295,34588,171410,4487,14679,84208,44015,18562,109133,54101,11531,86052,174479,303157,28095,9953,35642,14564,39802,16145,77606,117406,53038,121117,53624,22062,1212,7632,127157,237292,189087,10478,127345,102515,181997,86752,87623,10966,121602,68783,68681,83042,114380,138349,191305,67176,50085,39016,1427,42384,1412,67118,122616,72389,25260,2237,13576,137346,19938,20304,2191,68759,5373,61364,238507,75814,23931,69565,38993,131741,38364,12528,87762,5679,129853,5310,186831,32653,90338,260176,389531,108118,26843,43985,50175,30563,25106,56965,18130,140428,4542,165503,117991,24219,229605,1819,129663,1240,3797,76093,18398,71339,51919,93043,27175,47060,216257,6483,35051,1217,16512,80798,129064,13225,69339,8548,237079,72298,2575,34280,51379,117910,55671,53345,247552,29486,39328,140821,34681,57045,60177,5004,90269,78522,2479,322607,48474,61296,13057,31558,4678,59271,6699,27044,31988,35944,12503,83480,4389,136508,3781,114121,70279,4488,155829,42214,2898,68191,75695,305850,45041,74344,106509,30087,17429,93292,12477,290,23080,114802,35714,18751,26554,105424,17775,2144,2412,100610,65192,113975,52975,180272,135050,129815,76238,106483,21440,63186,4260,46189,9711,28249,4169,23429,23390,8324,141585,63809,67668,38457,38063,39226,59972,1189,203916,62368,14403,16949,61767,85801,1739,40147,35049,76757,33124,62102,15780,103593,103009,53484,22952,67973,114645,6566,5245,50462,7601,8288,3513,194571,80276,1908,54592,5124,58571,2513,6800,273997,193904,1119,17991,117245,2508,129156,82366,26278,71465,63341,56943,39662,106116,94966,156875,9736,2204,122308,94418,27134,1280,24539,49022,45314,3764,50904,46424,30699,28087,293839,9400,33646,40165,822,147499,50263,116179,29085,11863,31314,5578,17797,5104,12454,1604,15342,219206,10232,67800,94261,25872,13565,90339,78971,75377,26649,41184,47695,11514,35369,20767,14227,41953,309396,148270,147938,33074,14453,27499,109019,39018,25738,240196,158931,52820,8612,95853,21524,137010,84901,70869,70021,116794,48404,38771,6732,1070,70990,187297,49140,5238,576,3564,253975,16027,16483,2811,37775,19034,25259,4053,2e3,70083,95774,19713,33431,92703,91314,42381,288770,48194,95985,3991,77418,13406,241328,245086,56533,35275,62725,9246,51924,70181,95331,16163,31410,79016,39312,120878,119371,275987,80124,27712,9186,220,23598,146167,85209,68238,282190,57048,31273,30555,80913,17594,75779,59160,135002,101219,189377,29225,96735,60126,62522,104e3,27620,86814,17240,147533,11001,5425,43682,410,49460,87270,69480,46315,59448,1816,76201,9431,11788,87960,29063,65539,47347,11678,33846,7008,196704,9895,6753,8633,120892,59970,572824,115934,6646,202559,892,48351,37611,251282,57823,67263,57750,26527,34485,90747,7685,88370,6144,64182,1709,41969,21458,62327,181657,49247,225330,122600,114574,107124,85361,111833,63243,71420,15655,191178,72430,18063,51425,54002,12364,53225,86557,18193,97580,41232,138398,67821,128724,8944,233212,101353,52099,42127,14006,120107,32789,32132,3498,18123,33758,56058,5779,128760,59888,98869,18445,84702,51911,13234,218379,20093,39031,8074,70195,20708,23462,24355,131384,60189,26390,10403,41060,7140,10781,49410,42261,87202,82566,41663,43105,60276,2768,5733,74176,28329,2297,145430,131632,83615,122915,105441,655,224102,5284,136426,67763,16294,188511,32538,61049,27893,3394,13951,159099,28542,17930,145360,9492,190122,32285,78855,26440,13570,58648,73908,4239,124561,2444,74172,53131,11468,10794,73566,11623,35343,64710,30481,4163,10328,38309,29901,10538,154377,76132,92405,24839,11679,3465,13449,11637,7824,2337,57754,1260,14458,41118,19878,38661,13416,159180,37074,163164,54137,28627,52134,184900,8520,40385,29546,30502,22386,66527,107458,6850,24022,47983,30603,35083,8934,304066,39500,9,28261,33026,77251,9374,44833,116312,34990,29236,63563,125639,135405,165398,159055,55690,88141,69643,236964,31983,25572,20436,36746,60896,31850,16179,11828,5888,3043,66368,9750,31167,7915,53111,36430,1333,64344,93659,20061,60596,180191,51630,6792,30244,43509,101058,22409,420,44210,109783,43223,27030,72477,72831,32679,29235,7675,47556,12258,39907,149412,84926,118247,24692,71717,105038,86009,45941,41189,89453,29856,52543,30627,226798,67303,59230,67415,34408,1367,99685,16867,128419,52147,4111,125381,117881,16173,44093,102224,31575,23234,24870,83790,127407,239098,3200,994,1255,100903,242275,117266,55116,38205,16140,29662,11307,40414,208793,123355,56470,4862,75600,30119,58218,70828,24075,26974,7802,192353,4851,5475,78720,66596,3409,28573,64396,30381,30690,59859,88256,5406,99945,103064,34463,37727,24238,86643,60088,4057,23741,5967,162904,38240,28356,93858,25510,122879,6897,3278,7057,11971,4400,35461,211413,21395,59615,39471,87233,55795,128426,3051,22470,41950,14705,3974,180108,80476,78442,204996,91987,15634,67610,139015,142373,35611,51134,10387,4353,153456,57749,181039,14183,68447,151532,21107,36452,20551,3186,46247,46383,129666,88736,140662,146243,2066,8360,7978,64818,106963,17896,47801,10723,114821,223295,74192,3293,3393,16987,74064,11277,91622,4270,29828,27951,387869,103235,1374,61988,120083,477,145892,128378,11779,211263,61354,18221,17869,46530,83061,108538,157981,90608,67199,95080,49064,195814,12302,66307,10348,231346,160732,112859,63633,146558,21271,31037,198802,47622,12862,95710,3910,77850,73961,85585,34752,61e3,4082,24595,103679,71107,8208,79568,150019,16615,24961,139857,32664,197366,4559,54735,32696,4126,162019,75698,13916,70108,159638,19834,9349,24675,175560,49643,18206,52459,27992,10809,88865,401975,133172,29e3,34558,30915,3658,25834,42430,36562,125265,18182,10155,40149,97082,208980,19575,60853,90529,66545,9600,789,46420,2317,88593,55595,98980,115302,5742,169155,1073,177901,3472,11189,63711,78643,65472,50459,127979,93,42202,67053,21720,157650,11145,141378,42033,22824,85705,79114,35584,15974,1510,54172,28562,12451,104226,19190,97151,73024,20948,5151,81741,21499,29006,84183,198074,54003,45120,170125,26240,35177,28389,64863,79974,60778,176915,232183,45342,2038,80253,41564,40703,32689,5430,100689,5366,23007,134279,14266,26712,73993,24934,64242,52113,102887,61801,46415,201049,54251,62133,122757,164883,30815,139966,2319,30842,766,13362,10287,134518,86111,81665,82440,28333,43019,18963,8804,161944,23439,102144,101145,80029,39052,248708,30350,117340,11878,128467,974,138625,63961,5237,74778,61834,67040,43814,13690,65947,33809,232476,115258,181745,28824,94013,9510,10246,93722,81976,7217,114383,3493,16014,69045,72692,12145,80981,9507,6692,1620,60820,330444,35474,33962,4797,7053,295463,46445,27026,12491,77988,49524,35675,90947,29114,166705,101385,133782,32704,6186,84595,176031,185623,45966,151302,63069,1699,107491,947,15458,74452,196212,6046,10498,12163,10239,35191,243951,9277,9090,29539,54460,22820,26514,112549,60372,51753,48756,21812,70861,260326,41,44222,10441,16961,48148,138771,216194,5914,52153,53400,212036,56519,26245,10117,45888,15294,138019,90913,26368,43842,42111,23348,6082,194845,161089,156206,51546,11647,30759,302912,262094,8635,78876,26535,35283,54183,31183,85484,147873,12989,5197,6356,72894,65347,20150,27370,73787,1493,45918,12366,190217,20724,13858,10981,67449,81213,7553,14115,72242,271517,11842,48310,88743,143726,22177,3290,243231,58452,62937,12592,1654,40066,33477,13751,9921,128442,15868,7106,75236,83773,10775,36938,10482,170465,17368,17469,161508,32752,98340,800,19824,264456,3901,87319,2867,26782,9630,113102,185815,24197,44584,86366,40224,3636,140916,31731,267731,9567,53678,72984,29389,27963,17106,50282,284911,60170,8322,12608,23374,89652,5268,39044,229766,8869,151350,31436,177342,12269,183212,120418,116270,2843,78888,69192,7865,184099,1086,129897,18383,70508,20242,18508,229924,124569,35749,50589,55626,9884,83115,40971,30671,18135,14452,38861,17844,201826,5549,26413,17189,13561,38539,10679,143331,3314,36785,171194,49685,187713,67506,4618,104039,17060,195080,50648,33159,19238,67559,134840,28599,157523,17130,38064,117398,94355,31918,13575,34538,40326,13997,3494,348283,62481,26862,3603,104426,244363,153709,112487,304612,199674,41239,35545,54869,293005,28223,26277,26899,4533,18518,15492,38587,80488,70485,160395,263,60162,11382,222152,4696,250751,51921,182609,10707,48463,46243,1227,49111,111564,46502,33342,56846,68541,63559,858,139927,16654,229375,76759,26478,33205,95828,23399,92945,2637,35630,28470,143992,50214,14174,21456,166191,65665,1711,21594,78019,97599,111701,36,147151,110246,189022,43021,30397,40757,131935,42065,73335,48039,26596,28984,15102,2361,7421,202167,69744,43766,52826,3642,83304,33873,75140,63169,192389,36551,92748,13039,123959,233220,21738,84447,77230,20228,187852,19095,25799,92136,108774,29237,53947,2299,118106,2687,8830,42331,202924,33667,2023,73763,30704,19363,19779,16737,35629,48081,24068,101013,162338,291912,13749,24745,328289,167679,70086,48299,23306,16732,17801,43322,54589,3586,63653,43624,53474,925,109177,251316,43805,13082,19511,86565,142182,92461,17117,101033,103319,64589,4022,4351,235897,5352,82705,107142,46391,156084,5860,61365,10558,13045,7717,18357,33922,12590,33065,6928,46993,783,46937,67846,8952,26295,6107,119656,18799,17458,50747,4229,179559,112727,118080,20683,41464,125468,51560,49749,44231,7359,35339,62988,136487,67015,5208,29150,24956,105186,48858,6143,18097,6972,16404,73489,58742,97196,36357,164616,5834,32267,13746,147733,15113,132091,34127,106298,39729,106426,22294,9780,15602,36213,71502,42808,66802,599,60755,5851,39120,67363,108623,126368,72770,91263,32486,30596,151717,7951,52002,43103,11768,68942,40901,39344,24037,127500,116890,48403,16926,86750,17745,48648,159545,34460,58419,5634,114317,67865,31462,23352,24010,98185,125708,69686,68337,13610,26271,70691,2980,4768,27225,102402,75453,28106,8104,6931,1176,6274,6475,112635,22498,6176,238686,26832,28893,90319,14441,15682,15087,39517,45270,109134,104440,45965,47645,81772,7876,52683,87720,12898,4505,185665,2769,113401,15664,57592,105229,137381,97059,119268,6876,43309,33886,128363,35476,144249,67013,143587,83367,25703,91436,59347,53236,2289,16519,19844,46309,58558,99834,23313,218816,231303,36388,51333,183535,109792,139277,54306,90139,18235,8275,32710,37677,82464,86025,92204,88842,117723,37570,128723,234242,76350,73795,34896,148247,58424,11105,11744,45746,63372,17118,49772,199520,81902,38004,22911,33752,3125,1995,53792,4689,26909,108150,146062,69674,41811,161444,84855,8999,28561,16731,93937,3189,21967,24890,22943,1356,145300,51569,28802,517,118679,31703,40607,48098,108854,25003,10233,73969,177495,5248,24516,215347,146192,48712,60626,69188,40735,5866,586,101541,6509,47590,52129,5969,222045,110933,25733,24223,65339,62812,2414,155418,35819,16022,78423,43138,20995,128255,240673,46745,236093,72176,57085,97841,61248,107,36068,193177,105427,55726,215229,20446,47228,100420,87091,14429,121708,23605,21157,187721,21880,2997,203976,99166,95068,25877,7724,98925,83401,4829,13182,18229,13718,239662,38653,116505,153497,30589,89029,38962,181302,43853,78872,180301,4786,248240,7401,106136,112590,77745,19731,60880,77789,125748,135487,5975,48627,34084,12419,215770,47557,254582,10364,106495,21856,67539,88981,38805,21428,48732,42316,12149,16078,52808,25327,51322,33850,51147,12253,122354,46077,56483,254553,115417,81834,150991,94662,86668,7381,12841,100650,18218,15741,22372,68294,50705,15535,84660,61887,22553,72299,31361,24824,17743,46820,64288,31582,77006,111674,116384,30760,80920,86149,77192,51979,79691,60342,122805,103800,240873,160744,233114,78962,54920,8608,3484,316104,72548,24337,5088,230040,21926,10172,36838,26,86221,83458,102176,12062,17571,41929,41170,28428,68239,41750,103930,2634,18313,53019,34825,97837,63115,24606,73157,152474,14715,91439,37033,109806,140259,30668,174760,380,135597,95673,136073,65073,134249,13829,17279,122305,4420,46444,10237,64848,203623,70728,10349,182885,65075,24519,25783,40318,34139,22222,63394,55266,102764,41422,20126,65100,90408,53640,35128,48932,11192,38935,96839,34782,39492,19396,41332,6250,5511,19492,51304,25936,104466,54099,73771,86115,5080,7669,30891,111700,13931,25276,72289,135447,14820,258641,25265,31005,281179,75286,393,95359,14623,13584,6680,101227,80173,44933,76666,54542,13244,39348,458,25379,109451,134348,81143,6959,65554,12027,51311,8716,57589,140731,28467,23316,17272,30458,25980,55229,77197,83798,28302,114784,7428,34548,26241,14712,39336,103304,18928,54080,12870,334,87722,15208,16895,142098,114262,39820,83913,57817,28682,7721,14900,108672,11250,62246,42849,415188,1724,26555,24549,25505,26443,107450,145899,61035,43528,6901,60726,65906,267741,21338,147590,42079,18924,73017,135236,15393,5206,4026,84185,1531,5988,113890,82647,303391,7386,69844,71611,189865,76523,31877,13315,19314,198575,32821,1928,67641,25913,104475,103489,3297,70391,18406,15446,113347,19295,93790,27856,1792,167471,116449,8541,4408,41757,63233,25765,86680,64501,27034,24816,34975,6079,4486,49693,36229,16917,21581,62426,27862,11612,54284,35702,194034,355,24277,48262,87411,70504,310164,118018,12516,47559,43502,57433,107139,9290,66533,80863,14634,34312,91725,28606,21342,67241,72355,43244,375789,37402,174015,105070,8342,44167,67494,1890,16365,11723,271002,1865,47918,8350,45564,27742,25110,125803,8553,49504,81925,62211,4534,15491,19011,80373,206920,667,102405,128623,245524,5553,113309,192739,65766,19567,22832,261958,29679,21293,71134,20962,105123,24721,860,21752,33448,18372,157167,94822,35770,173224,232737,75729,28937,46828,28062,25453,5207,140366,36665,30652,6169,67920,150458,92040,23186,184604,92330,20891,176492,49427,27828,38305,42495,143982,49560,25503,90043,29747,65328,47830,12932,11068,77721,9003,25213,94205,140426,46090,89945,138173,192691,33329,112232,129905,35709,27514,1841,19957,31411,127476,53572,17497,173549,55063,175135,19841,69314,5192,237921,117660,150697,4060,273045,50414,98940,65348,153665,164423,58804,156695,48994,213928,86036,28608,8355,39574,34540,16927,135680,18374,151587,10830,53805,16878,16623,4282,48030,8537,14986,46102,13062,72897,72,33050,108227,39451,45935,651,113320,40535,95176,57450,48843,5003,19019,10407,211163,3848,1068,4988,32091,30095,41692,15099,43602,107434,50744,7627,171349,16313,150832,352665,207750,33937,38256,51091,156e3,87889,90663,84175,24908,114900,50365,31494,83829,5398,169342,47521,54818,18935,8356,43094,41212,174536,10082,92550,6678,60614,23355,69721,14796,34149,128830,58187,3179,208,40325,28399,225029,401412,51150,31580,207268,6657,10993,69818,64282,289845,23308,12961,38447,6681,52944,31855,2572,47646,120728,179148,37240,45196,218274,4816,3695,21961,50084,35209,18073,51452,27004,6100,33941,1377,84831,171214,85,141510,9078,99227,32610,6417,11718,49868,65579,87902,73018,49062,46280,61742,21512,40862,107733,15941,29168,157765,144919,14487,5767,158014,140070,7241,573,71584,16921,223566,40331,179473,35081,47926,140885,41508,52104,59180,42310,32811,29048,123517,102413,80208,10104,14746,12649,153641,126022,37965,113017,4171,83,142592,2809,6362,50416,71323,116894,260776,16204,1524,5760,30351,12658,20703,54403,36083,45408,74772,4946,14485,50759,111222,10890,2195,167147,92962,130534,16283,177256,35016,15472,210156,151187,73922,117691,43250,52051,37392,24811,24358,30830,5775,818,21969,1476,127322,151783,58392,31021,106913,65215,89407,90802,28531,11690,20234,95249,44602,37256,18707,11928,5161,4410,26571,51903,49768,22008,25252,65780,209499,68769,203726,13249,137363,48845,86823,6658,5674,31881,1083,1823,108676,34518,166752,13791,14287,91576,91429,8665,11529,26401,16191,91972,30964,5254,28486,54697,79613,66520,18447,22870,45203,194466,22822,51703,12278,76716,44595,73455,33546,12235,144843,36154,51247,11116,33040,3180,225753,60864,1972,28469,12891,28879,10338,144157,56294,353058,38302,41447,87532,110616,27065,168438,6557,1213,50804,144643,24817,2390,136531,38174,247513,16190,4059,122791,131994,137430,39506,57650,16305,5188,54309,106128,20628,88071,67394,395446,250285,66176,91254,1399,114196,43915,60230,44853,27206,106353,43013,18733,345105,226453,51202,16607,57106,117175,35492,10476,89598,127439,15187,39624,13688,61570,10615,31111,59370,6238,175252,32143,224492,41388,95408,34384,148238,78307,38959,9340,160091,61443,15737,11216,41244,170,38299,102443,113097,26382,14027,33707,3957,76300,66160,19431,18900,6952,1717,108656,82206,188021,257335,27295,43999,41210,31777,46956,57457,12657,11489,15697,48060,204748,53583,82422,284790,30503,137341,8120,19615,220311,15991,10217,63424,9808,67431,70976,98221,4491,15177,28535,144789,751,13230,2394,1504,33977,132104,30316,22230,931,97193,185240,24826,22687,174322,15307,22988,1390,188745,180325,29580,59068,74903,18994,29195,79,15436,7622,38462,11566,138710,44828,45774,37768,99236,68137,84083,19282,22698,17134,74807,126662,173497,46248,16938,119735,3212,28292,213652,49013,9975,32180,45660,86250,4801,68788,95490,77482,113751,11994,44624,94452,46839,128497,100316,5798,58588,73184,202987,65417,37790,88524,1606,43156,97964,105717,34947,11203,100060,37742,130074,93653,107799,94311,196106,41347,8035,10780,16390,27883,118236,167395,1979,25006,19375,31628,18916,144723,78502,114047,103107,86492,107686,5844,20934,206963,23556,22591,16562,146333,20167,10471,117434,33085,2863,9740,36669,41849,37271,22790,18209,28979,8231,12952,54408,21731,25130,45208,55748,138120,75826,414,29593,9925,292865,25999,683,123149,7036,92159,86055,61827,103680,23176,54918,58466,57578,13305,5709,86479,16697,31064,17660,200919,10770,49793,33423,32370,52047,16488,62555,6459,8426,83493,7763,59725,82812,18628,67760,79405,68557,9612,7673,28102,56517,69620,171797,32458,29541,15870,81109,32080,207644,71495,21202,11039,91036,61230,2810,130800,32260,4613,60590,37112,75214,33979,126402,155062,30642,63875,12810,194463,82799,47664,16725,36685,43367,61099,449,172150,102867,21691,301838,36745,7130,18671,57316,34852,38034,54182,35578,65900,99486,19771,3456,2658,16914,99866,28390,28109,8262,21147,34353,20006,4228,137085,1675,203023,283196,198286,214375,163329,290603,152574,40471,83506,30068,14730,23177,131539,34759,27668,32178,71896,104799,116305,85430,119262,42860,25160,8911,23428,49437,105322,6519,16203,6349,74711,1230,38045,8540,75165,44736,25909,51026,317034,4984,32281,91312,27060,44431,17817,45363,155937,239085,35697,59784,91993,29531,126740,213757,76560,167776,285273,24262,8237,65030,41160,74437,48804,118916,13159,37842,1031,75349,1478,11655,108777,23435,277425,101734,67469,70231,124711,43532,28514,65526,54956,1e3,21882,17728,25302,40952,52214,149632,1999,2111,3259,63362,89961,220561,39777,26335,9063,10572,12416,34551,34623,38604,24723,5947,15588,69927,66252,119177,69173,46629,28714,70715,212408,20521,406913,74380,11716,50659,50862,37009,88460,130101,7210,53853,538,65120,151950,55806,163748,52837,13153,21100,16674,64536,6091,138201,44837,58547,3723,163,2177,32288,85454,34033,8497,14282,25742,10535,10741,79559,117493,243787,49337,100718,79495,40139,42956,7551,55433,15421,31509,23034,45081,547,61176,53434,328001,8470,36263,30145,4519,74173,53935,11845,73774,60211,78025,3,4102,73782,109293,315332,48412,26683,13714,6865,20128,18490,104141,325,39470,171970,115860,15707,7268,73301,74336,31370,2368,111827,107757,136231,142844,97138,96638,84053,38691,23801,1588,10573,122098,77039,240,186135,146101,11996,18143,112963,46171,155836,348769,47795,121213,116266,132515,3344,144804,31286,99187,255838,129694,35894,48779,55235,148582,71967,65282,15174,13920,47080,6147,108242,157593,125025,7136,1286,28957,127956,28402,98813,20805,7532,109417,40610,5041,32958,15142,18408,108596,33543,50517,27748,80114,233434,91447,487,37094,100048,30541,43477,10639,89862,155868,37667,8726,60684,237903,73408,99589,12190,38739,97348,3914,13594,2680,149016,13907,30171,28343,23530,115225,61104,35821,147679,14337,4297,244282,24085,326976,56428,7851,21303,131620,71446,83253,68692,111870,5224,15813,38197,49026,45057,13660,3306,76345,40671,27905,91072,996,68527,62085,91351,122634,55109,168209,2024,27560,112707,17352,8306,167115,169921,166958,5031,46020,11844,67284,19130,76185,6920,32849,5450,14610,22451,21002,17392,31872,66682,84796,13709,40210,59898,12029,8719,53564,21462,91884,21647,88379,194428,12754,37797,132826,160016,22567,54383,53186,77611,31107,8339,4694,19185,90355,23597,17222,140675,28442,23668,55977,9128,61555,28774,155229,17658,9390,24379,69357,15752,127381,239631,62460,93181,55913,45133,140155,18676,25249,33164,29581,82837,67223,22362,29975,7317,52813,1943,29613,20012,207130,49617,49651,5636,15334,36313,29226,28084,95247,72072,19e3,224932,15811,114,32127,38097,37508,88507,37225,27359,91626,12193,69279,20608,11055,88156,92808,2152,57259,55275,72789,24475,104414,1708,9882,3818,48661,66897,1631,34806,227930,85815,87753,18321,250664,72733,25107,206797,50891,8082,196411,92596,96764,152823,65514,22819,387277,62176,51225,40329,15563,189,3659,73670,64357,51793,275136,33482,86653,74615,67058,11318,125720,15388,22388,8267,1730,102663,170910,40784,7144,85373,13040,7088,94309,583,44224,140424,77439,18496,164026,36578,4722,9151,5824,63365,26510,35199,40500,79277,32495,44614,35233,9566,203293,152144,7097,2330,183480,98629,13423,330887,44130,68600,30939,97829,31012,345465,56747,94879,4939,160027,149761,99423,46099,32251,15332,8761,96094,128555,5763,235318,222223,55729,30241,55420,201746,3987,81382,8259,49325,23287,7719,24633,251100,92311,18591,110533,64759,170260,393860,7175,21144,132887,3593,75346,101277,91109,16387,259187,11627,57459,173829,44694,55780,49797,89192,120443,62622,3904,14814,23887,1027,112258,64955,99800,11132,66353,36202,48624,18158,88481,96882,43059,11040,2455,7077,21651,181159,99126,100434,61388,68186,19161,110468,120052,8819,55324,41494,7014,37689,3618,87729,92615,207943,9823,128657,12587,15857,6379,67628,51216,71775,157617,63244,1503,3864,218754,110864,5769,21492,7243,1192,87921,85529,31512,18537,42698,35350,73510,84474,34301,8991,21013,35034,566,38832,19838,35586,37216,39413,55006,12178,59742,856,84563,6900,25632,17437,49786,30723,13847,70845,4044,7843,23944,235976,55530,48942,6518,20939,73769,192653,52936,95207,23895,132542,142982,22632,87452,48042,54018,178468,10728,26230,23559,363,81269,142012,5718,346258,31456,84333,246476,51018,66692,101804,120570,39962,30373,70593,2864,60541,19425,54209,104092,7201,31545,48018,25865,15442,46257,40443,8328,6451,111782,47527,97754,33046,470,245116,31095,39,91934,87208,73470,36708,36521,12801,70624,36272,8892,79768,12427,55454,103756,5908,52390,62962,22720,141138,94634,41689,128402,126390,6628,106394,35527,134394,82727,254651,194502,148064,89549,3202,28359,957,21954,27906,49840,142747,8307,24206,48978,1186,71728,133038,71474,91306,6333,110959,74600,70387,18983,62609,56057,22970,1147,135850,1321,28834,3578,59715,102227,32827,81415,99952,55636,257598,390,22702,35701,85872,402916,39216,189795,14929,19467,10112,144422,61514,5279,63421,134686,41436,8424,51925,10598,132295,124416,4604,194739,210929,57866,31829,51626,50007,9976,91878,61906,56168,81906,60918,61859,40017,23059,16887,40927,62064,12785,32893,32913,21782,93965,20169,44387,79084,38463,11457,93950,27127,157050,2697,337088,5116,54128,48255,33279,8821,27352,25515,124022,65710,28906,38557,33390,1722,104435,72215,38551,12094,30978,25113,6671,37355,175109,42862,98024,65406,221276,59624,118012,64637,78760,86697,21426,1639,40350,12584,67193,84144,31396,7863,143011,69629,63112,9454,28666,65798,46372,134721,6314,51402,30837,151922,2847,38676,38008,92823,136245,17540,5504,109295,205242,37606,5211,214892,1586,20670,208711,137743,19328,40652,16995,20023,14657,154919,34422,12996,13918,38221,47690,16398,2959,37680,89122,6721,198469,91876,172043,83898,101992,26084,94570,3635,76958,22853,76497,38266,176590,168403,44464,142840,79180,184594,1984,41806,83147,11985,6546,366068,59732,24533,271505,8736,39084,222992,93429,28962,58985,86665,8432,30028,14548,32439,54424,165029,55175,27458,69046,121277,46168,33732,20661,24581,135574,123110,37556,79260,72611,16957,12939,46162,58238,44907,72936,253758,41324,32518,96480,11949,124438,65280,43256,34107,53533,43531,37037,28366,45970,32741,173438,6121,194202,62969,26355,30314,58370,28455,1848,50519,82830,90393,21761,295490,10936,256940,133568,44050,20269,4089,27457,21610,219460,36743,14821,101388,52005,13124,30979,140816,167362,26054,18458,60789,34917,40447,26606,33422,9066,3452,83614,5761,20263,137238,25038,91310,101,52322,74548,42572,38084,214054,186568,31802,17665,30620,141936,37730,14420,4265,187218,49640,188208,51441,55388,96452,66659,40869,42039,60967,221027,19234,178581,29105,96050,9165,196118,157335,3738,40354,117436,2965,34136,59659,15570,50843,230035,31444,71260,43886,18316,5387,38500,168508,17406,32174,8828,103373,143806,90367,3560,18719,122310,16508,26719,2541,105429,6645,37998,73190,10591,235916,49737,87112,233941,53188,32193,79154,4544,52905,126477,7580,63501,57314,3216,31337,6541,103083,60846,49,9756,15481,1355,43840,14319,13743,27486,10222,73114,230718,418644,16706,6674,279748,23058,45273,295831,86306,2743,5535,88773,21829,35253,120938,31153,3169,16839,42847,8751,80974,33942,36867,35514,16485,26474,77775,56877,5391,48346,3882,108713,31403,27804,55248,26235,43821,136104,40118,175507,28034,203908,18732,1788,34030,106427,36958,54359,7251,44936,15356,69139,455,157915,22173,140291,50348,43275,82066,49621,54952,15216,36226,96695,66855,6936,1987,8227,196087,4631,68827,99004,47541,110265,17953,147605,110242,58520,31312,38724,329975,642,3155,34497,75937,6207,73843,6120,17249,51429,117746,3218,910,68961,319671,14938,29555,34700,1649,66673,72268,9655,76800,153087,6941,210168,27130,35398,1780,73242,3135,56689,19556,165307,8765,35967,121458,13333,70453,17350,117253,22265,13340,44265,39869,441,3742,135025,23581,33309,16543,17731,13291,157637,283005,21408,101360,63887,52312,83873,5338,233779,23759,186949,34531,177320,38069,156465,91004,19353,59852,68160,14891,1338,1072,29823,1950,28901,81407,313445,73038,84807,162348,240257,37162,138934,16111,58013,41253,102951,16457,96056,19541,56402,67217,41638,94381,89674,29481,37456,80815,151579,13937,13683,132537,19699,134545,67020,29816,222341,141235,427578,48868,129557,233342,23077,87871,16213,18728,16184,9469,37913,19680,2798,171356,178328,13216,50049,72690,71904,124644,55455,7504,29052,41036,266546,19899,30391,188755,8659,59469,16,104298,112943,53865,76203,138226,68857,139953,14125,107625,119795,173133,4398,50273,48808,54390,16466,122086,31835,67035,50971,48859,7508,46427,66477,73021,84615,39985,83076,46779,201569,53336,36443,60865,168164,143810,51393,25548,169307,32896,24485,38424,21837,29087,275813,51674,6714,64883,46169,187369,55186,76192,12852,12018,62134,31067,118303,16542,12125,10579,4928,26291,43854,7091,10946,253716,109062,39283,17261,113012,258512,47764,125126,32646,55892,80279,201623,149872,3192,385,1208,48750,5376,58738,22335,5427,82416,47811,32435,143086,38930,94128,59975,156037,37977,38224,62485,7698,50405,71027,16462,21559,136153,34131,107506,162069,63703,3101,215029,40407,4178,3774,9187,80019,17880,97926,67579,2600,18405,8351,47924,86638,70820,92206,86453,29610,42241,119200,3198,15466,67813,57863,35454,4779,99518,4649,104641,144269,33730,38073,65864,6838,109456,193298,154007,5623,45741,30846,182578,25573,157224,1543,58575,138703,146140,44971,49356,18275,59064,20300,13122,11848,24453,11973,9797,86843,2919,25530,49210,1130,161220,76788,75373,85604,34926,36014,17777,17255,51533,11676,92226,51845,119859,21525,5936,18507,28050,1140,31418,14857,34207,47859,10750,36382,32079,106909,59426,87757,38393,110042,15965,97104,33757,35344,97993,53979,33651,45407,41884,82515,173089,7177,58371,35365,47543,51927,35587,10670,23544,29306,84233,39976,76076,62097,9007,8668,28119,78281,120790,19835,143020,54968,18670,64959,20649,34469,42570,33001,136570,87796,120044,1106,58700,63951,127623,12805,83057,40212,31773,49850,7361,54336,347524,101314,23751,19569,48791,29174,49369,20467,7465,75842,38281,623,112457,60210,28849,51003,94720,6426,90047,85560,43761,3579,85105,34607,90410,118528,7224,42907,111163,18168,6960,161135,191298,5247,100584,127552,171568,20121,91173,12636,54615,20199,63730,98105,2396,40387,14438,125012,4765,33235,12865,45299,37728,82098,77872,114037,59253,19675,24838,398016,102561,11446,17069,57508,178277,65836,99941,26114,2585,271882,136866,50126,11027,155648,118367,14585,8910,123015,335383,40434,41016,53021,14439,87098,176860,201543,121888,2358,9286,5739,22666,54270,37884,169381,33984,93859,16124,89364,72207,51639,76366,99029,65812,2198,12147,174891,194289,6986,30252,88822,21284,11445,288337,160821,33034,100869,43852,25761,52882,1144,103809,1924,84458,86079,43411,13542,139276,18141,34978,41298,7276,26481,173800,33210,17951,142652,33616,33677,2210,19941,98568,2486,192414,80136,12058,235883,50963,249638,29572,27221,47034,6124,72107,63346,97620,158513,299699,40388,23235,37176,224244,198386,121323,67992,23827,63170,17838,106622,158590,26807,5345,23489,91891,55474,74834,37981,13058,5977,72552,34706,26828,145172,19904,21367,34043,960,77092,91381,4733,47446,7680,41697,5170,16960,14741,46101,13656,473,51842,37433,11103,11551,121951,13191,97536,165932,50397,51628,129028,9069,44885,6590,59195,47045,32940,225472,90345,21833,13303,29407,96615,141951,5198,6028,18395,7181,3861,14966,156358,167182,36529,55253,25942,173153,30959,27261,50691,150176,162201,38467,48462,80602,42163,118482,168,108756,26011,17166,54149,456538,22512,91374,13816,90358,131615,18132,226707,1824,28139,26860,42253,93877,77351,65575,8980,80574,22020,27948,40422,91324,76376,13528,39281,91685,82215,122541,144066,1983,193851,17283,26320,2739,194978,4790,26845,42627,61300,65815,174612,55133,4200,191130,79771,158321,52280,166796,221620,62461,11278,4067,88152,83409,31717,121367,13522,47325,37945,10406,174348,249321,154101,64912,29938,51775,17220,15776,166138,78890,84425,54121,42861,16368,24572,291647,10197,32073,22651,11677,97509,26952,35787,18424,41910,71614,94977,72318,41594,70024,275419,37702,60199,7335,39107,61315,18271,18394,33768,87884,104277,123724,7277,56288,71981,189803,49320,3352,6798,14240,8954,69220,94433,57372,28620,68863,193727,85575,42309,41667,67689,42081,22543,44824,12719,28540,114236,101553,27638,27296,4300,5353,4663,19379,94098,3758,95888,95144,80344,87320,28447,259518,12718,71391,152731,37063,24132,31911,104896,15672,103782,1521,4945,72541,23717,122632,15619,87175,206120,29428,189780,61416,28350,44457,972,1175,47233,198738,95789,41907,21953,97034,59341,22864,53713,16873,32971,20693,20954,31336,21477,16169,38370,16412,9019,3841,24599,21938,17085,6484,81198,76413,5849,72514,12320,65247,276175,37234,59796,52642,16312,57349,198507,94148,46134,18958,125552,1747,18725,151873,14901,5490,68287,29470,3689,64794,40814,26018,25692,54450,2703,88278,124886,173087,174e3,24159,179477,24276,46004,201876,209202,445,52876,31948,30206,157610,39180,18439,44124,50469,5774,96278,222758,200216,50290,45486,20435,46986,46276,140133,142326,15569,13363,47522,92583,2182,7135,16853,22998,30272,4952,63263,35623,39096,53789,44864,20053,110392,124213,4630,16087,28221,127787,25839,77481,44693,13464,113146,6983,27069,55717,50102,4760,7107,26186,66507,59145,36032,104182,71328,29425,64317,50781,47465,94298,69706,74899,22754,120756,25108,93077,56834,73286,39928,16218,41699,176763,7555,70819,50083,26895,23315,26014,16773,123079,41712,5719,31516,90427,158540,85051,183128,40864,27505,55392,9058,45224,96857,30901,136622,96557,56304,120061,11501,151448,5773,89743,7769,86069,2935,18471,41628,10114,33660,110170,49479,26745,92846,33221,26731,18795,87076,8550,2100,29972,120289,3077,72490,33784,2630,208722,50861,63483,79029,6419,39467,14302,45286,64207,9686,67513,44170,1050,77246,59266,17055,53801,7150,11111,42432,4278,94579,362117,36175,42902,41933,39002,98489,22913,74161,84773,57036,17556,162288,74485,178760,93867,73635,128860,50362,261,67455,80001,46080,35662,4368,25247,19230,74393,22588,1822,27682,235324,13798,85998,13194,235067,23514,71669,147632,23191,134748,214683,105101,1518,25489,247114,7380,54842,26922,3971,26361,20844,68642,170517,77339,123255,8963,77818,150998,48466,36806,2732,23261,11741,236162,18243,126216,28690,50546,16385,92760,197383,246558,201295,88255,67588,71687,176076,172653,169058,33906,63747,24835,157621,43338,30050,46152,132741,2770,51371,94835,6614,15112,11749,56936,1250,19027,399017,58036,100215,23388,55815,308768,124152,94803,9521,64186,8971,28,30427,62163,7616,103838,35079,29203,131235,7743,17389,10882,37420,61460,228512,85363,41581,131077,62822,119647,10130,54445,26925,19968,29016,24446,74028,24176,61448,67185,9254,8563,119129,9771,99184,37716,39514,10532,221512,258753,218630,55980,23394,32141,61924,66749,32411,3741,36475,26678,77010,44946,91203,128749,116953,20476,49625,53116,13735,102335,29376,51946,83407,67892,59212,34685,21083,1546,112982,32972,74397,1078,190545,16082,86140,58591,89611,101531,10061,105104,76319,20035,17551,52611,169061,190842,100780,23907,90413,115619,9675,34710,193435,49443,129734,11183,258877,16318,136182,126808,44635,27304,192375,2599,125648,47051,12091,23814,721,58800,40137,66726,97930,60877,74487,7942,54326,9841,41428,13762,8211,85383,6950,99177,79806,201786,296464,124087,13144,29741,41721,47634,55088,254286,106408,17041,99064,12942,64086,45233,14005,2612,55827,255,7984,13980,38574,12776,46654,73499,249951,2101,26676,25996,132326,116415,119062,50449,31033,23038,11589,179252,20007,14860,129270,21143,17796,144715,60106,70758,69842,34674,282133,44014,16774,57268,38528,24053,46373,201667,28327,471023,51889,102667,21193,114909,84132,69317,96723,67969,16134,68145,15058,28765,32035,2524,101089,98664,25045,76571,14957,86040,118506,262428,154764,81573,39681,283900,73287,127825,544,80448,52347,38512,175971,15180,45467,33086,46552,48894,81107,43213,36672,54025,76703,8053,7608,13299,56619,20752,238099,54164,105133,1444,32942,953,37564,8e3,66316,119463,106817,404,13667,149108,128597,31267,10269,49836,106150,1484,52330,76965,160486,171648,38456,31263,22424,37738,66245,67467,143369,60471,75610,20895,115528,86070,60854,40796,49347,18989,15030,11371,37578,15779,79867,10187,86462,46402,155626,93200,40229,7090,57547,108053,99598,11088,47505,41218,206017,2173,20988,30219,22919,80563,57566,42369,93141,41675,2407,182519,120495,27154,16702,29456,14349,7958,16688,117177,140375,42467,261919,74916,153569,10836,34742,49526,7621,105997,12212,2270,392377,7755,17959,25086,232152,138791,33847,13860,35316,5811,1344,71259,50452,207539,92635,50359,5821,33674,30255,2086,2587,96264,17543,42,6029,9580,43007,139248,82831,12917,29607,25786,51467,42137,85161,100698,31561,88989,121990,278500,3602,109344,37982,15279,116442,28936,30880,87894,58079,128661,126731,67392,28051,146885,4861,16216,97344,42827,147561,153948,22684,21335,47685,1853,43349,15185,59642,10229,25520,187921,108972,5579,98037,24945,6697,19193,63734,137934,75056,89740,19767,224268,56138,63643,151661,39313,70618,84031,89723,84074,13703,85626,35460,8867,64845,3439,57906,99776,63968,49270,81130,34356,16210,23547,36446,34090,140028,72439,2221,22163,57058,363492,113754,18913,95451,48663,54464,54037,176097,68425,3023,34906,29482,117389,341780,80431,58330,16753,92616,60907,94846,147486,4498,48646,7773,46801,7778,18946,464978,47558,33223,177444,7328,15626,63337,94700,11743,9351,255024,39098,16447,42647,96230,39769,58840,10068,63439,35800,65843,58823,413844,9156,51258,7434,61791,85018,6872,3692,28096,7121,33024,6009,75532,31997,192535,9661,3304,9547,14753,31987,25314,55689,15896,20430,39472,31340,99744,25398,115569,54883,28719,205423,23071,57855,64638,149867,25671,82403,37616,20668,39989,77996,74948,140555,175248,64810,36515,46595,4958,248773,24045,28728,136673,168704,20804,114833,100325,27135,21205,96151,153134,45992,7093,13992,76047,1980,19432,145001,75159,87462,17710,1013,45556,34297,144882,20648,26061,11319,129567,108555,18872,464580,33386,22717,65948,167189,5603,135042,79542,8801,202632,18114,91882,5973,5239,67315,4431,60916,47819,71693,32597,32606,18183,45072,80329,76385,24749,51305,40314,156514,14693,130345,13168,66214,18029,12858,34801,27628,14544,10823,40522,40185,33739,148694,23548,9923,61012,28859,17933,19442,34364,99849,164107,141167,30629,21054,6744,36491,8096,42474,41706,155060,30650,10600,163442,1143,96655,61390,52359,7559,51568,64256,203854,4467,22453,14504,436398,7878,6980,8293,63610,293747,16167,35763,19627,147603,15419,18032,110744,51346,33681,54571,40472,48615,39073,21604,13754,173027,92560,11083,47299,63062,11813,52007,29883,9734,139722,15953,1550,20651,13616,49306,16113,90089,92326,7584,30712,72424,164858,6831,152871,55746,197721,34167,196442,6022,112107,55215,7538,123381,4920,43539,77165,8939,50392,34192,20225,79762,22505,58667,40770,29788,97180,82835,4568,8579,13273,363569,35898,49983,436,36598,3237,131691,62418,35591,8101,4073,379438,65218,76072,33887,2968,27573,212619,288680,68278,72851,150504,217896,6913,121339,22017,35340,51072,43616,75043,31437,10833,81487,4364,22968,41454,106687,85446,19863,109625,149241,524,141850,214404,54376,657,237023,9401,108137,53800,32474,49712,53334,126876,27337,45552,177696,8269,15036,12097,42240,2328,125374,119295,99715,2500,19624,39441,27220,102691,60957,94543,39101,18566,67362,13975,78230,25017,34017,239007,90027,39351,41681,35354,43822,1043,916,58587,141983,94818,38799,75459,41114,67432,16195,36606,59568,22272,126769,31424,68659,12287,134302,257977,5756,207285,95637,47248,117689,19583,77451,22373,12200,54993,117118,34244,29386,34562,53819,71267,64172,77665,49368,7716,59301,25749,45426,194789,17297,2650,1766,32501,45198,20403,20984,6600,14171,94604,19037,5402,29896,9938,59935,109708,88081,145182,44844,39167,352626,164173,35374,45982,6122,154,73419,220487,53834,53601,17992,8609,229321,5610,68098,66815,71012,95069,140968,27396,8957,134489,24656,86659,56598,134852,17316,123838,255436,6613,41610,138033,81452,32023,32396,123687,63398,8693,29712,30407,19296,121188,3551,36099,20032,111948,56624,16547,27453,35916,15378,52039,56849,13489,22214,73177,53097,277349,2157,14029,187886,10260,141743,246460,91880,50869,3788,49486,133566,54950,33120,129337,53768,18333,9525,26902,312251,10297,9020,70759,16647,112432,59260,84609,9818,82766,73569,468,46001,75780,55028,52106,11498,43645,108069,17150,17753,29417,16705,31799,9606,289,122254,115975,8620,6133,255357,56908,14456,133464,43554,79224,11247,29630,160,12756,25464,65960,350428,62521,321796,100359,67358,35169,46172,113128,48988,88868,31094,33266,6847,60887,98188,49659,69117,92977,220228,13947,80181,35103,62170,97351,13475,2440,199768,19498,36597,46971,25234,67806,62881,84717,73648,181966,10488,94149,21550,26655,63436,48375,14405,165650,9621,24439,28043,42735,4490,29963,56674,45373,1934,262446,50855,67098,26898,5261,52696,40644,33900,9440,180286,87162,22940,19704,26936,69769,10254,101759,27406,12243,48e3,73926,113215,54935,5726,192787,4312,106216,9366,11550,52949,23457,212271,277152,133895,108374,6191,96477,29980,218916,58024,54696,40853,91124,65894,91170,65908,252552,6793,29212,15389,44516,122515,52617,35058,9017,103536,39510,49136,19242,130652,662077,74699,47024,31422,8517,73351,24399,13867,128360,4810,4434,61779,111983,61036,17798,110240,59722,102960,39688,10001,23803,23039,176498,56659,44814,134295,17188,77577,74466,226175,102472,154333,63900,111747,18062,41171,79669,32773,408933,42562,28931,30907,107388,43487,2946,240310,23938,24354,319,184983,7927,6488,1422,10790,68809,68209,64775,4361,202,17123,59634,51200,44391,18188,17843,2619,74278,3230,9540,47187,21702,36274,56894,43907,16310,34790,16866,6150,5561,13587,107545,108873,126867,86986,28640,33427,19017,5762,80637,17430,46903,2047,131055,25958,13558,5444,47152,13900,44563,122857,45348,70863,39593,54332,38068,33637,318,40310,143467,18502,24520,11377,62013,28942,27246,28269,83545,17999,59015,90707,30065,15161,34720,1263,37008,2012,6060,98575,92933,5721,299,199555,24578,29223,2985,743,115825,109523,136657,47454,26378,53586,3733,174945,93340,244456,5693,37386,28782,89767,27545,23573,18798,136425,34320,84778,20041,48453,38215,7477,71958,40621,8773,5874,187927,105965,51100,43533,18083,8443,10180,43597,2003,183999,69689,12216,129696,146188,62389,34044,68410,12765,43273,26949,266807,3345,34477,79197,5688,47539,213110,21634,22257,50092,32222,42346,39530,63668,98,134978,74022,5152,59088,174145,37220,9934,9545,118937,5724,87240,19875,15784,40143,23263,87513,181654,285152,37881,263241,4966,43934,10433,186657,6470,74416,225854,25908,142677,246262,32280,6192,75890,45546,143264,135305,29742,47013,77787,11732,126658,8763,37950,21806,57557,113464,89465,108995,164574,23894,22996,23169,15369,23117,17642,130607,40503,36239,280990,44666,9981,40427,147487,26869,168452,32886,32991,46798,240839,15111,70502,65697,88548,44145,28701,48767,31139,206777,35659,181164,166262,14554,171445,31786,66523,76607,17956,6507,31279,90476,116611,167918,6560,1243,115324,80128,41867,55897,187323,37069,32596,189444,145931,13390,105530,65709,26805,6999,55714,41300,22915,68951,22138,21120,22264,10058,19945,33635,56123,99085,10032,5818,6016,46649,57476,35264,94413,112522,262288,93686,83038,14341,23204,28807,66084,77987,6101,126673,7133,38126,5923,122091,170240,97772,46874,215746,43948,41622,3272,55596,8332,146411,251315,13533,8561,81521,115449,48616,175175,2063,186556,3036,134537,75772,29728,82360,22973,186559,86348,89100,38388,82297,45610,2613,87082,9986,177812,57884,23591,47485,42543,33582,44713,74439,257444,252451,31825,35631,38540,33066,5147,13973,4343,51830,70378,22827,26448,95560,36896,241741,48067,203953,298860,61620,20450,3220,67272,6586,107662,100160,108684,6929,57226,4762,7457,1320,40404,77204,99309,62750,208653,59977,44e3,74315,34332,5819,172217,64904,114077,18147,84012,1791,98456,90930,21446,116669,103938,7422,85140,59713,5768,326211,16239,75411,13229,29398,10758,236107,1539,112472,95979,152154,151294,306,21196,38146,10700,6891,84282,109646,56492,40539,6589,119491,51354,30685,140209,136906,29622,73617,49553,70525,51671,166869,139616,74395,37439,49595,45678,11959,33211,86560,52434,9282,62690,112155,130810,5243,108261,99970,265613,72551,80049,6391,33365,90721,66737,69872,87011,1860,9032,112544,60905,37371,89015,140351,19076,850,373531,2802,36725,218795,72062,28990,16550,24614,7815,6187,26336,33373,32162,42791,73555,32062,23386,10244,56392,49442,27076,136262,12412,14883,1134,33675,97153,199281,15608,100152,74072,47942,254301,36451,16026,10687,65067,56708,254030,30290,50490,13864,57941,259331,35588,23485,43486,24869,21620,92971,22072,88645,1048,182050,13343,32452,14825,19509,3325,216938,45740,99716,189082,53740,78245,25609,24311,176777,47340,308354,40669,66085,14102,125339,9225,128709,97207,1271,200933,78439,113451,88975,18324,46521,11819,18570,141756,72512,170020,52754,63550,118515,103073,93330,32736,50499,14722,31600,68452,398867,29316,172786,18417,104924,2606,5670,84818,16288,67106,59580,82929,607401,291,85829,359,15897,35830,50696,65630,52672,22115,356968,29895,40837,231192,34024,38957,26722,406,23335,124952,72068,68804,13268,147101,164740,276569,162596,66943,11569,26654,66358,4777,23229,102127,5848,978,2921,59666,5371,28212,90108,42938,39320,2499,4271,108792,33510,125072,71653,65239,38250,66357,38577,13964,86251,35708,50755,36010,29448,12209,3844,38222,206337,100876,67827,137088,14167,252225,84163,195270,1306,5703,54198,779,46802,22028,51124,86759,70560,113164,35685,162145,45471,34561,422,2611,6464,47486,19223,38246,9191,18331,89942,243642,212364,15893,17518,22617,6409,30046,126182,59716,36560,104428,18846,26592,19458,50793,147333,30826,1388,27647,10922,14495,33545,19269,135828,39727,41601,46931,233379,49169,131130,182112,16276,82381,118209,142445,128310,19672,28740,82907,33436,3118,102206,28723,24819,41937,38854,5157,3881,111491,1142,9776,421673,152241,29309,14961,87854,6054,15424,3796,82656,54996,2108,55367,239450,154525,9643,118103,106041,64601,68549,48707,30266,25772,18740,9462,229669,91798,112152,191327,14493,72828,8175,66636,236474,25817,87351,129027,76653,20422,22983,71240,27846,44661,12399,46158,77704,53101,35032,11072,17300,109294,33638,24408,1895,11241,760,17584,82479,125877,63150,141075,34259,23274,81698,15732,43577,48340,91584,14688,16379,24481,150280,96420,262050,48635,43727,61819,56268,72003,88178,17281,79912,13218,122519,125295,166396,11811,2171,118930,67746,17636,178278,174656,95661,173039,83845,79689,17473,98555,127696,203415,54730,22925,232239,9309,12136,175026,20740,180188,10747,39816,314017,266131,10040,175732,112550,220651,31974,37393,888,23008,86799,4303,64905,148467,75337,251,3284,370102,50264,9835,5438,23655,4481,29851,329,12855,7162,64931,78141,12804,42372,296771,83547,18624,34874,86271,3360,48665,77735,88767,11463,63527,28889,22258,29140,194315,113924,25499,6406,31334,1845,4802,49184,43455,35469,127594,92970,61038,115005,38840,87761,106838,8811,20572,55637,11162,96721,132425,108925,2948,125457,36356,3502,75270,27622,127192,2561,123095,49394,61155,16897,110064,9699,89448,53356,19628,220310,21622,83036,9885,112214,6087,26713,17901,161912,91492,3440,68594,9266,92238,8087,6866,150194,72175,80701,13459,31836,43243,239700,95846,44749,50647,21945,230538,120612,132371,244604,5193,105637,34661,41341,68775,85393,1874,8771,33718,49672,77403,595452,99507,6490,58895,128742,7704,39239,73217,43816,62824,37804,199976,22361,80005,87514,94832,14089,4574,139975,59142,75523,100268,43906,53442,15152,2547,186002,17011,19513,204282,3343,60568,128318,119250,4298,51871,41336,71759,21921,45074,98169,145889,99427,11350,1237,5520,28799,7803,53702,21026,136352,38293,128690,12158,90132,44600,10184,26957,39459,126025,78904,82999,59373,39301,150198,120529,153042,20177,50089,14764,271571,30530,123161,38975,101562,22941,5648,124654,109243,69817,71675,49162,106884,21241,107795,30258,16572,188262,141456,7688,60718,8271,11044,32440,104608,103419,236109,93156,43293,128929,42107,67180,25201,115254,185488,130954,72813,167547,20537,39969,38432,22582,184022,1139,27199,5655,17767,97412,122606,209377,27070,35871,326617,188954,42680,73512,80911,22629,3011,95021,315242,157737,383,41821,41808,19335,27950,15674,25677,110950,35375,76835,59108,57370,35262,16569,160415,37706,78086,32041,49691,137143,9782,172080,50148,77917,6323,10110,69172,17711,21795,59511,76184,135114,31046,132319,59105,157578,20549,80778,57649,158421,65143,4575,72235,21899,10797,92745,34035,106079,80159,4508,78304,25350,75457,46458,32937,25623,47,8531,104751,84953,8138,36508,187199,66310,115274,13253,32461,38536,1916,42007,187160,35055,26325,84394,35963,94216,45590,97782],Yl=15;class EO{constructor(e,t){h(this,"log");h(this,"peerRouting");h(this,"routingTable");h(this,"refreshInterval");h(this,"refreshQueryTimeout");h(this,"commonPrefixLengthRefreshedAt");h(this,"refreshTimeoutId");const{peerRouting:n,routingTable:i,refreshInterval:s,refreshQueryTimeout:o,logPrefix:a}=t;this.log=e.logger.forComponent(`${a}:routing-table:refresh`),this.peerRouting=n,this.routingTable=i,this.refreshInterval=s??tN,this.refreshQueryTimeout=o??rN,this.commonPrefixLengthRefreshedAt=[],this.refreshTable=this.refreshTable.bind(this)}async afterStart(){this.log(`refreshing routing table every ${this.refreshInterval}ms`),this.refreshTable(!0)}async stop(){this.refreshTimeoutId!=null&&clearTimeout(this.refreshTimeoutId)}refreshTable(e=!1,t){this.log("refreshing routing table");const n=this._maxCommonPrefix(),i=this._getTrackedCommonPrefixLengthsForRefresh(n);this.log(`max common prefix length ${n}`),this.log(`tracked CPLs [ ${i.map(s=>s.toISOString()).join(", ")} ]`),Promise.all(i.map(async(s,o)=>{try{if(await this._refreshCommonPrefixLength(o,s,e,t),this._numPeersForCpl(n)===0){const a=Math.min(2*(o+1),i.length-1);for(let c=o+1;c<a+1;c++)try{await this._refreshCommonPrefixLength(c,s,e,t)}catch(l){this.log.error(l)}}}catch(a){this.log.error(a)}})).catch(s=>{this.log.error(s)}).then(()=>{this.refreshTimeoutId=setTimeout(this.refreshTable,this.refreshInterval),this.refreshTimeoutId.unref!=null&&this.refreshTimeoutId.unref()}).catch(s=>{this.log.error(s)})}async _refreshCommonPrefixLength(e,t,n,i){if(!n&&t.getTime()>Date.now()-this.refreshInterval){this.log("not running refresh for cpl %s as time since last refresh not above interval",e);return}const s=this._generateRandomPeerId(e);this.log("starting refreshing cpl %s with key %p (routing table size was %s)",e,s,this.routingTable.size);const o=Fr([i==null?void 0:i.signal,AbortSignal.timeout(this.refreshQueryTimeout)]);try{const a=await ow(this.peerRouting.getClosestPeers(s.toMultihash().bytes,{signal:o}));this.log(`found ${a} peers that were close to imaginary peer %p`,s),this.log("finished refreshing cpl %s with key %p (routing table size is now %s)",e,s,this.routingTable.size)}finally{o.clear()}}_getTrackedCommonPrefixLengthsForRefresh(e){e>Yl&&(e=Yl);const t=[];for(let n=0;n<=e;n++)t[n]=this.commonPrefixLengthRefreshedAt[n]??new Date;return t}_generateRandomPeerId(e){if(this.routingTable.kb==null)throw new Error("Routing table not started");if(this.routingTable.kb.localPeer==null)throw new Error("Local peer not set");const t=ol(2),n=(t[1]<<8)+t[0],i=this._makePeerId(this.routingTable.kb.localPeer.kadId,n,e),s=$r(i);return bn(s)}_makePeerId(e,t,n){if(n>Yl)throw new Error(`Cannot generate peer ID for common prefix length greater than ${Yl}`);const o=new DataView(e.buffer,e.byteOffset,e.byteLength).getUint16(0,!1)^32768>>n,a=65535<<16-(n+1),c=o&a|t&~a,l=SO[c],u=new ArrayBuffer(34),f=new DataView(u,0,u.byteLength);return f.setUint8(0,wi.code),f.setUint8(1,32),f.setUint32(2,l,!1),new Uint8Array(f.buffer,f.byteOffset,f.byteLength)}_maxCommonPrefix(){let e=0;for(const t of this._prefixLengths())t>e&&(e=t);return e}_numPeersForCpl(e){let t=0;for(const n of this._prefixLengths())n===e&&t++;return t}*_prefixLengths(){var e;if(((e=this.routingTable.kb)==null?void 0:e.localPeer)!=null)for(const{kadId:t}of this.routingTable.kb.toIterable()){const n=$o(this.routingTable.kb.localPeer.kadId,t);let i=0;for(const s of n)if(s===0)i++;else break;yield i}}}class xO{constructor(e,t){h(this,"peerId");h(this,"providers");h(this,"peerStore");h(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:add-provider`),this.peerId=e.peerId,this.providers=t.providers,this.peerStore=e.peerStore}async handle(e,t){if(t.key==null||t.key.length===0)throw new We("Missing key");let n;try{n=it.decode(t.key)}catch{throw new We("Invalid CID")}(t.providers==null||t.providers.length===0)&&this.log.error("no providers found in message"),this.log("%p asked us, %p to store provider record for for %c",e,this.peerId,n),await Promise.all(t.providers.map(async i=>{const s=$r(i.id),o=bn(s),a=i.multiaddrs.map(c=>Ze(c));if(!e.equals(o)){this.log("invalid provider peer %p from %p",i.id,e);return}if(i.multiaddrs.length<1){this.log("no valid addresses for provider %p. Ignore",e);return}this.log.trace("received provider %p for %s (addrs %s)",e,n,a),await this.providers.addProvider(n,o),await this.peerStore.merge(o,{multiaddrs:a})}))}}class AO{constructor(e,t){h(this,"peerRouting");h(this,"peerInfoMapper");h(this,"peerId");h(this,"addressManager");h(this,"log");const{peerRouting:n,logPrefix:i}=t;this.log=e.logger.forComponent(`${i}:rpc:handlers:find-node`),this.peerId=e.peerId,this.addressManager=e.addressManager,this.peerRouting=n,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){this.log("incoming request from %p for peers close to %b",e,t.key);try{if(t.key==null)throw new We("Invalid FIND_NODE message received - key was missing");const n=await this.peerRouting.getClosestPeersOffline(t.key,{exclude:[e,this.peerId]});pt(this.peerId.toMultihash().bytes,t.key)&&n.push({id:this.peerId,multiaddrs:this.addressManager.getAddresses().map(s=>s.decapsulateCode(dr("p2p").code))});const i={type:vt.FIND_NODE,clusterLevel:t.clusterLevel,closer:n.map(this.peerInfoMapper).filter(({multiaddrs:s})=>s.length).map(s=>({id:s.id.toMultihash().bytes,multiaddrs:s.multiaddrs.map(o=>o.bytes)})),providers:[]};return i.closer.length===0?this.log("could not find any peers closer to %b for %p",t.key,e):this.log("found %d peers close to %b for %p",i.closer.length,t.key,e),i}catch(n){throw this.log("error during finding peers closer to %b for %p - %e",t.key,e,n),n}}}function _O(r){return r[Symbol.asyncIterator]!=null}function b1(r){if(_O(r))return(async()=>{const t=[];for await(const n of r)t.push(n);return t})();const e=[];for(const t of r)e.push(t);return e}class IO{constructor(e,t){h(this,"peerId");h(this,"peerRouting");h(this,"providers");h(this,"peerStore");h(this,"peerInfoMapper");h(this,"log");const{peerRouting:n,providers:i,logPrefix:s}=t;this.log=e.logger.forComponent(`${s}:rpc:handlers:get-providers`),this.peerId=e.peerId,this.peerStore=e.peerStore,this.peerRouting=n,this.providers=i,this.peerInfoMapper=t.peerInfoMapper}async handle(e,t){if(t.key==null)throw new We("Invalid GET_PROVIDERS message received - key was missing");let n;try{n=it.decode(t.key)}catch{throw new We("Invalid CID")}this.log("%p asking for providers for %s",e,n);const[i,s]=await Promise.all([b1(P4(await this.providers.getProviders(n),async a=>{const c=await this.peerStore.get(a);return{id:c.id,multiaddrs:c.addresses.map(({multiaddr:u})=>u)}})),this.peerRouting.getClosestPeersOffline(t.key)]),o={type:vt.GET_PROVIDERS,key:t.key,clusterLevel:t.clusterLevel,closer:s.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)})),providers:i.map(this.peerInfoMapper).filter(({id:a,multiaddrs:c})=>c.length>0).map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))};return this.log("got %s providers %s closerPeers",o.providers.length,o.closer.length),o}async _getAddresses(e){return[]}}class CO{constructor(e,t){h(this,"peerStore");h(this,"datastore");h(this,"peerRouting");h(this,"log");h(this,"datastorePrefix");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:get-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.peerStore=e.peerStore,this.datastore=e.datastore,this.peerRouting=t.peerRouting}async handle(e,t){const n=t.key;if(this.log("%p asked for key %b",e,n),n==null||n.length===0)throw new We("Invalid key");const i={type:vt.GET_VALUE,key:n,clusterLevel:t.clusterLevel,closer:[],providers:[]};if(SN(n)){this.log("is public key");const a=EN(n);let c;try{const l=await this.peerStore.get(a);if(l.id.publicKey==null)throw new zr("No public key found in key book");c=Yr(l.id.publicKey)}catch(l){if(l.name!=="NotFoundError")throw l}if(c!=null)return this.log("returning found public key"),i.record=new Zr(n,c,new Date).serialize(),i}const[s,o]=await Promise.all([this._checkLocalDatastore(n),this.peerRouting.getClosestPeersOffline(n)]);return s!=null&&(this.log("had record for %b in local datastore",n),i.record=s.serialize()),o.length>0&&(this.log("had %s closer peers in routing table",o.length),i.closer=o.map(a=>({id:a.id.toMultihash().bytes,multiaddrs:a.multiaddrs.map(c=>c.bytes)}))),i}async _checkLocalDatastore(e){this.log("checkLocalDatastore looking for %b",e);const t=ic(this.datastorePrefix,e);let n;try{n=await this.datastore.get(t)}catch(s){if(s.name==="NotFoundError")return;throw s}const i=Zr.deserialize(n);if(i.timeReceived==null||Date.now()-i.timeReceived.getTime()>HB){await this.datastore.delete(t);return}return i}}class kO{constructor(e,t){h(this,"log");this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:ping`)}async handle(e,t){return this.log("ping from %p",e),t}}class TO{constructor(e,t){h(this,"components");h(this,"validators");h(this,"log");h(this,"datastorePrefix");const{validators:n}=t;this.components=e,this.log=e.logger.forComponent(`${t.logPrefix}:rpc:handlers:put-value`),this.datastorePrefix=`${t.datastorePrefix}/record`,this.validators=n}async handle(e,t){const n=t.key;if(this.log("%p asked us to store value for key %b",e,n),t.record==null){const i=`Empty record from: ${e.toString()}`;throw this.log.error(i),new We(i)}try{const i=Zr.deserialize(t.record);await B4(this.validators,i),i.timeReceived=new Date;const s=ic(this.datastorePrefix,i.key);await this.components.datastore.put(s,i.serialize().subarray()),this.log("put record for %b into datastore under key %k",n,s)}catch(i){this.log("did not put record for key %b into datastore %o",n,i)}return t}}class PO{constructor(e,t){h(this,"handlers");h(this,"log");h(this,"metrics");h(this,"incomingMessageTimeout");var n,i,s;this.metrics={operations:(n=e.metrics)==null?void 0:n.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_requests_total`),errors:(i=e.metrics)==null?void 0:i.registerCounterGroup(`${t.metricsPrefix}_inbound_rpc_errors_total`),rpcTime:(s=e.metrics)==null?void 0:s.registerMetricGroup(`${t.metricsPrefix}_inbound_rpc_time_seconds`,{label:"operation"})},this.log=e.logger.forComponent(`${t.logPrefix}:rpc`),this.incomingMessageTimeout=t.incomingMessageTimeout??1e4,this.handlers={[vt.GET_VALUE.toString()]:new CO(e,t),[vt.PUT_VALUE.toString()]:new TO(e,t),[vt.FIND_NODE.toString()]:new AO(e,t),[vt.ADD_PROVIDER.toString()]:new xO(e,t),[vt.GET_PROVIDERS.toString()]:new IO(e,t),[vt.PING.toString()]:new kO(e,t)}}async handleMessage(e,t){var i,s;const n=this.handlers[t.type];if(n==null){this.log.error(`no handler found for message type: ${t.type}`);return}try{return(i=this.metrics.operations)==null||i.increment({[t.type]:!0}),await n.handle(e,t)}catch{(s=this.metrics.errors)==null||s.increment({[t.type]:!0})}}onIncomingStream(e){const t="unknown";Promise.resolve().then(async()=>{var c,l,u,f;const{stream:n,connection:i}=e,s=()=>{n.abort(new ph)};let o=AbortSignal.timeout(this.incomingMessageTimeout);o.addEventListener("abort",s);const a=Ic(n).pb(vo);try{for(;;){const g=await a.read({signal:o}),m=(l=(c=this.metrics)==null?void 0:c.rpcTime)==null?void 0:l.timer(g.type.toString()),w=(f=(u=this.metrics)==null?void 0:u.rpcTime)==null?void 0:f.timer(g.type.toString());let x=!1;try{this.log("incoming %s from %p",g.type,i.remotePeer);const v=await this.handleMessage(i.remotePeer,g);v!=null&&await a.write(v,{signal:o})}catch(v){throw x=!0,w==null||w(),v}finally{x||m==null||m()}o.removeEventListener("abort",s),o=AbortSignal.timeout(this.incomingMessageTimeout),o.addEventListener("abort",s)}}catch(g){n.abort(g)}}).catch(n=>{this.log.error("error handling %s RPC message from %p - %e",t,e.connection.remotePeer,n)})}}class BO extends or{constructor(t,n){super();h(this,"log");h(this,"components");h(this,"protocol");h(this,"running");h(this,"registrarId");const{protocol:i,logPrefix:s}=n;this.components=t,this.log=t.logger.forComponent(`${s}:topology-listener`),this.running=!1,this.protocol=i}isStarted(){return this.running}async start(){this.running||(this.running=!0,this.registrarId=await this.components.registrar.register(this.protocol,{onConnect:t=>{this.log("observed peer %p with protocol %s",t,this.protocol),this.dispatchEvent(new CustomEvent("peer",{detail:t}))}}))}async stop(){this.running=!1,this.registrarId!=null&&(this.components.registrar.unregister(this.registrarId),this.registrarId=void 0)}}class NO{constructor(e){h(this,"dht");this.dht=e}async provide(e,t={}){await _c(this.dht.provide(e,t))}async cancelReprovide(e){await this.dht.cancelReprovide(e)}async*findProviders(e,t={}){for await(const n of this.dht.findProviders(e,t))n.name==="PROVIDER"&&(yield*n.providers)}async put(e,t,n){await _c(this.dht.put(e,t,n))}async get(e,t){for await(const n of this.dht.get(e,t))if(n.name==="VALUE")return n.value;throw new zr("Could not find value for key")}}class OO{constructor(e){h(this,"dht");this.dht=e}async findPeer(e,t={}){for await(const n of this.dht.findPeer(e,t))if(n.name==="FINAL_PEER")return n.peer;throw new zr("Peer not found")}async*getClosestPeers(e,t={}){for await(const n of this.dht.getClosestPeers(e,t))n.name==="FINAL_PEER"&&(yield n.peer)}}const RO=32,DO=64;var i7,s7,o7;class LO extends or{constructor(t,n={}){var l,u,f,g;super();h(this,"k");h(this,"a");h(this,"d");h(this,"protocol");h(this,"routingTable");h(this,"providers");h(this,"network");h(this,"peerRouting");h(this,"components");h(this,"log");h(this,"running");h(this,"clientMode");h(this,"validators");h(this,"selectors");h(this,"queryManager");h(this,"contentFetching");h(this,"contentRouting");h(this,"routingTableRefresh");h(this,"rpc");h(this,"topologyListener");h(this,"querySelf");h(this,"maxInboundStreams");h(this,"maxOutboundStreams");h(this,"dhtContentRouting");h(this,"dhtPeerRouting");h(this,"peerInfoMapper");h(this,"reprovider");h(this,"onPeerConnectTimeout");h(this,o7,"@libp2p/kad-dht");h(this,s7,["@libp2p/content-routing","@libp2p/peer-routing","@libp2p/peer-discovery","@libp2p/kad-dht"]);h(this,i7,["@libp2p/identify","@libp2p/ping"]);const i=n.logPrefix??"libp2p:kad-dht",s=n.datastorePrefix??"/dht",o=n.metricsPrefix??"libp2p_kad_dht",a={queries:(l=t.metrics)==null?void 0:l.registerMetricGroup(`${o}_operations_total`,{label:"operation"}),errors:(u=t.metrics)==null?void 0:u.registerCounterGroup(`${o}_operation_errors_total`,{label:"operation"}),queryTime:(f=t.metrics)==null?void 0:f.registerMetricGroup(`${o}_operation_time_seconds`,{label:"operation"}),errorTime:(g=t.metrics)==null?void 0:g.registerMetricGroup(`${o}_operation_error_time_seconds`,{label:"operation"})};this.running=!1,this.components=t,this.log=t.logger.forComponent(i),this.k=n.kBucketSize??O4,this.a=n.alpha??Dh,this.d=n.disjointPaths??this.a,this.protocol=n.protocol??jB,this.clientMode=n.clientMode??!0,this.maxInboundStreams=n.maxInboundStreams??RO,this.maxOutboundStreams=n.maxOutboundStreams??DO,this.peerInfoMapper=n.peerInfoMapper??bN,this.onPeerConnectTimeout=n.onPeerConnectTimeout??ZB,this.providers=new zN(t,{...n.providers,logPrefix:i,datastorePrefix:s}),this.validators={...pN,...n.validators},this.selectors={...fN,...n.selectors},this.network=new HN(t,{protocol:this.protocol,logPrefix:i,metricsPrefix:o}),this.routingTable=new vO(t,{kBucketSize:this.k,pingOldContactTimeout:n.pingOldContactTimeout,pingOldContactConcurrency:n.pingOldContactConcurrency,pingOldContactMaxQueueSize:n.pingOldContactMaxQueueSize,pingNewContactTimeout:n.pingNewContactTimeout,pingNewContactConcurrency:n.pingNewContactConcurrency,pingNewContactMaxQueueSize:n.pingNewContactMaxQueueSize,protocol:this.protocol,logPrefix:i,metricsPrefix:o,prefixLength:n.prefixLength,splitThreshold:n.kBucketSplitThreshold,network:this.network});const c=St();n.allowQueryWithZeroPeers===!0&&c.resolve(),this.queryManager=new ZN(t,{disjointPaths:this.d,alpha:this.a,logPrefix:i,metricsPrefix:o,initialQuerySelfHasRun:c,routingTable:this.routingTable,allowQueryWithZeroPeers:n.allowQueryWithZeroPeers}),this.peerRouting=new jN(t,{routingTable:this.routingTable,network:this.network,validators:this.validators,queryManager:this.queryManager,logPrefix:i}),this.contentFetching=new PN(t,{validators:this.validators,selectors:this.selectors,peerRouting:this.peerRouting,queryManager:this.queryManager,network:this.network,logPrefix:i,datastorePrefix:s}),this.contentRouting=new UN(t,{network:this.network,peerRouting:this.peerRouting,queryManager:this.queryManager,routingTable:this.routingTable,providers:this.providers,logPrefix:i}),this.routingTableRefresh=new EO(t,{peerRouting:this.peerRouting,routingTable:this.routingTable,logPrefix:i}),this.rpc=new PO(t,{routingTable:this.routingTable,providers:this.providers,peerRouting:this.peerRouting,validators:this.validators,logPrefix:i,metricsPrefix:o,datastorePrefix:s,peerInfoMapper:this.peerInfoMapper}),this.topologyListener=new BO(t,{protocol:this.protocol,logPrefix:i}),this.querySelf=new eO(t,{peerRouting:this.peerRouting,interval:n.querySelfInterval,initialInterval:n.initialQuerySelfInterval,logPrefix:i,initialQuerySelfHasRun:c,operationMetrics:a}),this.reprovider=new tO(t,{...n.reprovide,logPrefix:i,metricsPrefix:o,datastorePrefix:s,contentRouting:this.contentRouting,operationMetrics:a}),this.network.addEventListener("peer",m=>{const w=m.detail;this.onPeerConnect(w).catch(x=>{this.log.error("could not add %p to routing table",w.id,x)}),this.dispatchEvent(new CustomEvent("peer",{detail:w}))}),this.topologyListener.addEventListener("peer",m=>{const w=m.detail;Promise.resolve().then(async()=>{const x=await this.components.peerStore.get(w),v={id:w,multiaddrs:x.addresses.map(({multiaddr:C})=>C),protocols:x.protocols};await this.onPeerConnect(v)}).catch(x=>{this.log.error("could not add %p to routing table - %e - %e",w,x)})}),this.dhtPeerRouting=new OO(this),this.dhtContentRouting=new NO(this),n.clientMode==null&&t.events.addEventListener("self:peer:update",m=>{this.log("received update of self-peer info"),Promise.resolve().then(async()=>{const w=m.detail.peer.addresses.some(({multiaddr:v})=>TN(v)),x=this.getMode();w&&x==="client"?await this.setMode("server"):x==="server"&&!w&&await this.setMode("client")}).catch(w=>{this.log.error("error setting dht server mode",w)})}),this.get=to(this.get.bind(this),a,"GET_VALUE"),this.findProviders=to(this.findProviders.bind(this),a,"FIND_PROVIDERS"),this.findPeer=to(this.findPeer.bind(this),a,"FIND_PEER"),this.getClosestPeers=to(this.getClosestPeers.bind(this),a,"GET_CLOSEST_PEERS"),this.provide=to(this.provide.bind(this),a,"PROVIDE"),this.put=to(this.put.bind(this),a,"PUT_VALUE")}get[(o7=Symbol.toStringTag,s7=Xr,i7=Uu,u0)](){return this.dhtContentRouting}get[h0](){return this.dhtPeerRouting}get[Ru](){return this}async onPeerConnect(t){if(this.log.trace("peer %p connected",t.id),t=this.peerInfoMapper(t),t.multiaddrs.length===0){this.log.trace("ignoring %p as there were no valid addresses in %s after filtering",t.id,t.multiaddrs.map(i=>i.toString()));return}const n=AbortSignal.timeout(this.onPeerConnectTimeout);try{await this.routingTable.add(t.id,{signal:n})}catch(i){this.log.error("could not add %p to routing table",t.id,i)}}isStarted(){return this.running}getMode(){return this.clientMode?"client":"server"}async setMode(t,n){if(t===this.getMode()&&(n==null?void 0:n.force)!==!0){this.log("already in %s mode",t);return}if(await this.components.registrar.unhandle(this.protocol,n),t===this.getMode()&&(n==null?void 0:n.force)!==!0){this.log("already in %s mode",t);return}t==="client"?(this.log("enabling client mode while in %s mode",this.getMode()),this.clientMode=!0):(this.log("enabling server mode while in %s mode",this.getMode()),this.clientMode=!1,await this.components.registrar.handle(this.protocol,this.rpc.onIncomingStream.bind(this.rpc),{signal:n==null?void 0:n.signal,maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams}))}async start(){this.running||(this.running=!0,await this.setMode(this.clientMode?"client":"server",{force:!0}),await Mu(this.routingTable,this.queryManager,this.network,this.topologyListener,this.routingTableRefresh,this.reprovider),await Mu(this.querySelf))}async stop(){this.running=!1,await K3(this.querySelf,this.queryManager,this.network,this.routingTable,this.routingTableRefresh,this.topologyListener,this.reprovider)}async*put(t,n,i={}){yield*this.contentFetching.put(t,n,i)}async*get(t,n={}){yield*this.contentFetching.get(t,n)}async*provide(t,n={}){yield*this.contentRouting.provide(t,this.components.addressManager.getAddresses(),n)}async cancelReprovide(t,n){await this.providers.removeProvider(t,this.components.peerId,n)}async*findProviders(t,n={}){yield*this.contentRouting.findProviders(t,n)}async*findPeer(t,n={}){yield*this.peerRouting.findPeer(t,n)}async*getClosestPeers(t,n={}){yield*this.peerRouting.getClosestPeers(t,n)}async refreshRoutingTable(t){this.routingTableRefresh.refreshTable(!0,t)}}var d5;(function(r){r[r.SEND_QUERY=0]="SEND_QUERY",r[r.PEER_RESPONSE=1]="PEER_RESPONSE",r[r.FINAL_PEER=2]="FINAL_PEER",r[r.QUERY_ERROR=3]="QUERY_ERROR",r[r.PROVIDER=4]="PROVIDER",r[r.VALUE=5]="VALUE",r[r.ADD_PEER=6]="ADD_PEER",r[r.DIAL_PEER=7]="DIAL_PEER",r[r.PATH_ENDED=8]="PATH_ENDED"})(d5||(d5={}));function MO(r={}){return e=>new LO(e,r)}const fd=32,UO="1.0.0",FO="ping",$O="ipfs",VO=1e4,qO=2,KO=1;var a7,c7;c7=Symbol.toStringTag,a7=Xr;class HO{constructor(e,t={}){h(this,"protocol");h(this,"components");h(this,"started");h(this,"timeout");h(this,"maxInboundStreams");h(this,"maxOutboundStreams");h(this,"runOnLimitedConnection");h(this,"log");h(this,c7,"@libp2p/ping");h(this,a7,["@libp2p/ping"]);this.components=e,this.log=e.logger.forComponent("libp2p:ping"),this.started=!1,this.protocol=`/${t.protocolPrefix??$O}/${FO}/${UO}`,this.timeout=t.timeout??VO,this.maxInboundStreams=t.maxInboundStreams??qO,this.maxOutboundStreams=t.maxOutboundStreams??KO,this.runOnLimitedConnection=t.runOnLimitedConnection??!0,this.handleMessage=this.handleMessage.bind(this)}async start(){await this.components.registrar.handle(this.protocol,this.handleMessage,{maxInboundStreams:this.maxInboundStreams,maxOutboundStreams:this.maxOutboundStreams,runOnLimitedConnection:this.runOnLimitedConnection}),this.started=!0}async stop(){await this.components.registrar.unhandle(this.protocol),this.started=!1}isStarted(){return this.started}handleMessage(e){this.log("incoming ping from %p",e.connection.remotePeer);const{stream:t}=e,n=Date.now(),i=Yu(t);let s=!1;Promise.resolve().then(async()=>{for(;;){const o=AbortSignal.timeout(this.timeout);o.addEventListener("abort",()=>{t==null||t.abort(new ph("ping timeout"))});const a=await i.read({bytes:fd,signal:o});await i.write(a,{signal:o}),s=!0}}).catch(o=>{s&&o.name==="UnexpectedEOFError"&&t.readStatus!=="ready"||(this.log.error("incoming ping from %p failed with error - %e",e.connection.remotePeer,o),t==null||t.abort(o))}).finally(()=>{const o=Date.now()-n;this.log("incoming ping from %p complete in %dms",e.connection.remotePeer,o);const a=AbortSignal.timeout(this.timeout);t.close({signal:a}).catch(c=>{this.log.error("error closing ping stream from %p - %e",e.connection.remotePeer,c),t==null||t.abort(c)})})}async ping(e,t={}){this.log("pinging %p",e);const n=Date.now(),i=ol(fd),s=await this.components.connectionManager.openConnection(e,t);let o;if(t.signal==null){const a=AbortSignal.timeout(this.timeout);t={...t,signal:a}}try{o=await s.newStream(this.protocol,{...t,runOnLimitedConnection:this.runOnLimitedConnection});const a=Yu(o),[,c]=await Promise.all([a.write(i,t),a.read({...t,bytes:fd})]),l=Date.now()-n;if(!pt(i,c.subarray()))throw new $9(`Received wrong ping ack after ${l}ms`);return this.log("ping %p complete in %dms",s.remotePeer,l),l}catch(a){throw this.log.error("error while pinging %p",s.remotePeer,a),o==null||o.abort(a),a}finally{o!=null&&await o.close(t)}}}function jO(r={}){return e=>new HO(e,r)}var br;(function(r){(function(n){n.FIN="FIN",n.STOP_SENDING="STOP_SENDING",n.RESET="RESET",n.FIN_ACK="FIN_ACK"})(r.Flag||(r.Flag={}));let e;(function(n){n[n.FIN=0]="FIN",n[n.STOP_SENDING=1]="STOP_SENDING",n[n.RESET=2]="RESET",n[n.FIN_ACK=3]="FIN_ACK"})(e||(e={})),function(n){n.codec=()=>xh(e)}(r.Flag||(r.Flag={}));let t;r.codec=()=>(t==null&&(t=lt((n,i,s={})=>{s.lengthDelimited!==!1&&i.fork(),n.flag!=null&&(i.uint32(8),r.Flag.codec().encode(n.flag,i)),n.message!=null&&(i.uint32(18),i.bytes(n.message)),s.lengthDelimited!==!1&&i.ldelim()},(n,i,s={})=>{const o={},a=i==null?n.len:n.pos+i;for(;n.pos<a;){const c=n.uint32();switch(c>>>3){case 1:{o.flag=r.Flag.codec().decode(n);break}case 2:{o.message=n.bytes();break}default:{n.skipType(c&7);break}}}return o})),t),r.encode=n=>ct(n,r.codec()),r.decode=(n,i)=>at(n,r.codec(),i)})(br||(br={}));const p5=Array.from("abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890"),zO="libp2p+webrtc+v1/",WO=466,GO=2*1024*1024,QO=30*1e3,Lh=16*1024;function YO(r=Lh){const e=nr(r-nr(r)),t=1+nr(Object.keys(br.Flag).length-1),n=1,i=r-e-t-n,s=nr(i);return e+t+n+s}const ZO=YO(),XO=5e3,JO=5e3,eR=3e4,aw="/webrtc",tR="/libp2p/webrtc-direct/certificate",rR="webrtc-direct-certificate-private-key",nR=12096e5,g5=864e5;var m5=function(r,e,t){if(t||arguments.length===2)for(var n=0,i=e.length,s;n<i;n++)(s||!(n in e))&&(s||(s=Array.prototype.slice.call(e,0,n)),s[n]=e[n]);return r.concat(s||Array.prototype.slice.call(e))},iR=function(){function r(e,t,n){this.name=e,this.version=t,this.os=n,this.type="browser"}return r}(),sR=function(){function r(e){this.version=e,this.type="node",this.name="node",this.os=process.platform}return r}(),oR=function(){function r(e,t,n,i){this.name=e,this.version=t,this.os=n,this.bot=i,this.type="bot-device"}return r}(),aR=function(){function r(){this.type="bot",this.bot=!0,this.name="bot",this.version=null,this.os=null}return r}(),cR=function(){function r(){this.type="react-native",this.name="react-native",this.version=null,this.os=null}return r}(),lR=/alexa|bot|crawl(er|ing)|facebookexternalhit|feedburner|google web preview|nagios|postrank|pingdom|slurp|spider|yahoo!|yandex/,uR=/(nuhk|curl|Googlebot|Yammybot|Openbot|Slurp|MSNBot|Ask\ Jeeves\/Teoma|ia_archiver)/,y5=3,hR=[["aol",/AOLShield\/([0-9\._]+)/],["edge",/Edge\/([0-9\._]+)/],["edge-ios",/EdgiOS\/([0-9\._]+)/],["yandexbrowser",/YaBrowser\/([0-9\._]+)/],["kakaotalk",/KAKAOTALK\s([0-9\.]+)/],["samsung",/SamsungBrowser\/([0-9\.]+)/],["silk",/\bSilk\/([0-9._-]+)\b/],["miui",/MiuiBrowser\/([0-9\.]+)$/],["beaker",/BeakerBrowser\/([0-9\.]+)/],["edge-chromium",/EdgA?\/([0-9\.]+)/],["chromium-webview",/(?!Chrom.*OPR)wv\).*Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["chrome",/(?!Chrom.*OPR)Chrom(?:e|ium)\/([0-9\.]+)(:?\s|$)/],["phantomjs",/PhantomJS\/([0-9\.]+)(:?\s|$)/],["crios",/CriOS\/([0-9\.]+)(:?\s|$)/],["firefox",/Firefox\/([0-9\.]+)(?:\s|$)/],["fxios",/FxiOS\/([0-9\.]+)/],["opera-mini",/Opera Mini.*Version\/([0-9\.]+)/],["opera",/Opera\/([0-9\.]+)(?:\s|$)/],["opera",/OPR\/([0-9\.]+)(:?\s|$)/],["pie",/^Microsoft Pocket Internet Explorer\/(\d+\.\d+)$/],["pie",/^Mozilla\/\d\.\d+\s\(compatible;\s(?:MSP?IE|MSInternet Explorer) (\d+\.\d+);.*Windows CE.*\)$/],["netfront",/^Mozilla\/\d\.\d+.*NetFront\/(\d.\d)/],["ie",/Trident\/7\.0.*rv\:([0-9\.]+).*\).*Gecko$/],["ie",/MSIE\s([0-9\.]+);.*Trident\/[4-7].0/],["ie",/MSIE\s(7\.0)/],["bb10",/BB10;\sTouch.*Version\/([0-9\.]+)/],["android",/Android\s([0-9\.]+)/],["ios",/Version\/([0-9\._]+).*Mobile.*Safari.*/],["safari",/Version\/([0-9\._]+).*Safari/],["facebook",/FB[AS]V\/([0-9\.]+)/],["instagram",/Instagram\s([0-9\.]+)/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Mobile/],["ios-webview",/AppleWebKit\/([0-9\.]+).*Gecko\)$/],["curl",/^curl\/([0-9\.]+)$/],["searchbot",lR]],w5=[["iOS",/iP(hone|od|ad)/],["Android OS",/Android/],["BlackBerry OS",/BlackBerry|BB10/],["Windows Mobile",/IEMobile/],["Amazon OS",/Kindle/],["Windows 3.11",/Win16/],["Windows 95",/(Windows 95)|(Win95)|(Windows_95)/],["Windows 98",/(Windows 98)|(Win98)/],["Windows 2000",/(Windows NT 5.0)|(Windows 2000)/],["Windows XP",/(Windows NT 5.1)|(Windows XP)/],["Windows Server 2003",/(Windows NT 5.2)/],["Windows Vista",/(Windows NT 6.0)/],["Windows 7",/(Windows NT 6.1)/],["Windows 8",/(Windows NT 6.2)/],["Windows 8.1",/(Windows NT 6.3)/],["Windows 10",/(Windows NT 10.0)/],["Windows ME",/Windows ME/],["Windows CE",/Windows CE|WinCE|Microsoft Pocket Internet Explorer/],["Open BSD",/OpenBSD/],["Sun OS",/SunOS/],["Chrome OS",/CrOS/],["Linux",/(Linux)|(X11)/],["Mac OS",/(Mac_PowerPC)|(Macintosh)/],["QNX",/QNX/],["BeOS",/BeOS/],["OS/2",/OS\/2/]];function fR(r){return typeof document>"u"&&typeof navigator<"u"&&navigator.product==="ReactNative"?new cR:typeof navigator<"u"?pR(navigator.userAgent):mR()}function dR(r){return r!==""&&hR.reduce(function(e,t){var n=t[0],i=t[1];if(e)return e;var s=i.exec(r);return!!s&&[n,s]},!1)}function pR(r){var e=dR(r);if(!e)return null;var t=e[0],n=e[1];if(t==="searchbot")return new aR;var i=n[1]&&n[1].split(".").join("_").split("_").slice(0,3);i?i.length<y5&&(i=m5(m5([],i,!0),yR(y5-i.length),!0)):i=[];var s=i.join("."),o=gR(r),a=uR.exec(r);return a&&a[1]?new oR(t,s,o,a[1]):new iR(t,s,o)}function gR(r){for(var e=0,t=w5.length;e<t;e++){var n=w5[e],i=n[0],s=n[1],o=s.exec(r);if(o)return i}return null}function mR(){var r=typeof process<"u"&&process.version;return r?new sR(process.version.slice(1)):null}function yR(r){for(var e=[],t=0;t<r;t++)e.push("0");return e}const b5=fR(),wR=b5!=null&&b5.name==="firefox",cw=async function*(){},lw=async r=>{};function bR(r,e,t=eR,n){r.readyState==="open"&&Promise.resolve().then(async()=>{if(r.bufferedAmount>0){n.log("%s drain channel with %d buffered bytes",e,r.bufferedAmount);const i=St();let s=!1;r.bufferedAmountLowThreshold=0;const o=()=>{s||(n.log("%s drain channel closed before drain",e),i.resolve())};r.addEventListener("close",o,{once:!0}),r.addEventListener("bufferedamountlow",()=>{s=!0,r.removeEventListener("close",o),i.resolve()}),await Ph(i.promise,{milliseconds:t})}}).then(async()=>{r.readyState==="open"&&r.close()}).catch(i=>{n.log.error("error closing outbound stream",i)})}const vR=(r=32)=>zO+[...Array(r)].map(()=>p5.at(Math.floor(Math.random()*p5.length))).join("");class SR{constructor(e,t){h(this,"log");h(this,"peerConnection");h(this,"remoteAddr");h(this,"timeline");h(this,"metrics");h(this,"source",cw());h(this,"sink",lw);this.log=e.logger.forComponent("libp2p:webrtc:maconn"),this.remoteAddr=t.remoteAddr,this.timeline=t.timeline,this.peerConnection=t.peerConnection;const n=this.peerConnection,i=n.connectionState;this.peerConnection.onconnectionstatechange=()=>{this.log.trace("peer connection state change",n.connectionState,"initial state",i),(n.connectionState==="disconnected"||n.connectionState==="failed"||n.connectionState==="closed")&&(this.timeline.close=Date.now())}}async close(e){var t;this.log.trace("closing connection"),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({close:!0})}abort(e){var t;this.log.error("closing connection due to error",e),this.peerConnection.close(),this.timeline.close=Date.now(),(t=this.metrics)==null||t.increment({abort:!0})}}class ER extends py{constructor(t){const n=t.onEnd;t.onEnd=s=>{this.log.trace('readable and writeable ends closed with status "%s"',this.status),Promise.resolve(async()=>{if(!(this.timeline.abort!=null||this.timeline.reset!==null))try{await Ph(this.receiveFinAck.promise,{milliseconds:this.finAckTimeout})}catch(o){this.log.error("error receiving FIN_ACK",o)}}).then(()=>{this.incomingData.end(),n==null||n(s)}).catch(o=>{this.log.error("error ending stream",o)}).finally(()=>{this.channel.close()})};super(t);h(this,"channel");h(this,"incomingData");h(this,"maxBufferedAmount");h(this,"bufferedAmountLowEventTimeout");h(this,"maxMessageSize");h(this,"receiveFinAck");h(this,"finAckTimeout");h(this,"openTimeout");h(this,"closeController");switch(this.channel=t.channel,this.channel.binaryType="arraybuffer",this.incomingData=bi(),this.bufferedAmountLowEventTimeout=t.bufferedAmountLowEventTimeout??QO,this.maxBufferedAmount=t.maxBufferedAmount??GO,this.maxMessageSize=(t.maxMessageSize??Lh)-ZO,this.receiveFinAck=St(),this.finAckTimeout=t.closeTimeout??XO,this.openTimeout=t.openTimeout??JO,this.closeController=new AbortController,this.channel.readyState){case"open":this.timeline.open=new Date().getTime();break;case"closed":case"closing":(this.timeline.close===void 0||this.timeline.close===0)&&(this.timeline.close=Date.now());break;case"connecting":break;default:throw this.log.error("unknown datachannel state %s",this.channel.readyState),new Lu("Unknown datachannel state")}this.channel.onopen=s=>{this.timeline.open=new Date().getTime()},this.channel.onclose=s=>{this.log.trace("received onclose event"),this.closeController.abort(),this.receiveFinAck.resolve(),this.close().catch(o=>{this.log.error("error closing stream after channel closed",o)})},this.channel.onerror=s=>{this.log.trace("received onerror event"),this.closeController.abort();const o=s.error;this.abort(o)},this.channel.onmessage=async s=>{const{data:o}=s;o===null||o.byteLength===0||this.incomingData.push(new Uint8Array(o,0,o.byteLength))};const i=this;Promise.resolve().then(async()=>{for await(const s of vc(this.incomingData)){const o=i.processIncomingProtobuf(s);o!=null&&i.sourcePush(new je(o))}}).catch(s=>{this.log.error("error processing incoming data channel messages",s)})}sendNewStream(){}async _sendMessage(t,n=!0){if(this.channel.readyState==="closed"||this.channel.readyState==="closing")throw new Lu(`Invalid datachannel state - ${this.channel.readyState}`);if(this.channel.readyState!=="open"){const i=AbortSignal.timeout(this.openTimeout),s=Fr([this.closeController.signal,i]);try{this.log('channel state is "%s" and not "open", waiting for "open" event before sending data',this.channel.readyState),await Ln(this.channel,"open",s)}finally{s.clear()}this.log('channel state is now "%s", sending data',this.channel.readyState)}if(n&&this.channel.bufferedAmount>this.maxBufferedAmount){const i=AbortSignal.timeout(this.bufferedAmountLowEventTimeout),s=Fr([this.closeController.signal,i]);try{this.log('channel buffer is %d, wait for "bufferedamountlow" event',this.channel.bufferedAmount),await Ln(this.channel,"bufferedamountlow",s)}catch(o){throw i.aborted?new ph(`Timed out waiting for DataChannel buffer to clear after ${this.bufferedAmountLowEventTimeout}ms`):o}finally{s.clear()}}try{this.log.trace('sending message, channel state "%s"',this.channel.readyState),this.channel.send(t.subarray())}catch(i){this.log.error("error while sending message",i)}}async sendData(t){const n=t.byteLength;for(t=t.sublist();t.byteLength>0;){const i=Math.min(t.byteLength,this.maxMessageSize),s=t.subarray(0,i),o=br.encode({message:s}),a=bc.single(o);this.log.trace("sending %d/%d bytes on channel",s.byteLength,n),await this._sendMessage(a),t.consume(i)}this.log.trace('finished sending data, channel state "%s"',this.channel.readyState)}async sendReset(){try{await this._sendFlag(br.Flag.RESET)}catch(t){this.log.error("failed to send reset - %e",t)}finally{this.channel.close()}}async sendCloseWrite(t){if(this.channel.readyState!=="open"){this.receiveFinAck.resolve();return}if(await this._sendFlag(br.Flag.FIN)){this.log.trace("awaiting FIN_ACK");try{await Ht(this.receiveFinAck.promise,t==null?void 0:t.signal,{errorMessage:"sending close-write was aborted before FIN_ACK was received",errorName:"FinAckNotReceivedError"})}catch(i){this.log.error("failed to await FIN_ACK",i)}}else this.log.trace("sending FIN failed, not awaiting FIN_ACK");this.receiveFinAck.resolve()}async sendCloseRead(){this.channel.readyState==="open"&&await this._sendFlag(br.Flag.STOP_SENDING)}processIncomingProtobuf(t){const n=br.decode(t);if(n.flag!==void 0&&(this.log.trace('incoming flag %s, write status "%s", read status "%s"',n.flag,this.writeStatus,this.readStatus),n.flag===br.Flag.FIN&&(this.remoteCloseWrite(),this.log.trace("sending FIN_ACK"),this._sendFlag(br.Flag.FIN_ACK).catch(i=>{this.log.error("error sending FIN_ACK immediately",i)})),n.flag===br.Flag.RESET&&this.reset(),n.flag===br.Flag.STOP_SENDING&&this.remoteCloseRead(),n.flag===br.Flag.FIN_ACK&&(this.log.trace("received FIN_ACK"),this.receiveFinAck.resolve())),this.readStatus==="ready")return n.message}async _sendFlag(t){if(this.channel.readyState!=="open")return this.log.trace('not sending flag %s because channel is "%s" and not "open"',t.toString(),this.channel.readyState),!1;this.log.trace("sending flag %s",t.toString());const n=br.encode({flag:t}),i=bc.single(n);try{return await this._sendMessage(i,!1),!0}catch(s){this.log.error("could not send flag %s - %e",t.toString(),s)}return!1}}function v1(r){const{channel:e,direction:t,handshake:n}=r;return new ER({id:`${e.id}`,log:r.logger.forComponent(`libp2p:webrtc:stream:${n===!0?"handshake":t}:${e.id}`),...r})}class xR{constructor(e,t){h(this,"protocol");h(this,"peerConnection");h(this,"bufferedStreams",[]);h(this,"metrics");h(this,"dataChannelOptions");h(this,"components");h(this,"log");this.components=e,this.peerConnection=t.peerConnection,this.metrics=t.metrics,this.protocol=t.protocol??aw,this.dataChannelOptions=t.dataChannelOptions??{},this.log=e.logger.forComponent("libp2p:webrtc:muxerfactory"),this.peerConnection.ondatachannel=({channel:n})=>{if(this.log.trace('incoming early datachannel with channel id %d and label "%s"',n.id),n.label==="init"){this.log.trace("closing early init channel"),n.close();return}const i={},s=v1({channel:n,direction:"inbound",onEnd:o=>{i.onEnd(o)},logger:e.logger,...this.dataChannelOptions});i.stream=s,i.channel=n,i.onEnd=()=>{this.bufferedStreams=this.bufferedStreams.filter(o=>o.stream.id!==s.id)},this.bufferedStreams.push(i)}}createStreamMuxer(e){return new AR(this.components,{...e,peerConnection:this.peerConnection,dataChannelOptions:this.dataChannelOptions,metrics:this.metrics,streams:this.bufferedStreams,protocol:this.protocol})}}var Bo,vu;class AR{constructor(e,t){ut(this,Bo);h(this,"init");h(this,"streams");h(this,"protocol");h(this,"log");h(this,"peerConnection");h(this,"dataChannelOptions");h(this,"metrics");h(this,"logger");h(this,"source",cw());h(this,"sink",lw);this.init=t,this.log=e.logger.forComponent("libp2p:webrtc:muxer"),this.logger=e.logger,this.streams=t.streams.map(n=>n.stream),this.peerConnection=t.peerConnection,this.protocol=t.protocol??aw,this.metrics=t.metrics,this.dataChannelOptions=t.dataChannelOptions??{},this.peerConnection.ondatachannel=({channel:n})=>{var o,a;if(this.log.trace("incoming datachannel with channel id %d",n.id),n.label==="init"){this.log.trace("closing init channel"),n.close();return}const i=n.id,s=v1({channel:n,direction:"inbound",onEnd:()=>{Ke(this,Bo,vu).call(this,s,n),this.log("incoming channel %s ended",i)},logger:this.logger,...this.dataChannelOptions});this.streams.push(s),(o=this.metrics)==null||o.increment({incoming_stream:!0}),(a=t==null?void 0:t.onIncomingStream)==null||a.call(t,s)},this.init.streams.length>0&&queueMicrotask(()=>{this.init.streams.forEach(n=>{var i,s,o;n.onEnd=()=>{this.log("incoming early channel %s ended with state %s",n.channel.id,n.channel.readyState),Ke(this,Bo,vu).call(this,n.stream,n.channel)},(i=this.metrics)==null||i.increment({incoming_stream:!0}),(o=(s=this.init)==null?void 0:s.onIncomingStream)==null||o.call(s,n.stream)})})}async close(e){try{await Promise.all(this.streams.map(async t=>t.close(e)))}catch(t){this.abort(t)}}abort(e){for(const t of this.streams)t.abort(e)}newStream(){var i;const e=this.peerConnection.createDataChannel(""),t=e.id;this.log.trace("opened outgoing datachannel with channel id %s",t);const n=v1({channel:e,direction:"outbound",onEnd:()=>{Ke(this,Bo,vu).call(this,n,e),this.log("outgoing channel %s ended",t)},logger:this.logger,...this.dataChannelOptions});return this.streams.push(n),(i=this.metrics)==null||i.increment({outgoing_stream:!0}),n}}Bo=new WeakSet,vu=function(e,t){var n,i,s;this.log.trace("stream %s %s %s onEnd",e.direction,e.id,e.protocol),bR(t,`${e.direction} ${e.id} ${e.protocol}`,this.dataChannelOptions.drainTimeout,{log:this.log}),this.streams=this.streams.filter(o=>o.id!==e.id),(n=this.metrics)==null||n.increment({stream_end:!0}),(s=(i=this.init)==null?void 0:i.onStreamEnd)==null||s.call(i,e)};class Ar extends Event{constructor(t,n){super(t);h(this,"type");h(this,"detail");this.type=t,this.detail=n}}class Mh extends Error{constructor(e){super(`WebRTC transport error: ${e}`),this.name="WebRTCTransportError"}}class _R extends Mh{constructor(e,t){super(`Invalid fingerprint "${e}" within ${t}`),this.name="WebRTC/InvalidFingerprintError"}}class IR extends Mh{constructor(e){super(`A method (${e}) was called though it has been intentionally left unimplemented.`),this.name="WebRTC/UnimplementedError"}}class CR extends Mh{constructor(e){super(`unsupported hash algorithm code: ${e} please see the codes at https://github.com/multiformats/multicodec/blob/master/table.csv `),this.name="WebRTC/UnsupportedHashAlgorithmError"}}var v5={};/*! *****************************************************************************
Copyright (C) Microsoft. All rights reserved.
Licensed under the Apache License, Version 2.0 (the "License"); you may not use
this file except in compliance with the License. You may obtain a copy of the
License at http://www.apache.org/licenses/LICENSE-2.0

THIS CODE IS PROVIDED ON AN *AS IS* BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY
KIND, EITHER EXPRESS OR IMPLIED, INCLUDING WITHOUT LIMITATION ANY IMPLIED
WARRANTIES OR CONDITIONS OF TITLE, FITNESS FOR A PARTICULAR PURPOSE,
MERCHANTABLITY OR NON-INFRINGEMENT.

See the Apache Version 2.0 License for specific language governing permissions
and limitations under the License.
***************************************************************************** */var S5;function kR(){if(S5)return v5;S5=1;var r;return function(e){(function(t){var n=typeof globalThis=="object"?globalThis:typeof Q6=="object"?Q6:typeof self=="object"?self:typeof this=="object"?this:c(),i=s(e);typeof n.Reflect<"u"&&(i=s(n.Reflect,i)),t(i,n),typeof n.Reflect>"u"&&(n.Reflect=e);function s(l,u){return function(f,g){Object.defineProperty(l,f,{configurable:!0,writable:!0,value:g}),u&&u(f,g)}}function o(){try{return Function("return this;")()}catch{}}function a(){try{return(0,eval)("(function() { return this; })()")}catch{}}function c(){return o()||a()}})(function(t,n){var i=Object.prototype.hasOwnProperty,s=typeof Symbol=="function",o=s&&typeof Symbol.toPrimitive<"u"?Symbol.toPrimitive:"@@toPrimitive",a=s&&typeof Symbol.iterator<"u"?Symbol.iterator:"@@iterator",c=typeof Object.create=="function",l={__proto__:[]}instanceof Array,u=!c&&!l,f={create:c?function(){return T(Object.create(null))}:l?function(){return T({__proto__:null})}:function(){return T({})},has:u?function(E,_){return i.call(E,_)}:function(E,_){return _ in E},get:u?function(E,_){return i.call(E,_)?E[_]:void 0}:function(E,_){return E[_]}},g=Object.getPrototypeOf(Function),m=typeof Map=="function"&&typeof Map.prototype.entries=="function"?Map:d(),w=typeof Set=="function"&&typeof Set.prototype.entries=="function"?Set:p(),x=typeof WeakMap=="function"?WeakMap:A(),v=s?Symbol.for("@reflect-metadata:registry"):void 0,C=Ie(),N=Ce(C);function O(E,_,D,z){if(ae(D)){if(!I(E))throw new TypeError;if(!V(_))throw new TypeError;return q(E,_)}else{if(!I(E))throw new TypeError;if(!Te(_))throw new TypeError;if(!Te(z)&&!ae(z)&&!Ue(z))throw new TypeError;return Ue(z)&&(z=void 0),D=Et(D),G(E,_,D,z)}}t("decorate",O);function L(E,_){function D(z,ce){if(!Te(z))throw new TypeError;if(!ae(ce)&&!re(ce))throw new TypeError;ie(E,_,z,ce)}return D}t("metadata",L);function R(E,_,D,z){if(!Te(D))throw new TypeError;return ae(z)||(z=Et(z)),ie(E,_,D,z)}t("defineMetadata",R);function F(E,_,D){if(!Te(_))throw new TypeError;return ae(D)||(D=Et(D)),W(E,_,D)}t("hasMetadata",F);function K(E,_,D){if(!Te(_))throw new TypeError;return ae(D)||(D=Et(D)),j(E,_,D)}t("hasOwnMetadata",K);function H(E,_,D){if(!Te(_))throw new TypeError;return ae(D)||(D=Et(D)),Q(E,_,D)}t("getMetadata",H);function P(E,_,D){if(!Te(_))throw new TypeError;return ae(D)||(D=Et(D)),Y(E,_,D)}t("getOwnMetadata",P);function U(E,_){if(!Te(E))throw new TypeError;return ae(_)||(_=Et(_)),Se(E,_)}t("getMetadataKeys",U);function M(E,_){if(!Te(E))throw new TypeError;return ae(_)||(_=Et(_)),te(E,_)}t("getOwnMetadataKeys",M);function $(E,_,D){if(!Te(_))throw new TypeError;if(ae(D)||(D=Et(D)),!Te(_))throw new TypeError;ae(D)||(D=Et(D));var z=b(_,D,!1);return ae(z)?!1:z.OrdinaryDeleteMetadata(E,_,D)}t("deleteMetadata",$);function q(E,_){for(var D=E.length-1;D>=0;--D){var z=E[D],ce=z(_);if(!ae(ce)&&!Ue(ce)){if(!V(ce))throw new TypeError;_=ce}}return _}function G(E,_,D,z){for(var ce=E.length-1;ce>=0;--ce){var Ne=E[ce],Oe=Ne(_,D,z);if(!ae(Oe)&&!Ue(Oe)){if(!Te(Oe))throw new TypeError;z=Oe}}return z}function W(E,_,D){var z=j(E,_,D);if(z)return!0;var ce=we(_);return Ue(ce)?!1:W(E,ce,D)}function j(E,_,D){var z=b(_,D,!1);return ae(z)?!1:ot(z.OrdinaryHasOwnMetadata(E,_,D))}function Q(E,_,D){var z=j(E,_,D);if(z)return Y(E,_,D);var ce=we(_);if(!Ue(ce))return Q(E,ce,D)}function Y(E,_,D){var z=b(_,D,!1);if(!ae(z))return z.OrdinaryGetOwnMetadata(E,_,D)}function ie(E,_,D,z){var ce=b(D,z,!0);ce.OrdinaryDefineOwnMetadata(E,_,D,z)}function Se(E,_){var D=te(E,_),z=we(E);if(z===null)return D;var ce=Se(z,_);if(ce.length<=0)return D;if(D.length<=0)return ce;for(var Ne=new w,Oe=[],$e=0,ge=D;$e<ge.length;$e++){var ve=ge[$e],xe=Ne.has(ve);xe||(Ne.add(ve),Oe.push(ve))}for(var _e=0,Ve=ce;_e<Ve.length;_e++){var ve=Ve[_e],xe=Ne.has(ve);xe||(Ne.add(ve),Oe.push(ve))}return Oe}function te(E,_){var D=b(E,_,!1);return D?D.OrdinaryOwnMetadataKeys(E,_):[]}function de(E){if(E===null)return 1;switch(typeof E){case"undefined":return 0;case"boolean":return 2;case"string":return 3;case"symbol":return 4;case"number":return 5;case"object":return E===null?1:6;default:return 6}}function ae(E){return E===void 0}function Ue(E){return E===null}function Le(E){return typeof E=="symbol"}function Te(E){return typeof E=="object"?E!==null:typeof E=="function"}function wt(E,_){switch(de(E)){case 0:return E;case 1:return E;case 2:return E;case 3:return E;case 4:return E;case 5:return E}var D="string",z=J(E,o);if(z!==void 0){var ce=z.call(E,D);if(Te(ce))throw new TypeError;return ce}return nt(E)}function nt(E,_){var D,z,ce;{var Ne=E.toString;if(k(Ne)){var z=Ne.call(E);if(!Te(z))return z}var D=E.valueOf;if(k(D)){var z=D.call(E);if(!Te(z))return z}}throw new TypeError}function ot(E){return!!E}function $t(E){return""+E}function Et(E){var _=wt(E);return Le(_)?_:$t(_)}function I(E){return Array.isArray?Array.isArray(E):E instanceof Object?E instanceof Array:Object.prototype.toString.call(E)==="[object Array]"}function k(E){return typeof E=="function"}function V(E){return typeof E=="function"}function re(E){switch(de(E)){case 3:return!0;case 4:return!0;default:return!1}}function Z(E,_){return E===_||E!==E&&_!==_}function J(E,_){var D=E[_];if(D!=null){if(!k(D))throw new TypeError;return D}}function ue(E){var _=J(E,a);if(!k(_))throw new TypeError;var D=_.call(E);if(!Te(D))throw new TypeError;return D}function le(E){return E.value}function se(E){var _=E.next();return _.done?!1:_}function ee(E){var _=E.return;_&&_.call(E)}function we(E){var _=Object.getPrototypeOf(E);if(typeof E!="function"||E===g||_!==g)return _;var D=E.prototype,z=D&&Object.getPrototypeOf(D);if(z==null||z===Object.prototype)return _;var ce=z.constructor;return typeof ce!="function"||ce===E?_:ce}function he(){var E;!ae(v)&&typeof n.Reflect<"u"&&!(v in n.Reflect)&&typeof n.Reflect.defineMetadata=="function"&&(E=Fe(n.Reflect));var _,D,z,ce=new x,Ne={registerProvider:Oe,getProvider:ge,setProvider:xe};return Ne;function Oe(_e){if(!Object.isExtensible(Ne))throw new Error("Cannot add provider to a frozen registry.");switch(!0){case E===_e:break;case ae(_):_=_e;break;case _===_e:break;case ae(D):D=_e;break;case D===_e:break;default:z===void 0&&(z=new w),z.add(_e);break}}function $e(_e,Ve){if(!ae(_)){if(_.isProviderFor(_e,Ve))return _;if(!ae(D)){if(D.isProviderFor(_e,Ve))return _;if(!ae(z))for(var gt=ue(z);;){var Pt=se(gt);if(!Pt)return;var an=le(Pt);if(an.isProviderFor(_e,Ve))return ee(gt),an}}}if(!ae(E)&&E.isProviderFor(_e,Ve))return E}function ge(_e,Ve){var gt=ce.get(_e),Pt;return ae(gt)||(Pt=gt.get(Ve)),ae(Pt)&&(Pt=$e(_e,Ve),ae(Pt)||(ae(gt)&&(gt=new m,ce.set(_e,gt)),gt.set(Ve,Pt))),Pt}function ve(_e){if(ae(_e))throw new TypeError;return _===_e||D===_e||!ae(z)&&z.has(_e)}function xe(_e,Ve,gt){if(!ve(gt))throw new Error("Metadata provider not registered.");var Pt=ge(_e,Ve);if(Pt!==gt){if(!ae(Pt))return!1;var an=ce.get(_e);ae(an)&&(an=new m,ce.set(_e,an)),an.set(Ve,gt)}return!0}}function Ie(){var E;return!ae(v)&&Te(n.Reflect)&&Object.isExtensible(n.Reflect)&&(E=n.Reflect[v]),ae(E)&&(E=he()),!ae(v)&&Te(n.Reflect)&&Object.isExtensible(n.Reflect)&&Object.defineProperty(n.Reflect,v,{enumerable:!1,configurable:!1,writable:!1,value:E}),E}function Ce(E){var _=new x,D={isProviderFor:function(ve,xe){var _e=_.get(ve);return ae(_e)?!1:_e.has(xe)},OrdinaryDefineOwnMetadata:Oe,OrdinaryHasOwnMetadata:ce,OrdinaryGetOwnMetadata:Ne,OrdinaryOwnMetadataKeys:$e,OrdinaryDeleteMetadata:ge};return C.registerProvider(D),D;function z(ve,xe,_e){var Ve=_.get(ve),gt=!1;if(ae(Ve)){if(!_e)return;Ve=new m,_.set(ve,Ve),gt=!0}var Pt=Ve.get(xe);if(ae(Pt)){if(!_e)return;if(Pt=new m,Ve.set(xe,Pt),!E.setProvider(ve,xe,D))throw Ve.delete(xe),gt&&_.delete(ve),new Error("Wrong provider for target.")}return Pt}function ce(ve,xe,_e){var Ve=z(xe,_e,!1);return ae(Ve)?!1:ot(Ve.has(ve))}function Ne(ve,xe,_e){var Ve=z(xe,_e,!1);if(!ae(Ve))return Ve.get(ve)}function Oe(ve,xe,_e,Ve){var gt=z(_e,Ve,!0);gt.set(ve,xe)}function $e(ve,xe){var _e=[],Ve=z(ve,xe,!1);if(ae(Ve))return _e;for(var gt=Ve.keys(),Pt=ue(gt),an=0;;){var xp=se(Pt);if(!xp)return _e.length=an,_e;var Vv=le(xp);try{_e[an]=Vv}catch(qv){try{ee(Pt)}finally{throw qv}}an++}}function ge(ve,xe,_e){var Ve=z(xe,_e,!1);if(ae(Ve)||!Ve.delete(ve))return!1;if(Ve.size===0){var gt=_.get(xe);ae(gt)||(gt.delete(_e),gt.size===0&&_.delete(gt))}return!0}}function Fe(E){var _=E.defineMetadata,D=E.hasOwnMetadata,z=E.getOwnMetadata,ce=E.getOwnMetadataKeys,Ne=E.deleteMetadata,Oe=new x,$e={isProviderFor:function(ge,ve){var xe=Oe.get(ge);return!ae(xe)&&xe.has(ve)?!0:ce(ge,ve).length?(ae(xe)&&(xe=new w,Oe.set(ge,xe)),xe.add(ve),!0):!1},OrdinaryDefineOwnMetadata:_,OrdinaryHasOwnMetadata:D,OrdinaryGetOwnMetadata:z,OrdinaryOwnMetadataKeys:ce,OrdinaryDeleteMetadata:Ne};return $e}function b(E,_,D){var z=C.getProvider(E,_);if(!ae(z))return z;if(D){if(C.setProvider(E,_,N))return N;throw new Error("Illegal state.")}}function d(){var E={},_=[],D=function(){function $e(ge,ve,xe){this._index=0,this._keys=ge,this._values=ve,this._selector=xe}return $e.prototype["@@iterator"]=function(){return this},$e.prototype[a]=function(){return this},$e.prototype.next=function(){var ge=this._index;if(ge>=0&&ge<this._keys.length){var ve=this._selector(this._keys[ge],this._values[ge]);return ge+1>=this._keys.length?(this._index=-1,this._keys=_,this._values=_):this._index++,{value:ve,done:!1}}return{value:void 0,done:!0}},$e.prototype.throw=function(ge){throw this._index>=0&&(this._index=-1,this._keys=_,this._values=_),ge},$e.prototype.return=function(ge){return this._index>=0&&(this._index=-1,this._keys=_,this._values=_),{value:ge,done:!0}},$e}(),z=function(){function $e(){this._keys=[],this._values=[],this._cacheKey=E,this._cacheIndex=-2}return Object.defineProperty($e.prototype,"size",{get:function(){return this._keys.length},enumerable:!0,configurable:!0}),$e.prototype.has=function(ge){return this._find(ge,!1)>=0},$e.prototype.get=function(ge){var ve=this._find(ge,!1);return ve>=0?this._values[ve]:void 0},$e.prototype.set=function(ge,ve){var xe=this._find(ge,!0);return this._values[xe]=ve,this},$e.prototype.delete=function(ge){var ve=this._find(ge,!1);if(ve>=0){for(var xe=this._keys.length,_e=ve+1;_e<xe;_e++)this._keys[_e-1]=this._keys[_e],this._values[_e-1]=this._values[_e];return this._keys.length--,this._values.length--,Z(ge,this._cacheKey)&&(this._cacheKey=E,this._cacheIndex=-2),!0}return!1},$e.prototype.clear=function(){this._keys.length=0,this._values.length=0,this._cacheKey=E,this._cacheIndex=-2},$e.prototype.keys=function(){return new D(this._keys,this._values,ce)},$e.prototype.values=function(){return new D(this._keys,this._values,Ne)},$e.prototype.entries=function(){return new D(this._keys,this._values,Oe)},$e.prototype["@@iterator"]=function(){return this.entries()},$e.prototype[a]=function(){return this.entries()},$e.prototype._find=function(ge,ve){if(!Z(this._cacheKey,ge)){this._cacheIndex=-1;for(var xe=0;xe<this._keys.length;xe++)if(Z(this._keys[xe],ge)){this._cacheIndex=xe;break}}return this._cacheIndex<0&&ve&&(this._cacheIndex=this._keys.length,this._keys.push(ge),this._values.push(void 0)),this._cacheIndex},$e}();return z;function ce($e,ge){return $e}function Ne($e,ge){return ge}function Oe($e,ge){return[$e,ge]}}function p(){var E=function(){function _(){this._map=new m}return Object.defineProperty(_.prototype,"size",{get:function(){return this._map.size},enumerable:!0,configurable:!0}),_.prototype.has=function(D){return this._map.has(D)},_.prototype.add=function(D){return this._map.set(D,D),this},_.prototype.delete=function(D){return this._map.delete(D)},_.prototype.clear=function(){this._map.clear()},_.prototype.keys=function(){return this._map.keys()},_.prototype.values=function(){return this._map.keys()},_.prototype.entries=function(){return this._map.entries()},_.prototype["@@iterator"]=function(){return this.keys()},_.prototype[a]=function(){return this.keys()},_}();return E}function A(){var E=16,_=f.create(),D=z();return function(){function ge(){this._key=z()}return ge.prototype.has=function(ve){var xe=ce(ve,!1);return xe!==void 0?f.has(xe,this._key):!1},ge.prototype.get=function(ve){var xe=ce(ve,!1);return xe!==void 0?f.get(xe,this._key):void 0},ge.prototype.set=function(ve,xe){var _e=ce(ve,!0);return _e[this._key]=xe,this},ge.prototype.delete=function(ve){var xe=ce(ve,!1);return xe!==void 0?delete xe[this._key]:!1},ge.prototype.clear=function(){this._key=z()},ge}();function z(){var ge;do ge="@@WeakMap@@"+$e();while(f.has(_,ge));return _[ge]=!0,ge}function ce(ge,ve){if(!i.call(ge,D)){if(!ve)return;Object.defineProperty(ge,D,{value:f.create()})}return ge[D]}function Ne(ge,ve){for(var xe=0;xe<ve;++xe)ge[xe]=Math.random()*255|0;return ge}function Oe(ge){if(typeof Uint8Array=="function"){var ve=new Uint8Array(ge);return typeof crypto<"u"?crypto.getRandomValues(ve):typeof msCrypto<"u"?msCrypto.getRandomValues(ve):Ne(ve,ge),ve}return Ne(new Array(ge),ge)}function $e(){var ge=Oe(E);ge[6]=ge[6]&79|64,ge[8]=ge[8]&191|128;for(var ve="",xe=0;xe<E;++xe){var _e=ge[xe];(xe===4||xe===6||xe===8)&&(ve+="-"),_e<16&&(ve+="0"),ve+=_e.toString(16).toLowerCase()}return ve}}function T(E){return E.__=void 0,delete E.__,E}})}(r||(r={})),v5}kR();/*!
 * MIT License
 * 
 * Copyright (c) 2017-2024 Peculiar Ventures, LLC
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const TR="[object ArrayBuffer]";class pe{static isArrayBuffer(e){return Object.prototype.toString.call(e)===TR}static toArrayBuffer(e){return this.isArrayBuffer(e)?e:e.byteLength===e.buffer.byteLength||e.byteOffset===0&&e.byteLength===e.buffer.byteLength?e.buffer:this.toUint8Array(e.buffer).slice(e.byteOffset,e.byteOffset+e.byteLength).buffer}static toUint8Array(e){return this.toView(e,Uint8Array)}static toView(e,t){if(e.constructor===t)return e;if(this.isArrayBuffer(e))return new t(e);if(this.isArrayBufferView(e))return new t(e.buffer,e.byteOffset,e.byteLength);throw new TypeError("The provided value is not of type '(ArrayBuffer or ArrayBufferView)'")}static isBufferSource(e){return this.isArrayBufferView(e)||this.isArrayBuffer(e)}static isArrayBufferView(e){return ArrayBuffer.isView(e)||e&&this.isArrayBuffer(e.buffer)}static isEqual(e,t){const n=pe.toUint8Array(e),i=pe.toUint8Array(t);if(n.length!==i.byteLength)return!1;for(let s=0;s<n.length;s++)if(n[s]!==i[s])return!1;return!0}static concat(...e){let t;Array.isArray(e[0])&&!(e[1]instanceof Function)||Array.isArray(e[0])&&e[1]instanceof Function?t=e[0]:e[e.length-1]instanceof Function?t=e.slice(0,e.length-1):t=e;let n=0;for(const o of t)n+=o.byteLength;const i=new Uint8Array(n);let s=0;for(const o of t){const a=this.toUint8Array(o);i.set(a,s),s+=a.length}return e[e.length-1]instanceof Function?this.toView(i,e[e.length-1]):i.buffer}}const dd="string",PR=/^[0-9a-f\s]+$/i,BR=/^(?:[A-Za-z0-9+/]{4})*(?:[A-Za-z0-9+/]{2}==|[A-Za-z0-9+/]{3}=)?$/,NR=/^[a-zA-Z0-9-_]+$/;class E5{static fromString(e){const t=unescape(encodeURIComponent(e)),n=new Uint8Array(t.length);for(let i=0;i<t.length;i++)n[i]=t.charCodeAt(i);return n.buffer}static toString(e){const t=pe.toUint8Array(e);let n="";for(let s=0;s<t.length;s++)n+=String.fromCharCode(t[s]);return decodeURIComponent(escape(n))}}class An{static toString(e,t=!1){const n=pe.toArrayBuffer(e),i=new DataView(n);let s="";for(let o=0;o<n.byteLength;o+=2){const a=i.getUint16(o,t);s+=String.fromCharCode(a)}return s}static fromString(e,t=!1){const n=new ArrayBuffer(e.length*2),i=new DataView(n);for(let s=0;s<e.length;s++)i.setUint16(s*2,e.charCodeAt(s),t);return n}}class Ee{static isHex(e){return typeof e===dd&&PR.test(e)}static isBase64(e){return typeof e===dd&&BR.test(e)}static isBase64Url(e){return typeof e===dd&&NR.test(e)}static ToString(e,t="utf8"){const n=pe.toUint8Array(e);switch(t.toLowerCase()){case"utf8":return this.ToUtf8String(n);case"binary":return this.ToBinary(n);case"hex":return this.ToHex(n);case"base64":return this.ToBase64(n);case"base64url":return this.ToBase64Url(n);case"utf16le":return An.toString(n,!0);case"utf16":case"utf16be":return An.toString(n);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromString(e,t="utf8"){if(!e)return new ArrayBuffer(0);switch(t.toLowerCase()){case"utf8":return this.FromUtf8String(e);case"binary":return this.FromBinary(e);case"hex":return this.FromHex(e);case"base64":return this.FromBase64(e);case"base64url":return this.FromBase64Url(e);case"utf16le":return An.fromString(e,!0);case"utf16":case"utf16be":return An.fromString(e);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToBase64(e){const t=pe.toUint8Array(e);if(typeof btoa<"u"){const n=this.ToString(t,"binary");return btoa(n)}else return Buffer.from(t).toString("base64")}static FromBase64(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ee.isBase64(t))throw new TypeError("Argument 'base64Text' is not Base64 encoded");return typeof atob<"u"?this.FromBinary(atob(t)):new Uint8Array(Buffer.from(t,"base64")).buffer}static FromBase64Url(e){const t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ee.isBase64Url(t))throw new TypeError("Argument 'base64url' is not Base64Url encoded");return this.FromBase64(this.Base64Padding(t.replace(/\-/g,"+").replace(/\_/g,"/")))}static ToBase64Url(e){return this.ToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/\=/g,"")}static FromUtf8String(e,t=Ee.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.FromBinary(e);case"utf8":return E5.fromString(e);case"utf16":case"utf16be":return An.fromString(e);case"utf16le":case"usc2":return An.fromString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static ToUtf8String(e,t=Ee.DEFAULT_UTF8_ENCODING){switch(t){case"ascii":return this.ToBinary(e);case"utf8":return E5.toString(e);case"utf16":case"utf16be":return An.toString(e);case"utf16le":case"usc2":return An.toString(e,!0);default:throw new Error(`Unknown type of encoding '${t}'`)}}static FromBinary(e){const t=e.length,n=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);return n.buffer}static ToBinary(e){const t=pe.toUint8Array(e);let n="";for(let i=0;i<t.length;i++)n+=String.fromCharCode(t[i]);return n}static ToHex(e){const t=pe.toUint8Array(e);let n="";const i=t.length;for(let s=0;s<i;s++){const o=t[s];o<16&&(n+="0"),n+=o.toString(16)}return n}static FromHex(e){let t=this.formatString(e);if(!t)return new ArrayBuffer(0);if(!Ee.isHex(t))throw new TypeError("Argument 'hexString' is not HEX encoded");t.length%2&&(t=`0${t}`);const n=new Uint8Array(t.length/2);for(let i=0;i<t.length;i=i+2){const s=t.slice(i,i+2);n[i/2]=parseInt(s,16)}return n.buffer}static ToUtf16String(e,t=!1){return An.toString(e,t)}static FromUtf16String(e,t=!1){return An.fromString(e,t)}static Base64Padding(e){const t=4-e.length%4;if(t<4)for(let n=0;n<t;n++)e+="=";return e}static formatString(e){return(e==null?void 0:e.replace(/[\n\r\t ]/g,""))||""}}Ee.DEFAULT_UTF8_ENCODING="utf8";function OR(...r){const e=r.map(i=>i.byteLength).reduce((i,s)=>i+s),t=new Uint8Array(e);let n=0;return r.map(i=>new Uint8Array(i)).forEach(i=>{for(const s of i)t[n++]=s}),t.buffer}function uw(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)if(t[i]!==n[i])return!1;return!0}/*!
 Copyright (c) Peculiar Ventures, LLC
*/function Wo(r,e){let t=0;if(r.length===1)return r[0];for(let n=r.length-1;n>=0;n--)t+=r[r.length-1-n]*Math.pow(2,e*n);return t}function Bs(r,e,t=-1){const n=t;let i=r,s=0,o=Math.pow(2,e);for(let a=1;a<8;a++){if(r<o){let c;if(n<0)c=new ArrayBuffer(a),s=a;else{if(n<a)return new ArrayBuffer(0);c=new ArrayBuffer(n),s=n}const l=new Uint8Array(c);for(let u=a-1;u>=0;u--){const f=Math.pow(2,u*e);l[s-u-1]=Math.floor(i/f),i-=l[s-u-1]*f}return c}o*=Math.pow(2,e)}return new ArrayBuffer(0)}function j0(...r){let e=0,t=0;for(const s of r)e+=s.length;const n=new ArrayBuffer(e),i=new Uint8Array(n);for(const s of r)i.set(s,t),t+=s.length;return i}function hw(){const r=new Uint8Array(this.valueHex);if(this.valueHex.byteLength>=2){const a=r[0]===255&&r[1]&128,c=r[0]===0&&(r[1]&128)===0;(a||c)&&this.warnings.push("Needlessly long format")}const e=new ArrayBuffer(this.valueHex.byteLength),t=new Uint8Array(e);for(let a=0;a<this.valueHex.byteLength;a++)t[a]=0;t[0]=r[0]&128;const n=Wo(t,8),i=new ArrayBuffer(this.valueHex.byteLength),s=new Uint8Array(i);for(let a=0;a<this.valueHex.byteLength;a++)s[a]=r[a];return s[0]&=127,Wo(s,8)-n}function RR(r){const e=r<0?r*-1:r;let t=128;for(let n=1;n<8;n++){if(e<=t){if(r<0){const o=t-e,a=Bs(o,8,n),c=new Uint8Array(a);return c[0]|=128,a}let i=Bs(e,8,n),s=new Uint8Array(i);if(s[0]&128){const o=i.slice(0),a=new Uint8Array(o);i=new ArrayBuffer(i.byteLength+1),s=new Uint8Array(i);for(let c=0;c<o.byteLength;c++)s[c+1]=a[c];s[0]=0}return i}t*=Math.pow(2,8)}return new ArrayBuffer(0)}function DR(r,e){if(r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<t.length;i++)if(t[i]!==n[i])return!1;return!0}function Rr(r,e){const t=r.toString(10);if(e<t.length)return"";const n=e-t.length,i=new Array(n);for(let o=0;o<n;o++)i[o]="0";return i.join("").concat(t)}/*!
 * Copyright (c) 2014, GMO GlobalSign
 * Copyright (c) 2015-2022, Peculiar Ventures
 * All rights reserved.
 * 
 * Author 2014-2019, Yury Strozhevsky
 * 
 * Redistribution and use in source and binary forms, with or without modification,
 * are permitted provided that the following conditions are met:
 * 
 * * Redistributions of source code must retain the above copyright notice, this
 *   list of conditions and the following disclaimer.
 * 
 * * Redistributions in binary form must reproduce the above copyright notice, this
 *   list of conditions and the following disclaimer in the documentation and/or
 *   other materials provided with the distribution.
 * 
 * * Neither the name of the copyright holder nor the names of its
 *   contributors may be used to endorse or promote products derived from
 *   this software without specific prior written permission.
 * 
 * THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
 * ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE IMPLIED
 * WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR PURPOSE ARE
 * DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR CONTRIBUTORS BE LIABLE FOR
 * ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES
 * (INCLUDING, BUT NOT LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES;
 * LOSS OF USE, DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON
 * ANY THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
 * (INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
 * SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
 * 
 */function S1(){if(typeof BigInt>"u")throw new Error("BigInt is not defined. Your environment doesn't implement BigInt.")}function R4(r){let e=0,t=0;for(let i=0;i<r.length;i++){const s=r[i];e+=s.byteLength}const n=new Uint8Array(e);for(let i=0;i<r.length;i++){const s=r[i];n.set(new Uint8Array(s),t),t+=s.byteLength}return n.buffer}function vi(r,e,t,n){return e instanceof Uint8Array?e.byteLength?t<0?(r.error="Wrong parameter: inputOffset less than zero",!1):n<0?(r.error="Wrong parameter: inputLength less than zero",!1):e.byteLength-t-n<0?(r.error="End of input reached before message was fully decoded (inconsistent offset and length values)",!1):!0:(r.error="Wrong parameter: inputBuffer has zero length",!1):(r.error="Wrong parameter: inputBuffer must be 'Uint8Array'",!1)}class Uh{constructor(){this.items=[]}write(e){this.items.push(e)}final(){return R4(this.items)}}const Oa=[new Uint8Array([1])],x5="0123456789",pd="name",A5="valueHexView",LR="isHexOnly",MR="idBlock",UR="tagClass",FR="tagNumber",$R="isConstructed",VR="fromBER",qR="toBER",KR="local",Er="",vn=new ArrayBuffer(0),Fh=new Uint8Array(0),Nc="EndOfContent",fw="OCTET STRING",dw="BIT STRING";function $n(r){var e;return e=class extends r{get valueHex(){return this.valueHexView.slice().buffer}set valueHex(n){this.valueHexView=new Uint8Array(n)}constructor(...n){var i;super(...n);const s=n[0]||{};this.isHexOnly=(i=s.isHexOnly)!==null&&i!==void 0?i:!1,this.valueHexView=s.valueHex?pe.toUint8Array(s.valueHex):Fh}fromBER(n,i,s){const o=n instanceof ArrayBuffer?new Uint8Array(n):n;if(!vi(this,o,i,s))return-1;const a=i+s;return this.valueHexView=o.subarray(i,a),this.valueHexView.length?(this.blockLength=s,a):(this.warnings.push("Zero buffer length"),i)}toBER(n=!1){return this.isHexOnly?n?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.byteLength===this.valueHexView.buffer.byteLength?this.valueHexView.buffer:this.valueHexView.slice().buffer:(this.error="Flag 'isHexOnly' is not set, abort",vn)}toJSON(){return{...super.toJSON(),isHexOnly:this.isHexOnly,valueHex:Ee.ToHex(this.valueHexView)}}},e.NAME="hexBlock",e}class zs{static blockName(){return this.NAME}get valueBeforeDecode(){return this.valueBeforeDecodeView.slice().buffer}set valueBeforeDecode(e){this.valueBeforeDecodeView=new Uint8Array(e)}constructor({blockLength:e=0,error:t=Er,warnings:n=[],valueBeforeDecode:i=Fh}={}){this.blockLength=e,this.error=t,this.warnings=n,this.valueBeforeDecodeView=pe.toUint8Array(i)}toJSON(){return{blockName:this.constructor.NAME,blockLength:this.blockLength,error:this.error,warnings:this.warnings,valueBeforeDecode:Ee.ToHex(this.valueBeforeDecodeView)}}}zs.NAME="baseBlock";class yr extends zs{fromBER(e,t,n){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}toBER(e,t){throw TypeError("User need to make a specific function in a class which extends 'ValueBlock'")}}yr.NAME="valueBlock";class pw extends $n(zs){constructor({idBlock:e={}}={}){var t,n,i,s;super(),e?(this.isHexOnly=(t=e.isHexOnly)!==null&&t!==void 0?t:!1,this.valueHexView=e.valueHex?pe.toUint8Array(e.valueHex):Fh,this.tagClass=(n=e.tagClass)!==null&&n!==void 0?n:-1,this.tagNumber=(i=e.tagNumber)!==null&&i!==void 0?i:-1,this.isConstructed=(s=e.isConstructed)!==null&&s!==void 0?s:!1):(this.tagClass=-1,this.tagNumber=-1,this.isConstructed=!1)}toBER(e=!1){let t=0;switch(this.tagClass){case 1:t|=0;break;case 2:t|=64;break;case 3:t|=128;break;case 4:t|=192;break;default:return this.error="Unknown tag class",vn}if(this.isConstructed&&(t|=32),this.tagNumber<31&&!this.isHexOnly){const i=new Uint8Array(1);if(!e){let s=this.tagNumber;s&=31,t|=s,i[0]=t}return i.buffer}if(!this.isHexOnly){const i=Bs(this.tagNumber,7),s=new Uint8Array(i),o=i.byteLength,a=new Uint8Array(o+1);if(a[0]=t|31,!e){for(let c=0;c<o-1;c++)a[c+1]=s[c]|128;a[o]=s[o-1]}return a.buffer}const n=new Uint8Array(this.valueHexView.byteLength+1);if(n[0]=t|31,!e){const i=this.valueHexView;for(let s=0;s<i.length-1;s++)n[s+1]=i[s]|128;n[this.valueHexView.byteLength]=i[i.length-1]}return n.buffer}fromBER(e,t,n){const i=pe.toUint8Array(e);if(!vi(this,i,t,n))return-1;const s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;switch(s[0]&192){case 0:this.tagClass=1;break;case 64:this.tagClass=2;break;case 128:this.tagClass=3;break;case 192:this.tagClass=4;break;default:return this.error="Unknown tag class",-1}this.isConstructed=(s[0]&32)===32,this.isHexOnly=!1;const a=s[0]&31;if(a!==31)this.tagNumber=a,this.blockLength=1;else{let c=1,l=this.valueHexView=new Uint8Array(255),u=255;for(;s[c]&128;){if(l[c-1]=s[c]&127,c++,c>=s.length)return this.error="End of input reached before message was fully decoded",-1;if(c===u){u+=255;const g=new Uint8Array(u);for(let m=0;m<l.length;m++)g[m]=l[m];l=this.valueHexView=new Uint8Array(u)}}this.blockLength=c+1,l[c-1]=s[c]&127;const f=new Uint8Array(c);for(let g=0;g<c;g++)f[g]=l[g];l=this.valueHexView=new Uint8Array(c),l.set(f),this.blockLength<=9?this.tagNumber=Wo(l,7):(this.isHexOnly=!0,this.warnings.push("Tag too long, represented as hex-coded"))}if(this.tagClass===1&&this.isConstructed)switch(this.tagNumber){case 1:case 2:case 5:case 6:case 9:case 13:case 14:case 23:case 24:case 31:case 32:case 33:case 34:return this.error="Constructed encoding used for primitive type",-1}return t+this.blockLength}toJSON(){return{...super.toJSON(),tagClass:this.tagClass,tagNumber:this.tagNumber,isConstructed:this.isConstructed}}}pw.NAME="identificationBlock";class gw extends zs{constructor({lenBlock:e={}}={}){var t,n,i;super(),this.isIndefiniteForm=(t=e.isIndefiniteForm)!==null&&t!==void 0?t:!1,this.longFormUsed=(n=e.longFormUsed)!==null&&n!==void 0?n:!1,this.length=(i=e.length)!==null&&i!==void 0?i:0}fromBER(e,t,n){const i=pe.toUint8Array(e);if(!vi(this,i,t,n))return-1;const s=i.subarray(t,t+n);if(s.length===0)return this.error="Zero buffer length",-1;if(s[0]===255)return this.error="Length block 0xFF is reserved by standard",-1;if(this.isIndefiniteForm=s[0]===128,this.isIndefiniteForm)return this.blockLength=1,t+this.blockLength;if(this.longFormUsed=!!(s[0]&128),this.longFormUsed===!1)return this.length=s[0],this.blockLength=1,t+this.blockLength;const o=s[0]&127;if(o>8)return this.error="Too big integer",-1;if(o+1>s.length)return this.error="End of input reached before message was fully decoded",-1;const a=t+1,c=i.subarray(a,a+o);return c[o-1]===0&&this.warnings.push("Needlessly long encoded length"),this.length=Wo(c,8),this.longFormUsed&&this.length<=127&&this.warnings.push("Unnecessary usage of long length form"),this.blockLength=o+1,t+this.blockLength}toBER(e=!1){let t,n;if(this.length>127&&(this.longFormUsed=!0),this.isIndefiniteForm)return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=128),t;if(this.longFormUsed){const i=Bs(this.length,8);if(i.byteLength>127)return this.error="Too big length",vn;if(t=new ArrayBuffer(i.byteLength+1),e)return t;const s=new Uint8Array(i);n=new Uint8Array(t),n[0]=i.byteLength|128;for(let o=0;o<i.byteLength;o++)n[o+1]=s[o];return t}return t=new ArrayBuffer(1),e===!1&&(n=new Uint8Array(t),n[0]=this.length),t}toJSON(){return{...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,longFormUsed:this.longFormUsed,length:this.length}}}gw.NAME="lengthBlock";const be={};class Wt extends zs{constructor({name:e=Er,optional:t=!1,primitiveSchema:n,...i}={},s){super(i),this.name=e,this.optional=t,n&&(this.primitiveSchema=n),this.idBlock=new pw(i),this.lenBlock=new gw(i),this.valueBlock=s?new s(i):new yr(i)}fromBER(e,t,n){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}toBER(e,t){const n=t||new Uh;t||mw(this);const i=this.idBlock.toBER(e);if(n.write(i),this.lenBlock.isIndefiniteForm)n.write(new Uint8Array([128]).buffer),this.valueBlock.toBER(e,n),n.write(new ArrayBuffer(2));else{const s=this.valueBlock.toBER(e);this.lenBlock.length=s.byteLength;const o=this.lenBlock.toBER(e);n.write(o),n.write(s)}return t?vn:n.final()}toJSON(){const e={...super.toJSON(),idBlock:this.idBlock.toJSON(),lenBlock:this.lenBlock.toJSON(),valueBlock:this.valueBlock.toJSON(),name:this.name,optional:this.optional};return this.primitiveSchema&&(e.primitiveSchema=this.primitiveSchema.toJSON()),e}toString(e="ascii"){return e==="ascii"?this.onAsciiEncoding():Ee.ToHex(this.toBER())}onAsciiEncoding(){const e=this.constructor.NAME,t=Ee.ToHex(this.valueBlock.valueBeforeDecodeView);return`${e} : ${t}`}isEqual(e){if(this===e)return!0;if(!(e instanceof this.constructor))return!1;const t=this.toBER(),n=e.toBER();return DR(t,n)}}Wt.NAME="BaseBlock";function mw(r){var e;if(r instanceof be.Constructed)for(const t of r.valueBlock.value)mw(t)&&(r.lenBlock.isIndefiniteForm=!0);return!!(!((e=r.lenBlock)===null||e===void 0)&&e.isIndefiniteForm)}class D4 extends Wt{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor({value:e=Er,...t}={},n){super(t,n),e&&this.fromString(e)}fromBER(e,t,n){const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.fromBuffer(this.valueBlock.valueHexView),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){return`${this.constructor.NAME} : '${this.valueBlock.value}'`}}D4.NAME="BaseStringBlock";class yw extends $n(yr){constructor({isHexOnly:e=!0,...t}={}){super(t),this.isHexOnly=e}}yw.NAME="PrimitiveValueBlock";var ww;class dl extends Wt{constructor(e={}){super(e,yw),this.idBlock.isConstructed=!1}}ww=dl;be.Primitive=ww;dl.NAME="PRIMITIVE";function HR(r,e){if(r instanceof e)return r;const t=new e;return t.idBlock=r.idBlock,t.lenBlock=r.lenBlock,t.warnings=r.warnings,t.valueBeforeDecodeView=r.valueBeforeDecodeView,t}function pa(r,e=0,t=r.length){const n=e;let i=new Wt({},yr);const s=new zs;if(!vi(s,r,e,t))return i.error=s.error,{offset:-1,result:i};if(!r.subarray(e,e+t).length)return i.error="Zero buffer length",{offset:-1,result:i};let a=i.idBlock.fromBER(r,e,t);if(i.idBlock.warnings.length&&i.warnings.concat(i.idBlock.warnings),a===-1)return i.error=i.idBlock.error,{offset:-1,result:i};if(e=a,t-=i.idBlock.blockLength,a=i.lenBlock.fromBER(r,e,t),i.lenBlock.warnings.length&&i.warnings.concat(i.lenBlock.warnings),a===-1)return i.error=i.lenBlock.error,{offset:-1,result:i};if(e=a,t-=i.lenBlock.blockLength,!i.idBlock.isConstructed&&i.lenBlock.isIndefiniteForm)return i.error="Indefinite length form used for primitive encoding form",{offset:-1,result:i};let c=Wt;switch(i.idBlock.tagClass){case 1:if(i.idBlock.tagNumber>=37&&i.idBlock.isHexOnly===!1)return i.error="UNIVERSAL 37 and upper tags are reserved by ASN.1 standard",{offset:-1,result:i};switch(i.idBlock.tagNumber){case 0:if(i.idBlock.isConstructed&&i.lenBlock.length>0)return i.error="Type [UNIVERSAL 0] is reserved",{offset:-1,result:i};c=be.EndOfContent;break;case 1:c=be.Boolean;break;case 2:c=be.Integer;break;case 3:c=be.BitString;break;case 4:c=be.OctetString;break;case 5:c=be.Null;break;case 6:c=be.ObjectIdentifier;break;case 10:c=be.Enumerated;break;case 12:c=be.Utf8String;break;case 13:c=be.RelativeObjectIdentifier;break;case 14:c=be.TIME;break;case 15:return i.error="[UNIVERSAL 15] is reserved by ASN.1 standard",{offset:-1,result:i};case 16:c=be.Sequence;break;case 17:c=be.Set;break;case 18:c=be.NumericString;break;case 19:c=be.PrintableString;break;case 20:c=be.TeletexString;break;case 21:c=be.VideotexString;break;case 22:c=be.IA5String;break;case 23:c=be.UTCTime;break;case 24:c=be.GeneralizedTime;break;case 25:c=be.GraphicString;break;case 26:c=be.VisibleString;break;case 27:c=be.GeneralString;break;case 28:c=be.UniversalString;break;case 29:c=be.CharacterString;break;case 30:c=be.BmpString;break;case 31:c=be.DATE;break;case 32:c=be.TimeOfDay;break;case 33:c=be.DateTime;break;case 34:c=be.Duration;break;default:{const l=i.idBlock.isConstructed?new be.Constructed:new be.Primitive;l.idBlock=i.idBlock,l.lenBlock=i.lenBlock,l.warnings=i.warnings,i=l}}break;case 2:case 3:case 4:default:c=i.idBlock.isConstructed?be.Constructed:be.Primitive}return i=HR(i,c),a=i.fromBER(r,e,i.lenBlock.isIndefiniteForm?t:i.lenBlock.length),i.valueBeforeDecodeView=r.subarray(n,n+i.blockLength),{offset:a,result:i}}function So(r){if(!r.byteLength){const e=new Wt({},yr);return e.error="Input buffer has zero length",{offset:-1,result:e}}return pa(pe.toUint8Array(r).slice(),0,r.byteLength)}function jR(r,e){return r?1:e}class Vi extends yr{constructor({value:e=[],isIndefiniteForm:t=!1,...n}={}){super(n),this.value=e,this.isIndefiniteForm=t}fromBER(e,t,n){const i=pe.toUint8Array(e);if(!vi(this,i,t,n))return-1;if(this.valueBeforeDecodeView=i.subarray(t,t+n),this.valueBeforeDecodeView.length===0)return this.warnings.push("Zero buffer length"),t;let s=t;for(;jR(this.isIndefiniteForm,n)>0;){const o=pa(i,s,n);if(o.offset===-1)return this.error=o.result.error,this.warnings.concat(o.result.warnings),-1;if(s=o.offset,this.blockLength+=o.result.blockLength,n-=o.result.blockLength,this.value.push(o.result),this.isIndefiniteForm&&o.result.constructor.NAME===Nc)break}return this.isIndefiniteForm&&(this.value[this.value.length-1].constructor.NAME===Nc?this.value.pop():this.warnings.push("No EndOfContent block encoded")),s}toBER(e,t){const n=t||new Uh;for(let i=0;i<this.value.length;i++)this.value[i].toBER(e,n);return t?vn:n.final()}toJSON(){const e={...super.toJSON(),isIndefiniteForm:this.isIndefiniteForm,value:[]};for(const t of this.value)e.value.push(t.toJSON());return e}}Vi.NAME="ConstructedValueBlock";var bw;class Ir extends Wt{constructor(e={}){super(e,Vi),this.idBlock.isConstructed=!0}fromBER(e,t,n){this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm;const i=this.valueBlock.fromBER(e,t,this.lenBlock.isIndefiniteForm?n:this.lenBlock.length);return i===-1?(this.error=this.valueBlock.error,i):(this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.valueBlock.error.length||(this.blockLength+=this.valueBlock.blockLength),i)}onAsciiEncoding(){const e=[];for(const n of this.valueBlock.value)e.push(n.toString("ascii").split(`
`).map(i=>`  ${i}`).join(`
`));const t=this.idBlock.tagClass===3?`[${this.idBlock.tagNumber}]`:this.constructor.NAME;return e.length?`${t} :
${e.join(`
`)}`:`${t} :`}}bw=Ir;be.Constructed=bw;Ir.NAME="CONSTRUCTED";class vw extends yr{fromBER(e,t,n){return t}toBER(e){return vn}}vw.override="EndOfContentValueBlock";var Sw;class L4 extends Wt{constructor(e={}){super(e,vw),this.idBlock.tagClass=1,this.idBlock.tagNumber=0}}Sw=L4;be.EndOfContent=Sw;L4.NAME=Nc;var Ew;class Ns extends Wt{constructor(e={}){super(e,yr),this.idBlock.tagClass=1,this.idBlock.tagNumber=5}fromBER(e,t,n){return this.lenBlock.length>0&&this.warnings.push("Non-zero length of value block for Null type"),this.idBlock.error.length||(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length||(this.blockLength+=this.lenBlock.blockLength),this.blockLength+=n,t+n>e.byteLength?(this.error="End of input reached before message was fully decoded (inconsistent offset and length values)",-1):t+n}toBER(e,t){const n=new ArrayBuffer(2);if(!e){const i=new Uint8Array(n);i[0]=5,i[1]=0}return t&&t.write(n),n}onAsciiEncoding(){return`${this.constructor.NAME}`}}Ew=Ns;be.Null=Ew;Ns.NAME="NULL";class xw extends $n(yr){get value(){for(const e of this.valueHexView)if(e>0)return!0;return!1}set value(e){this.valueHexView[0]=e?255:0}constructor({value:e,...t}={}){super(t),t.valueHex?this.valueHexView=pe.toUint8Array(t.valueHex):this.valueHexView=new Uint8Array(1),e&&(this.value=e)}fromBER(e,t,n){const i=pe.toUint8Array(e);return vi(this,i,t,n)?(this.valueHexView=i.subarray(t,t+n),n>1&&this.warnings.push("Boolean value encoded in more then 1 octet"),this.isHexOnly=!0,hw.call(this),this.blockLength=n,t+n):-1}toBER(){return this.valueHexView.slice()}toJSON(){return{...super.toJSON(),value:this.value}}}xw.NAME="BooleanValueBlock";var Aw;let $h=class extends Wt{getValue(){return this.valueBlock.value}setValue(e){this.valueBlock.value=e}constructor(e={}){super(e,xw),this.idBlock.tagClass=1,this.idBlock.tagNumber=1}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.getValue}`}};Aw=$h;be.Boolean=Aw;$h.NAME="BOOLEAN";class _w extends $n(Vi){constructor({isConstructed:e=!1,...t}={}){super(t),this.isConstructed=e}fromBER(e,t,n){let i=0;if(this.isConstructed){if(this.isHexOnly=!1,i=Vi.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(let s=0;s<this.value.length;s++){const o=this.value[s].constructor.NAME;if(o===Nc){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, OCTET STRING may consists of OCTET STRINGs only",-1}if(o!==fw)return this.error="OCTET STRING may consists of OCTET STRINGs only",-1}}else this.isHexOnly=!0,i=super.fromBER(e,t,n),this.blockLength=n;return i}toBER(e,t){return this.isConstructed?Vi.prototype.toBER.call(this,e,t):e?new ArrayBuffer(this.valueHexView.byteLength):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),isConstructed:this.isConstructed}}}_w.NAME="OctetStringValueBlock";var M4;let ws=class extends Wt{constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},_w),this.idBlock.tagClass=1,this.idBlock.tagNumber=4}fromBER(e,t,n){if(this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,n===0)return this.idBlock.error.length===0&&(this.blockLength+=this.idBlock.blockLength),this.lenBlock.error.length===0&&(this.blockLength+=this.lenBlock.blockLength),t;if(!this.valueBlock.isConstructed){const s=(e instanceof ArrayBuffer?new Uint8Array(e):e).subarray(t,t+n);try{if(s.byteLength){const o=pa(s,0,s.byteLength);o.offset!==-1&&o.offset===n&&(this.valueBlock.value=[o.result])}}catch{}}return super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Ir.prototype.onAsciiEncoding.call(this);const e=this.constructor.NAME,t=Ee.ToHex(this.valueBlock.valueHexView);return`${e} : ${t}`}getValue(){if(!this.idBlock.isConstructed)return this.valueBlock.valueHexView.slice().buffer;const e=[];for(const t of this.valueBlock.value)t instanceof M4&&e.push(t.valueBlock.valueHexView);return pe.concat(e)}};M4=ws;be.OctetString=M4;ws.NAME=fw;class Iw extends $n(Vi){constructor({unusedBits:e=0,isConstructed:t=!1,...n}={}){super(n),this.unusedBits=e,this.isConstructed=t,this.blockLength=this.valueHexView.byteLength}fromBER(e,t,n){if(!n)return t;let i=-1;if(this.isConstructed){if(i=Vi.prototype.fromBER.call(this,e,t,n),i===-1)return i;for(const a of this.value){const c=a.constructor.NAME;if(c===Nc){if(this.isIndefiniteForm)break;return this.error="EndOfContent is unexpected, BIT STRING may consists of BIT STRINGs only",-1}if(c!==dw)return this.error="BIT STRING may consists of BIT STRINGs only",-1;const l=a.valueBlock;if(this.unusedBits>0&&l.unusedBits>0)return this.error='Using of "unused bits" inside constructive BIT STRING allowed for least one only',-1;this.unusedBits=l.unusedBits}return i}const s=pe.toUint8Array(e);if(!vi(this,s,t,n))return-1;const o=s.subarray(t,t+n);if(this.unusedBits=o[0],this.unusedBits>7)return this.error="Unused bits for BitString must be in range 0-7",-1;if(!this.unusedBits){const a=o.subarray(1);try{if(a.byteLength){const c=pa(a,0,a.byteLength);c.offset!==-1&&c.offset===n-1&&(this.value=[c.result])}}catch{}}return this.valueHexView=o.subarray(1),this.blockLength=o.length,t+n}toBER(e,t){if(this.isConstructed)return Vi.prototype.toBER.call(this,e,t);if(e)return new ArrayBuffer(this.valueHexView.byteLength+1);if(!this.valueHexView.byteLength)return vn;const n=new Uint8Array(this.valueHexView.length+1);return n[0]=this.unusedBits,n.set(this.valueHexView,1),n.buffer}toJSON(){return{...super.toJSON(),unusedBits:this.unusedBits,isConstructed:this.isConstructed}}}Iw.NAME="BitStringValueBlock";var Cw;let bs=class extends Wt{constructor({idBlock:e={},lenBlock:t={},...n}={}){var i,s;(i=n.isConstructed)!==null&&i!==void 0||(n.isConstructed=!!(!((s=n.value)===null||s===void 0)&&s.length)),super({idBlock:{isConstructed:n.isConstructed,...e},lenBlock:{...t,isIndefiniteForm:!!n.isIndefiniteForm},...n},Iw),this.idBlock.tagClass=1,this.idBlock.tagNumber=3}fromBER(e,t,n){return this.valueBlock.isConstructed=this.idBlock.isConstructed,this.valueBlock.isIndefiniteForm=this.lenBlock.isIndefiniteForm,super.fromBER(e,t,n)}onAsciiEncoding(){if(this.valueBlock.isConstructed||this.valueBlock.value&&this.valueBlock.value.length)return Ir.prototype.onAsciiEncoding.call(this);{const e=[],t=this.valueBlock.valueHexView;for(const o of t)e.push(o.toString(2).padStart(8,"0"));const n=e.join(""),i=this.constructor.NAME,s=n.substring(0,n.length-this.valueBlock.unusedBits);return`${i} : ${s}`}}};Cw=bs;be.BitString=Cw;bs.NAME=dw;var kw;function zR(r,e){const t=new Uint8Array([0]),n=new Uint8Array(r),i=new Uint8Array(e);let s=n.slice(0);const o=s.length-1,a=i.slice(0),c=a.length-1;let l=0;const u=c<o?o:c;let f=0;for(let g=u;g>=0;g--,f++){switch(!0){case f<a.length:l=s[o-f]+a[c-f]+t[0];break;default:l=s[o-f]+t[0]}switch(t[0]=l/10,!0){case f>=s.length:s=j0(new Uint8Array([l%10]),s);break;default:s[o-f]=l%10}}return t[0]>0&&(s=j0(t,s)),s}function _5(r){if(r>=Oa.length)for(let e=Oa.length;e<=r;e++){const t=new Uint8Array([0]);let n=Oa[e-1].slice(0);for(let i=n.length-1;i>=0;i--){const s=new Uint8Array([(n[i]<<1)+t[0]]);t[0]=s[0]/10,n[i]=s[0]%10}t[0]>0&&(n=j0(t,n)),Oa.push(n)}return Oa[r]}function WR(r,e){let t=0;const n=new Uint8Array(r),i=new Uint8Array(e),s=n.slice(0),o=s.length-1,a=i.slice(0),c=a.length-1;let l,u=0;for(let f=c;f>=0;f--,u++)switch(l=s[o-u]-a[c-u]-t,!0){case l<0:t=1,s[o-u]=l+10;break;default:t=0,s[o-u]=l}if(t>0)for(let f=o-c+1;f>=0;f--,u++)if(l=s[o-u]-t,l<0)t=1,s[o-u]=l+10;else{t=0,s[o-u]=l;break}return s.slice()}class U4 extends $n(yr){setValueHex(){this.valueHexView.length>=4?(this.warnings.push("Too big Integer for decoding, hex only"),this.isHexOnly=!0,this._valueDec=0):(this.isHexOnly=!1,this.valueHexView.length>0&&(this._valueDec=hw.call(this)))}constructor({value:e,...t}={}){super(t),this._valueDec=0,t.valueHex&&this.setValueHex(),e!==void 0&&(this.valueDec=e)}set valueDec(e){this._valueDec=e,this.isHexOnly=!1,this.valueHexView=new Uint8Array(RR(e))}get valueDec(){return this._valueDec}fromDER(e,t,n,i=0){const s=this.fromBER(e,t,n);if(s===-1)return s;const o=this.valueHexView;return o[0]===0&&(o[1]&128)!==0?this.valueHexView=o.subarray(1):i!==0&&o.length<i&&(i-o.length>1&&(i=o.length+1),this.valueHexView=o.subarray(i-o.length)),s}toDER(e=!1){const t=this.valueHexView;switch(!0){case(t[0]&128)!==0:{const n=new Uint8Array(this.valueHexView.length+1);n[0]=0,n.set(t,1),this.valueHexView=n}break;case(t[0]===0&&(t[1]&128)===0):this.valueHexView=this.valueHexView.subarray(1);break}return this.toBER(e)}fromBER(e,t,n){const i=super.fromBER(e,t,n);return i===-1||this.setValueHex(),i}toBER(e){return e?new ArrayBuffer(this.valueHexView.length):this.valueHexView.slice().buffer}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}toString(){const e=this.valueHexView.length*8-1;let t=new Uint8Array(this.valueHexView.length*8/3),n=0,i;const s=this.valueHexView;let o="",a=!1;for(let c=s.byteLength-1;c>=0;c--){i=s[c];for(let l=0;l<8;l++){if((i&1)===1)switch(n){case e:t=WR(_5(n),t),o="-";break;default:t=zR(t,_5(n))}n++,i>>=1}}for(let c=0;c<t.length;c++)t[c]&&(a=!0),a&&(o+=x5.charAt(t[c]));return a===!1&&(o+=x5.charAt(0)),o}}kw=U4;U4.NAME="IntegerValueBlock";Object.defineProperty(kw.prototype,"valueHex",{set:function(r){this.valueHexView=new Uint8Array(r),this.setValueHex()},get:function(){return this.valueHexView.slice().buffer}});var oc;class ga extends Wt{constructor(e={}){super(e,U4),this.idBlock.tagClass=1,this.idBlock.tagNumber=2}toBigInt(){return S1(),BigInt(this.valueBlock.toString())}static fromBigInt(e){S1();const t=BigInt(e),n=new Uh,i=t.toString(16).replace(/^-/,""),s=new Uint8Array(Ee.FromHex(i));if(t<0){const a=new Uint8Array(s.length+(s[0]&128?1:0));a[0]|=128;const l=BigInt(`0x${Ee.ToHex(a)}`)+t,u=pe.toUint8Array(Ee.FromHex(l.toString(16)));u[0]|=128,n.write(u)}else s[0]&128&&n.write(new Uint8Array([0])),n.write(s);return new oc({valueHex:n.final()})}convertToDER(){const e=new oc({valueHex:this.valueBlock.valueHexView});return e.valueBlock.toDER(),e}convertFromDER(){return new oc({valueHex:this.valueBlock.valueHexView[0]===0?this.valueBlock.valueHexView.subarray(1):this.valueBlock.valueHexView})}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()}`}}oc=ga;be.Integer=oc;ga.NAME="INTEGER";var Tw;class Vh extends ga{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=10}}Tw=Vh;be.Enumerated=Tw;Vh.NAME="ENUMERATED";class z0 extends $n(yr){constructor({valueDec:e=-1,isFirstSid:t=!1,...n}={}){super(n),this.valueDec=e,this.isFirstSid=t}fromBER(e,t,n){if(!n)return t;const i=pe.toUint8Array(e);if(!vi(this,i,t,n))return-1;const s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=s[a]&127,this.blockLength++,(s[a]&128)!==0);a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,(s[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Wo(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}set valueBigInt(e){S1();let t=BigInt(e).toString(2);for(;t.length%7;)t="0"+t;const n=new Uint8Array(t.length/7);for(let i=0;i<n.length;i++)n[i]=parseInt(t.slice(i*7,i*7+7),2)+(i+1<n.length?128:0);this.fromBER(n.buffer,0,n.length)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}const t=Bs(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",vn;const n=new Uint8Array(t.byteLength);if(!e){const i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n}toString(){let e="";if(this.isHexOnly)e=Ee.ToHex(this.valueHexView);else if(this.isFirstSid){let t=this.valueDec;this.valueDec<=39?e="0.":this.valueDec<=79?(e="1.",t-=40):(e="2.",t-=80),e+=t.toString()}else e=this.valueDec.toString();return e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec,isFirstSid:this.isFirstSid}}}z0.NAME="sidBlock";class Pw extends yr{constructor({value:e=Er,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){const s=new z0;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.value.length===0&&(s.isFirstSid=!0),this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e){const t=[];for(let n=0;n<this.value.length;n++){const i=this.value[n].toBER(e);if(i.byteLength===0)return this.error=this.value[n].error,vn;t.push(i)}return R4(t)}fromString(e){this.value=[];let t=0,n=0,i="",s=!1;do if(n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1,s){const o=this.value[0];let a=0;switch(o.valueDec){case 0:break;case 1:a=40;break;case 2:a=80;break;default:this.value=[];return}const c=parseInt(i,10);if(isNaN(c))return;o.valueDec=c+a,s=!1}else{const o=new z0;if(i>Number.MAX_SAFE_INTEGER){S1();const a=BigInt(i);o.valueBigInt=a}else if(o.valueDec=parseInt(i,10),isNaN(o.valueDec))return;this.value.length||(o.isFirstSid=!0,s=!0),this.value.push(o)}while(n!==-1)}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t?(i=`{${i}}`,this.value[n].isFirstSid?e=`2.{${i} - 80}`:e+=i):e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Pw.NAME="ObjectIdentifierValueBlock";var Bw;class qh extends Wt{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Pw),this.idBlock.tagClass=1,this.idBlock.tagNumber=6}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Bw=qh;be.ObjectIdentifier=Bw;qh.NAME="OBJECT IDENTIFIER";class W0 extends $n(zs){constructor({valueDec:e=0,...t}={}){super(t),this.valueDec=e}fromBER(e,t,n){if(n===0)return t;const i=pe.toUint8Array(e);if(!vi(this,i,t,n))return-1;const s=i.subarray(t,t+n);this.valueHexView=new Uint8Array(n);for(let a=0;a<n&&(this.valueHexView[a]=s[a]&127,this.blockLength++,(s[a]&128)!==0);a++);const o=new Uint8Array(this.blockLength);for(let a=0;a<this.blockLength;a++)o[a]=this.valueHexView[a];return this.valueHexView=o,(s[this.blockLength-1]&128)!==0?(this.error="End of input reached before message was fully decoded",-1):(this.valueHexView[0]===0&&this.warnings.push("Needlessly long format of SID encoding"),this.blockLength<=8?this.valueDec=Wo(this.valueHexView,7):(this.isHexOnly=!0,this.warnings.push("Too big SID for decoding, hex only")),t+this.blockLength)}toBER(e){if(this.isHexOnly){if(e)return new ArrayBuffer(this.valueHexView.byteLength);const i=this.valueHexView,s=new Uint8Array(this.blockLength);for(let o=0;o<this.blockLength-1;o++)s[o]=i[o]|128;return s[this.blockLength-1]=i[this.blockLength-1],s.buffer}const t=Bs(this.valueDec,7);if(t.byteLength===0)return this.error="Error during encoding SID value",vn;const n=new Uint8Array(t.byteLength);if(!e){const i=new Uint8Array(t),s=t.byteLength-1;for(let o=0;o<s;o++)n[o]=i[o]|128;n[s]=i[s]}return n.buffer}toString(){let e="";return this.isHexOnly?e=Ee.ToHex(this.valueHexView):e=this.valueDec.toString(),e}toJSON(){return{...super.toJSON(),valueDec:this.valueDec}}}W0.NAME="relativeSidBlock";class Nw extends yr{constructor({value:e=Er,...t}={}){super(t),this.value=[],e&&this.fromString(e)}fromBER(e,t,n){let i=t;for(;n>0;){const s=new W0;if(i=s.fromBER(e,i,n),i===-1)return this.blockLength=0,this.error=s.error,i;this.blockLength+=s.blockLength,n-=s.blockLength,this.value.push(s)}return i}toBER(e,t){const n=[];for(let i=0;i<this.value.length;i++){const s=this.value[i].toBER(e);if(s.byteLength===0)return this.error=this.value[i].error,vn;n.push(s)}return R4(n)}fromString(e){this.value=[];let t=0,n=0,i="";do{n=e.indexOf(".",t),n===-1?i=e.substring(t):i=e.substring(t,n),t=n+1;const s=new W0;if(s.valueDec=parseInt(i,10),isNaN(s.valueDec))return!0;this.value.push(s)}while(n!==-1);return!0}toString(){let e="",t=!1;for(let n=0;n<this.value.length;n++){t=this.value[n].isHexOnly;let i=this.value[n].toString();n!==0&&(e=`${e}.`),t&&(i=`{${i}}`),e+=i}return e}toJSON(){const e={...super.toJSON(),value:this.toString(),sidArray:[]};for(let t=0;t<this.value.length;t++)e.sidArray.push(this.value[t].toJSON());return e}}Nw.NAME="RelativeObjectIdentifierValueBlock";var Ow;class F4 extends Wt{getValue(){return this.valueBlock.toString()}setValue(e){this.valueBlock.fromString(e)}constructor(e={}){super(e,Nw),this.idBlock.tagClass=1,this.idBlock.tagNumber=13}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.valueBlock.toString()||"empty"}`}toJSON(){return{...super.toJSON(),value:this.getValue()}}}Ow=F4;be.RelativeObjectIdentifier=Ow;F4.NAME="RelativeObjectIdentifier";var Rw;class ii extends Ir{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=16}}Rw=ii;be.Sequence=Rw;ii.NAME="SEQUENCE";var Dw;let si=class extends Ir{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=17}};Dw=si;be.Set=Dw;si.NAME="SET";class Lw extends $n(yr){constructor({...e}={}){super(e),this.isHexOnly=!0,this.value=Er}toJSON(){return{...super.toJSON(),value:this.value}}}Lw.NAME="StringValueBlock";class Mw extends Lw{}Mw.NAME="SimpleStringValueBlock";class Vr extends D4{constructor({...e}={}){super(e,Mw)}fromBuffer(e){this.valueBlock.value=String.fromCharCode.apply(null,pe.toUint8Array(e))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t);for(let i=0;i<t;i++)n[i]=e.charCodeAt(i);this.valueBlock.value=e}}Vr.NAME="SIMPLE STRING";class Uw extends Vr{fromBuffer(e){this.valueBlock.valueHexView=pe.toUint8Array(e);try{this.valueBlock.value=Ee.ToUtf8String(e)}catch(t){this.warnings.push(`Error during "decodeURIComponent": ${t}, using raw string`),this.valueBlock.value=Ee.ToBinary(e)}}fromString(e){this.valueBlock.valueHexView=new Uint8Array(Ee.FromUtf8String(e)),this.valueBlock.value=e}}Uw.NAME="Utf8StringValueBlock";var Fw;class Si extends Uw{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=12}}Fw=Si;be.Utf8String=Fw;Si.NAME="UTF8String";class $w extends Vr{fromBuffer(e){this.valueBlock.value=Ee.ToUtf16String(e),this.valueBlock.valueHexView=pe.toUint8Array(e)}fromString(e){this.valueBlock.value=e,this.valueBlock.valueHexView=new Uint8Array(Ee.FromUtf16String(e))}}$w.NAME="BmpStringValueBlock";var Vw;class Kh extends $w{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=30}}Vw=Kh;be.BmpString=Vw;Kh.NAME="BMPString";class qw extends Vr{fromBuffer(e){const t=ArrayBuffer.isView(e)?e.slice().buffer:e.slice(0),n=new Uint8Array(t);for(let i=0;i<n.length;i+=4)n[i]=n[i+3],n[i+1]=n[i+2],n[i+2]=0,n[i+3]=0;this.valueBlock.value=String.fromCharCode.apply(null,new Uint32Array(t))}fromString(e){const t=e.length,n=this.valueBlock.valueHexView=new Uint8Array(t*4);for(let i=0;i<t;i++){const s=Bs(e.charCodeAt(i),8),o=new Uint8Array(s);if(o.length>4)continue;const a=4-o.length;for(let c=o.length-1;c>=0;c--)n[i*4+c+a]=o[c]}this.valueBlock.value=e}}qw.NAME="UniversalStringValueBlock";var Kw;class Hh extends qw{constructor({...e}={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=28}}Kw=Hh;be.UniversalString=Kw;Hh.NAME="UniversalString";var Hw;class jh extends Vr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=18}}Hw=jh;be.NumericString=Hw;jh.NAME="NumericString";var jw;class zh extends Vr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=19}}jw=zh;be.PrintableString=jw;zh.NAME="PrintableString";var zw;class Wh extends Vr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=20}}zw=Wh;be.TeletexString=zw;Wh.NAME="TeletexString";var Ww;class Gh extends Vr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=21}}Ww=Gh;be.VideotexString=Ww;Gh.NAME="VideotexString";var Gw;class Qh extends Vr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=22}}Gw=Qh;be.IA5String=Gw;Qh.NAME="IA5String";var Qw;class Yh extends Vr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=25}}Qw=Yh;be.GraphicString=Qw;Yh.NAME="GraphicString";var Yw;class pl extends Vr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=26}}Yw=pl;be.VisibleString=Yw;pl.NAME="VisibleString";var Zw;class Zh extends Vr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=27}}Zw=Zh;be.GeneralString=Zw;Zh.NAME="GeneralString";var Xw;class Xh extends Vr{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=29}}Xw=Xh;be.CharacterString=Xw;Xh.NAME="CharacterString";var Jw;class gl extends pl{constructor({value:e,valueDate:t,...n}={}){if(super(n),this.year=0,this.month=0,this.day=0,this.hour=0,this.minute=0,this.second=0,e){this.fromString(e),this.valueBlock.valueHexView=new Uint8Array(e.length);for(let i=0;i<e.length;i++)this.valueBlock.valueHexView[i]=e.charCodeAt(i)}t&&(this.fromDate(t),this.valueBlock.valueHexView=new Uint8Array(this.toBuffer())),this.idBlock.tagClass=1,this.idBlock.tagNumber=23}fromBuffer(e){this.fromString(String.fromCharCode.apply(null,pe.toUint8Array(e)))}toBuffer(){const e=this.toString(),t=new ArrayBuffer(e.length),n=new Uint8Array(t);for(let i=0;i<e.length;i++)n[i]=e.charCodeAt(i);return t}fromDate(e){this.year=e.getUTCFullYear(),this.month=e.getUTCMonth()+1,this.day=e.getUTCDate(),this.hour=e.getUTCHours(),this.minute=e.getUTCMinutes(),this.second=e.getUTCSeconds()}toDate(){return new Date(Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second))}fromString(e){const n=/(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})Z/ig.exec(e);if(n===null){this.error="Wrong input string for conversion";return}const i=parseInt(n[1],10);i>=50?this.year=1900+i:this.year=2e3+i,this.month=parseInt(n[2],10),this.day=parseInt(n[3],10),this.hour=parseInt(n[4],10),this.minute=parseInt(n[5],10),this.second=parseInt(n[6],10)}toString(e="iso"){if(e==="iso"){const t=new Array(7);return t[0]=Rr(this.year<2e3?this.year-1900:this.year-2e3,2),t[1]=Rr(this.month,2),t[2]=Rr(this.day,2),t[3]=Rr(this.hour,2),t[4]=Rr(this.minute,2),t[5]=Rr(this.second,2),t[6]="Z",t.join("")}return super.toString(e)}onAsciiEncoding(){return`${this.constructor.NAME} : ${this.toDate().toISOString()}`}toJSON(){return{...super.toJSON(),year:this.year,month:this.month,day:this.day,hour:this.hour,minute:this.minute,second:this.second}}}Jw=gl;be.UTCTime=Jw;gl.NAME="UTCTime";var eb;class Jh extends gl{constructor(e={}){var t;super(e),(t=this.millisecond)!==null&&t!==void 0||(this.millisecond=0),this.idBlock.tagClass=1,this.idBlock.tagNumber=24}fromDate(e){super.fromDate(e),this.millisecond=e.getUTCMilliseconds()}toDate(){const e=Date.UTC(this.year,this.month-1,this.day,this.hour,this.minute,this.second,this.millisecond);return new Date(e)}fromString(e){let t=!1,n="",i="",s=0,o,a=0,c=0;if(e[e.length-1]==="Z")n=e.substring(0,e.length-1),t=!0;else{const f=new Number(e[e.length-1]);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");n=e}if(t){if(n.indexOf("+")!==-1)throw new Error("Wrong input string for conversion");if(n.indexOf("-")!==-1)throw new Error("Wrong input string for conversion")}else{let f=1,g=n.indexOf("+"),m="";if(g===-1&&(g=n.indexOf("-"),f=-1),g!==-1){if(m=n.substring(g+1),n=n.substring(0,g),m.length!==2&&m.length!==4)throw new Error("Wrong input string for conversion");let w=parseInt(m.substring(0,2),10);if(isNaN(w.valueOf()))throw new Error("Wrong input string for conversion");if(a=f*w,m.length===4){if(w=parseInt(m.substring(2,4),10),isNaN(w.valueOf()))throw new Error("Wrong input string for conversion");c=f*w}}}let l=n.indexOf(".");if(l===-1&&(l=n.indexOf(",")),l!==-1){const f=new Number(`0${n.substring(l)}`);if(isNaN(f.valueOf()))throw new Error("Wrong input string for conversion");s=f.valueOf(),i=n.substring(0,l)}else i=n;switch(!0){case i.length===8:if(o=/(\d{4})(\d{2})(\d{2})/ig,l!==-1)throw new Error("Wrong input string for conversion");break;case i.length===10:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let f=60*s;this.minute=Math.floor(f),f=60*(f-this.minute),this.second=Math.floor(f),f=1e3*(f-this.second),this.millisecond=Math.floor(f)}break;case i.length===12:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){let f=60*s;this.second=Math.floor(f),f=1e3*(f-this.second),this.millisecond=Math.floor(f)}break;case i.length===14:if(o=/(\d{4})(\d{2})(\d{2})(\d{2})(\d{2})(\d{2})/ig,l!==-1){const f=1e3*s;this.millisecond=Math.floor(f)}break;default:throw new Error("Wrong input string for conversion")}const u=o.exec(i);if(u===null)throw new Error("Wrong input string for conversion");for(let f=1;f<u.length;f++)switch(f){case 1:this.year=parseInt(u[f],10);break;case 2:this.month=parseInt(u[f],10);break;case 3:this.day=parseInt(u[f],10);break;case 4:this.hour=parseInt(u[f],10)+a;break;case 5:this.minute=parseInt(u[f],10)+c;break;case 6:this.second=parseInt(u[f],10);break;default:throw new Error("Wrong input string for conversion")}if(t===!1){const f=new Date(this.year,this.month,this.day,this.hour,this.minute,this.second,this.millisecond);this.year=f.getUTCFullYear(),this.month=f.getUTCMonth(),this.day=f.getUTCDay(),this.hour=f.getUTCHours(),this.minute=f.getUTCMinutes(),this.second=f.getUTCSeconds(),this.millisecond=f.getUTCMilliseconds()}}toString(e="iso"){if(e==="iso"){const t=[];return t.push(Rr(this.year,4)),t.push(Rr(this.month,2)),t.push(Rr(this.day,2)),t.push(Rr(this.hour,2)),t.push(Rr(this.minute,2)),t.push(Rr(this.second,2)),this.millisecond!==0&&(t.push("."),t.push(Rr(this.millisecond,3))),t.push("Z"),t.join("")}return super.toString(e)}toJSON(){return{...super.toJSON(),millisecond:this.millisecond}}}eb=Jh;be.GeneralizedTime=eb;Jh.NAME="GeneralizedTime";var tb;class $4 extends Si{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=31}}tb=$4;be.DATE=tb;$4.NAME="DATE";var rb;class V4 extends Si{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=32}}rb=V4;be.TimeOfDay=rb;V4.NAME="TimeOfDay";var nb;class q4 extends Si{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=33}}nb=q4;be.DateTime=nb;q4.NAME="DateTime";var ib;class K4 extends Si{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=34}}ib=K4;be.Duration=ib;K4.NAME="Duration";var sb;class H4 extends Si{constructor(e={}){super(e),this.idBlock.tagClass=1,this.idBlock.tagNumber=14}}sb=H4;be.TIME=sb;H4.NAME="TIME";class Os{constructor({name:e=Er,optional:t=!1}={}){this.name=e,this.optional=t}}class j4 extends Os{constructor({value:e=[],...t}={}){super(t),this.value=e}}class E1 extends Os{constructor({value:e=new Os,local:t=!1,...n}={}){super(n),this.value=e,this.local=t}}class GR{get data(){return this.dataView.slice().buffer}set data(e){this.dataView=pe.toUint8Array(e)}constructor({data:e=Fh}={}){this.dataView=pe.toUint8Array(e)}fromBER(e,t,n){const i=t+n;return this.dataView=pe.toUint8Array(e).subarray(t,i),i}toBER(e){return this.dataView.slice().buffer}}function hs(r,e,t){if(t instanceof j4){for(const s of t.value)if(hs(r,e,s).verified)return{verified:!0,result:r};{const s={verified:!1,result:{error:"Wrong values for Choice type"}};return t.hasOwnProperty(pd)&&(s.name=t.name),s}}if(t instanceof Os)return t.hasOwnProperty(pd)&&(r[t.name]=e),{verified:!0,result:r};if(!(r instanceof Object))return{verified:!1,result:{error:"Wrong root object"}};if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 data"}};if(!(t instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(MR in t))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(VR in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(!(qR in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const n=t.idBlock.toBER(!1);if(n.byteLength===0)return{verified:!1,result:{error:"Error encoding idBlock for ASN.1 schema"}};if(t.idBlock.fromBER(n,0,n.byteLength)===-1)return{verified:!1,result:{error:"Error decoding idBlock for ASN.1 schema"}};if(t.idBlock.hasOwnProperty(UR)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagClass!==e.idBlock.tagClass)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty(FR)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.tagNumber!==e.idBlock.tagNumber)return{verified:!1,result:r};if(t.idBlock.hasOwnProperty($R)===!1)return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isConstructed!==e.idBlock.isConstructed)return{verified:!1,result:r};if(!(LR in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};if(t.idBlock.isHexOnly!==e.idBlock.isHexOnly)return{verified:!1,result:r};if(t.idBlock.isHexOnly){if(!(A5 in t.idBlock))return{verified:!1,result:{error:"Wrong ASN.1 schema"}};const s=t.idBlock.valueHexView,o=e.idBlock.valueHexView;if(s.length!==o.length)return{verified:!1,result:r};for(let a=0;a<s.length;a++)if(s[a]!==o[1])return{verified:!1,result:r}}if(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Er),t.name&&(r[t.name]=e)),t instanceof be.Constructed){let s=0,o={verified:!1,result:{error:"Unknown error"}},a=t.valueBlock.value.length;if(a>0&&t.valueBlock.value[0]instanceof E1&&(a=e.valueBlock.value.length),a===0)return{verified:!0,result:r};if(e.valueBlock.value.length===0&&t.valueBlock.value.length!==0){let c=!0;for(let l=0;l<t.valueBlock.value.length;l++)c=c&&(t.valueBlock.value[l].optional||!1);return c?{verified:!0,result:r}:(t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Er),t.name&&delete r[t.name]),r.error="Inconsistent object length",{verified:!1,result:r})}for(let c=0;c<a;c++)if(c-s>=e.valueBlock.value.length){if(t.valueBlock.value[c].optional===!1){const l={verified:!1,result:r};return r.error="Inconsistent length between ASN.1 data and schema",t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Er),t.name&&(delete r[t.name],l.name=t.name)),l}}else if(t.valueBlock.value[0]instanceof E1){if(o=hs(r,e.valueBlock.value[c],t.valueBlock.value[0].value),o.verified===!1)if(t.valueBlock.value[0].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Er),t.name&&delete r[t.name]),o;if(pd in t.valueBlock.value[0]&&t.valueBlock.value[0].name.length>0){let l={};KR in t.valueBlock.value[0]&&t.valueBlock.value[0].local?l=e:l=r,typeof l[t.valueBlock.value[0].name]>"u"&&(l[t.valueBlock.value[0].name]=[]),l[t.valueBlock.value[0].name].push(e.valueBlock.value[c])}}else if(o=hs(r,e.valueBlock.value[c-s],t.valueBlock.value[c]),o.verified===!1)if(t.valueBlock.value[c].optional)s++;else return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Er),t.name&&delete r[t.name]),o;if(o.verified===!1){const c={verified:!1,result:r};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Er),t.name&&(delete r[t.name],c.name=t.name)),c}return{verified:!0,result:r}}if(t.primitiveSchema&&A5 in e.valueBlock){const s=pa(e.valueBlock.valueHexView);if(s.offset===-1){const o={verified:!1,result:s.result};return t.name&&(t.name=t.name.replace(/^\s+|\s+$/g,Er),t.name&&(delete r[t.name],o.name=t.name)),o}return hs(r,s.result,t.primitiveSchema)}return{verified:!0,result:r}}function QR(r,e){if(!(e instanceof Object))return{verified:!1,result:{error:"Wrong ASN.1 schema type"}};const t=pa(pe.toUint8Array(r));return t.offset===-1?{verified:!1,result:t.result}:hs(t.result,t.result,e)}const ob=Object.freeze(Object.defineProperty({__proto__:null,Any:Os,BaseBlock:Wt,BaseStringBlock:D4,BitString:bs,BmpString:Kh,Boolean:$h,CharacterString:Xh,Choice:j4,Constructed:Ir,DATE:$4,DateTime:q4,Duration:K4,EndOfContent:L4,Enumerated:Vh,GeneralString:Zh,GeneralizedTime:Jh,GraphicString:Yh,HexBlock:$n,IA5String:Qh,Integer:ga,Null:Ns,NumericString:jh,ObjectIdentifier:qh,OctetString:ws,Primitive:dl,PrintableString:zh,RawData:GR,RelativeObjectIdentifier:F4,Repeated:E1,Sequence:ii,Set:si,TIME:H4,TeletexString:Wh,TimeOfDay:V4,UTCTime:gl,UniversalString:Hh,Utf8String:Si,ValueBlock:yr,VideotexString:Gh,ViewWriter:Uh,VisibleString:pl,compareSchema:hs,fromBER:So,verifySchema:QR},Symbol.toStringTag,{value:"Module"}));var X;(function(r){r[r.Sequence=0]="Sequence",r[r.Set=1]="Set",r[r.Choice=2]="Choice"})(X||(X={}));var B;(function(r){r[r.Any=1]="Any",r[r.Boolean=2]="Boolean",r[r.OctetString=3]="OctetString",r[r.BitString=4]="BitString",r[r.Integer=5]="Integer",r[r.Enumerated=6]="Enumerated",r[r.ObjectIdentifier=7]="ObjectIdentifier",r[r.Utf8String=8]="Utf8String",r[r.BmpString=9]="BmpString",r[r.UniversalString=10]="UniversalString",r[r.NumericString=11]="NumericString",r[r.PrintableString=12]="PrintableString",r[r.TeletexString=13]="TeletexString",r[r.VideotexString=14]="VideotexString",r[r.IA5String=15]="IA5String",r[r.GraphicString=16]="GraphicString",r[r.VisibleString=17]="VisibleString",r[r.GeneralString=18]="GeneralString",r[r.CharacterString=19]="CharacterString",r[r.UTCTime=20]="UTCTime",r[r.GeneralizedTime=21]="GeneralizedTime",r[r.DATE=22]="DATE",r[r.TimeOfDay=23]="TimeOfDay",r[r.DateTime=24]="DateTime",r[r.Duration=25]="Duration",r[r.TIME=26]="TIME",r[r.Null=27]="Null"})(B||(B={}));class ef{constructor(e,t=0){if(this.unusedBits=0,this.value=new ArrayBuffer(0),e)if(typeof e=="number")this.fromNumber(e);else if(pe.isBufferSource(e))this.unusedBits=t,this.value=pe.toArrayBuffer(e);else throw TypeError("Unsupported type of 'params' argument for BitString")}fromASN(e){if(!(e instanceof bs))throw new TypeError("Argument 'asn' is not instance of ASN.1 BitString");return this.unusedBits=e.valueBlock.unusedBits,this.value=e.valueBlock.valueHex,this}toASN(){return new bs({unusedBits:this.unusedBits,valueHex:this.value})}toSchema(e){return new bs({name:e})}toNumber(){let e="";const t=new Uint8Array(this.value);for(const n of t)e+=n.toString(2).padStart(8,"0");return e=e.split("").reverse().join(""),this.unusedBits&&(e=e.slice(this.unusedBits).padStart(this.unusedBits,"0")),parseInt(e,2)}fromNumber(e){let t=e.toString(2);const n=t.length+7>>3;this.unusedBits=(n<<3)-t.length;const i=new Uint8Array(n);t=t.padStart(n<<3,"0").split("").reverse().join("");let s=0;for(;s<n;)i[s]=parseInt(t.slice(s<<3,(s<<3)+8),2),s++;this.value=i.buffer}}class ze{get byteLength(){return this.buffer.byteLength}get byteOffset(){return 0}constructor(e){typeof e=="number"?this.buffer=new ArrayBuffer(e):pe.isBufferSource(e)?this.buffer=pe.toArrayBuffer(e):Array.isArray(e)?this.buffer=new Uint8Array(e):this.buffer=new ArrayBuffer(0)}fromASN(e){if(!(e instanceof ws))throw new TypeError("Argument 'asn' is not instance of ASN.1 OctetString");return this.buffer=e.valueBlock.valueHex,this}toASN(){return new ws({valueHex:this.buffer})}toSchema(e){return new ws({name:e})}}const YR={fromASN:r=>r instanceof Ns?null:r.valueBeforeDecodeView,toASN:r=>{if(r===null)return new Ns;const e=So(r);if(e.result.error)throw new Error(e.result.error);return e.result}},ZR={fromASN:r=>r.valueBlock.valueHexView.byteLength>=4?r.valueBlock.toString():r.valueBlock.valueDec,toASN:r=>new ga({value:+r})},XR={fromASN:r=>r.valueBlock.valueDec,toASN:r=>new Vh({value:r})},yt={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new ga({valueHex:r})},JR={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new bs({valueHex:r})},eD={fromASN:r=>r.valueBlock.toString(),toASN:r=>new qh({value:r})},tD={fromASN:r=>r.valueBlock.value,toASN:r=>new $h({value:r})},x1={fromASN:r=>r.valueBlock.valueHexView,toASN:r=>new ws({valueHex:r})},rD={fromASN:r=>new ze(r.getValue()),toASN:r=>r.toASN()};function nn(r){return{fromASN:e=>e.valueBlock.value,toASN:e=>new r({value:e})}}const ab=nn(Si),nD=nn(Kh),iD=nn(Hh),sD=nn(jh),oD=nn(zh),aD=nn(Wh),cD=nn(Gh),lD=nn(Qh),uD=nn(Yh),hD=nn(pl),fD=nn(Zh),dD=nn(Xh),pD={fromASN:r=>r.toDate(),toASN:r=>new gl({valueDate:r})},gD={fromASN:r=>r.toDate(),toASN:r=>new Jh({valueDate:r})},mD={fromASN:()=>null,toASN:()=>new Ns};function z4(r){switch(r){case B.Any:return YR;case B.BitString:return JR;case B.BmpString:return nD;case B.Boolean:return tD;case B.CharacterString:return dD;case B.Enumerated:return XR;case B.GeneralString:return fD;case B.GeneralizedTime:return gD;case B.GraphicString:return uD;case B.IA5String:return lD;case B.Integer:return ZR;case B.Null:return mD;case B.NumericString:return sD;case B.ObjectIdentifier:return eD;case B.OctetString:return x1;case B.PrintableString:return oD;case B.TeletexString:return aD;case B.UTCTime:return pD;case B.UniversalString:return iD;case B.Utf8String:return ab;case B.VideotexString:return cD;case B.VisibleString:return hD;default:return null}}function ei(r){return typeof r=="function"&&r.prototype?r.prototype.toASN&&r.prototype.fromASN?!0:ei(r.prototype):!!(r&&typeof r=="object"&&"toASN"in r&&"fromASN"in r)}function cb(r){var e;if(r){const t=Object.getPrototypeOf(r);return((e=t==null?void 0:t.prototype)===null||e===void 0?void 0:e.constructor)===Array?!0:cb(t)}return!1}function yD(r,e){if(!(r&&e)||r.byteLength!==e.byteLength)return!1;const t=new Uint8Array(r),n=new Uint8Array(e);for(let i=0;i<r.byteLength;i++)if(t[i]!==n[i])return!1;return!0}class wD{constructor(){this.items=new WeakMap}has(e){return this.items.has(e)}get(e,t=!1){const n=this.items.get(e);if(!n)throw new Error(`Cannot get schema for '${e.prototype.constructor.name}' target`);if(t&&!n.schema)throw new Error(`Schema '${e.prototype.constructor.name}' doesn't contain ASN.1 schema. Call 'AsnSchemaStorage.cache'.`);return n}cache(e){const t=this.get(e);t.schema||(t.schema=this.create(e,!0))}createDefault(e){const t={type:X.Sequence,items:{}},n=this.findParentSchema(e);return n&&(Object.assign(t,n),t.items=Object.assign({},t.items,n.items)),t}create(e,t){const n=this.items.get(e)||this.createDefault(e),i=[];for(const s in n.items){const o=n.items[s],a=t?s:"";let c;if(typeof o.type=="number"){const u=B[o.type],f=ob[u];if(!f)throw new Error(`Cannot get ASN1 class by name '${u}'`);c=new f({name:a})}else ei(o.type)?c=new o.type().toSchema(a):o.optional?this.get(o.type).type===X.Choice?c=new Os({name:a}):(c=this.create(o.type,!1),c.name=a):c=new Os({name:a});const l=!!o.optional||o.defaultValue!==void 0;if(o.repeated){c.name="";const u=o.repeated==="set"?si:ii;c=new u({name:"",value:[new E1({name:a,value:c})]})}if(o.context!==null&&o.context!==void 0)if(o.implicit)if(typeof o.type=="number"||ei(o.type)){const u=o.repeated?Ir:dl;i.push(new u({name:a,optional:l,idBlock:{tagClass:3,tagNumber:o.context}}))}else{this.cache(o.type);const u=!!o.repeated;let f=u?c:this.get(o.type,!0).schema;f="valueBlock"in f?f.valueBlock.value:f.value,i.push(new Ir({name:u?"":a,optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:f}))}else i.push(new Ir({optional:l,idBlock:{tagClass:3,tagNumber:o.context},value:[c]}));else c.optional=l,i.push(c)}switch(n.type){case X.Sequence:return new ii({value:i,name:""});case X.Set:return new si({value:i,name:""});case X.Choice:return new j4({value:i,name:""});default:throw new Error("Unsupported ASN1 type in use")}}set(e,t){return this.items.set(e,t),this}findParentSchema(e){const t=Object.getPrototypeOf(e);return t?this.items.get(t)||this.findParentSchema(t):null}}const Wr=new wD,ne=r=>e=>{let t;Wr.has(e)?t=Wr.get(e):(t=Wr.createDefault(e),Wr.set(e,t)),Object.assign(t,r)},S=r=>(e,t)=>{let n;Wr.has(e.constructor)?n=Wr.get(e.constructor):(n=Wr.createDefault(e.constructor),Wr.set(e.constructor,n));const i=Object.assign({},r);if(typeof i.type=="number"&&!i.converter){const s=z4(r.type);if(!s)throw new Error(`Cannot get default converter for property '${t}' of ${e.constructor.name}`);i.converter=s}n.items[t]=i};class I5 extends Error{constructor(){super(...arguments),this.schemas=[]}}class bD{static parse(e,t){const n=So(e);if(n.result.error)throw new Error(n.result.error);return this.fromASN(n.result,t)}static fromASN(e,t){var n;try{if(ei(t))return new t().fromASN(e);const i=Wr.get(t);Wr.cache(t);let s=i.schema;if(e.constructor===Ir&&i.type!==X.Choice){s=new Ir({idBlock:{tagClass:3,tagNumber:e.idBlock.tagNumber},value:i.schema.valueBlock.value});for(const c in i.items)delete e[c]}const o=hs({},e,s);if(!o.verified)throw new I5(`Data does not match to ${t.name} ASN1 schema. ${o.result.error}`);const a=new t;if(cb(t)){if(!("value"in e.valueBlock&&Array.isArray(e.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const c=i.itemType;if(typeof c=="number"){const l=z4(c);if(!l)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);return t.from(e.valueBlock.value,u=>l.fromASN(u))}else return t.from(e.valueBlock.value,l=>this.fromASN(l,c))}for(const c in i.items){const l=o.result[c];if(!l)continue;const u=i.items[c],f=u.type;if(typeof f=="number"||ei(f)){const g=(n=u.converter)!==null&&n!==void 0?n:ei(f)?new f:null;if(!g)throw new Error("Converter is empty");if(u.repeated)if(u.implicit){const m=u.repeated==="sequence"?ii:si,w=new m;w.valueBlock=l.valueBlock;const x=So(w.toBER(!1));if(x.offset===-1)throw new Error(`Cannot parse the child item. ${x.result.error}`);if(!("value"in x.result.valueBlock&&Array.isArray(x.result.valueBlock.value)))throw new Error("Cannot get items from the ASN.1 parsed value. ASN.1 object is not constructed.");const v=x.result.valueBlock.value;a[c]=Array.from(v,C=>g.fromASN(C))}else a[c]=Array.from(l,m=>g.fromASN(m));else{let m=l;if(u.implicit){let w;if(ei(f))w=new f().toSchema("");else{const x=B[f],v=ob[x];if(!v)throw new Error(`Cannot get '${x}' class from asn1js module`);w=new v}w.valueBlock=m.valueBlock,m=So(w.toBER(!1)).result}a[c]=g.fromASN(m)}}else if(u.repeated){if(!Array.isArray(l))throw new Error("Cannot get list of items from the ASN.1 parsed value. ASN.1 value should be iterable.");a[c]=Array.from(l,g=>this.fromASN(g,f))}else a[c]=this.fromASN(l,f)}return a}catch(i){throw i instanceof I5&&i.schemas.push(t.name),i}}}class W4{static serialize(e){return e instanceof Wt?e.toBER(!1):this.toASN(e).toBER(!1)}static toASN(e){if(e&&typeof e=="object"&&ei(e))return e.toASN();if(!(e&&typeof e=="object"))throw new TypeError("Parameter 1 should be type of Object.");const t=e.constructor,n=Wr.get(t);Wr.cache(t);let i=[];if(n.itemType){if(!Array.isArray(e))throw new TypeError("Parameter 1 should be type of Array.");if(typeof n.itemType=="number"){const o=z4(n.itemType);if(!o)throw new Error(`Cannot get default converter for array item of ${t.name} ASN1 schema`);i=e.map(a=>o.toASN(a))}else i=e.map(o=>this.toAsnItem({type:n.itemType},"[]",t,o))}else for(const o in n.items){const a=n.items[o],c=e[o];if(c===void 0||a.defaultValue===c||typeof a.defaultValue=="object"&&typeof c=="object"&&yD(this.serialize(a.defaultValue),this.serialize(c)))continue;const l=W4.toAsnItem(a,o,t,c);if(typeof a.context=="number")if(a.implicit)if(!a.repeated&&(typeof a.type=="number"||ei(a.type))){const u={};u.valueHex=l instanceof Ns?l.valueBeforeDecodeView:l.valueBlock.toBER(),i.push(new dl({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},...u}))}else i.push(new Ir({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:l.valueBlock.value}));else i.push(new Ir({optional:a.optional,idBlock:{tagClass:3,tagNumber:a.context},value:[l]}));else a.repeated?i=i.concat(l):i.push(l)}let s;switch(n.type){case X.Sequence:s=new ii({value:i});break;case X.Set:s=new si({value:i});break;case X.Choice:if(!i[0])throw new Error(`Schema '${t.name}' has wrong data. Choice cannot be empty.`);s=i[0];break}return s}static toAsnItem(e,t,n,i){let s;if(typeof e.type=="number"){const o=e.converter;if(!o)throw new Error(`Property '${t}' doesn't have converter for type ${B[e.type]} in schema '${n.name}'`);if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const a=Array.from(i,l=>o.toASN(l)),c=e.repeated==="sequence"?ii:si;s=new c({value:a})}else s=o.toASN(i)}else if(e.repeated){if(!Array.isArray(i))throw new TypeError("Parameter 'objProp' should be type of Array.");const o=Array.from(i,c=>this.toASN(c)),a=e.repeated==="sequence"?ii:si;s=new a({value:o})}else s=this.toASN(i);return s}}class rt extends Array{constructor(e=[]){if(typeof e=="number")super(e);else{super();for(const t of e)this.push(t)}}}class fe{static serialize(e){return W4.serialize(e)}static parse(e,t){return bD.parse(e,t)}static toString(e){const t=pe.isBufferSource(e)?pe.toArrayBuffer(e):fe.serialize(e),n=So(t);if(n.offset===-1)throw new Error(`Cannot decode ASN.1 data. ${n.result.error}`);return n.result.toString()}}function y(r,e,t,n){var i=arguments.length,s=i<3?e:n===null?n=Object.getOwnPropertyDescriptor(e,t):n,o;if(typeof Reflect=="object"&&typeof Reflect.decorate=="function")s=Reflect.decorate(r,e,t,n);else for(var a=r.length-1;a>=0;a--)(o=r[a])&&(s=(i<3?o(s):i>3?o(e,t,s):o(e,t))||s);return i>3&&s&&Object.defineProperty(e,t,s),s}class C5{static isIPv4(e){return/^(\d{1,3}\.){3}\d{1,3}$/.test(e)}static parseIPv4(e){const t=e.split(".");if(t.length!==4)throw new Error("Invalid IPv4 address");return t.map(n=>{const i=parseInt(n,10);if(isNaN(i)||i<0||i>255)throw new Error("Invalid IPv4 address part");return i})}static parseIPv6(e){const n=this.expandIPv6(e).split(":");if(n.length!==8)throw new Error("Invalid IPv6 address");return n.reduce((i,s)=>{const o=parseInt(s,16);if(isNaN(o)||o<0||o>65535)throw new Error("Invalid IPv6 address part");return i.push(o>>8&255),i.push(o&255),i},[])}static expandIPv6(e){if(!e.includes("::"))return e;const t=e.split("::");if(t.length>2)throw new Error("Invalid IPv6 address");const n=t[0]?t[0].split(":"):[],i=t[1]?t[1].split(":"):[],s=8-(n.length+i.length);if(s<0)throw new Error("Invalid IPv6 address");return[...n,...Array(s).fill("0"),...i].join(":")}static formatIPv6(e){const t=[];for(let n=0;n<16;n+=2)t.push((e[n]<<8|e[n+1]).toString(16));return this.compressIPv6(t.join(":"))}static compressIPv6(e){const t=e.split(":");let n=-1,i=0,s=-1,o=0;for(let a=0;a<t.length;a++)t[a]==="0"?(s===-1&&(s=a),o++):(o>i&&(n=s,i=o),s=-1,o=0);if(o>i&&(n=s,i=o),i>1){const a=t.slice(0,n).join(":"),c=t.slice(n+i).join(":");return`${a}::${c}`}return e}static parseCIDR(e){const[t,n]=e.split("/"),i=parseInt(n,10);if(this.isIPv4(t)){if(i<0||i>32)throw new Error("Invalid IPv4 prefix length");return[this.parseIPv4(t),i]}else{if(i<0||i>128)throw new Error("Invalid IPv6 prefix length");return[this.parseIPv6(t),i]}}static decodeIP(e){if(e.length===64&&parseInt(e,16)===0)return"::/0";if(e.length!==16)return e;const t=parseInt(e.slice(8),16).toString(2).split("").reduce((i,s)=>i+ +s,0);let n=e.slice(0,8).replace(/(.{2})/g,i=>`${parseInt(i,16)}.`);return n=n.slice(0,-1),`${n}/${t}`}static toString(e){const t=new Uint8Array(e);if(t.length===4)return Array.from(t).join(".");if(t.length===16)return this.formatIPv6(t);if(t.length===8||t.length===32){const n=t.length/2,i=t.slice(0,n),s=t.slice(n);if(t.every(c=>c===0))return t.length===8?"0.0.0.0/0":"::/0";const a=s.reduce((c,l)=>c+(l.toString(2).match(/1/g)||[]).length,0);return t.length===8?`${Array.from(i).join(".")}/${a}`:`${this.formatIPv6(i)}/${a}`}return this.decodeIP(Ee.ToHex(e))}static fromString(e){if(e.includes("/")){const[n,i]=this.parseCIDR(e),s=new Uint8Array(n.length);let o=i;for(let c=0;c<s.length;c++)o>=8?(s[c]=255,o-=8):o>0&&(s[c]=255<<8-o,o=0);const a=new Uint8Array(n.length*2);return a.set(n,0),a.set(s,n.length),a.buffer}const t=this.isIPv4(e)?this.parseIPv4(e):this.parseIPv6(e);return new Uint8Array(t).buffer}}var G0,Q0,Y0;let Gt=class{constructor(e={}){Object.assign(this,e)}toString(){return this.bmpString||this.printableString||this.teletexString||this.universalString||this.utf8String||""}};y([S({type:B.TeletexString})],Gt.prototype,"teletexString",void 0);y([S({type:B.PrintableString})],Gt.prototype,"printableString",void 0);y([S({type:B.UniversalString})],Gt.prototype,"universalString",void 0);y([S({type:B.Utf8String})],Gt.prototype,"utf8String",void 0);y([S({type:B.BmpString})],Gt.prototype,"bmpString",void 0);Gt=y([ne({type:X.Choice})],Gt);let Go=class extends Gt{constructor(e={}){super(e),Object.assign(this,e)}toString(){return this.ia5String||(this.anyValue?Ee.ToHex(this.anyValue):super.toString())}};y([S({type:B.IA5String})],Go.prototype,"ia5String",void 0);y([S({type:B.Any})],Go.prototype,"anyValue",void 0);Go=y([ne({type:X.Choice})],Go);class tf{constructor(e={}){this.type="",this.value=new Go,Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],tf.prototype,"type",void 0);y([S({type:Go})],tf.prototype,"value",void 0);let Qo=G0=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,G0.prototype)}};Qo=G0=y([ne({type:X.Set,itemType:tf})],Qo);let Z0=Q0=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,Q0.prototype)}};Z0=Q0=y([ne({type:X.Sequence,itemType:Qo})],Z0);let Bt=Y0=class extends Z0{constructor(e){super(e),Object.setPrototypeOf(this,Y0.prototype)}};Bt=Y0=y([ne({type:X.Sequence})],Bt);const vD={fromASN:r=>C5.toString(x1.fromASN(r)),toASN:r=>x1.toASN(C5.fromString(r))};class Oc{constructor(e={}){this.typeId="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],Oc.prototype,"typeId",void 0);y([S({type:B.Any,context:0})],Oc.prototype,"value",void 0);class G4{constructor(e={}){this.partyName=new Gt,Object.assign(this,e)}}y([S({type:Gt,optional:!0,context:0,implicit:!0})],G4.prototype,"nameAssigner",void 0);y([S({type:Gt,context:1,implicit:!0})],G4.prototype,"partyName",void 0);let Re=class{constructor(e={}){Object.assign(this,e)}};y([S({type:Oc,context:0,implicit:!0})],Re.prototype,"otherName",void 0);y([S({type:B.IA5String,context:1,implicit:!0})],Re.prototype,"rfc822Name",void 0);y([S({type:B.IA5String,context:2,implicit:!0})],Re.prototype,"dNSName",void 0);y([S({type:B.Any,context:3,implicit:!0})],Re.prototype,"x400Address",void 0);y([S({type:Bt,context:4,implicit:!1})],Re.prototype,"directoryName",void 0);y([S({type:G4,context:5})],Re.prototype,"ediPartyName",void 0);y([S({type:B.IA5String,context:6,implicit:!0})],Re.prototype,"uniformResourceIdentifier",void 0);y([S({type:B.OctetString,context:7,implicit:!0,converter:vD})],Re.prototype,"iPAddress",void 0);y([S({type:B.ObjectIdentifier,context:8,implicit:!0})],Re.prototype,"registeredID",void 0);Re=y([ne({type:X.Choice})],Re);const Q4="1.3.6.1.5.5.7",SD=`${Q4}.1`,ma=`${Q4}.3`,rf=`${Q4}.48`,k5=`${rf}.1`,T5=`${rf}.2`,P5=`${rf}.3`,B5=`${rf}.5`,Zi="2.5.29";var X0;const J0=`${SD}.1`;class ml{constructor(e={}){this.accessMethod="",this.accessLocation=new Re,Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],ml.prototype,"accessMethod",void 0);y([S({type:Re})],ml.prototype,"accessLocation",void 0);let uo=X0=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,X0.prototype)}};uo=X0=y([ne({type:X.Sequence,itemType:ml})],uo);const e2=`${Zi}.35`;class Y4 extends ze{}class fs{constructor(e={}){e&&Object.assign(this,e)}}y([S({type:Y4,context:0,optional:!0,implicit:!0})],fs.prototype,"keyIdentifier",void 0);y([S({type:Re,context:1,optional:!0,implicit:!0,repeated:"sequence"})],fs.prototype,"authorityCertIssuer",void 0);y([S({type:B.Integer,context:2,optional:!0,implicit:!0,converter:yt})],fs.prototype,"authorityCertSerialNumber",void 0);const lb=`${Zi}.19`;class A1{constructor(e={}){this.cA=!1,Object.assign(this,e)}}y([S({type:B.Boolean,defaultValue:!1})],A1.prototype,"cA",void 0);y([S({type:B.Integer,optional:!0})],A1.prototype,"pathLenConstraint",void 0);var t2;let pr=t2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,t2.prototype)}};pr=t2=y([ne({type:X.Sequence,itemType:Re})],pr);var r2;let N5=r2=class extends pr{constructor(e){super(e),Object.setPrototypeOf(this,r2.prototype)}};N5=r2=y([ne({type:X.Sequence})],N5);var n2;const ub=`${Zi}.32`;let hi=class{constructor(e={}){Object.assign(this,e)}toString(){return this.ia5String||this.visibleString||this.bmpString||this.utf8String||""}};y([S({type:B.IA5String})],hi.prototype,"ia5String",void 0);y([S({type:B.VisibleString})],hi.prototype,"visibleString",void 0);y([S({type:B.BmpString})],hi.prototype,"bmpString",void 0);y([S({type:B.Utf8String})],hi.prototype,"utf8String",void 0);hi=y([ne({type:X.Choice})],hi);class Z4{constructor(e={}){this.organization=new hi,this.noticeNumbers=[],Object.assign(this,e)}}y([S({type:hi})],Z4.prototype,"organization",void 0);y([S({type:B.Integer,repeated:"sequence"})],Z4.prototype,"noticeNumbers",void 0);class X4{constructor(e={}){Object.assign(this,e)}}y([S({type:Z4,optional:!0})],X4.prototype,"noticeRef",void 0);y([S({type:hi,optional:!0})],X4.prototype,"explicitText",void 0);let _1=class{constructor(e={}){Object.assign(this,e)}};y([S({type:B.IA5String})],_1.prototype,"cPSuri",void 0);y([S({type:X4})],_1.prototype,"userNotice",void 0);_1=y([ne({type:X.Choice})],_1);class J4{constructor(e={}){this.policyQualifierId="",this.qualifier=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],J4.prototype,"policyQualifierId",void 0);y([S({type:B.Any})],J4.prototype,"qualifier",void 0);class nf{constructor(e={}){this.policyIdentifier="",Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],nf.prototype,"policyIdentifier",void 0);y([S({type:J4,repeated:"sequence",optional:!0})],nf.prototype,"policyQualifiers",void 0);let I1=n2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,n2.prototype)}};I1=n2=y([ne({type:X.Sequence,itemType:nf})],I1);let C1=class{constructor(e=0){this.value=e}};y([S({type:B.Integer})],C1.prototype,"value",void 0);C1=y([ne({type:X.Choice})],C1);let O5=class extends C1{};O5=y([ne({type:X.Choice})],O5);var i2;const s2=`${Zi}.31`;var un;(function(r){r[r.unused=1]="unused",r[r.keyCompromise=2]="keyCompromise",r[r.cACompromise=4]="cACompromise",r[r.affiliationChanged=8]="affiliationChanged",r[r.superseded=16]="superseded",r[r.cessationOfOperation=32]="cessationOfOperation",r[r.certificateHold=64]="certificateHold",r[r.privilegeWithdrawn=128]="privilegeWithdrawn",r[r.aACompromise=256]="aACompromise"})(un||(un={}));class hb extends ef{toJSON(){const e=[],t=this.toNumber();return t&un.aACompromise&&e.push("aACompromise"),t&un.affiliationChanged&&e.push("affiliationChanged"),t&un.cACompromise&&e.push("cACompromise"),t&un.certificateHold&&e.push("certificateHold"),t&un.cessationOfOperation&&e.push("cessationOfOperation"),t&un.keyCompromise&&e.push("keyCompromise"),t&un.privilegeWithdrawn&&e.push("privilegeWithdrawn"),t&un.superseded&&e.push("superseded"),t&un.unused&&e.push("unused"),e}toString(){return`[${this.toJSON().join(", ")}]`}}let Rs=class{constructor(e={}){Object.assign(this,e)}};y([S({type:Re,context:0,repeated:"sequence",implicit:!0})],Rs.prototype,"fullName",void 0);y([S({type:Qo,context:1,implicit:!0})],Rs.prototype,"nameRelativeToCRLIssuer",void 0);Rs=y([ne({type:X.Choice})],Rs);class ya{constructor(e={}){Object.assign(this,e)}}y([S({type:Rs,context:0,optional:!0})],ya.prototype,"distributionPoint",void 0);y([S({type:hb,context:1,optional:!0,implicit:!0})],ya.prototype,"reasons",void 0);y([S({type:Re,context:2,optional:!0,repeated:"sequence",implicit:!0})],ya.prototype,"cRLIssuer",void 0);let Eo=i2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,i2.prototype)}};Eo=i2=y([ne({type:X.Sequence,itemType:ya})],Eo);var o2;let R5=o2=class extends Eo{constructor(e){super(e),Object.setPrototypeOf(this,o2.prototype)}};R5=o2=y([ne({type:X.Sequence,itemType:ya})],R5);class ir{constructor(e={}){this.onlyContainsUserCerts=ir.ONLY,this.onlyContainsCACerts=ir.ONLY,this.indirectCRL=ir.ONLY,this.onlyContainsAttributeCerts=ir.ONLY,Object.assign(this,e)}}ir.ONLY=!1;y([S({type:Rs,context:0,optional:!0})],ir.prototype,"distributionPoint",void 0);y([S({type:B.Boolean,context:1,defaultValue:ir.ONLY,implicit:!0})],ir.prototype,"onlyContainsUserCerts",void 0);y([S({type:B.Boolean,context:2,defaultValue:ir.ONLY,implicit:!0})],ir.prototype,"onlyContainsCACerts",void 0);y([S({type:hb,context:3,optional:!0,implicit:!0})],ir.prototype,"onlySomeReasons",void 0);y([S({type:B.Boolean,context:4,defaultValue:ir.ONLY,implicit:!0})],ir.prototype,"indirectCRL",void 0);y([S({type:B.Boolean,context:5,defaultValue:ir.ONLY,implicit:!0})],ir.prototype,"onlyContainsAttributeCerts",void 0);var ac;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(ac||(ac={}));let a2=class{constructor(e=ac.unspecified){this.reason=ac.unspecified,this.reason=e}toJSON(){return ac[this.reason]}toString(){return this.toJSON()}};y([S({type:B.Enumerated})],a2.prototype,"reason",void 0);a2=y([ne({type:X.Choice})],a2);var c2;const fb=`${Zi}.37`;let k1=c2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,c2.prototype)}};k1=c2=y([ne({type:X.Sequence,itemType:B.ObjectIdentifier})],k1);const ED=`${ma}.1`,xD=`${ma}.2`,AD=`${ma}.3`,_D=`${ma}.4`,ID=`${ma}.8`,CD=`${ma}.9`;let l2=class{constructor(e=new ArrayBuffer(0)){this.value=e}};y([S({type:B.Integer,converter:yt})],l2.prototype,"value",void 0);l2=y([ne({type:X.Choice})],l2);let u2=class{constructor(e){this.value=new Date,e&&(this.value=e)}};y([S({type:B.GeneralizedTime})],u2.prototype,"value",void 0);u2=y([ne({type:X.Choice})],u2);var h2;let D5=h2=class extends pr{constructor(e){super(e),Object.setPrototypeOf(this,h2.prototype)}};D5=h2=y([ne({type:X.Sequence})],D5);const db=`${Zi}.15`;var hn;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(hn||(hn={}));class gd extends ef{toJSON(){const e=this.toNumber(),t=[];return e&hn.cRLSign&&t.push("crlSign"),e&hn.dataEncipherment&&t.push("dataEncipherment"),e&hn.decipherOnly&&t.push("decipherOnly"),e&hn.digitalSignature&&t.push("digitalSignature"),e&hn.encipherOnly&&t.push("encipherOnly"),e&hn.keyAgreement&&t.push("keyAgreement"),e&hn.keyCertSign&&t.push("keyCertSign"),e&hn.keyEncipherment&&t.push("keyEncipherment"),e&hn.nonRepudiation&&t.push("nonRepudiation"),t}toString(){return`[${this.toJSON().join(", ")}]`}}var f2;class sf{constructor(e={}){this.base=new Re,this.minimum=0,Object.assign(this,e)}}y([S({type:Re})],sf.prototype,"base",void 0);y([S({type:B.Integer,context:0,defaultValue:0,implicit:!0})],sf.prototype,"minimum",void 0);y([S({type:B.Integer,context:1,optional:!0,implicit:!0})],sf.prototype,"maximum",void 0);let T1=f2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,f2.prototype)}};T1=f2=y([ne({type:X.Sequence,itemType:sf})],T1);class pb{constructor(e={}){Object.assign(this,e)}}y([S({type:T1,context:0,optional:!0,implicit:!0})],pb.prototype,"permittedSubtrees",void 0);y([S({type:T1,context:1,optional:!0,implicit:!0})],pb.prototype,"excludedSubtrees",void 0);class gb{constructor(e={}){Object.assign(this,e)}}y([S({type:B.Integer,context:0,implicit:!0,optional:!0,converter:yt})],gb.prototype,"requireExplicitPolicy",void 0);y([S({type:B.Integer,context:1,implicit:!0,optional:!0,converter:yt})],gb.prototype,"inhibitPolicyMapping",void 0);var d2;class ep{constructor(e={}){this.issuerDomainPolicy="",this.subjectDomainPolicy="",Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],ep.prototype,"issuerDomainPolicy",void 0);y([S({type:B.ObjectIdentifier})],ep.prototype,"subjectDomainPolicy",void 0);let L5=d2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,d2.prototype)}};L5=d2=y([ne({type:X.Sequence,itemType:ep})],L5);var p2;const mb=`${Zi}.17`;let g2=p2=class extends pr{constructor(e){super(e),Object.setPrototypeOf(this,p2.prototype)}};g2=p2=y([ne({type:X.Sequence})],g2);let fi=class{constructor(e={}){this.type="",this.values=[],Object.assign(this,e)}};y([S({type:B.ObjectIdentifier})],fi.prototype,"type",void 0);y([S({type:B.Any,repeated:"set"})],fi.prototype,"values",void 0);var m2;let M5=m2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,m2.prototype)}};M5=m2=y([ne({type:X.Sequence,itemType:fi})],M5);const yb=`${Zi}.14`;class qi extends Y4{}class wb{constructor(e={}){Object.assign(this,e)}}y([S({type:B.GeneralizedTime,context:0,implicit:!0,optional:!0})],wb.prototype,"notBefore",void 0);y([S({type:B.GeneralizedTime,context:1,implicit:!0,optional:!0})],wb.prototype,"notAfter",void 0);var cc;(function(r){r[r.keyUpdateAllowed=1]="keyUpdateAllowed",r[r.newExtensions=2]="newExtensions",r[r.pKIXCertificate=4]="pKIXCertificate"})(cc||(cc={}));class bb extends ef{toJSON(){const e=[],t=this.toNumber();return t&cc.pKIXCertificate&&e.push("pKIXCertificate"),t&cc.newExtensions&&e.push("newExtensions"),t&cc.keyUpdateAllowed&&e.push("keyUpdateAllowed"),e}toString(){return`[${this.toJSON().join(", ")}]`}}class vb{constructor(e={}){this.entrustVers="",this.entrustInfoFlags=new bb,Object.assign(this,e)}}y([S({type:B.GeneralString})],vb.prototype,"entrustVers",void 0);y([S({type:bb})],vb.prototype,"entrustInfoFlags",void 0);var y2;let U5=y2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,y2.prototype)}};U5=y2=y([ne({type:X.Sequence,itemType:ml})],U5);class ye{constructor(e={}){this.algorithm="",Object.assign(this,e)}isEqual(e){return e instanceof ye&&e.algorithm==this.algorithm&&(e.parameters&&this.parameters&&uw(e.parameters,this.parameters)||e.parameters===this.parameters)}}y([S({type:B.ObjectIdentifier})],ye.prototype,"algorithm",void 0);y([S({type:B.Any,optional:!0})],ye.prototype,"parameters",void 0);class pn{constructor(e={}){this.algorithm=new ye,this.subjectPublicKey=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:ye})],pn.prototype,"algorithm",void 0);y([S({type:B.BitString})],pn.prototype,"subjectPublicKey",void 0);let jt=class{constructor(e){if(e)if(typeof e=="string"||typeof e=="number"||e instanceof Date){const t=new Date(e);t.getUTCFullYear()>2049?this.generalTime=t:this.utcTime=t}else Object.assign(this,e)}getTime(){const e=this.utcTime||this.generalTime;if(!e)throw new Error("Cannot get time from CHOICE object");return e}};y([S({type:B.UTCTime})],jt.prototype,"utcTime",void 0);y([S({type:B.GeneralizedTime})],jt.prototype,"generalTime",void 0);jt=y([ne({type:X.Choice})],jt);class yl{constructor(e){this.notBefore=new jt(new Date),this.notAfter=new jt(new Date),e&&(this.notBefore=new jt(e.notBefore),this.notAfter=new jt(e.notAfter))}}y([S({type:jt})],yl.prototype,"notBefore",void 0);y([S({type:jt})],yl.prototype,"notAfter",void 0);var w2;let rn=class Sb{constructor(e={}){this.extnID="",this.critical=Sb.CRITICAL,this.extnValue=new ze,Object.assign(this,e)}};rn.CRITICAL=!1;y([S({type:B.ObjectIdentifier})],rn.prototype,"extnID",void 0);y([S({type:B.Boolean,defaultValue:rn.CRITICAL})],rn.prototype,"critical",void 0);y([S({type:ze})],rn.prototype,"extnValue",void 0);let zi=w2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,w2.prototype)}};zi=w2=y([ne({type:X.Sequence,itemType:rn})],zi);var Ds;(function(r){r[r.v1=0]="v1",r[r.v2=1]="v2",r[r.v3=2]="v3"})(Ds||(Ds={}));class qr{constructor(e={}){this.version=Ds.v1,this.serialNumber=new ArrayBuffer(0),this.signature=new ye,this.issuer=new Bt,this.validity=new yl,this.subject=new Bt,this.subjectPublicKeyInfo=new pn,Object.assign(this,e)}}y([S({type:B.Integer,context:0,defaultValue:Ds.v1})],qr.prototype,"version",void 0);y([S({type:B.Integer,converter:yt})],qr.prototype,"serialNumber",void 0);y([S({type:ye})],qr.prototype,"signature",void 0);y([S({type:Bt})],qr.prototype,"issuer",void 0);y([S({type:yl})],qr.prototype,"validity",void 0);y([S({type:Bt})],qr.prototype,"subject",void 0);y([S({type:pn})],qr.prototype,"subjectPublicKeyInfo",void 0);y([S({type:B.BitString,context:1,implicit:!0,optional:!0})],qr.prototype,"issuerUniqueID",void 0);y([S({type:B.BitString,context:2,implicit:!0,optional:!0})],qr.prototype,"subjectUniqueID",void 0);y([S({type:zi,context:3,optional:!0})],qr.prototype,"extensions",void 0);class Ls{constructor(e={}){this.tbsCertificate=new qr,this.signatureAlgorithm=new ye,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:qr})],Ls.prototype,"tbsCertificate",void 0);y([S({type:ye})],Ls.prototype,"signatureAlgorithm",void 0);y([S({type:B.BitString})],Ls.prototype,"signatureValue",void 0);class of{constructor(e={}){this.userCertificate=new ArrayBuffer(0),this.revocationDate=new jt,Object.assign(this,e)}}y([S({type:B.Integer,converter:yt})],of.prototype,"userCertificate",void 0);y([S({type:jt})],of.prototype,"revocationDate",void 0);y([S({type:rn,optional:!0,repeated:"sequence"})],of.prototype,"crlEntryExtensions",void 0);class Ei{constructor(e={}){this.signature=new ye,this.issuer=new Bt,this.thisUpdate=new jt,Object.assign(this,e)}}y([S({type:B.Integer,optional:!0})],Ei.prototype,"version",void 0);y([S({type:ye})],Ei.prototype,"signature",void 0);y([S({type:Bt})],Ei.prototype,"issuer",void 0);y([S({type:jt})],Ei.prototype,"thisUpdate",void 0);y([S({type:jt,optional:!0})],Ei.prototype,"nextUpdate",void 0);y([S({type:of,repeated:"sequence",optional:!0})],Ei.prototype,"revokedCertificates",void 0);y([S({type:rn,optional:!0,context:0,repeated:"sequence"})],Ei.prototype,"crlExtensions",void 0);class tp{constructor(e={}){this.tbsCertList=new Ei,this.signatureAlgorithm=new ye,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:Ei})],tp.prototype,"tbsCertList",void 0);y([S({type:ye})],tp.prototype,"signatureAlgorithm",void 0);y([S({type:B.BitString})],tp.prototype,"signature",void 0);class wa{constructor(e={}){this.issuer=new Bt,this.serialNumber=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:Bt})],wa.prototype,"issuer",void 0);y([S({type:B.Integer,converter:yt})],wa.prototype,"serialNumber",void 0);let Yo=class{constructor(e={}){Object.assign(this,e)}};y([S({type:qi,context:0,implicit:!0})],Yo.prototype,"subjectKeyIdentifier",void 0);y([S({type:wa})],Yo.prototype,"issuerAndSerialNumber",void 0);Yo=y([ne({type:X.Choice})],Yo);var di;(function(r){r[r.v0=0]="v0",r[r.v1=1]="v1",r[r.v2=2]="v2",r[r.v3=3]="v3",r[r.v4=4]="v4",r[r.v5=5]="v5"})(di||(di={}));let Rc=class extends ye{};Rc=y([ne({type:X.Sequence})],Rc);let P1=class extends ye{};P1=y([ne({type:X.Sequence})],P1);let Fn=class extends ye{};Fn=y([ne({type:X.Sequence})],Fn);let B1=class extends ye{};B1=y([ne({type:X.Sequence})],B1);let F5=class extends ye{};F5=y([ne({type:X.Sequence})],F5);let b2=class extends ye{};b2=y([ne({type:X.Sequence})],b2);let ba=class{constructor(e={}){this.attrType="",this.attrValues=[],Object.assign(this,e)}};y([S({type:B.ObjectIdentifier})],ba.prototype,"attrType",void 0);y([S({type:B.Any,repeated:"set"})],ba.prototype,"attrValues",void 0);var v2;class Vn{constructor(e={}){this.version=di.v0,this.sid=new Yo,this.digestAlgorithm=new Rc,this.signatureAlgorithm=new P1,this.signature=new ze,Object.assign(this,e)}}y([S({type:B.Integer})],Vn.prototype,"version",void 0);y([S({type:Yo})],Vn.prototype,"sid",void 0);y([S({type:Rc})],Vn.prototype,"digestAlgorithm",void 0);y([S({type:ba,repeated:"set",context:0,implicit:!0,optional:!0})],Vn.prototype,"signedAttrs",void 0);y([S({type:P1})],Vn.prototype,"signatureAlgorithm",void 0);y([S({type:ze})],Vn.prototype,"signature",void 0);y([S({type:ba,repeated:"set",context:1,implicit:!0,optional:!0})],Vn.prototype,"unsignedAttrs",void 0);let N1=v2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,v2.prototype)}};N1=v2=y([ne({type:X.Set,itemType:Vn})],N1);let $5=class extends jt{};$5=y([ne({type:X.Choice})],$5);let V5=class extends Vn{};V5=y([ne({type:X.Sequence})],V5);class rp{constructor(e={}){this.acIssuer=new Re,this.acSerial=0,this.attrs=[],Object.assign(this,e)}}y([S({type:Re})],rp.prototype,"acIssuer",void 0);y([S({type:B.Integer})],rp.prototype,"acSerial",void 0);y([S({type:fi,repeated:"sequence"})],rp.prototype,"attrs",void 0);var S2;let O1=S2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,S2.prototype)}};O1=S2=y([ne({type:X.Sequence,itemType:B.ObjectIdentifier})],O1);class af{constructor(e={}){this.permitUnSpecified=!0,Object.assign(this,e)}}y([S({type:B.Integer,optional:!0})],af.prototype,"pathLenConstraint",void 0);y([S({type:O1,implicit:!0,context:0,optional:!0})],af.prototype,"permittedAttrs",void 0);y([S({type:O1,implicit:!0,context:1,optional:!0})],af.prototype,"excludedAttrs",void 0);y([S({type:B.Boolean,defaultValue:!0})],af.prototype,"permitUnSpecified",void 0);class Ws{constructor(e={}){this.issuer=new pr,this.serial=new ArrayBuffer(0),this.issuerUID=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:pr})],Ws.prototype,"issuer",void 0);y([S({type:B.Integer,converter:yt})],Ws.prototype,"serial",void 0);y([S({type:B.BitString,optional:!0})],Ws.prototype,"issuerUID",void 0);var E2;(function(r){r[r.publicKey=0]="publicKey",r[r.publicKeyCert=1]="publicKeyCert",r[r.otherObjectTypes=2]="otherObjectTypes"})(E2||(E2={}));class Gs{constructor(e={}){this.digestedObjectType=E2.publicKey,this.digestAlgorithm=new ye,this.objectDigest=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.Enumerated})],Gs.prototype,"digestedObjectType",void 0);y([S({type:B.ObjectIdentifier,optional:!0})],Gs.prototype,"otherObjectTypeID",void 0);y([S({type:ye})],Gs.prototype,"digestAlgorithm",void 0);y([S({type:B.BitString})],Gs.prototype,"objectDigest",void 0);class cf{constructor(e={}){Object.assign(this,e)}}y([S({type:pr,optional:!0})],cf.prototype,"issuerName",void 0);y([S({type:Ws,context:0,implicit:!0,optional:!0})],cf.prototype,"baseCertificateID",void 0);y([S({type:Gs,context:1,implicit:!0,optional:!0})],cf.prototype,"objectDigestInfo",void 0);let Zo=class{constructor(e={}){Object.assign(this,e)}};y([S({type:Re,repeated:"sequence"})],Zo.prototype,"v1Form",void 0);y([S({type:cf,context:0,implicit:!0})],Zo.prototype,"v2Form",void 0);Zo=y([ne({type:X.Choice})],Zo);class lf{constructor(e={}){this.notBeforeTime=new Date,this.notAfterTime=new Date,Object.assign(this,e)}}y([S({type:B.GeneralizedTime})],lf.prototype,"notBeforeTime",void 0);y([S({type:B.GeneralizedTime})],lf.prototype,"notAfterTime",void 0);class wl{constructor(e={}){Object.assign(this,e)}}y([S({type:Ws,implicit:!0,context:0,optional:!0})],wl.prototype,"baseCertificateID",void 0);y([S({type:pr,implicit:!0,context:1,optional:!0})],wl.prototype,"entityName",void 0);y([S({type:Gs,implicit:!0,context:2,optional:!0})],wl.prototype,"objectDigestInfo",void 0);var x2;(function(r){r[r.v2=1]="v2"})(x2||(x2={}));class Sn{constructor(e={}){this.version=x2.v2,this.holder=new wl,this.issuer=new Zo,this.signature=new ye,this.serialNumber=new ArrayBuffer(0),this.attrCertValidityPeriod=new lf,this.attributes=[],Object.assign(this,e)}}y([S({type:B.Integer})],Sn.prototype,"version",void 0);y([S({type:wl})],Sn.prototype,"holder",void 0);y([S({type:Zo})],Sn.prototype,"issuer",void 0);y([S({type:ye})],Sn.prototype,"signature",void 0);y([S({type:B.Integer,converter:yt})],Sn.prototype,"serialNumber",void 0);y([S({type:lf})],Sn.prototype,"attrCertValidityPeriod",void 0);y([S({type:fi,repeated:"sequence"})],Sn.prototype,"attributes",void 0);y([S({type:B.BitString,optional:!0})],Sn.prototype,"issuerUniqueID",void 0);y([S({type:zi,optional:!0})],Sn.prototype,"extensions",void 0);class uf{constructor(e={}){this.acinfo=new Sn,this.signatureAlgorithm=new ye,this.signatureValue=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:Sn})],uf.prototype,"acinfo",void 0);y([S({type:ye})],uf.prototype,"signatureAlgorithm",void 0);y([S({type:B.BitString})],uf.prototype,"signatureValue",void 0);var R1;(function(r){r[r.unmarked=1]="unmarked",r[r.unclassified=2]="unclassified",r[r.restricted=4]="restricted",r[r.confidential=8]="confidential",r[r.secret=16]="secret",r[r.topSecret=32]="topSecret"})(R1||(R1={}));class A2 extends ef{}class np{constructor(e={}){this.type="",this.value=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.ObjectIdentifier,implicit:!0,context:0})],np.prototype,"type",void 0);y([S({type:B.Any,implicit:!0,context:1})],np.prototype,"value",void 0);class ip{constructor(e={}){this.policyId="",this.classList=new A2(R1.unclassified),Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],ip.prototype,"policyId",void 0);y([S({type:A2,defaultValue:new A2(R1.unclassified)})],ip.prototype,"classList",void 0);y([S({type:np,repeated:"set"})],ip.prototype,"securityCategories",void 0);class hf{constructor(e={}){Object.assign(this,e)}}y([S({type:ze})],hf.prototype,"cotets",void 0);y([S({type:B.ObjectIdentifier})],hf.prototype,"oid",void 0);y([S({type:B.Utf8String})],hf.prototype,"string",void 0);class Eb{constructor(e={}){this.values=[],Object.assign(this,e)}}y([S({type:pr,implicit:!0,context:0,optional:!0})],Eb.prototype,"policyAuthority",void 0);y([S({type:hf,repeated:"sequence"})],Eb.prototype,"values",void 0);var _2;class ff{constructor(e={}){this.targetCertificate=new Ws,Object.assign(this,e)}}y([S({type:Ws})],ff.prototype,"targetCertificate",void 0);y([S({type:Re,optional:!0})],ff.prototype,"targetName",void 0);y([S({type:Gs,optional:!0})],ff.prototype,"certDigestInfo",void 0);let Xo=class{constructor(e={}){Object.assign(this,e)}};y([S({type:Re,context:0,implicit:!0})],Xo.prototype,"targetName",void 0);y([S({type:Re,context:1,implicit:!0})],Xo.prototype,"targetGroup",void 0);y([S({type:ff,context:2,implicit:!0})],Xo.prototype,"targetCert",void 0);Xo=y([ne({type:X.Choice})],Xo);let I2=_2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,_2.prototype)}};I2=_2=y([ne({type:X.Sequence,itemType:Xo})],I2);var C2;let q5=C2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,C2.prototype)}};q5=C2=y([ne({type:X.Sequence,itemType:I2})],q5);class xb{constructor(e={}){Object.assign(this,e)}}y([S({type:pr,implicit:!0,context:0,optional:!0})],xb.prototype,"roleAuthority",void 0);y([S({type:Re,implicit:!0,context:1})],xb.prototype,"roleName",void 0);class sp{constructor(e={}){this.service=new Re,this.ident=new Re,Object.assign(this,e)}}y([S({type:Re})],sp.prototype,"service",void 0);y([S({type:Re})],sp.prototype,"ident",void 0);y([S({type:ze,optional:!0})],sp.prototype,"authInfo",void 0);var k2;class op{constructor(e={}){this.otherCertFormat="",this.otherCert=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],op.prototype,"otherCertFormat",void 0);y([S({type:B.Any})],op.prototype,"otherCert",void 0);let Jo=class{constructor(e={}){Object.assign(this,e)}};y([S({type:Ls})],Jo.prototype,"certificate",void 0);y([S({type:uf,context:2,implicit:!0})],Jo.prototype,"v2AttrCert",void 0);y([S({type:op,context:3,implicit:!0})],Jo.prototype,"other",void 0);Jo=y([ne({type:X.Choice})],Jo);let D1=k2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,k2.prototype)}};D1=k2=y([ne({type:X.Set,itemType:Jo})],D1);class va{constructor(e={}){this.contentType="",this.content=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],va.prototype,"contentType",void 0);y([S({type:B.Any,context:0})],va.prototype,"content",void 0);let Dc=class{constructor(e={}){Object.assign(this,e)}};y([S({type:ze})],Dc.prototype,"single",void 0);y([S({type:B.Any})],Dc.prototype,"any",void 0);Dc=y([ne({type:X.Choice})],Dc);class df{constructor(e={}){this.eContentType="",Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],df.prototype,"eContentType",void 0);y([S({type:Dc,context:0,optional:!0})],df.prototype,"eContent",void 0);let Lc=class{constructor(e={}){Object.assign(this,e)}};y([S({type:ze,context:0,implicit:!0,optional:!0})],Lc.prototype,"value",void 0);y([S({type:ze,converter:rD,context:0,implicit:!0,optional:!0,repeated:"sequence"})],Lc.prototype,"constructedValue",void 0);Lc=y([ne({type:X.Choice})],Lc);class bl{constructor(e={}){this.contentType="",this.contentEncryptionAlgorithm=new B1,Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],bl.prototype,"contentType",void 0);y([S({type:B1})],bl.prototype,"contentEncryptionAlgorithm",void 0);y([S({type:Lc,optional:!0})],bl.prototype,"encryptedContent",void 0);class pf{constructor(e={}){this.keyAttrId="",Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],pf.prototype,"keyAttrId",void 0);y([S({type:B.Any,optional:!0})],pf.prototype,"keyAttr",void 0);var T2;class gf{constructor(e={}){this.subjectKeyIdentifier=new qi,Object.assign(this,e)}}y([S({type:qi})],gf.prototype,"subjectKeyIdentifier",void 0);y([S({type:B.GeneralizedTime,optional:!0})],gf.prototype,"date",void 0);y([S({type:pf,optional:!0})],gf.prototype,"other",void 0);let ea=class{constructor(e={}){Object.assign(this,e)}};y([S({type:gf,context:0,implicit:!0,optional:!0})],ea.prototype,"rKeyId",void 0);y([S({type:wa,optional:!0})],ea.prototype,"issuerAndSerialNumber",void 0);ea=y([ne({type:X.Choice})],ea);class ap{constructor(e={}){this.rid=new ea,this.encryptedKey=new ze,Object.assign(this,e)}}y([S({type:ea})],ap.prototype,"rid",void 0);y([S({type:ze})],ap.prototype,"encryptedKey",void 0);let L1=T2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,T2.prototype)}};L1=T2=y([ne({type:X.Sequence,itemType:ap})],L1);class cp{constructor(e={}){this.algorithm=new ye,this.publicKey=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:ye})],cp.prototype,"algorithm",void 0);y([S({type:B.BitString})],cp.prototype,"publicKey",void 0);let Ms=class{constructor(e={}){Object.assign(this,e)}};y([S({type:qi,context:0,implicit:!0,optional:!0})],Ms.prototype,"subjectKeyIdentifier",void 0);y([S({type:cp,context:1,implicit:!0,optional:!0})],Ms.prototype,"originatorKey",void 0);y([S({type:wa,optional:!0})],Ms.prototype,"issuerAndSerialNumber",void 0);Ms=y([ne({type:X.Choice})],Ms);class Sa{constructor(e={}){this.version=di.v3,this.originator=new Ms,this.keyEncryptionAlgorithm=new Fn,this.recipientEncryptedKeys=new L1,Object.assign(this,e)}}y([S({type:B.Integer})],Sa.prototype,"version",void 0);y([S({type:Ms,context:0})],Sa.prototype,"originator",void 0);y([S({type:ze,context:1,optional:!0})],Sa.prototype,"ukm",void 0);y([S({type:Fn})],Sa.prototype,"keyEncryptionAlgorithm",void 0);y([S({type:L1})],Sa.prototype,"recipientEncryptedKeys",void 0);let ta=class{constructor(e={}){Object.assign(this,e)}};y([S({type:qi,context:0,implicit:!0})],ta.prototype,"subjectKeyIdentifier",void 0);y([S({type:wa})],ta.prototype,"issuerAndSerialNumber",void 0);ta=y([ne({type:X.Choice})],ta);class vl{constructor(e={}){this.version=di.v0,this.rid=new ta,this.keyEncryptionAlgorithm=new Fn,this.encryptedKey=new ze,Object.assign(this,e)}}y([S({type:B.Integer})],vl.prototype,"version",void 0);y([S({type:ta})],vl.prototype,"rid",void 0);y([S({type:Fn})],vl.prototype,"keyEncryptionAlgorithm",void 0);y([S({type:ze})],vl.prototype,"encryptedKey",void 0);class Sl{constructor(e={}){this.keyIdentifier=new ze,Object.assign(this,e)}}y([S({type:ze})],Sl.prototype,"keyIdentifier",void 0);y([S({type:B.GeneralizedTime,optional:!0})],Sl.prototype,"date",void 0);y([S({type:pf,optional:!0})],Sl.prototype,"other",void 0);class El{constructor(e={}){this.version=di.v4,this.kekid=new Sl,this.keyEncryptionAlgorithm=new Fn,this.encryptedKey=new ze,Object.assign(this,e)}}y([S({type:B.Integer})],El.prototype,"version",void 0);y([S({type:Sl})],El.prototype,"kekid",void 0);y([S({type:Fn})],El.prototype,"keyEncryptionAlgorithm",void 0);y([S({type:ze})],El.prototype,"encryptedKey",void 0);class xl{constructor(e={}){this.version=di.v0,this.keyEncryptionAlgorithm=new Fn,this.encryptedKey=new ze,Object.assign(this,e)}}y([S({type:B.Integer})],xl.prototype,"version",void 0);y([S({type:b2,context:0,optional:!0})],xl.prototype,"keyDerivationAlgorithm",void 0);y([S({type:Fn})],xl.prototype,"keyEncryptionAlgorithm",void 0);y([S({type:ze})],xl.prototype,"encryptedKey",void 0);class lp{constructor(e={}){this.oriType="",this.oriValue=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],lp.prototype,"oriType",void 0);y([S({type:B.Any})],lp.prototype,"oriValue",void 0);let Wi=class{constructor(e={}){Object.assign(this,e)}};y([S({type:vl,optional:!0})],Wi.prototype,"ktri",void 0);y([S({type:Sa,context:1,implicit:!0,optional:!0})],Wi.prototype,"kari",void 0);y([S({type:El,context:2,implicit:!0,optional:!0})],Wi.prototype,"kekri",void 0);y([S({type:xl,context:3,implicit:!0,optional:!0})],Wi.prototype,"pwri",void 0);y([S({type:lp,context:4,implicit:!0,optional:!0})],Wi.prototype,"ori",void 0);Wi=y([ne({type:X.Choice})],Wi);var P2;let M1=P2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,P2.prototype)}};M1=P2=y([ne({type:X.Set,itemType:Wi})],M1);var B2;class mf{constructor(e={}){this.otherRevInfoFormat="",this.otherRevInfo=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],mf.prototype,"otherRevInfoFormat",void 0);y([S({type:B.Any})],mf.prototype,"otherRevInfo",void 0);let U1=class{constructor(e={}){this.other=new mf,Object.assign(this,e)}};y([S({type:mf,context:1,implicit:!0})],U1.prototype,"other",void 0);U1=y([ne({type:X.Choice})],U1);let F1=B2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,B2.prototype)}};F1=B2=y([ne({type:X.Set,itemType:U1})],F1);class up{constructor(e={}){Object.assign(this,e)}}y([S({type:D1,context:0,implicit:!0,optional:!0})],up.prototype,"certs",void 0);y([S({type:F1,context:1,implicit:!0,optional:!0})],up.prototype,"crls",void 0);var N2;let O2=N2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,N2.prototype)}};O2=N2=y([ne({type:X.Set,itemType:ba})],O2);class Al{constructor(e={}){this.version=di.v0,this.recipientInfos=new M1,this.encryptedContentInfo=new bl,Object.assign(this,e)}}y([S({type:B.Integer})],Al.prototype,"version",void 0);y([S({type:up,context:0,implicit:!0,optional:!0})],Al.prototype,"originatorInfo",void 0);y([S({type:M1})],Al.prototype,"recipientInfos",void 0);y([S({type:bl})],Al.prototype,"encryptedContentInfo",void 0);y([S({type:O2,context:1,implicit:!0,optional:!0})],Al.prototype,"unprotectedAttrs",void 0);const kD="1.2.840.113549.1.7.2";var R2;let $1=R2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,R2.prototype)}};$1=R2=y([ne({type:X.Set,itemType:Rc})],$1);class Ea{constructor(e={}){this.version=di.v0,this.digestAlgorithms=new $1,this.encapContentInfo=new df,this.signerInfos=new N1,Object.assign(this,e)}}y([S({type:B.Integer})],Ea.prototype,"version",void 0);y([S({type:$1})],Ea.prototype,"digestAlgorithms",void 0);y([S({type:df})],Ea.prototype,"encapContentInfo",void 0);y([S({type:D1,context:0,implicit:!0,optional:!0})],Ea.prototype,"certificates",void 0);y([S({type:F1,context:1,implicit:!0,optional:!0})],Ea.prototype,"crls",void 0);y([S({type:N1})],Ea.prototype,"signerInfos",void 0);const Mc="1.2.840.10045.2.1",hp="1.2.840.10045.4.1",Ab="1.2.840.10045.4.3.1",fp="1.2.840.10045.4.3.2",dp="1.2.840.10045.4.3.3",pp="1.2.840.10045.4.3.4",K5="1.2.840.10045.3.1.7",H5="1.3.132.0.34",j5="1.3.132.0.35";function _l(r){return new ye({algorithm:r})}const TD=_l(hp);_l(Ab);const PD=_l(fp),BD=_l(dp),ND=_l(pp);let Uc=class{constructor(e={}){Object.assign(this,e)}};y([S({type:B.ObjectIdentifier})],Uc.prototype,"fieldType",void 0);y([S({type:B.Any})],Uc.prototype,"parameters",void 0);Uc=y([ne({type:X.Sequence})],Uc);class OD extends ze{}let ra=class{constructor(e={}){Object.assign(this,e)}};y([S({type:B.OctetString})],ra.prototype,"a",void 0);y([S({type:B.OctetString})],ra.prototype,"b",void 0);y([S({type:B.BitString,optional:!0})],ra.prototype,"seed",void 0);ra=y([ne({type:X.Sequence})],ra);var D2;(function(r){r[r.ecpVer1=1]="ecpVer1"})(D2||(D2={}));let pi=class{constructor(e={}){this.version=D2.ecpVer1,Object.assign(this,e)}};y([S({type:B.Integer})],pi.prototype,"version",void 0);y([S({type:Uc})],pi.prototype,"fieldID",void 0);y([S({type:ra})],pi.prototype,"curve",void 0);y([S({type:OD})],pi.prototype,"base",void 0);y([S({type:B.Integer,converter:yt})],pi.prototype,"order",void 0);y([S({type:B.Integer,optional:!0})],pi.prototype,"cofactor",void 0);pi=y([ne({type:X.Sequence})],pi);let Gi=class{constructor(e={}){Object.assign(this,e)}};y([S({type:B.ObjectIdentifier})],Gi.prototype,"namedCurve",void 0);y([S({type:B.Null})],Gi.prototype,"implicitCurve",void 0);y([S({type:pi})],Gi.prototype,"specifiedCurve",void 0);Gi=y([ne({type:X.Choice})],Gi);class yf{constructor(e={}){this.version=1,this.privateKey=new ze,Object.assign(this,e)}}y([S({type:B.Integer})],yf.prototype,"version",void 0);y([S({type:ze})],yf.prototype,"privateKey",void 0);y([S({type:Gi,context:0,optional:!0})],yf.prototype,"parameters",void 0);y([S({type:B.BitString,context:1,optional:!0})],yf.prototype,"publicKey",void 0);class V1{constructor(e={}){this.r=new ArrayBuffer(0),this.s=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.Integer,converter:yt})],V1.prototype,"r",void 0);y([S({type:B.Integer,converter:yt})],V1.prototype,"s",void 0);const Tr="1.2.840.113549.1.1",Us=`${Tr}.1`,RD=`${Tr}.7`,DD=`${Tr}.9`,lc=`${Tr}.10`,LD=`${Tr}.2`,MD=`${Tr}.4`,q1=`${Tr}.5`,UD=`${Tr}.14`,L2=`${Tr}.11`,K1=`${Tr}.12`,H1=`${Tr}.13`,_b=`${Tr}.15`,Ib=`${Tr}.16`,j1="1.3.14.3.2.26",Cb="2.16.840.1.101.3.4.2.4",z1="2.16.840.1.101.3.4.2.1",W1="2.16.840.1.101.3.4.2.2",G1="2.16.840.1.101.3.4.2.3",FD="2.16.840.1.101.3.4.2.5",$D="2.16.840.1.101.3.4.2.6",VD="1.2.840.113549.2.2",qD="1.2.840.113549.2.5",wf=`${Tr}.8`;function Mt(r){return new ye({algorithm:r,parameters:null})}Mt(VD);Mt(qD);const Fs=Mt(j1);Mt(Cb);Mt(z1);Mt(W1);Mt(G1);Mt(FD);Mt($D);const kb=new ye({algorithm:wf,parameters:fe.serialize(Fs)}),Tb=new ye({algorithm:DD,parameters:fe.serialize(x1.toASN(new Uint8Array([218,57,163,238,94,107,75,13,50,85,191,239,149,96,24,144,175,216,7,9]).buffer))});Mt(Us);Mt(LD);Mt(MD);Mt(q1);Mt(_b);Mt(Ib);Mt(K1);Mt(H1);Mt(_b);Mt(Ib);class bf{constructor(e={}){this.hashAlgorithm=new ye(Fs),this.maskGenAlgorithm=new ye({algorithm:wf,parameters:fe.serialize(Fs)}),this.pSourceAlgorithm=new ye(Tb),Object.assign(this,e)}}y([S({type:ye,context:0,defaultValue:Fs})],bf.prototype,"hashAlgorithm",void 0);y([S({type:ye,context:1,defaultValue:kb})],bf.prototype,"maskGenAlgorithm",void 0);y([S({type:ye,context:2,defaultValue:Tb})],bf.prototype,"pSourceAlgorithm",void 0);new ye({algorithm:RD,parameters:fe.serialize(new bf)});class $s{constructor(e={}){this.hashAlgorithm=new ye(Fs),this.maskGenAlgorithm=new ye({algorithm:wf,parameters:fe.serialize(Fs)}),this.saltLength=20,this.trailerField=1,Object.assign(this,e)}}y([S({type:ye,context:0,defaultValue:Fs})],$s.prototype,"hashAlgorithm",void 0);y([S({type:ye,context:1,defaultValue:kb})],$s.prototype,"maskGenAlgorithm",void 0);y([S({type:B.Integer,context:2,defaultValue:20})],$s.prototype,"saltLength",void 0);y([S({type:B.Integer,context:3,defaultValue:1})],$s.prototype,"trailerField",void 0);new ye({algorithm:lc,parameters:fe.serialize(new $s)});class vf{constructor(e={}){this.digestAlgorithm=new ye,this.digest=new ze,Object.assign(this,e)}}y([S({type:ye})],vf.prototype,"digestAlgorithm",void 0);y([S({type:ze})],vf.prototype,"digest",void 0);var M2;class Sf{constructor(e={}){this.prime=new ArrayBuffer(0),this.exponent=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.Integer,converter:yt})],Sf.prototype,"prime",void 0);y([S({type:B.Integer,converter:yt})],Sf.prototype,"exponent",void 0);y([S({type:B.Integer,converter:yt})],Sf.prototype,"coefficient",void 0);let U2=M2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,M2.prototype)}};U2=M2=y([ne({type:X.Sequence,itemType:Sf})],U2);class qn{constructor(e={}){this.version=0,this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),this.privateExponent=new ArrayBuffer(0),this.prime1=new ArrayBuffer(0),this.prime2=new ArrayBuffer(0),this.exponent1=new ArrayBuffer(0),this.exponent2=new ArrayBuffer(0),this.coefficient=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.Integer})],qn.prototype,"version",void 0);y([S({type:B.Integer,converter:yt})],qn.prototype,"modulus",void 0);y([S({type:B.Integer,converter:yt})],qn.prototype,"publicExponent",void 0);y([S({type:B.Integer,converter:yt})],qn.prototype,"privateExponent",void 0);y([S({type:B.Integer,converter:yt})],qn.prototype,"prime1",void 0);y([S({type:B.Integer,converter:yt})],qn.prototype,"prime2",void 0);y([S({type:B.Integer,converter:yt})],qn.prototype,"exponent1",void 0);y([S({type:B.Integer,converter:yt})],qn.prototype,"exponent2",void 0);y([S({type:B.Integer,converter:yt})],qn.prototype,"coefficient",void 0);y([S({type:U2,optional:!0})],qn.prototype,"otherPrimeInfos",void 0);class gp{constructor(e={}){this.modulus=new ArrayBuffer(0),this.publicExponent=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.Integer,converter:yt})],gp.prototype,"modulus",void 0);y([S({type:B.Integer,converter:yt})],gp.prototype,"publicExponent",void 0);var F2;(function(r){r[r.Transient=0]="Transient",r[r.Singleton=1]="Singleton",r[r.ResolutionScoped=2]="ResolutionScoped",r[r.ContainerScoped=3]="ContainerScoped"})(F2||(F2={}));const wr=F2;/*! *****************************************************************************
Copyright (c) Microsoft Corporation.

Permission to use, copy, modify, and/or distribute this software for any
purpose with or without fee is hereby granted.

THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
PERFORMANCE OF THIS SOFTWARE.
***************************************************************************** */var $2=function(r,e){return $2=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,n){t.__proto__=n}||function(t,n){for(var i in n)n.hasOwnProperty(i)&&(t[i]=n[i])},$2(r,e)};function mp(r,e){$2(r,e);function t(){this.constructor=r}r.prototype=e===null?Object.create(e):(t.prototype=e.prototype,new t)}function KD(r,e,t,n){function i(s){return s instanceof t?s:new t(function(o){o(s)})}return new(t||(t=Promise))(function(s,o){function a(u){try{l(n.next(u))}catch(f){o(f)}}function c(u){try{l(n.throw(u))}catch(f){o(f)}}function l(u){u.done?s(u.value):i(u.value).then(a,c)}l((n=n.apply(r,[])).next())})}function HD(r,e){var t={label:0,sent:function(){if(s[0]&1)throw s[1];return s[1]},trys:[],ops:[]},n,i,s,o;return o={next:a(0),throw:a(1),return:a(2)},typeof Symbol=="function"&&(o[Symbol.iterator]=function(){return this}),o;function a(l){return function(u){return c([l,u])}}function c(l){if(n)throw new TypeError("Generator is already executing.");for(;t;)try{if(n=1,i&&(s=l[0]&2?i.return:l[0]?i.throw||((s=i.return)&&s.call(i),0):i.next)&&!(s=s.call(i,l[1])).done)return s;switch(i=0,s&&(l=[l[0]&2,s.value]),l[0]){case 0:case 1:s=l;break;case 4:return t.label++,{value:l[1],done:!1};case 5:t.label++,i=l[1],l=[0];continue;case 7:l=t.ops.pop(),t.trys.pop();continue;default:if(s=t.trys,!(s=s.length>0&&s[s.length-1])&&(l[0]===6||l[0]===2)){t=0;continue}if(l[0]===3&&(!s||l[1]>s[0]&&l[1]<s[3])){t.label=l[1];break}if(l[0]===6&&t.label<s[1]){t.label=s[1],s=l;break}if(s&&t.label<s[2]){t.label=s[2],t.ops.push(l);break}s[2]&&t.ops.pop(),t.trys.pop();continue}l=e.call(r,t)}catch(u){l=[6,u],i=0}finally{n=s=0}if(l[0]&5)throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}}function Zl(r){var e=typeof Symbol=="function"&&Symbol.iterator,t=e&&r[e],n=0;if(t)return t.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&n>=r.length&&(r=void 0),{value:r&&r[n++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")}function Q1(r,e){var t=typeof Symbol=="function"&&r[Symbol.iterator];if(!t)return r;var n=t.call(r),i,s=[],o;try{for(;(e===void 0||e-- >0)&&!(i=n.next()).done;)s.push(i.value)}catch(a){o={error:a}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(o)throw o.error}}return s}function os(){for(var r=[],e=0;e<arguments.length;e++)r=r.concat(Q1(arguments[e]));return r}var jD="injectionTokens";function zD(r){var e=Reflect.getMetadata("design:paramtypes",r)||[],t=Reflect.getOwnMetadata(jD,r)||{};return Object.keys(t).forEach(function(n){e[+n]=t[n]}),e}function Pb(r){return!!r.useClass}function V2(r){return!!r.useFactory}var Bb=function(){function r(e){this.wrap=e,this.reflectMethods=["get","getPrototypeOf","setPrototypeOf","getOwnPropertyDescriptor","defineProperty","has","set","deleteProperty","apply","construct","ownKeys"]}return r.prototype.createProxy=function(e){var t=this,n={},i=!1,s,o=function(){return i||(s=e(t.wrap()),i=!0),s};return new Proxy(n,this.createHandler(o))},r.prototype.createHandler=function(e){var t={},n=function(i){t[i]=function(){for(var s=[],o=0;o<arguments.length;o++)s[o]=arguments[o];s[0]=e();var a=Reflect[i];return a.apply(void 0,os(s))}};return this.reflectMethods.forEach(n),t},r}();function ro(r){return typeof r=="string"||typeof r=="symbol"}function WD(r){return typeof r=="object"&&"token"in r&&"multiple"in r}function z5(r){return typeof r=="object"&&"token"in r&&"transform"in r}function GD(r){return typeof r=="function"||r instanceof Bb}function Su(r){return!!r.useToken}function Eu(r){return r.useValue!=null}function QD(r){return Pb(r)||Eu(r)||Su(r)||V2(r)}var yp=function(){function r(){this._registryMap=new Map}return r.prototype.entries=function(){return this._registryMap.entries()},r.prototype.getAll=function(e){return this.ensure(e),this._registryMap.get(e)},r.prototype.get=function(e){this.ensure(e);var t=this._registryMap.get(e);return t[t.length-1]||null},r.prototype.set=function(e,t){this.ensure(e),this._registryMap.get(e).push(t)},r.prototype.setAll=function(e,t){this._registryMap.set(e,t)},r.prototype.has=function(e){return this.ensure(e),this._registryMap.get(e).length>0},r.prototype.clear=function(){this._registryMap.clear()},r.prototype.ensure=function(e){this._registryMap.has(e)||this._registryMap.set(e,[])},r}(),YD=function(r){mp(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(yp),Xl=function(){function r(){this.scopedResolutions=new Map}return r}();function ZD(r,e){if(r===null)return"at position #"+e;var t=r.split(",")[e].trim();return'"'+t+'" at position #'+e}function XD(r,e,t){return t===void 0&&(t="    "),os([r],e.message.split(`
`).map(function(n){return t+n})).join(`
`)}function JD(r,e,t){var n=Q1(r.toString().match(/constructor\(([\w, ]+)\)/)||[],2),i=n[1],s=i===void 0?null:i,o=ZD(s,e);return XD("Cannot inject the dependency "+o+' of "'+r.name+'" constructor. Reason:',t)}function eL(r){if(typeof r.dispose!="function")return!1;var e=r.dispose;return!(e.length>0)}var tL=function(r){mp(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(yp),rL=function(r){mp(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e}(yp),nL=function(){function r(){this.preResolution=new tL,this.postResolution=new rL}return r}(),Nb=new Map,iL=function(){function r(e){this.parent=e,this._registry=new YD,this.interceptors=new nL,this.disposed=!1,this.disposables=new Set}return r.prototype.register=function(e,t,n){n===void 0&&(n={lifecycle:wr.Transient}),this.ensureNotDisposed();var i;if(QD(t)?i=t:i={useClass:t},Su(i))for(var s=[e],o=i;o!=null;){var a=o.useToken;if(s.includes(a))throw new Error("Token registration cycle detected! "+os(s,[a]).join(" -> "));s.push(a);var c=this._registry.get(a);c&&Su(c.provider)?o=c.provider:o=null}if((n.lifecycle===wr.Singleton||n.lifecycle==wr.ContainerScoped||n.lifecycle==wr.ResolutionScoped)&&(Eu(i)||V2(i)))throw new Error('Cannot use lifecycle "'+wr[n.lifecycle]+'" with ValueProviders or FactoryProviders');return this._registry.set(e,{provider:i,options:n}),this},r.prototype.registerType=function(e,t){return this.ensureNotDisposed(),ro(t)?this.register(e,{useToken:t}):this.register(e,{useClass:t})},r.prototype.registerInstance=function(e,t){return this.ensureNotDisposed(),this.register(e,{useValue:t})},r.prototype.registerSingleton=function(e,t){if(this.ensureNotDisposed(),ro(e)){if(ro(t))return this.register(e,{useToken:t},{lifecycle:wr.Singleton});if(t)return this.register(e,{useClass:t},{lifecycle:wr.Singleton});throw new Error('Cannot register a type name as a singleton without a "to" token')}var n=e;return t&&!ro(t)&&(n=t),this.register(e,{useClass:n},{lifecycle:wr.Singleton})},r.prototype.resolve=function(e,t,n){t===void 0&&(t=new Xl),n===void 0&&(n=!1),this.ensureNotDisposed();var i=this.getRegistration(e);if(!i&&ro(e)){if(n)return;throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"Single"),i){var s=this.resolveRegistration(i,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}if(GD(e)){var s=this.construct(e,t);return this.executePostResolutionInterceptor(e,s,"Single"),s}throw new Error("Attempted to construct an undefined constructor. Could mean a circular dependency problem. Try using `delay` function.")},r.prototype.executePreResolutionInterceptor=function(e,t){var n,i;if(this.interceptors.preResolution.has(e)){var s=[];try{for(var o=Zl(this.interceptors.preResolution.getAll(e)),a=o.next();!a.done;a=o.next()){var c=a.value;c.options.frequency!="Once"&&s.push(c),c.callback(e,t)}}catch(l){n={error:l}}finally{try{a&&!a.done&&(i=o.return)&&i.call(o)}finally{if(n)throw n.error}}this.interceptors.preResolution.setAll(e,s)}},r.prototype.executePostResolutionInterceptor=function(e,t,n){var i,s;if(this.interceptors.postResolution.has(e)){var o=[];try{for(var a=Zl(this.interceptors.postResolution.getAll(e)),c=a.next();!c.done;c=a.next()){var l=c.value;l.options.frequency!="Once"&&o.push(l),l.callback(e,t,n)}}catch(u){i={error:u}}finally{try{c&&!c.done&&(s=a.return)&&s.call(a)}finally{if(i)throw i.error}}this.interceptors.postResolution.setAll(e,o)}},r.prototype.resolveRegistration=function(e,t){if(this.ensureNotDisposed(),e.options.lifecycle===wr.ResolutionScoped&&t.scopedResolutions.has(e))return t.scopedResolutions.get(e);var n=e.options.lifecycle===wr.Singleton,i=e.options.lifecycle===wr.ContainerScoped,s=n||i,o;return Eu(e.provider)?o=e.provider.useValue:Su(e.provider)?o=s?e.instance||(e.instance=this.resolve(e.provider.useToken,t)):this.resolve(e.provider.useToken,t):Pb(e.provider)?o=s?e.instance||(e.instance=this.construct(e.provider.useClass,t)):this.construct(e.provider.useClass,t):V2(e.provider)?o=e.provider.useFactory(this):o=this.construct(e.provider,t),e.options.lifecycle===wr.ResolutionScoped&&t.scopedResolutions.set(e,o),o},r.prototype.resolveAll=function(e,t,n){var i=this;t===void 0&&(t=new Xl),n===void 0&&(n=!1),this.ensureNotDisposed();var s=this.getAllRegistrations(e);if(!s&&ro(e)){if(n)return[];throw new Error('Attempted to resolve unregistered dependency token: "'+e.toString()+'"')}if(this.executePreResolutionInterceptor(e,"All"),s){var o=s.map(function(c){return i.resolveRegistration(c,t)});return this.executePostResolutionInterceptor(e,o,"All"),o}var a=[this.construct(e,t)];return this.executePostResolutionInterceptor(e,a,"All"),a},r.prototype.isRegistered=function(e,t){return t===void 0&&(t=!1),this.ensureNotDisposed(),this._registry.has(e)||t&&(this.parent||!1)&&this.parent.isRegistered(e,!0)},r.prototype.reset=function(){this.ensureNotDisposed(),this._registry.clear(),this.interceptors.preResolution.clear(),this.interceptors.postResolution.clear()},r.prototype.clearInstances=function(){var e,t;this.ensureNotDisposed();try{for(var n=Zl(this._registry.entries()),i=n.next();!i.done;i=n.next()){var s=Q1(i.value,2),o=s[0],a=s[1];this._registry.setAll(o,a.filter(function(c){return!Eu(c.provider)}).map(function(c){return c.instance=void 0,c}))}}catch(c){e={error:c}}finally{try{i&&!i.done&&(t=n.return)&&t.call(n)}finally{if(e)throw e.error}}},r.prototype.createChildContainer=function(){var e,t;this.ensureNotDisposed();var n=new r(this);try{for(var i=Zl(this._registry.entries()),s=i.next();!s.done;s=i.next()){var o=Q1(s.value,2),a=o[0],c=o[1];c.some(function(l){var u=l.options;return u.lifecycle===wr.ContainerScoped})&&n._registry.setAll(a,c.map(function(l){return l.options.lifecycle===wr.ContainerScoped?{provider:l.provider,options:l.options}:l}))}}catch(l){e={error:l}}finally{try{s&&!s.done&&(t=i.return)&&t.call(i)}finally{if(e)throw e.error}}return n},r.prototype.beforeResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.preResolution.set(e,{callback:t,options:n})},r.prototype.afterResolution=function(e,t,n){n===void 0&&(n={frequency:"Always"}),this.interceptors.postResolution.set(e,{callback:t,options:n})},r.prototype.dispose=function(){return KD(this,void 0,void 0,function(){var e;return HD(this,function(t){switch(t.label){case 0:return this.disposed=!0,e=[],this.disposables.forEach(function(n){var i=n.dispose();i&&e.push(i)}),[4,Promise.all(e)];case 1:return t.sent(),[2]}})})},r.prototype.getRegistration=function(e){return this.isRegistered(e)?this._registry.get(e):this.parent?this.parent.getRegistration(e):null},r.prototype.getAllRegistrations=function(e){return this.isRegistered(e)?this._registry.getAll(e):this.parent?this.parent.getAllRegistrations(e):null},r.prototype.construct=function(e,t){var n=this;if(e instanceof Bb)return e.createProxy(function(s){return n.resolve(s,t)});var i=function(){var s=Nb.get(e);if(!s||s.length===0){if(e.length===0)return new e;throw new Error('TypeInfo not known for "'+e.name+'"')}var o=s.map(n.resolveParams(t,e));return new(e.bind.apply(e,os([void 0],o)))}();return eL(i)&&this.disposables.add(i),i},r.prototype.resolveParams=function(e,t){var n=this;return function(i,s){var o,a,c;try{return WD(i)?z5(i)?i.multiple?(o=n.resolve(i.transform)).transform.apply(o,os([n.resolveAll(i.token,new Xl,i.isOptional)],i.transformArgs)):(a=n.resolve(i.transform)).transform.apply(a,os([n.resolve(i.token,e,i.isOptional)],i.transformArgs)):i.multiple?n.resolveAll(i.token,new Xl,i.isOptional):n.resolve(i.token,e,i.isOptional):z5(i)?(c=n.resolve(i.transform,e)).transform.apply(c,os([n.resolve(i.token,e)],i.transformArgs)):n.resolve(i,e)}catch(l){throw new Error(JD(t,s,l))}}},r.prototype.ensureNotDisposed=function(){if(this.disposed)throw new Error("This container has been disposed, you cannot interact with a disposed container")},r}(),Qt=new iL;function Ef(r){return function(e){Nb.set(e,zD(e))}}if(typeof Reflect>"u"||!Reflect.getMetadata)throw new Error(`tsyringe requires a reflect polyfill. Please add 'import "reflect-metadata"' to the top of your entry point.`);var q2;class xf{constructor(e={}){this.attrId="",this.attrValues=[],Object.assign(e)}}y([S({type:B.ObjectIdentifier})],xf.prototype,"attrId",void 0);y([S({type:B.Any,repeated:"set"})],xf.prototype,"attrValues",void 0);let W5=q2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,q2.prototype)}};W5=q2=y([ne({type:X.Sequence,itemType:xf})],W5);var K2;let G5=K2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,K2.prototype)}};G5=K2=y([ne({type:X.Sequence,itemType:va})],G5);class Ob{constructor(e={}){this.certId="",this.certValue=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],Ob.prototype,"certId",void 0);y([S({type:B.Any,context:0})],Ob.prototype,"certValue",void 0);class Rb{constructor(e={}){this.crlId="",this.crltValue=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],Rb.prototype,"crlId",void 0);y([S({type:B.Any,context:0})],Rb.prototype,"crltValue",void 0);class Db extends ze{}let Af=class{constructor(e={}){this.encryptionAlgorithm=new ye,this.encryptedData=new Db,Object.assign(this,e)}};y([S({type:ye})],Af.prototype,"encryptionAlgorithm",void 0);y([S({type:Db})],Af.prototype,"encryptedData",void 0);var H2,j2;(function(r){r[r.v1=0]="v1"})(j2||(j2={}));class Lb extends ze{}let z2=H2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,H2.prototype)}};z2=H2=y([ne({type:X.Sequence,itemType:fi})],z2);class Il{constructor(e={}){this.version=j2.v1,this.privateKeyAlgorithm=new ye,this.privateKey=new Lb,Object.assign(this,e)}}y([S({type:B.Integer})],Il.prototype,"version",void 0);y([S({type:ye})],Il.prototype,"privateKeyAlgorithm",void 0);y([S({type:Lb})],Il.prototype,"privateKey",void 0);y([S({type:z2,implicit:!0,context:0,optional:!0})],Il.prototype,"attributes",void 0);let Q5=class extends Il{};Q5=y([ne({type:X.Sequence})],Q5);let Y5=class extends Af{};Y5=y([ne({type:X.Sequence})],Y5);class Mb{constructor(e={}){this.secretTypeId="",this.secretValue=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],Mb.prototype,"secretTypeId",void 0);y([S({type:B.Any,context:0})],Mb.prototype,"secretValue",void 0);class Cl{constructor(e={}){this.mac=new vf,this.macSalt=new ze,this.iterations=1,Object.assign(this,e)}}y([S({type:vf})],Cl.prototype,"mac",void 0);y([S({type:ze})],Cl.prototype,"macSalt",void 0);y([S({type:B.Integer,defaultValue:1})],Cl.prototype,"iterations",void 0);class _f{constructor(e={}){this.version=3,this.authSafe=new va,this.macData=new Cl,Object.assign(this,e)}}y([S({type:B.Integer})],_f.prototype,"version",void 0);y([S({type:va})],_f.prototype,"authSafe",void 0);y([S({type:Cl,optional:!0})],_f.prototype,"macData",void 0);var W2;class If{constructor(e={}){this.bagId="",this.bagValue=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:B.ObjectIdentifier})],If.prototype,"bagId",void 0);y([S({type:B.Any,context:0})],If.prototype,"bagValue",void 0);y([S({type:xf,repeated:"set",optional:!0})],If.prototype,"bagAttributes",void 0);let Z5=W2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,W2.prototype)}};Z5=W2=y([ne({type:X.Sequence,itemType:If})],Z5);var G2,Q2,Y2;const Ub="1.2.840.113549.1.9",Fb=`${Ub}.7`,wp=`${Ub}.14`;let Y1=class extends Gt{constructor(e={}){super(e)}toString(){return this.ia5String||super.toString()}};y([S({type:B.IA5String})],Y1.prototype,"ia5String",void 0);Y1=y([ne({type:X.Choice})],Y1);let X5=class extends va{};X5=y([ne({type:X.Sequence})],X5);let J5=class extends _f{};J5=y([ne({type:X.Sequence})],J5);let e8=class extends Af{};e8=y([ne({type:X.Sequence})],e8);let Z2=class{constructor(e=""){this.value=e}toString(){return this.value}};y([S({type:B.IA5String})],Z2.prototype,"value",void 0);Z2=y([ne({type:X.Choice})],Z2);let t8=class extends Y1{};t8=y([ne({type:X.Choice})],t8);let r8=class extends Gt{};r8=y([ne({type:X.Choice})],r8);let X2=class{constructor(e=new Date){this.value=e}};y([S({type:B.GeneralizedTime})],X2.prototype,"value",void 0);X2=y([ne({type:X.Choice})],X2);let n8=class extends Gt{};n8=y([ne({type:X.Choice})],n8);let J2=class{constructor(e="M"){this.value=e}toString(){return this.value}};y([S({type:B.PrintableString})],J2.prototype,"value",void 0);J2=y([ne({type:X.Choice})],J2);let Z1=class{constructor(e=""){this.value=e}toString(){return this.value}};y([S({type:B.PrintableString})],Z1.prototype,"value",void 0);Z1=y([ne({type:X.Choice})],Z1);let i8=class extends Z1{};i8=y([ne({type:X.Choice})],i8);let s8=class extends Gt{};s8=y([ne({type:X.Choice})],s8);let e3=class{constructor(e=""){this.value=e}toString(){return this.value}};y([S({type:B.ObjectIdentifier})],e3.prototype,"value",void 0);e3=y([ne({type:X.Choice})],e3);let o8=class extends jt{};o8=y([ne({type:X.Choice})],o8);let t3=class{constructor(e=0){this.value=e}toString(){return this.value.toString()}};y([S({type:B.Integer})],t3.prototype,"value",void 0);t3=y([ne({type:X.Choice})],t3);let a8=class extends Vn{};a8=y([ne({type:X.Sequence})],a8);let X1=class extends Gt{};X1=y([ne({type:X.Choice})],X1);let c8=G2=class extends zi{constructor(e){super(e),Object.setPrototypeOf(this,G2.prototype)}};c8=G2=y([ne({type:X.Sequence})],c8);let l8=Q2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,Q2.prototype)}};l8=Q2=y([ne({type:X.Set,itemType:ba})],l8);let r3=class{constructor(e=""){this.value=e}toString(){return this.value}};y([S({type:B.BmpString})],r3.prototype,"value",void 0);r3=y([ne({type:X.Choice})],r3);let n3=class extends ye{};n3=y([ne({type:X.Sequence})],n3);let u8=Y2=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,Y2.prototype)}};u8=Y2=y([ne({type:X.Sequence,itemType:n3})],u8);var i3;let J1=i3=class extends rt{constructor(e){super(e),Object.setPrototypeOf(this,i3.prototype)}};J1=i3=y([ne({type:X.Sequence,itemType:fi})],J1);class xa{constructor(e={}){this.version=0,this.subject=new Bt,this.subjectPKInfo=new pn,this.attributes=new J1,Object.assign(this,e)}}y([S({type:B.Integer})],xa.prototype,"version",void 0);y([S({type:Bt})],xa.prototype,"subject",void 0);y([S({type:pn})],xa.prototype,"subjectPKInfo",void 0);y([S({type:J1,implicit:!0,context:0})],xa.prototype,"attributes",void 0);class Fc{constructor(e={}){this.certificationRequestInfo=new xa,this.signatureAlgorithm=new ye,this.signature=new ArrayBuffer(0),Object.assign(this,e)}}y([S({type:xa})],Fc.prototype,"certificationRequestInfo",void 0);y([S({type:ye})],Fc.prototype,"signatureAlgorithm",void 0);y([S({type:B.BitString})],Fc.prototype,"signature",void 0);/*!
 * MIT License
 * 
 * Copyright (c) Peculiar Ventures. All rights reserved.
 * 
 * Permission is hereby granted, free of charge, to any person obtaining a copy
 * of this software and associated documentation files (the "Software"), to deal
 * in the Software without restriction, including without limitation the rights
 * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell
 * copies of the Software, and to permit persons to whom the Software is
 * furnished to do so, subject to the following conditions:
 * 
 * The above copyright notice and this permission notice shall be included in all
 * copies or substantial portions of the Software.
 * 
 * THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
 * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
 * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE
 * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
 * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,
 * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE
 * SOFTWARE.
 * 
 */const kl="crypto.algorithm";class sL{getAlgorithms(){return Qt.resolveAll(kl)}toAsnAlgorithm(e){({...e});for(const t of this.getAlgorithms()){const n=t.toAsnAlgorithm(e);if(n)return n}if(/^[0-9.]+$/.test(e.name)){const t=new ye({algorithm:e.name});if("parameters"in e){const n=e;t.parameters=n.parameters}return t}throw new Error("Cannot convert WebCrypto algorithm to ASN.1 algorithm")}toWebAlgorithm(e){for(const n of this.getAlgorithms()){const i=n.toWebAlgorithm(e);if(i)return i}return{name:e.algorithm,parameters:e.parameters}}}const Vs="crypto.algorithmProvider";Qt.registerSingleton(Vs,sL);var xu;const Pr="1.3.36.3.3.2.8.1.1",h8=`${Pr}.1`,f8=`${Pr}.2`,d8=`${Pr}.3`,p8=`${Pr}.4`,g8=`${Pr}.5`,m8=`${Pr}.6`,y8=`${Pr}.7`,w8=`${Pr}.8`,b8=`${Pr}.9`,v8=`${Pr}.10`,S8=`${Pr}.11`,E8=`${Pr}.12`,x8=`${Pr}.13`,A8=`${Pr}.14`,_8="brainpoolP160r1",I8="brainpoolP160t1",C8="brainpoolP192r1",k8="brainpoolP192t1",T8="brainpoolP224r1",P8="brainpoolP224t1",B8="brainpoolP256r1",N8="brainpoolP256t1",O8="brainpoolP320r1",R8="brainpoolP320t1",D8="brainpoolP384r1",L8="brainpoolP384t1",M8="brainpoolP512r1",U8="brainpoolP512t1",xt="ECDSA";let $c=xu=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case xt.toLowerCase():if("hash"in e)switch((typeof e.hash=="string"?e.hash:e.hash.name).toLowerCase()){case"sha-1":return TD;case"sha-256":return PD;case"sha-384":return BD;case"sha-512":return ND}else if("namedCurve"in e){let t="";switch(e.namedCurve){case"P-256":t=K5;break;case"K-256":t=xu.SECP256K1;break;case"P-384":t=H5;break;case"P-521":t=j5;break;case _8:t=h8;break;case I8:t=f8;break;case C8:t=d8;break;case k8:t=p8;break;case T8:t=g8;break;case P8:t=m8;break;case B8:t=y8;break;case N8:t=w8;break;case O8:t=b8;break;case R8:t=v8;break;case D8:t=S8;break;case L8:t=E8;break;case M8:t=x8;break;case U8:t=A8;break}if(t)return new ye({algorithm:Mc,parameters:fe.serialize(new Gi({namedCurve:t}))})}}return null}toWebAlgorithm(e){switch(e.algorithm){case hp:return{name:xt,hash:{name:"SHA-1"}};case fp:return{name:xt,hash:{name:"SHA-256"}};case dp:return{name:xt,hash:{name:"SHA-384"}};case pp:return{name:xt,hash:{name:"SHA-512"}};case Mc:{if(!e.parameters)throw new TypeError("Cannot get required parameters from EC algorithm");switch(fe.parse(e.parameters,Gi).namedCurve){case K5:return{name:xt,namedCurve:"P-256"};case xu.SECP256K1:return{name:xt,namedCurve:"K-256"};case H5:return{name:xt,namedCurve:"P-384"};case j5:return{name:xt,namedCurve:"P-521"};case h8:return{name:xt,namedCurve:_8};case f8:return{name:xt,namedCurve:I8};case d8:return{name:xt,namedCurve:C8};case p8:return{name:xt,namedCurve:k8};case g8:return{name:xt,namedCurve:T8};case m8:return{name:xt,namedCurve:P8};case y8:return{name:xt,namedCurve:B8};case w8:return{name:xt,namedCurve:N8};case b8:return{name:xt,namedCurve:O8};case v8:return{name:xt,namedCurve:R8};case S8:return{name:xt,namedCurve:D8};case E8:return{name:xt,namedCurve:L8};case x8:return{name:xt,namedCurve:M8};case A8:return{name:xt,namedCurve:U8}}}}return null}};$c.SECP256K1="1.3.132.0.10";$c=xu=y([Ef()],$c);Qt.registerSingleton(kl,$c);const $b=Symbol("name"),Vb=Symbol("value");class Qe{constructor(e,t={},n=""){this[$b]=e,this[Vb]=n;for(const i in t)this[i]=t[i]}}Qe.NAME=$b;Qe.VALUE=Vb;class oL{static toTextObject(e){const t=new Qe("Algorithm Identifier",{},Xi.toString(e.algorithm));if(e.parameters)switch(e.algorithm){case Mc:{const n=new $c().toWebAlgorithm(e);n&&"namedCurve"in n?t["Named Curve"]=n.namedCurve:t.Parameters=e.parameters;break}default:t.Parameters=e.parameters}return t}}class Xi{static toString(e){const t=this.items[e];return t||e}}Xi.items={[j1]:"sha1",[Cb]:"sha224",[z1]:"sha256",[W1]:"sha384",[G1]:"sha512",[Us]:"rsaEncryption",[q1]:"sha1WithRSAEncryption",[UD]:"sha224WithRSAEncryption",[L2]:"sha256WithRSAEncryption",[K1]:"sha384WithRSAEncryption",[H1]:"sha512WithRSAEncryption",[Mc]:"ecPublicKey",[hp]:"ecdsaWithSHA1",[Ab]:"ecdsaWithSHA224",[fp]:"ecdsaWithSHA256",[dp]:"ecdsaWithSHA384",[pp]:"ecdsaWithSHA512",[ED]:"TLS WWW server authentication",[xD]:"TLS WWW client authentication",[AD]:"Code Signing",[_D]:"E-mail Protection",[ID]:"Time Stamping",[CD]:"OCSP Signing",[kD]:"Signed Data"};class qs{static serialize(e){return this.serializeObj(e).join(`
`)}static pad(e=0){return"".padStart(2*e," ")}static serializeObj(e,t=0){const n=[];let i=this.pad(t++),s="";const o=e[Qe.VALUE];o&&(s=` ${o}`),n.push(`${i}${e[Qe.NAME]}:${s}`),i=this.pad(t);for(const a in e){if(typeof a=="symbol")continue;const c=e[a],l=a?`${a}: `:"";if(typeof c=="string"||typeof c=="number"||typeof c=="boolean")n.push(`${i}${l}${c}`);else if(c instanceof Date)n.push(`${i}${l}${c.toUTCString()}`);else if(Array.isArray(c))for(const u of c)u[Qe.NAME]=a,n.push(...this.serializeObj(u,t));else if(c instanceof Qe)c[Qe.NAME]=a,n.push(...this.serializeObj(c,t));else if(pe.isBufferSource(c))a?(n.push(`${i}${l}`),n.push(...this.serializeBufferSource(c,t+1))):n.push(...this.serializeBufferSource(c,t));else if("toTextObject"in c){const u=c.toTextObject();u[Qe.NAME]=a,n.push(...this.serializeObj(u,t))}else throw new TypeError("Cannot serialize data in text format. Unsupported type.")}return n}static serializeBufferSource(e,t=0){const n=this.pad(t),i=pe.toUint8Array(e),s=[];for(let o=0;o<i.length;){const a=[];for(let c=0;c<16&&o<i.length;c++){c===8&&a.push("");const l=i[o++].toString(16).padStart(2,"0");a.push(l)}s.push(`${n}${a.join(" ")}`)}return s}static serializeAlgorithm(e){return this.algorithmSerializer.toTextObject(e)}}qs.oidSerializer=Xi;qs.algorithmSerializer=oL;class Ji{constructor(...e){if(e.length===1){const t=e[0];this.rawData=fe.serialize(t),this.onInit(t)}else{const t=fe.parse(e[0],e[1]);this.rawData=pe.toArrayBuffer(e[0]),this.onInit(t)}}equal(e){return e instanceof Ji?uw(e.rawData,this.rawData):!1}toString(e="text"){switch(e){case"asn":return fe.toString(this.rawData);case"text":return qs.serialize(this.toTextObject());case"hex":return Ee.ToHex(this.rawData);case"base64":return Ee.ToBase64(this.rawData);case"base64url":return Ee.ToBase64Url(this.rawData);default:throw TypeError("Argument 'format' is unsupported value")}}getTextName(){return this.constructor.NAME}toTextObject(){const e=this.toTextObjectEmpty();return e[""]=this.rawData,e}toTextObjectEmpty(e){return new Qe(this.getTextName(),{},e)}}Ji.NAME="ASN";class sn extends Ji{constructor(...e){let t;pe.isBufferSource(e[0])?t=pe.toArrayBuffer(e[0]):t=fe.serialize(new rn({extnID:e[0],critical:e[1],extnValue:new ze(pe.toArrayBuffer(e[2]))})),super(t,rn)}onInit(e){this.type=e.extnID,this.critical=e.critical,this.value=e.extnValue.buffer}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.value,e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty(this.critical?"critical":void 0);return e[Qe.NAME]===sn.NAME&&(e[Qe.NAME]=Xi.toString(this.type)),e}}var qb;class Di{static isCryptoKeyPair(e){return e&&e.privateKey&&e.publicKey}static isCryptoKey(e){return e&&e.usages&&e.type&&e.algorithm&&e.extractable!==void 0}constructor(){this.items=new Map,this[qb]="CryptoProvider",typeof self<"u"&&typeof crypto<"u"?this.set(Di.DEFAULT,crypto):typeof global<"u"&&global.crypto&&global.crypto.subtle&&this.set(Di.DEFAULT,global.crypto)}clear(){this.items.clear()}delete(e){return this.items.delete(e)}forEach(e,t){return this.items.forEach(e,t)}has(e){return this.items.has(e)}get size(){return this.items.size}entries(){return this.items.entries()}keys(){return this.items.keys()}values(){return this.items.values()}[Symbol.iterator](){return this.items[Symbol.iterator]()}get(e=Di.DEFAULT){const t=this.items.get(e.toLowerCase());if(!t)throw new Error(`Cannot get Crypto by name '${e}'`);return t}set(e,t){if(typeof e=="string"){if(!t)throw new TypeError("Argument 'value' is required");this.items.set(e.toLowerCase(),t)}else this.items.set(Di.DEFAULT,e);return this}}qb=Symbol.toStringTag;Di.DEFAULT="default";const Kt=new Di,aL=/^[0-2](?:\.[1-9][0-9]*)+$/;function cL(r){return new RegExp(aL).test(r)}class Kb{constructor(e={}){this.items={};for(const t in e)this.register(t,e[t])}get(e){return this.items[e]||null}findId(e){return cL(e)?e:this.get(e)}register(e,t){this.items[e]=t,this.items[t]=e}}const kr=new Kb;kr.register("CN","2.5.4.3");kr.register("L","2.5.4.7");kr.register("ST","2.5.4.8");kr.register("O","2.5.4.10");kr.register("OU","2.5.4.11");kr.register("C","2.5.4.6");kr.register("DC","0.9.2342.19200300.100.1.25");kr.register("E","1.2.840.113549.1.9.1");kr.register("G","2.5.4.42");kr.register("I","2.5.4.43");kr.register("SN","2.5.4.4");kr.register("T","2.5.4.12");function lL(r,e){return`\\${Ee.ToHex(Ee.FromUtf8String(e)).toUpperCase()}`}function uL(r){return r.replace(/([,+"\\<>;])/g,"\\$1").replace(/^([ #])/,"\\$1").replace(/([ ]$)/,"\\$1").replace(/([\r\n\t])/,lL)}class Gr{static isASCII(e){for(let t=0;t<e.length;t++)if(e.charCodeAt(t)>255)return!1;return!0}static isPrintableString(e){return/^[A-Za-z0-9 '()+,-./:=?]*$/g.test(e)}constructor(e,t={}){this.extraNames=new Kb,this.asn=new Bt;for(const n in t)if(Object.prototype.hasOwnProperty.call(t,n)){const i=t[n];this.extraNames.register(n,i)}typeof e=="string"?this.asn=this.fromString(e):e instanceof Bt?this.asn=e:pe.isBufferSource(e)?this.asn=fe.parse(e,Bt):this.asn=this.fromJSON(e)}getField(e){const t=this.extraNames.findId(e)||kr.findId(e),n=[];for(const i of this.asn)for(const s of i)s.type===t&&n.push(s.value.toString());return n}getName(e){return this.extraNames.get(e)||kr.get(e)}toString(){return this.asn.map(e=>e.map(t=>{const n=this.getName(t.type)||t.type,i=t.value.anyValue?`#${Ee.ToHex(t.value.anyValue)}`:uL(t.value.toString());return`${n}=${i}`}).join("+")).join(", ")}toJSON(){var e;const t=[];for(const n of this.asn){const i={};for(const s of n){const o=this.getName(s.type)||s.type;(e=i[o])!==null&&e!==void 0||(i[o]=[]),i[o].push(s.value.anyValue?`#${Ee.ToHex(s.value.anyValue)}`:s.value.toString())}t.push(i)}return t}fromString(e){const t=new Bt,n=/(\d\.[\d.]*\d|[A-Za-z]+)=((?:"")|(?:".*?[^\\]")|(?:[^,+"\\](?=[,+]|$))|(?:[^,+].*?(?:[^\\][,+]))|(?:))([,+])?/g;let i=null,s=",";for(;i=n.exec(`${e},`);){let[,o,a]=i;const c=a[a.length-1];(c===","||c==="+")&&(a=a.slice(0,a.length-1),i[3]=c);const l=i[3];o=this.getTypeOid(o);const u=this.createAttribute(o,a);s==="+"?t[t.length-1].push(u):t.push(new Qo([u])),s=l}return t}fromJSON(e){const t=new Bt;for(const n of e){const i=new Qo;for(const s in n){const o=this.getTypeOid(s),a=n[s];for(const c of a){const l=this.createAttribute(o,c);i.push(l)}}t.push(i)}return t}getTypeOid(e){if(/[\d.]+/.test(e)||(e=this.getName(e)||""),!e)throw new Error(`Cannot get OID for name type '${e}'`);return e}createAttribute(e,t){const n=new tf({type:e});if(typeof t=="object")for(const i in t)switch(i){case"ia5String":n.value.ia5String=t[i];break;case"utf8String":n.value.utf8String=t[i];break;case"universalString":n.value.universalString=t[i];break;case"bmpString":n.value.bmpString=t[i];break;case"printableString":n.value.printableString=t[i];break}else if(t[0]==="#")n.value.anyValue=Ee.FromHex(t.slice(1));else{const i=this.processStringValue(t);e===this.getName("E")||e===this.getName("DC")?n.value.ia5String=i:Gr.isPrintableString(i)?n.value.printableString=i:n.value.utf8String=i}return n}processStringValue(e){const t=/"(.*?[^\\])?"/.exec(e);return t&&(e=t[1]),e.replace(/\\0a/ig,`
`).replace(/\\0d/ig,"\r").replace(/\\0g/ig,"	").replace(/\\(.)/g,"$1")}toArrayBuffer(){return fe.serialize(this.asn)}async getThumbprint(...e){var t;let n,i="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(i=e[0]||i,n=e[1]||Kt.get()):n=e[0]||Kt.get(),await n.subtle.digest(i,this.toArrayBuffer())}}const Hb="Cannot initialize GeneralName from ASN.1 data.",F8=`${Hb} Unsupported string format in use.`,hL=`${Hb} Value doesn't match to GUID regular expression.`,$8=/^([0-9a-f]{8})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{4})-?([0-9a-f]{12})$/i,V8="1.3.6.1.4.1.311.25.1",q8="1.3.6.1.4.1.311.20.2.3",md="dns",yd="dn",wd="email",bd="ip",vd="url",Sd="guid",Ed="upn",Jl="id";class Li extends Ji{constructor(...e){let t;if(e.length===2)switch(e[0]){case yd:{const n=new Gr(e[1]).toArrayBuffer(),i=fe.parse(n,Bt);t=new Re({directoryName:i});break}case md:t=new Re({dNSName:e[1]});break;case wd:t=new Re({rfc822Name:e[1]});break;case Sd:{const n=new RegExp($8,"i").exec(e[1]);if(!n)throw new Error("Cannot parse GUID value. Value doesn't match to regular expression");const i=n.slice(1).map((s,o)=>o<3?Ee.ToHex(new Uint8Array(Ee.FromHex(s)).reverse()):s).join("");t=new Re({otherName:new Oc({typeId:V8,value:fe.serialize(new ze(Ee.FromHex(i)))})});break}case bd:t=new Re({iPAddress:e[1]});break;case Jl:t=new Re({registeredID:e[1]});break;case Ed:{t=new Re({otherName:new Oc({typeId:q8,value:fe.serialize(ab.toASN(e[1]))})});break}case vd:t=new Re({uniformResourceIdentifier:e[1]});break;default:throw new Error("Cannot create GeneralName. Unsupported type of the name")}else pe.isBufferSource(e[0])?t=fe.parse(e[0],Re):t=e[0];super(t)}onInit(e){if(e.dNSName!=null)this.type=md,this.value=e.dNSName;else if(e.rfc822Name!=null)this.type=wd,this.value=e.rfc822Name;else if(e.iPAddress!=null)this.type=bd,this.value=e.iPAddress;else if(e.uniformResourceIdentifier!=null)this.type=vd,this.value=e.uniformResourceIdentifier;else if(e.registeredID!=null)this.type=Jl,this.value=e.registeredID;else if(e.directoryName!=null)this.type=yd,this.value=new Gr(e.directoryName).toString();else if(e.otherName!=null)if(e.otherName.typeId===V8){this.type=Sd;const t=fe.parse(e.otherName.value,ze),n=new RegExp($8,"i").exec(Ee.ToHex(t));if(!n)throw new Error(hL);this.value=n.slice(1).map((i,s)=>s<3?Ee.ToHex(new Uint8Array(Ee.FromHex(i)).reverse()):i).join("-")}else if(e.otherName.typeId===q8)this.type=Ed,this.value=fe.parse(e.otherName.value,Gt).toString();else throw new Error(F8);else throw new Error(F8)}toJSON(){return{type:this.type,value:this.value}}toTextObject(){let e;switch(this.type){case yd:case md:case Sd:case bd:case Jl:case Ed:case vd:e=this.type.toUpperCase();break;case wd:e="Email";break;default:throw new Error("Unsupported GeneralName type")}let t=this.value;return this.type===Jl&&(t=Xi.toString(t)),new Qe(e,void 0,t)}}class Vc extends Ji{constructor(e){let t;if(e instanceof pr)t=e;else if(Array.isArray(e)){const n=[];for(const i of e)if(i instanceof Re)n.push(i);else{const s=fe.parse(new Li(i.type,i.value).rawData,Re);n.push(s)}t=new pr(n)}else if(pe.isBufferSource(e))t=fe.parse(e,pr);else throw new Error("Cannot initialize GeneralNames. Incorrect incoming arguments");super(t)}onInit(e){const t=[];for(const n of e){let i=null;try{i=new Li(n)}catch{continue}t.push(i)}this.items=t}toJSON(){return this.items.map(e=>e.toJSON())}toTextObject(){const e=super.toTextObjectEmpty();for(const t of this.items){const n=t.toTextObject();let i=e[n[Qe.NAME]];Array.isArray(i)||(i=[],e[n[Qe.NAME]]=i),i.push(n)}return e}}Vc.NAME="GeneralNames";const uc="-{5}",qc="\\n",fL=`[^${qc}]+`,dL=`${uc}BEGIN (${fL}(?=${uc}))${uc}`,pL=`${uc}END \\1${uc}`,na="\\n",gL=`[^:${qc}]+`,mL=`(?:[^${qc}]+${na}(?: +[^${qc}]+${na})*)`,yL="[a-zA-Z0-9=+/]+",wL=`(?:${yL}${na})+`,K8=`${dL}${na}(?:((?:${gL}: ${mL})+))?${na}?(${wL})${pL}`;class Dr{static isPem(e){return typeof e=="string"&&new RegExp(K8,"g").test(e.replace(/\r/g,""))}static decodeWithHeaders(e){e=e.replace(/\r/g,"");const t=new RegExp(K8,"g"),n=[];let i=null;for(;i=t.exec(e);){const s=i[3].replace(new RegExp(`[${qc}]+`,"g"),""),o={type:i[1],headers:[],rawData:Ee.FromBase64(s)},a=i[2];if(a){const c=a.split(new RegExp(na,"g"));let l=null;for(const u of c){const[f,g]=u.split(/:(.*)/);if(g===void 0){if(!l)throw new Error("Cannot parse PEM string. Incorrect header value");l.value+=f.trim()}else l&&o.headers.push(l),l={key:f,value:g.trim()}}l&&o.headers.push(l)}n.push(o)}return n}static decode(e){return this.decodeWithHeaders(e).map(n=>n.rawData)}static decodeFirst(e){const t=this.decode(e);if(!t.length)throw new RangeError("PEM string doesn't contain any objects");return t[0]}static encode(e,t){if(Array.isArray(e)){const n=new Array;return t?e.forEach(i=>{if(!pe.isBufferSource(i))throw new TypeError("Cannot encode array of BufferSource in PEM format. Not all items of the array are BufferSource");n.push(this.encodeStruct({type:t,rawData:pe.toArrayBuffer(i)}))}):e.forEach(i=>{if(!("type"in i))throw new TypeError("Cannot encode array of PemStruct in PEM format. Not all items of the array are PemStrut");n.push(this.encodeStruct(i))}),n.join(`
`)}else{if(!t)throw new Error("Required argument 'tag' is missed");return this.encodeStruct({type:t,rawData:pe.toArrayBuffer(e)})}}static encodeStruct(e){var t;const n=e.type.toLocaleUpperCase(),i=[];if(i.push(`-----BEGIN ${n}-----`),!((t=e.headers)===null||t===void 0)&&t.length){for(const l of e.headers)i.push(`${l.key}: ${l.value}`);i.push("")}const s=Ee.ToBase64(e.rawData);let o,a=0;const c=Array();for(;a<s.length&&(s.length-a<64?o=s.substring(a):(o=s.substring(a,a+64),a+=64),o.length!==0);)if(c.push(o),o.length<64)break;return i.push(...c),i.push(`-----END ${n}-----`),i.join(`
`)}}Dr.CertificateTag="CERTIFICATE";Dr.CrlTag="CRL";Dr.CertificateRequestTag="CERTIFICATE REQUEST";Dr.PublicKeyTag="PUBLIC KEY";Dr.PrivateKeyTag="PRIVATE KEY";class gi extends Ji{static isAsnEncoded(e){return pe.isBufferSource(e)||typeof e=="string"}static toArrayBuffer(e){if(typeof e=="string"){if(Dr.isPem(e))return Dr.decode(e)[0];if(Ee.isHex(e))return Ee.FromHex(e);if(Ee.isBase64(e))return Ee.FromBase64(e);if(Ee.isBase64Url(e))return Ee.FromBase64Url(e);throw new TypeError("Unsupported format of 'raw' argument. Must be one of DER, PEM, HEX, Base64, or Base4Url")}else{const t=Ee.ToBinary(e);return Dr.isPem(t)?Dr.decode(t)[0]:Ee.isHex(t)?Ee.FromHex(t):Ee.isBase64(t)?Ee.FromBase64(t):Ee.isBase64Url(t)?Ee.FromBase64Url(t):pe.toArrayBuffer(e)}}constructor(...e){gi.isAsnEncoded(e[0])?super(gi.toArrayBuffer(e[0]),e[1]):super(e[0])}toString(e="pem"){switch(e){case"pem":return Dr.encode(this.rawData,this.tag);default:return super.toString(e)}}}class yn extends gi{static async create(e,t=Kt.get()){if(e instanceof yn)return e;if(Di.isCryptoKey(e)){if(e.type!=="public")throw new TypeError("Public key is required");const n=await t.subtle.exportKey("spki",e);return new yn(n)}else{if(e.publicKey)return e.publicKey;if(pe.isBufferSource(e))return new yn(e);throw new TypeError("Unsupported PublicKeyType")}}constructor(e){gi.isAsnEncoded(e)?super(e,pn):super(e),this.tag=Dr.PublicKeyTag}async export(...e){let t,n=["verify"],i={hash:"SHA-256",...this.algorithm};e.length>1?(i=e[0]||i,n=e[1]||n,t=e[2]||Kt.get()):t=e[0]||Kt.get();let s=this.rawData;const o=fe.parse(this.rawData,pn);return o.algorithm.algorithm===lc&&(s=bL(o,s)),t.subtle.importKey("spki",s,i,!0,n)}onInit(e){const t=Qt.resolve(Vs),n=this.algorithm=t.toWebAlgorithm(e.algorithm);switch(e.algorithm.algorithm){case Us:{const i=fe.parse(e.subjectPublicKey,gp),s=pe.toUint8Array(i.modulus);n.publicExponent=pe.toUint8Array(i.publicExponent),n.modulusLength=(s[0]?s:s.slice(1)).byteLength<<3;break}}}async getThumbprint(...e){var t;let n,i="SHA-1";return e.length>=1&&!(!((t=e[0])===null||t===void 0)&&t.subtle)?(i=e[0]||i,n=e[1]||Kt.get()):n=e[0]||Kt.get(),await n.subtle.digest(i,this.rawData)}async getKeyIdentifier(...e){let t,n="SHA-1";e.length===1?typeof e[0]=="string"?(n=e[0],t=Kt.get()):t=e[0]:e.length===2?(n=e[0],t=e[1]):t=Kt.get();const i=fe.parse(this.rawData,pn);return await t.subtle.digest(n,i.subjectPublicKey)}toTextObject(){const e=this.toTextObjectEmpty(),t=fe.parse(this.rawData,pn);switch(e.Algorithm=qs.serializeAlgorithm(t.algorithm),t.algorithm.algorithm){case Mc:e["EC Point"]=t.subjectPublicKey;break;case Us:default:e["Raw Data"]=t.subjectPublicKey}return e}}function bL(r,e){return r.algorithm=new ye({algorithm:Us,parameters:null}),e=fe.serialize(r),e}class Kc extends sn{static async create(e,t=!1,n=Kt.get()){if("name"in e&&"serialNumber"in e)return new Kc(e,t);const s=await(await yn.create(e,n)).getKeyIdentifier(n);return new Kc(Ee.ToHex(s),t)}constructor(...e){if(pe.isBufferSource(e[0]))super(e[0]);else if(typeof e[0]=="string"){const t=new fs({keyIdentifier:new Y4(Ee.FromHex(e[0]))});super(e2,e[1],fe.serialize(t))}else{const t=e[0],n=t.name instanceof Vc?fe.parse(t.name.rawData,pr):t.name,i=new fs({authorityCertIssuer:n,authorityCertSerialNumber:Ee.FromHex(t.serialNumber)});super(e2,e[1],fe.serialize(i))}}onInit(e){super.onInit(e);const t=fe.parse(e.extnValue,fs);t.keyIdentifier&&(this.keyId=Ee.ToHex(t.keyIdentifier)),(t.authorityCertIssuer||t.authorityCertSerialNumber)&&(this.certId={name:t.authorityCertIssuer||[],serialNumber:t.authorityCertSerialNumber?Ee.ToHex(t.authorityCertSerialNumber):""})}toTextObject(){const e=this.toTextObjectWithoutValue(),t=fe.parse(this.value,fs);return t.authorityCertIssuer&&(e["Authority Issuer"]=new Vc(t.authorityCertIssuer).toTextObject()),t.authorityCertSerialNumber&&(e["Authority Serial Number"]=t.authorityCertSerialNumber),t.keyIdentifier&&(e[""]=t.keyIdentifier),e}}Kc.NAME="Authority Key Identifier";class bp extends sn{constructor(...e){if(pe.isBufferSource(e[0])){super(e[0]);const t=fe.parse(this.value,A1);this.ca=t.cA,this.pathLength=t.pathLenConstraint}else{const t=new A1({cA:e[0],pathLenConstraint:e[1]});super(lb,e[2],fe.serialize(t)),this.ca=e[0],this.pathLength=e[1]}}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ca&&(e.CA=this.ca),this.pathLength!==void 0&&(e["Path Length"]=this.pathLength),e}}bp.NAME="Basic Constraints";var H8;(function(r){r.serverAuth="1.3.6.1.5.5.7.3.1",r.clientAuth="1.3.6.1.5.5.7.3.2",r.codeSigning="1.3.6.1.5.5.7.3.3",r.emailProtection="1.3.6.1.5.5.7.3.4",r.timeStamping="1.3.6.1.5.5.7.3.8",r.ocspSigning="1.3.6.1.5.5.7.3.9"})(H8||(H8={}));class jb extends sn{constructor(...e){if(pe.isBufferSource(e[0])){super(e[0]);const t=fe.parse(this.value,k1);this.usages=t.map(n=>n)}else{const t=new k1(e[0]);super(fb,e[1],fe.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[""]=this.usages.map(t=>Xi.toString(t)).join(", "),e}}jb.NAME="Extended Key Usages";var j8;(function(r){r[r.digitalSignature=1]="digitalSignature",r[r.nonRepudiation=2]="nonRepudiation",r[r.keyEncipherment=4]="keyEncipherment",r[r.dataEncipherment=8]="dataEncipherment",r[r.keyAgreement=16]="keyAgreement",r[r.keyCertSign=32]="keyCertSign",r[r.cRLSign=64]="cRLSign",r[r.encipherOnly=128]="encipherOnly",r[r.decipherOnly=256]="decipherOnly"})(j8||(j8={}));class zb extends sn{constructor(...e){if(pe.isBufferSource(e[0])){super(e[0]);const t=fe.parse(this.value,gd);this.usages=t.toNumber()}else{const t=new gd(e[0]);super(db,e[1],fe.serialize(t)),this.usages=e[0]}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=fe.parse(this.value,gd);return e[""]=t.toJSON().join(", "),e}}zb.NAME="Key Usages";class Cf extends sn{static async create(e,t=!1,n=Kt.get()){const s=await(await yn.create(e,n)).getKeyIdentifier(n);return new Cf(Ee.ToHex(s),t)}constructor(...e){if(pe.isBufferSource(e[0])){super(e[0]);const t=fe.parse(this.value,qi);this.keyId=Ee.ToHex(t)}else{const t=typeof e[0]=="string"?Ee.FromHex(e[0]):e[0],n=new qi(t);super(yb,e[1],fe.serialize(n)),this.keyId=Ee.ToHex(t)}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=fe.parse(this.value,qi);return e[""]=t,e}}Cf.NAME="Subject Key Identifier";class Wb extends sn{constructor(...e){pe.isBufferSource(e[0])?super(e[0]):super(mb,e[1],new Vc(e[0]||[]).rawData)}onInit(e){super.onInit(e);const t=fe.parse(e.extnValue,g2);this.names=new Vc(t)}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.names.toTextObject();for(const n in t)e[n]=t[n];return e}}Wb.NAME="Subject Alternative Name";class on{static register(e,t){this.items.set(e,t)}static create(e){const t=new sn(e),n=this.items.get(t.type);return n?new n(e):t}}on.items=new Map;class Gb extends sn{constructor(...e){var t;if(pe.isBufferSource(e[0])){super(e[0]);const n=fe.parse(this.value,I1);this.policies=n.map(i=>i.policyIdentifier)}else{const n=e[0],i=(t=e[1])!==null&&t!==void 0?t:!1,s=new I1(n.map(o=>new nf({policyIdentifier:o})));super(ub,i,fe.serialize(s)),this.policies=n}}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Policy=this.policies.map(t=>new Qe("",{},Xi.toString(t))),e}}Gb.NAME="Certificate Policies";on.register(ub,Gb);class Qb extends sn{constructor(...e){var t;if(pe.isBufferSource(e[0]))super(e[0]);else if(Array.isArray(e[0])&&typeof e[0][0]=="string"){const i=e[0].map(o=>new ya({distributionPoint:new Rs({fullName:[new Re({uniformResourceIdentifier:o})]})})),s=new Eo(i);super(s2,e[1],fe.serialize(s))}else{const n=new Eo(e[0]);super(s2,e[1],fe.serialize(n))}(t=this.distributionPoints)!==null&&t!==void 0||(this.distributionPoints=[])}onInit(e){super.onInit(e);const t=fe.parse(e.extnValue,Eo);this.distributionPoints=t}toTextObject(){const e=this.toTextObjectWithoutValue();return e["Distribution Point"]=this.distributionPoints.map(t=>{var n;const i={};return t.distributionPoint&&(i[""]=(n=t.distributionPoint.fullName)===null||n===void 0?void 0:n.map(s=>new Li(s).toString()).join(", ")),t.reasons&&(i.Reasons=t.reasons.toString()),t.cRLIssuer&&(i["CRL Issuer"]=t.cRLIssuer.map(s=>s.toString()).join(", ")),i}),e}}Qb.NAME="CRL Distribution Points";class Yb extends sn{constructor(...e){var t,n,i,s;if(pe.isBufferSource(e[0]))super(e[0]);else if(e[0]instanceof uo){const o=new uo(e[0]);super(J0,e[1],fe.serialize(o))}else{const o=e[0],a=new uo;tu(a,o,k5,"ocsp"),tu(a,o,T5,"caIssuers"),tu(a,o,P5,"timeStamping"),tu(a,o,B5,"caRepository"),super(J0,e[1],fe.serialize(a))}(t=this.ocsp)!==null&&t!==void 0||(this.ocsp=[]),(n=this.caIssuers)!==null&&n!==void 0||(this.caIssuers=[]),(i=this.timeStamping)!==null&&i!==void 0||(this.timeStamping=[]),(s=this.caRepository)!==null&&s!==void 0||(this.caRepository=[])}onInit(e){super.onInit(e),this.ocsp=[],this.caIssuers=[],this.timeStamping=[],this.caRepository=[],fe.parse(e.extnValue,uo).forEach(n=>{switch(n.accessMethod){case k5:this.ocsp.push(new Li(n.accessLocation));break;case T5:this.caIssuers.push(new Li(n.accessLocation));break;case P5:this.timeStamping.push(new Li(n.accessLocation));break;case B5:this.caRepository.push(new Li(n.accessLocation));break}})}toTextObject(){const e=this.toTextObjectWithoutValue();return this.ocsp.length&&eu(e,"OCSP",this.ocsp),this.caIssuers.length&&eu(e,"CA Issuers",this.caIssuers),this.timeStamping.length&&eu(e,"Time Stamping",this.timeStamping),this.caRepository.length&&eu(e,"CA Repository",this.caRepository),e}}Yb.NAME="Authority Info Access";function eu(r,e,t){if(t.length===1)r[e]=t[0].toTextObject();else{const n=new Qe("");t.forEach((i,s)=>{const o=i.toTextObject(),a=`${o[Qe.NAME]} ${s+1}`;let c=n[a];Array.isArray(c)||(c=[],n[a]=c),c.push(o)}),r[e]=n}}function tu(r,e,t,n){const i=e[n];i&&(Array.isArray(i)?i:[i]).forEach(o=>{typeof o=="string"&&(o=new Li("url",o)),r.push(new ml({accessMethod:t,accessLocation:fe.parse(o.rawData,Re)}))})}class Aa extends Ji{constructor(...e){let t;if(pe.isBufferSource(e[0]))t=pe.toArrayBuffer(e[0]);else{const n=e[0],i=Array.isArray(e[1])?e[1].map(s=>pe.toArrayBuffer(s)):[];t=fe.serialize(new fi({type:n,values:i}))}super(t,fi)}onInit(e){this.type=e.type,this.values=e.values}toTextObject(){const e=this.toTextObjectWithoutValue();return e.Value=this.values.map(t=>new Qe("",{"":t})),e}toTextObjectWithoutValue(){const e=this.toTextObjectEmpty();return e[Qe.NAME]===Aa.NAME&&(e[Qe.NAME]=Xi.toString(this.type)),e}}Aa.NAME="Attribute";class Zb extends Aa{constructor(...e){var t;if(pe.isBufferSource(e[0]))super(e[0]);else{const n=new X1({printableString:e[0]});super(Fb,[fe.serialize(n)])}(t=this.password)!==null&&t!==void 0||(this.password="")}onInit(e){if(super.onInit(e),this.values[0]){const t=fe.parse(this.values[0],X1);this.password=t.toString()}}toTextObject(){const e=this.toTextObjectWithoutValue();return e[Qe.VALUE]=this.password,e}}Zb.NAME="Challenge Password";class vp extends Aa{constructor(...e){var t;if(pe.isBufferSource(e[0]))super(e[0]);else{const n=e[0],i=new zi;for(const s of n)i.push(fe.parse(s.rawData,rn));super(wp,[fe.serialize(i)])}(t=this.items)!==null&&t!==void 0||(this.items=[])}onInit(e){if(super.onInit(e),this.values[0]){const t=fe.parse(this.values[0],zi);this.items=t.map(n=>on.create(fe.serialize(n)))}}toTextObject(){const e=this.toTextObjectWithoutValue(),t=this.items.map(n=>n.toTextObject());for(const n of t)e[n[Qe.NAME]]=n;return e}}vp.NAME="Extensions";class kf{static register(e,t){this.items.set(e,t)}static create(e){const t=new Aa(e),n=this.items.get(t.type);return n?new n(e):t}}kf.items=new Map;const Tl="crypto.signatureFormatter";class vL{toAsnSignature(e,t){return pe.toArrayBuffer(t)}toWebSignature(e,t){return pe.toArrayBuffer(t)}}var Au;let s3=Au=class{static createPssParams(e,t){const n=Au.getHashAlgorithm(e);return n?new $s({hashAlgorithm:n,maskGenAlgorithm:new ye({algorithm:wf,parameters:fe.serialize(n)}),saltLength:t}):null}static getHashAlgorithm(e){const t=Qt.resolve(Vs);return typeof e=="string"?t.toAsnAlgorithm({name:e}):typeof e=="object"&&e&&"name"in e?t.toAsnAlgorithm(e):null}toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"rsassa-pkcs1-v1_5":if("hash"in e){let t;if(typeof e.hash=="string")t=e.hash;else if(e.hash&&typeof e.hash=="object"&&"name"in e.hash&&typeof e.hash.name=="string")t=e.hash.name.toUpperCase();else throw new Error("Cannot get hash algorithm name");switch(t.toLowerCase()){case"sha-1":return new ye({algorithm:q1,parameters:null});case"sha-256":return new ye({algorithm:L2,parameters:null});case"sha-384":return new ye({algorithm:K1,parameters:null});case"sha-512":return new ye({algorithm:H1,parameters:null})}}else return new ye({algorithm:Us,parameters:null});break;case"rsa-pss":if("hash"in e){if(!("saltLength"in e&&typeof e.saltLength=="number"))throw new Error("Cannot get 'saltLength' from 'alg' argument");const t=Au.createPssParams(e.hash,e.saltLength);if(!t)throw new Error("Cannot create PSS parameters");return new ye({algorithm:lc,parameters:fe.serialize(t)})}else return new ye({algorithm:lc,parameters:null})}return null}toWebAlgorithm(e){switch(e.algorithm){case Us:return{name:"RSASSA-PKCS1-v1_5"};case q1:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-1"}};case L2:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case K1:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-384"}};case H1:return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-512"}};case lc:if(e.parameters){const t=fe.parse(e.parameters,$s);return{name:"RSA-PSS",hash:Qt.resolve(Vs).toWebAlgorithm(t.hashAlgorithm),saltLength:t.saltLength}}else return{name:"RSA-PSS"}}return null}};s3=Au=y([Ef()],s3);Qt.registerSingleton(kl,s3);let o3=class{toAsnAlgorithm(e){switch(e.name.toLowerCase()){case"sha-1":return new ye({algorithm:j1});case"sha-256":return new ye({algorithm:z1});case"sha-384":return new ye({algorithm:W1});case"sha-512":return new ye({algorithm:G1})}return null}toWebAlgorithm(e){switch(e.algorithm){case j1:return{name:"SHA-1"};case z1:return{name:"SHA-256"};case W1:return{name:"SHA-384"};case G1:return{name:"SHA-512"}}return null}};o3=y([Ef()],o3);Qt.registerSingleton(kl,o3);class Qr{addPadding(e,t){const n=pe.toUint8Array(t),i=new Uint8Array(e);return i.set(n,e-n.length),i}removePadding(e,t=!1){let n=pe.toUint8Array(e);for(let i=0;i<n.length;i++)if(n[i]){n=n.slice(i);break}if(t&&n[0]>127){const i=new Uint8Array(n.length+1);return i.set(n,1),i.buffer}return n.buffer}toAsnSignature(e,t){if(e.name==="ECDSA"){const n=e.namedCurve,i=Qr.namedCurveSize.get(n)||Qr.defaultNamedCurveSize,s=new V1,o=pe.toUint8Array(t);return s.r=this.removePadding(o.slice(0,i),!0),s.s=this.removePadding(o.slice(i,i+i),!0),fe.serialize(s)}return null}toWebSignature(e,t){if(e.name==="ECDSA"){const n=fe.parse(t,V1),i=e.namedCurve,s=Qr.namedCurveSize.get(i)||Qr.defaultNamedCurveSize,o=this.addPadding(s,this.removePadding(n.r)),a=this.addPadding(s,this.removePadding(n.s));return OR(o,a)}return null}}Qr.namedCurveSize=new Map;Qr.defaultNamedCurveSize=32;const xd="1.3.101.110",z8="1.3.101.111",Ad="1.3.101.112",W8="1.3.101.113";let a3=class{toAsnAlgorithm(e){let t=null;switch(e.name.toLowerCase()){case"ed25519":t=Ad;break;case"x25519":t=xd;break;case"eddsa":switch(e.namedCurve.toLowerCase()){case"ed25519":t=Ad;break;case"ed448":t=W8;break}break;case"ecdh-es":switch(e.namedCurve.toLowerCase()){case"x25519":t=xd;break;case"x448":t=z8;break}}return t?new ye({algorithm:t}):null}toWebAlgorithm(e){switch(e.algorithm){case Ad:return{name:"Ed25519"};case W8:return{name:"EdDSA",namedCurve:"Ed448"};case xd:return{name:"X25519"};case z8:return{name:"ECDH-ES",namedCurve:"X448"}}return null}};a3=y([Ef()],a3);Qt.registerSingleton(kl,a3);class SL extends gi{constructor(e){gi.isAsnEncoded(e)?super(e,Fc):super(e),this.tag=Dr.CertificateRequestTag}onInit(e){this.tbs=fe.serialize(e.certificationRequestInfo),this.publicKey=new yn(e.certificationRequestInfo.subjectPKInfo);const t=Qt.resolve(Vs);this.signatureAlgorithm=t.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signature,this.attributes=e.certificationRequestInfo.attributes.map(i=>kf.create(fe.serialize(i)));const n=this.getAttribute(wp);this.extensions=[],n instanceof vp&&(this.extensions=n.items),this.subjectName=new Gr(e.certificationRequestInfo.subject),this.subject=this.subjectName.toString()}getAttribute(e){for(const t of this.attributes)if(t.type===e)return t;return null}getAttributes(e){return this.attributes.filter(t=>t.type===e)}getExtension(e){for(const t of this.extensions)if(t.type===e)return t;return null}getExtensions(e){return this.extensions.filter(t=>t.type===e)}async verify(e=Kt.get()){const t={...this.publicKey.algorithm,...this.signatureAlgorithm},n=await this.publicKey.export(t,["verify"],e),i=Qt.resolveAll(Tl).reverse();let s=null;for(const a of i)if(s=a.toWebSignature(t,this.signature),s)break;if(!s)throw Error("Cannot convert WebCrypto signature value to ASN.1 format");return await e.subtle.verify(this.signatureAlgorithm,n,s,this.tbs)}toTextObject(){const e=this.toTextObjectEmpty(),t=fe.parse(this.rawData,Fc),n=t.certificationRequestInfo,i=new Qe("",{Version:`${Ds[n.version]} (${n.version})`,Subject:this.subject,"Subject Public Key Info":this.publicKey});if(this.attributes.length){const s=new Qe("");for(const o of this.attributes){const a=o.toTextObject();s[a[Qe.NAME]]=a}i.Attributes=s}return e.Data=i,e.Signature=new Qe("",{Algorithm:qs.serializeAlgorithm(t.signatureAlgorithm),"":t.signature}),e}}SL.NAME="PKCS#10 Certificate Request";class Sp extends gi{constructor(e){gi.isAsnEncoded(e)?super(e,Ls):super(e),this.tag=Dr.CertificateTag}onInit(e){const t=e.tbsCertificate;this.tbs=fe.serialize(t);let n=new Uint8Array(t.serialNumber);n.length>1&&n[0]===0&&n[1]>127&&(n=n.slice(1)),this.serialNumber=Ee.ToHex(n),this.subjectName=new Gr(t.subject),this.subject=new Gr(t.subject).toString(),this.issuerName=new Gr(t.issuer),this.issuer=this.issuerName.toString();const i=Qt.resolve(Vs);this.signatureAlgorithm=i.toWebAlgorithm(e.signatureAlgorithm),this.signature=e.signatureValue;const s=t.validity.notBefore.utcTime||t.validity.notBefore.generalTime;if(!s)throw new Error("Cannot get 'notBefore' value");this.notBefore=s;const o=t.validity.notAfter.utcTime||t.validity.notAfter.generalTime;if(!o)throw new Error("Cannot get 'notAfter' value");this.notAfter=o,this.extensions=[],t.extensions&&(this.extensions=t.extensions.map(a=>on.create(fe.serialize(a)))),this.publicKey=new yn(t.subjectPublicKeyInfo)}getExtension(e){for(const t of this.extensions)if(typeof e=="string"){if(t.type===e)return t}else if(t instanceof e)return t;return null}getExtensions(e){return this.extensions.filter(t=>typeof e=="string"?t.type===e:t instanceof e)}async verify(e={},t=Kt.get()){let n,i;const s=e.publicKey;try{if(!s)n={...this.publicKey.algorithm,...this.signatureAlgorithm},i=await this.publicKey.export(n,["verify"],t);else if("publicKey"in s)n={...s.publicKey.algorithm,...this.signatureAlgorithm},i=await s.publicKey.export(n,["verify"],t);else if(s instanceof yn)n={...s.algorithm,...this.signatureAlgorithm},i=await s.export(n,["verify"],t);else if(pe.isBufferSource(s)){const l=new yn(s);n={...l.algorithm,...this.signatureAlgorithm},i=await l.export(n,["verify"],t)}else n={...s.algorithm,...this.signatureAlgorithm},i=s}catch{return!1}const o=Qt.resolveAll(Tl).reverse();let a=null;for(const l of o)if(a=l.toWebSignature(n,this.signature),a)break;if(!a)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");const c=await t.subtle.verify(this.signatureAlgorithm,i,a,this.tbs);if(e.signatureOnly)return c;{const u=(e.date||new Date).getTime();return c&&this.notBefore.getTime()<u&&u<this.notAfter.getTime()}}async getThumbprint(...e){let t,n="SHA-1";return e[0]&&(e[0].subtle?t=e[0]:(n=e[0]||n,t=e[1])),t??(t=Kt.get()),await t.subtle.digest(n,this.rawData)}async isSelfSigned(e=Kt.get()){return this.subject===this.issuer&&await this.verify({signatureOnly:!0},e)}toTextObject(){const e=this.toTextObjectEmpty(),t=fe.parse(this.rawData,Ls),n=t.tbsCertificate,i=new Qe("",{Version:`${Ds[n.version]} (${n.version})`,"Serial Number":n.serialNumber,"Signature Algorithm":qs.serializeAlgorithm(n.signature),Issuer:this.issuer,Validity:new Qe("",{"Not Before":n.validity.notBefore.getTime(),"Not After":n.validity.notAfter.getTime()}),Subject:this.subject,"Subject Public Key Info":this.publicKey});if(n.issuerUniqueID&&(i["Issuer Unique ID"]=n.issuerUniqueID),n.subjectUniqueID&&(i["Subject Unique ID"]=n.subjectUniqueID),this.extensions.length){const s=new Qe("");for(const o of this.extensions){const a=o.toTextObject();s[a[Qe.NAME]]=a}i.Extensions=s}return e.Data=i,e.Signature=new Qe("",{Algorithm:qs.serializeAlgorithm(t.signatureAlgorithm),"":t.signatureValue}),e}}Sp.NAME="Certificate";class EL{static async createSelfSigned(e,t=Kt.get()){if(!e.keys.privateKey)throw new Error("Bad field 'keys' in 'params' argument. 'privateKey' is empty");if(!e.keys.publicKey)throw new Error("Bad field 'keys' in 'params' argument. 'publicKey' is empty");return this.create({serialNumber:e.serialNumber,subject:e.name,issuer:e.name,notBefore:e.notBefore,notAfter:e.notAfter,publicKey:e.keys.publicKey,signingKey:e.keys.privateKey,signingAlgorithm:e.signingAlgorithm,extensions:e.extensions},t)}static async create(e,t=Kt.get()){var n;let i;e.publicKey instanceof yn?i=e.publicKey.rawData:"publicKey"in e.publicKey?i=e.publicKey.publicKey.rawData:pe.isBufferSource(e.publicKey)?i=e.publicKey:i=await t.subtle.exportKey("spki",e.publicKey);let s=e.serialNumber?pe.toUint8Array(Ee.FromHex(e.serialNumber)):t.getRandomValues(new Uint8Array(16));if(s[0]>127){const v=new Uint8Array(s.length+1);v[0]=0,v.set(s,1),s=v}const o=e.notBefore||new Date,a=e.notAfter||new Date(o.getTime()+31536e6),c=new Ls({tbsCertificate:new qr({version:Ds.v3,serialNumber:s,validity:new yl({notBefore:o,notAfter:a}),extensions:new zi(((n=e.extensions)===null||n===void 0?void 0:n.map(v=>fe.parse(v.rawData,rn)))||[]),subjectPublicKeyInfo:fe.parse(i,pn)})});if(e.subject){const v=e.subject instanceof Gr?e.subject:new Gr(e.subject);c.tbsCertificate.subject=fe.parse(v.toArrayBuffer(),Bt)}if(e.issuer){const v=e.issuer instanceof Gr?e.issuer:new Gr(e.issuer);c.tbsCertificate.issuer=fe.parse(v.toArrayBuffer(),Bt)}const l={hash:"SHA-256"},u="signingKey"in e?{...l,...e.signingAlgorithm,...e.signingKey.algorithm}:{...l,...e.signingAlgorithm},f=Qt.resolve(Vs);c.tbsCertificate.signature=c.signatureAlgorithm=f.toAsnAlgorithm(u);const g=fe.serialize(c.tbsCertificate),m="signingKey"in e?await t.subtle.sign(u,e.signingKey,g):e.signature,w=Qt.resolveAll(Tl).reverse();let x=null;for(const v of w)if(x=v.toAsnSignature(u,m),x)break;if(!x)throw Error("Cannot convert ASN.1 signature value to WebCrypto format");return c.signatureValue=x,new Sp(fe.serialize(c))}}var G8;(function(r){r[r.unspecified=0]="unspecified",r[r.keyCompromise=1]="keyCompromise",r[r.cACompromise=2]="cACompromise",r[r.affiliationChanged=3]="affiliationChanged",r[r.superseded=4]="superseded",r[r.cessationOfOperation=5]="cessationOfOperation",r[r.certificateHold=6]="certificateHold",r[r.removeFromCRL=8]="removeFromCRL",r[r.privilegeWithdrawn=9]="privilegeWithdrawn",r[r.aACompromise=10]="aACompromise"})(G8||(G8={}));on.register(lb,bp);on.register(fb,jb);on.register(db,zb);on.register(yb,Cf);on.register(e2,Kc);on.register(mb,Wb);on.register(s2,Qb);on.register(J0,Yb);kf.register(Fb,Zb);kf.register(wp,vp);Qt.registerSingleton(Tl,vL);Qt.registerSingleton(Tl,Qr);Qr.namedCurveSize.set("P-256",32);Qr.namedCurveSize.set("K-256",32);Qr.namedCurveSize.set("P-384",48);Qr.namedCurveSize.set("P-521",66);class xL extends or{async listen(){throw new IR("WebRTCTransport.createListener")}getAddrs(){return[]}updateAnnounceAddrs(){}async close(){}}const Xb=Object.values(qu).map(r=>r.decoder).reduce((r,e)=>r.or(e)),AL=/^a=fingerprint:(?:\w+-[0-9]+)\s(?<fingerprint>(:?[0-9a-fA-F]{2})+)$/m;function _L(r){var t;if(r==null)return;const e=r.match(AL);return(t=e==null?void 0:e.groups)==null?void 0:t.fingerprint}function Jb(r){const t=r.stringTuples().filter(n=>n[0]===WO).map(n=>n[1])[0];if(t===void 0||t==="")throw new ke(`Couldn't find a certhash component of multiaddr: ${r.toString()}`);return t}function IL(r){return $r(Xb.decode(r))}function CL(r){const e=IL(Jb(r)),t=TL(e.code),n=e.digest.reduce((s,o)=>s+o.toString(16).padStart(2,"0"),""),i=n.match(/.{1,2}/g);if(i==null)throw new _R(n,r.toString());return`${t} ${i.join(":").toUpperCase()}`}function kL(r){const e=r.split(":").map(i=>parseInt(i,16)),t=Uint8Array.from(e),n=ji(wi.code,t);return Ze(`/certhash/${tl.encode(n.bytes)}`)}function TL(r){switch(r){case 17:return"sha-1";case 18:return"sha-256";case 19:return"sha-512";default:throw new CR(r)}}function PL(r,e){const{host:t,port:n,family:i}=r.toOptions(),s=CL(r);return{type:"answer",sdp:`v=0
o=- 0 0 IN IP${i} ${t}
s=-
t=0 0
a=ice-lite
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
c=IN IP${i} ${t}
a=mid:0
a=ice-options:ice2
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:${s}
a=setup:passive
a=sctp-port:5000
a=max-message-size:${Lh}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function BL(r,e){const{host:t,port:n,family:i}=r.toOptions();return{type:"offer",sdp:`v=0
o=- 0 0 IN IP${i} ${t}
s=-
c=IN IP${i} ${t}
t=0 0
a=ice-options:ice2,trickle
m=application ${n} UDP/DTLS/SCTP webrtc-datachannel
a=mid:0
a=setup:active
a=ice-ufrag:${e}
a=ice-pwd:${e}
a=fingerprint:sha-256 00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00:00
a=sctp-port:5000
a=max-message-size:${Lh}
a=candidate:1467250027 1 UDP 1467250027 ${t} ${n} typ host
a=end-of-candidates
`}}function Q8(r,e){if(r.sdp===void 0)throw new ke("Can't munge a missing SDP");const t=r.sdp.includes(`\r
`)?`\r
`:`
`;return r.sdp=r.sdp.replace(/\na=ice-ufrag:[^\n]*\n/,`
a=ice-ufrag:`+e+t).replace(/\na=ice-pwd:[^\n]*\n/,`
a=ice-pwd:`+e+t),r}const _d=Ae("libp2p-webrtc-noise:");function NL(r,e,t){const n=r.trim().toLowerCase().replaceAll(":",""),i=Ae(n,"hex"),s=ji(wi.code,i),o=Xb.decode(Jb(e)),a=_d.byteLength+s.bytes.byteLength+o.byteLength;return Jr(t==="server"?[_d,o,s.bytes]:[_d,s.bytes,o],a)}const OL=wR?"iceconnectionstatechange":"connectionstatechange";async function RL(r,e,t){var i,s,o;const n=r.createDataChannel("",{negotiated:!0,id:0});try{if(t.role==="client"){t.log.trace("client creating local offer");const w=await r.createOffer();t.log.trace("client created local offer %s",w.sdp);const x=Q8(w,e);t.log.trace("client setting local offer %s",x.sdp),await r.setLocalDescription(x);const v=PL(t.remoteAddr,e);t.log.trace("client setting server description %s",v.sdp),await r.setRemoteDescription(v)}else{const w=BL(t.remoteAddr,e);t.log.trace("server setting client %s %s",w.type,w.sdp),await r.setRemoteDescription(w),t.log.trace("server creating local answer");const x=await r.createAnswer();t.log.trace("server created local answer");const v=Q8(x,e);t.log.trace("server setting local description %s",x.sdp),await r.setLocalDescription(v)}if(n.readyState!=="open"&&(t.log.trace("%s wait for handshake channel to open, starting status %s",t.role,n.readyState),await Ln(n,"open",t.signal)),t.log.trace("%s handshake channel opened",t.role),t.role==="server"){const w=((i=r.remoteFingerprint())==null?void 0:i.value)??"";t.remoteAddr=t.remoteAddr.encapsulate(kL(w))}const a=_L((s=r.localDescription)==null?void 0:s.sdp);if(a==null)throw new Mh("Could not get fingerprint from local description sdp");t.log.trace("%s performing noise handshake",t.role);const c=NL(a,t.remoteAddr,t.role),l=ay({prologueBytes:c})(t),u=v1({channel:n,direction:"outbound",handshake:!0,logger:t.logger,...t.dataChannel??{}}),f=new SR(t,{peerConnection:r,remoteAddr:t.remoteAddr,timeline:{open:Date.now()},metrics:t.events});r.addEventListener(OL,()=>{switch(r.connectionState){case"failed":case"disconnected":case"closed":f.close().catch(w=>{t.log.error("error closing connection",w),f.abort(w)});break;default:break}}),(o=t.events)==null||o.increment({peer_connection:!0});const g=new xR(t,{peerConnection:r,metrics:t.events,dataChannelOptions:t.dataChannel});if(t.role==="client")return t.log.trace("%s secure inbound",t.role),await l.secureInbound(u,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0}),t.log.trace("%s upgrade outbound",t.role),await t.upgrader.upgradeOutbound(f,{skipProtection:!0,skipEncryption:!0,muxerFactory:g,signal:t.signal});t.log.trace("%s secure outbound",t.role);const m=await l.secureOutbound(u,{remotePeer:t.remotePeerId,signal:t.signal,skipStreamMuxerNegotiation:!0});f.remoteAddr=f.remoteAddr.encapsulate(`/p2p/${m.remotePeer}`),t.log.trace("%s upgrade inbound",t.role),await t.upgrader.upgradeInbound(f,{skipProtection:!0,skipEncryption:!0,muxerFactory:g,signal:t.signal})}catch(a){throw n.close(),a}}async function DL(r,e,t,n){n==null&&(n=await RTCPeerConnection.generateCertificate({name:"ECDSA",namedCurve:"P-256"}));const i=typeof t=="function"?await t():t;return new RTCPeerConnection({...i??{},certificates:[n]})}async function LL(r){const e=await Mm(r),t=await crypto.subtle.exportKey("pkcs8",e.privateKey);return["-----BEGIN PRIVATE KEY-----",...Be(new Uint8Array(t),"base64pad").split(/(.{64})/).filter(Boolean),"-----END PRIVATE KEY-----"].join(`
`)}var l7,u7,h7;h7=O9,u7=Symbol.toStringTag,l7=Xr;class ML{constructor(e,t={}){h(this,"log");h(this,"metrics");h(this,"components");h(this,"init");h(this,"certificate");h(this,"privateKey");h(this,"emitter");h(this,"renewCertificateTask");h(this,h7,!0);h(this,u7,"@libp2p/webrtc-direct");h(this,l7,["@libp2p/transport"]);if(this.log=e.logger.forComponent("libp2p:webrtc-direct"),this.components=e,this.init=t,this.emitter=new or,t.certificateLifespan!=null&&t.certificateRenewalThreshold!=null&&t.certificateRenewalThreshold>=t.certificateLifespan)throw new ke("Certificate renewal threshold must be less than certificate lifespan");e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_webrtc-direct_dialer_events_total",{label:"event",help:"Total count of WebRTC-direct dial events by type"})})}async start(){this.certificate=await this.getCertificate()}async stop(){this.renewCertificateTask!=null&&clearTimeout(this.renewCertificateTask),this.certificate=void 0}async dial(e,t){var a;this.log("dial %a",e),t.signal.throwIfAborted();let n;const i=e.getPeerId();i!=null&&(n=li(i));const s=vR(),o=await DL("client",s,typeof this.init.rtcConfiguration=="function"?await this.init.rtcConfiguration():this.init.rtcConfiguration??{});try{return await RL(o,s,{role:"client",log:this.log,logger:this.components.logger,metrics:this.components.metrics,events:(a=this.metrics)==null?void 0:a.dialerEvents,signal:t.signal,remoteAddr:e,dataChannel:this.init.dataChannel,upgrader:t.upgrader,peerId:this.components.peerId,remotePeerId:n,privateKey:this.components.privateKey})}catch(c){throw o.close(),c}}createListener(e){if(this.certificate==null)throw new Ss;return new xL(this.components,{...this.init,...e,certificate:this.certificate,emitter:this.emitter})}listenFilter(e){return e.filter(U0.exactMatch)}dialFilter(e){return this.listenFilter(e)}async getCertificate(e){if(UL(this.init.certificate))return this.log("using provided TLS certificate"),this.init.certificate;const t=await this.loadOrCreatePrivateKey(),{pem:n,certhash:i}=await this.loadOrCreateCertificate(t,e);return{privateKey:await LL(t),pem:n,certhash:i}}async loadOrCreatePrivateKey(){if(this.privateKey!=null)return this.privateKey;const e=this.init.certificateKeychainName??rR,t=this.getKeychain();try{if(t==null)throw this.log("no keychain configured - not checking for stored private key"),new zr;this.log.trace("checking for stored private key"),this.privateKey=await t.exportKey(e)}catch(n){if(n.name!=="NotFoundError")throw n;this.log.trace("generating private key"),this.privateKey=await Lm("ECDSA","P-256"),t!=null?(this.log.trace("storing private key"),await t.importKey(e,this.privateKey)):this.log("no keychain configured - not storing private key")}return this.privateKey}async loadOrCreateCertificate(e,t){if(this.certificate!=null&&t!==!0)return this.certificate;let n;const i=new Ut(this.init.certificateDatastoreKey??tR),s=await Mm(e);try{if(t===!0)throw this.log.trace("forcing renewal of TLS certificate"),new zr;this.log.trace("checking for stored TLS certificate"),n=await this.loadCertificate(i,s)}catch(a){if(a.name!=="NotFoundError")throw a;this.log.trace("generating new TLS certificate"),n=await this.createCertificate(i,s)}let o=n.notAfter.getTime()-(this.init.certificateRenewalThreshold??g5)-Date.now();return o<0&&(o=100),this.log("will renew TLS certificate after %d ms",o),this.renewCertificateTask=setTimeout(()=>{this.log("renewing TLS certificate"),this.getCertificate(!0).then(a=>{this.certificate=a,this.emitter.safeDispatchEvent("certificate:renew",{detail:a})}).catch(a=>{this.log.error("could not renew certificate - %e",a)})},o),{pem:n.toString("pem"),certhash:tl.encode((await wi.digest(new Uint8Array(n.rawData))).bytes)}}async loadCertificate(e,t){const n=await this.components.datastore.get(e),i=new Sp(n),s=i.notAfter.getTime()-(this.init.certificateRenewalThreshold??g5);if(Date.now()>s)throw this.log("stored TLS certificate has expired"),new zr;this.log("loaded certificate, expires in %d ms",s);const o=await i.publicKey.export(crypto),a=await crypto.subtle.exportKey("raw",o),c=await crypto.subtle.exportKey("raw",t.publicKey);if(!pt(new Uint8Array(a,0,a.byteLength),new Uint8Array(c,0,c.byteLength)))throw this.log("stored TLS certificate public key did not match public key from private key"),new zr;return this.log("loaded certificate, expiry time is %o",s),i}async createCertificate(e,t){const n=new Date,i=new Date(Date.now()+(this.init.certificateLifespan??nR));n.setMilliseconds(0),i.setMilliseconds(0);const s=await EL.createSelfSigned({serialNumber:(BigInt(Math.random().toString().replace(".",""))*100000n).toString(16),name:"CN=example.com, C=US, L=CA, O=example, ST=CA",notBefore:n,notAfter:i,keys:t,extensions:[new bp(!1,void 0,!0)]},crypto);return this.getKeychain()!=null?(this.log.trace("storing TLS certificate"),await this.components.datastore.put(e,Ae(s.toString("pem")))):this.log("no keychain is configured so not storing TLS certificate since the private key will not be reused"),s}getKeychain(){try{return this.components.keychain}catch{}}}function UL(r){return r==null?!1:typeof r.privateKey=="string"&&typeof r.pem=="string"&&typeof r.certhash=="string"}function FL(r){return e=>new ML(e,r)}const $L=[dr("tcp").code,dr("dns").code,dr("dnsaddr").code,dr("dns4").code,dr("dns6").code];function Y8(r){var e;return(e=ev("sni",r))==null?void 0:e[1]}function Z8(r){var t;const e=(t=ev("tcp",r))==null?void 0:t[1];return e==null?"":`:${e}`}function ev(r,e){let t;try{t=dr(r).code}catch{return}for(const[n,i]of e)if(n===t&&i!=null)return[n,i]}function X8(r){return r.some(([e,t])=>e===dr("tls").code)}function ln(r,e,t){const n=tv[dr(r).name];if(n==null)throw new Error(`Can't interpret protocol ${dr(r).name}`);const i=n(e,t);return r===dr("ip6").code?`[${i}]`:i}const tv={ip4:(r,e)=>r,ip6:(r,e)=>e.length===0?r:`[${r}]`,tcp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`tcp://${ln(t[0],t[1]??"",e)}:${r}`},udp:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`udp://${ln(t[0],t[1]??"",e)}:${r}`},dnsaddr:(r,e)=>r,dns4:(r,e)=>r,dns6:(r,e)=>r,dns:(r,e)=>r,ipfs:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${ln(t[0],t[1]??"",e)}`},p2p:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return`${ln(t[0],t[1]??"",e)}`},http:(r,e)=>{const t=X8(e),n=Y8(e),i=Z8(e);if(t&&n!=null)return`https://${n}${i}`;const s=t?"https://":"http://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=ln(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},"http-path":(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");const n=ln(t[0],t[1]??"",e),i=decodeURIComponent(r);return`${n}/${i}`},tls:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return ln(t[0],t[1]??"",e)},sni:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");return ln(t[0],t[1]??"",e)},https:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=ln(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`https://${n}`},ws:(r,e)=>{const t=X8(e),n=Y8(e),i=Z8(e);if(t&&n!=null)return`wss://${n}${i}`;const s=t?"wss://":"ws://",o=e.pop();if(o==null)throw new Error("Unexpected end of multiaddr");let a=ln(o[0],o[1]??"",e);return a=a.replace("tcp://",""),`${s}${a}`},wss:(r,e)=>{const t=e.pop();if(t==null)throw new Error("Unexpected end of multiaddr");let n=ln(t[0],t[1]??"",e);return n=n.replace("tcp://",""),`wss://${n}`}};function VL(r,e){const n=Ze(r).stringTuples(),i=n.pop();if(i==null)throw new Error("Unexpected end of multiaddr");const s=dr(i[0]),o=tv[s.name];if(o==null)throw new Error(`No interpreter found for ${s.name}`);let a=o(i[1]??"",n);return $L.includes(i[0])&&(a=a.replace(/^.*:\/\//,""),i[1]==="443"?a=`https://${a}`:a=`http://${a}`),(a.startsWith("http://")||a.startsWith("https://")||a.startsWith("ws://")||a.startsWith("wss://"))&&(a=new URL(a).toString(),a.endsWith("/")&&(a=a.substring(0,a.length-1))),a}const qL=async r=>{if(r.readyState>=2)throw new Error("socket closed");r.readyState!==1&&await new Promise((e,t)=>{function n(){r.removeEventListener("open",i),r.removeEventListener("error",s)}function i(){n(),e()}function s(o){n(),t(o.error??new Error(`connect ECONNREFUSED ${r.url}`))}r.addEventListener("open",i),r.addEventListener("error",s)})},KL=(r,e)=>(e=e??{},e.closeOnEnd=e.closeOnEnd!==!1,async n=>{for await(const i of n){try{await qL(r)}catch(s){if(s.message==="socket closed")break;throw s}if(r.readyState===r.CLOSING||r.readyState===r.CLOSED)break;r.send(i)}e.closeOnEnd!=null&&r.readyState<=1&&await new Promise((i,s)=>{r.addEventListener("close",o=>{if(o.wasClean||o.code===1006)i();else{const a=Object.assign(new Error("ws error"),{event:o});s(a)}}),setTimeout(()=>{r.close()})})});var no={},Ra={},J8;function HL(){if(J8)return Ra;J8=1,Object.defineProperty(Ra,"__esModule",{value:!0});class r{constructor(){this.pullQueue=[],this.pushQueue=[],this.eventHandlers={},this.isPaused=!1,this.isStopped=!1}push(n){if(this.isStopped)return;const i={value:n,done:!1};if(this.pullQueue.length){const s=this.pullQueue.shift();s&&s.resolve(i)}else this.pushQueue.push(Promise.resolve(i)),this.highWaterMark!==void 0&&this.pushQueue.length>=this.highWaterMark&&!this.isPaused&&(this.isPaused=!0,this.eventHandlers.highWater?this.eventHandlers.highWater():console&&console.warn(`EventIterator queue reached ${this.pushQueue.length} items`))}stop(){if(!this.isStopped){this.isStopped=!0,this.remove();for(const n of this.pullQueue)n.resolve({value:void 0,done:!0});this.pullQueue.length=0}}fail(n){if(!this.isStopped)if(this.isStopped=!0,this.remove(),this.pullQueue.length){for(const i of this.pullQueue)i.reject(n);this.pullQueue.length=0}else{const i=Promise.reject(n);i.catch(()=>{}),this.pushQueue.push(i)}}remove(){Promise.resolve().then(()=>{this.removeCallback&&this.removeCallback()})}[Symbol.asyncIterator](){return{next:n=>{const i=this.pushQueue.shift();return i?(this.lowWaterMark!==void 0&&this.pushQueue.length<=this.lowWaterMark&&this.isPaused&&(this.isPaused=!1,this.eventHandlers.lowWater&&this.eventHandlers.lowWater()),i):this.isStopped?Promise.resolve({value:void 0,done:!0}):new Promise((s,o)=>{this.pullQueue.push({resolve:s,reject:o})})},return:()=>(this.isStopped=!0,this.pushQueue.length=0,this.remove(),Promise.resolve({value:void 0,done:!0}))}}}class e{constructor(n,{highWaterMark:i=100,lowWaterMark:s=1}={}){const o=new r;o.highWaterMark=i,o.lowWaterMark=s,o.removeCallback=n({push:a=>o.push(a),stop:()=>o.stop(),fail:a=>o.fail(a),on:(a,c)=>{o.eventHandlers[a]=c}})||(()=>{}),this[Symbol.asyncIterator]=()=>o[Symbol.asyncIterator](),Object.freeze(this)}}return Ra.EventIterator=e,Ra.default=e,Ra}var eg;function jL(){if(eg)return no;eg=1,Object.defineProperty(no,"__esModule",{value:!0});const r=HL();no.EventIterator=r.EventIterator;function e(t,n,i){return new r.EventIterator(({push:s})=>(this.addEventListener(t,s,n),()=>this.removeEventListener(t,s,n)),i)}return no.subscribe=e,no.default=r.EventIterator,no}var zL=jL();function tg(r){var e;return r instanceof ArrayBuffer||((e=r==null?void 0:r.constructor)==null?void 0:e.name)==="ArrayBuffer"&&typeof(r==null?void 0:r.byteLength)=="number"}const WL=r=>{r.binaryType="arraybuffer";const e=async()=>{await new Promise((s,o)=>{if(n){s();return}if(i!=null){o(i);return}const a=u=>{r.removeEventListener("open",c),r.removeEventListener("error",l),u()},c=()=>{a(s)},l=u=>{a(()=>{o(u.error??new Error(`connect ECONNREFUSED ${r.url}`))})};r.addEventListener("open",c),r.addEventListener("error",l)})},t=async function*(){const s=new zL.EventIterator(({push:o,stop:a,fail:c})=>{const l=f=>{let g=null;typeof f.data=="string"&&(g=Ae(f.data)),tg(f.data)&&(g=new Uint8Array(f.data)),f.data instanceof Uint8Array&&(g=f.data),g!=null&&o(g)},u=f=>{c(f.error??new Error("Socket error"))};return r.addEventListener("message",l),r.addEventListener("error",u),r.addEventListener("close",a),()=>{r.removeEventListener("message",l),r.removeEventListener("error",u),r.removeEventListener("close",a)}},{highWaterMark:1/0});await e();for await(const o of s)yield tg(o)?new Uint8Array(o):o}();let n=r.readyState===1,i;return r.addEventListener("open",()=>{n=!0,i=null}),r.addEventListener("close",()=>{n=!1,i=null}),r.addEventListener("error",s=>{n||(i=s.error??new Error(`connect ECONNREFUSED ${r.url}`))}),Object.assign(t,{connected:e})},GL=(r,e)=>{e=e??{};const t=WL(r);let n=e.remoteAddress,i=e.remotePort;if(r.url!=null)try{const o=new URL(r.url);n=o.hostname,i=parseInt(o.port,10)}catch{}if(n==null||i==null)throw new Error("Remote connection did not have address and/or port");return{sink:KL(r,e),source:t,connected:async()=>{await t.connected()},close:async()=>{(r.readyState===r.CONNECTING||r.readyState===r.OPEN)&&await new Promise(o=>{r.addEventListener("close",()=>{o()}),r.close()})},destroy:()=>{r.terminate!=null?r.terminate():r.close()},remoteAddress:n,remotePort:i,socket:r}},QL=WebSocket,YL={"http:":"ws:","https:":"wss:"},rg="ws:",ZL=(r,e)=>{if(r.startsWith("//")&&(r=`${(e==null?void 0:e.protocol)??rg}${r}`),r.startsWith("/")&&e!=null){const n=e.protocol??rg,i=e.host,s=e.port!=null&&(i==null?void 0:i.endsWith(`:${e.port}`))!==!0?`:${e.port}`:"";r=`${n}//${i}${s}${r}`}const t=new URL(r);for(const[n,i]of Object.entries(YL))t.protocol===n&&(t.protocol=i);return t};function XL(r,e){const t=typeof window>"u"?void 0:window.location;e=e??{};const n=ZL(r,t),i=new QL(n.toString(),e.websocket);return GL(i,e)}function JL(r){return r.filter(e=>p1.exactMatch(e)||Tc.exactMatch(e))}function eM(){throw new Error("WebSocket Servers can not be created in the browser!")}const tM=500;function rM(r,e,t){const n=t.logger.forComponent("libp2p:websockets:maconn"),i=t.metrics,s=t.metricPrefix??"",o={log:n,async sink(a){try{await r.sink(async function*(){for await(const c of a)c instanceof Uint8Array?yield c:yield c.subarray()}())}catch(c){c.type!=="aborted"&&n.error(c)}},source:r.source,remoteAddr:e,timeline:{open:Date.now()},async close(a={}){var u,f;const c=Date.now();if(a.signal==null){const g=AbortSignal.timeout(tM);a={...a,signal:g}}const l=()=>{const{host:g,port:m}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s after %dms, destroying it manually",g,m,Date.now()-c),this.abort(new Hi("Socket close timeout"))};(u=a.signal)==null||u.addEventListener("abort",l);try{await r.close()}catch(g){n.error("error closing WebSocket gracefully",g),this.abort(g)}finally{(f=a.signal)==null||f.removeEventListener("abort",l),o.timeline.close=Date.now()}},abort(a){const{host:c,port:l}=o.remoteAddr.toOptions();n("timeout closing stream to %s:%s due to error",c,l,a),r.destroy(),o.timeline.close=Date.now(),i==null||i.increment({[`${s}error`]:!0})}};return r.socket.addEventListener("close",()=>{i==null||i.increment({[`${s}close`]:!0}),o.timeline.close==null&&(o.timeline.close=Date.now())},{once:!0}),o}var f7,d7,p7;p7=O9,d7=Symbol.toStringTag,f7=Xr;class nM{constructor(e,t={}){h(this,"log");h(this,"init");h(this,"logger");h(this,"metrics");h(this,"components");h(this,p7,!0);h(this,d7,"@libp2p/websockets");h(this,f7,["@libp2p/transport"]);this.log=e.logger.forComponent("libp2p:websockets"),this.logger=e.logger,this.components=e,this.init=t,e.metrics!=null&&(this.metrics={dialerEvents:e.metrics.registerCounterGroup("libp2p_websockets_dialer_events_total",{label:"event",help:"Total count of WebSockets dialer events by type"})})}async dial(e,t){var o;this.log("dialing %s",e),t=t??{};const n=await this._connect(e,t),i=rM(n,e,{logger:this.logger,metrics:(o=this.metrics)==null?void 0:o.dialerEvents});this.log("new outbound connection %s",i.remoteAddr);const s=await t.upgrader.upgradeOutbound(i,t);return this.log("outbound connection %s upgraded",i.remoteAddr),s}async _connect(e,t){var o,a,c,l,u;(o=t==null?void 0:t.signal)==null||o.throwIfAborted();const n=e.toOptions();this.log("dialing %s:%s",n.host,n.port);const i=St(),s=XL(VL(e),this.init);s.socket.addEventListener("error",()=>{var g;const f=new L9(`Could not connect to ${e.toString()}`);this.log.error("connection error:",f),(g=this.metrics)==null||g.dialerEvents.increment({error:!0}),i.reject(f)});try{(a=t.onProgress)==null||a.call(t,new Ar("websockets:open-connection")),await Ht(Promise.race([s.connected(),i.promise]),t.signal)}catch(f){throw(c=t.signal)!=null&&c.aborted&&((l=this.metrics)==null||l.dialerEvents.increment({abort:!0})),s.close().catch(g=>{this.log.error("error closing raw socket",g)}),f}return this.log("connected %s",e),(u=this.metrics)==null||u.dialerEvents.increment({connect:!0}),s}createListener(e){return eM({logger:this.logger,events:this.components.events,metrics:this.components.metrics},{...this.init,...e})}listenFilter(e){var t,n;return e=Array.isArray(e)?e:[e],((t=this.init)==null?void 0:t.filter)!=null?(n=this.init)==null?void 0:n.filter(e):JL(e)}dialFilter(e){return this.listenFilter(e)}}function iM(r={}){return e=>new nM(e,r)}var Id={},Da={},ng;function sM(){if(ng)return Da;ng=1,Da.byteLength=a,Da.toByteArray=l,Da.fromByteArray=g;for(var r=[],e=[],t=typeof Uint8Array<"u"?Uint8Array:Array,n="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",i=0,s=n.length;i<s;++i)r[i]=n[i],e[n.charCodeAt(i)]=i;e[45]=62,e[95]=63;function o(m){var w=m.length;if(w%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var x=m.indexOf("=");x===-1&&(x=w);var v=x===w?0:4-x%4;return[x,v]}function a(m){var w=o(m),x=w[0],v=w[1];return(x+v)*3/4-v}function c(m,w,x){return(w+x)*3/4-x}function l(m){var w,x=o(m),v=x[0],C=x[1],N=new t(c(m,v,C)),O=0,L=C>0?v-4:v,R;for(R=0;R<L;R+=4)w=e[m.charCodeAt(R)]<<18|e[m.charCodeAt(R+1)]<<12|e[m.charCodeAt(R+2)]<<6|e[m.charCodeAt(R+3)],N[O++]=w>>16&255,N[O++]=w>>8&255,N[O++]=w&255;return C===2&&(w=e[m.charCodeAt(R)]<<2|e[m.charCodeAt(R+1)]>>4,N[O++]=w&255),C===1&&(w=e[m.charCodeAt(R)]<<10|e[m.charCodeAt(R+1)]<<4|e[m.charCodeAt(R+2)]>>2,N[O++]=w>>8&255,N[O++]=w&255),N}function u(m){return r[m>>18&63]+r[m>>12&63]+r[m>>6&63]+r[m&63]}function f(m,w,x){for(var v,C=[],N=w;N<x;N+=3)v=(m[N]<<16&16711680)+(m[N+1]<<8&65280)+(m[N+2]&255),C.push(u(v));return C.join("")}function g(m){for(var w,x=m.length,v=x%3,C=[],N=16383,O=0,L=x-v;O<L;O+=N)C.push(f(m,O,O+N>L?L:O+N));return v===1?(w=m[x-1],C.push(r[w>>2]+r[w<<4&63]+"==")):v===2&&(w=(m[x-2]<<8)+m[x-1],C.push(r[w>>10]+r[w>>4&63]+r[w<<2&63]+"=")),C.join("")}return Da}var ru={};/*! ieee754. BSD-3-Clause License. Feross Aboukhadijeh <https://feross.org/opensource> */var ig;function oM(){return ig||(ig=1,ru.read=function(r,e,t,n,i){var s,o,a=i*8-n-1,c=(1<<a)-1,l=c>>1,u=-7,f=t?i-1:0,g=t?-1:1,m=r[e+f];for(f+=g,s=m&(1<<-u)-1,m>>=-u,u+=a;u>0;s=s*256+r[e+f],f+=g,u-=8);for(o=s&(1<<-u)-1,s>>=-u,u+=n;u>0;o=o*256+r[e+f],f+=g,u-=8);if(s===0)s=1-l;else{if(s===c)return o?NaN:(m?-1:1)*(1/0);o=o+Math.pow(2,n),s=s-l}return(m?-1:1)*o*Math.pow(2,s-n)},ru.write=function(r,e,t,n,i,s){var o,a,c,l=s*8-i-1,u=(1<<l)-1,f=u>>1,g=i===23?Math.pow(2,-24)-Math.pow(2,-77):0,m=n?0:s-1,w=n?1:-1,x=e<0||e===0&&1/e<0?1:0;for(e=Math.abs(e),isNaN(e)||e===1/0?(a=isNaN(e)?1:0,o=u):(o=Math.floor(Math.log(e)/Math.LN2),e*(c=Math.pow(2,-o))<1&&(o--,c*=2),o+f>=1?e+=g/c:e+=g*Math.pow(2,1-f),e*c>=2&&(o++,c/=2),o+f>=u?(a=0,o=u):o+f>=1?(a=(e*c-1)*Math.pow(2,i),o=o+f):(a=e*Math.pow(2,f-1)*Math.pow(2,i),o=0));i>=8;r[t+m]=a&255,m+=w,a/=256,i-=8);for(o=o<<i|a,l+=i;l>0;r[t+m]=o&255,m+=w,o/=256,l-=8);r[t+m-w]|=x*128}),ru}/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <https://feross.org>
 * @license  MIT
 */var sg;function aM(){return sg||(sg=1,function(r){const e=sM(),t=oM(),n=typeof Symbol=="function"&&typeof Symbol.for=="function"?Symbol.for("nodejs.util.inspect.custom"):null;r.Buffer=a,r.SlowBuffer=N,r.INSPECT_MAX_BYTES=50;const i=2147483647;r.kMaxLength=i,a.TYPED_ARRAY_SUPPORT=s(),!a.TYPED_ARRAY_SUPPORT&&typeof console<"u"&&typeof console.error=="function"&&console.error("This browser lacks typed array (Uint8Array) support which is required by `buffer` v5.x. Use `buffer` v4.x if you require old browser support.");function s(){try{const b=new Uint8Array(1),d={foo:function(){return 42}};return Object.setPrototypeOf(d,Uint8Array.prototype),Object.setPrototypeOf(b,d),b.foo()===42}catch{return!1}}Object.defineProperty(a.prototype,"parent",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.buffer}}),Object.defineProperty(a.prototype,"offset",{enumerable:!0,get:function(){if(a.isBuffer(this))return this.byteOffset}});function o(b){if(b>i)throw new RangeError('The value "'+b+'" is invalid for option "size"');const d=new Uint8Array(b);return Object.setPrototypeOf(d,a.prototype),d}function a(b,d,p){if(typeof b=="number"){if(typeof d=="string")throw new TypeError('The "string" argument must be of type string. Received type number');return f(b)}return c(b,d,p)}a.poolSize=8192;function c(b,d,p){if(typeof b=="string")return g(b,d);if(ArrayBuffer.isView(b))return w(b);if(b==null)throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof b);if(we(b,ArrayBuffer)||b&&we(b.buffer,ArrayBuffer)||typeof SharedArrayBuffer<"u"&&(we(b,SharedArrayBuffer)||b&&we(b.buffer,SharedArrayBuffer)))return x(b,d,p);if(typeof b=="number")throw new TypeError('The "value" argument must not be of type number. Received type number');const A=b.valueOf&&b.valueOf();if(A!=null&&A!==b)return a.from(A,d,p);const T=v(b);if(T)return T;if(typeof Symbol<"u"&&Symbol.toPrimitive!=null&&typeof b[Symbol.toPrimitive]=="function")return a.from(b[Symbol.toPrimitive]("string"),d,p);throw new TypeError("The first argument must be one of type string, Buffer, ArrayBuffer, Array, or Array-like Object. Received type "+typeof b)}a.from=function(b,d,p){return c(b,d,p)},Object.setPrototypeOf(a.prototype,Uint8Array.prototype),Object.setPrototypeOf(a,Uint8Array);function l(b){if(typeof b!="number")throw new TypeError('"size" argument must be of type number');if(b<0)throw new RangeError('The value "'+b+'" is invalid for option "size"')}function u(b,d,p){return l(b),b<=0?o(b):d!==void 0?typeof p=="string"?o(b).fill(d,p):o(b).fill(d):o(b)}a.alloc=function(b,d,p){return u(b,d,p)};function f(b){return l(b),o(b<0?0:C(b)|0)}a.allocUnsafe=function(b){return f(b)},a.allocUnsafeSlow=function(b){return f(b)};function g(b,d){if((typeof d!="string"||d==="")&&(d="utf8"),!a.isEncoding(d))throw new TypeError("Unknown encoding: "+d);const p=O(b,d)|0;let A=o(p);const T=A.write(b,d);return T!==p&&(A=A.slice(0,T)),A}function m(b){const d=b.length<0?0:C(b.length)|0,p=o(d);for(let A=0;A<d;A+=1)p[A]=b[A]&255;return p}function w(b){if(we(b,Uint8Array)){const d=new Uint8Array(b);return x(d.buffer,d.byteOffset,d.byteLength)}return m(b)}function x(b,d,p){if(d<0||b.byteLength<d)throw new RangeError('"offset" is outside of buffer bounds');if(b.byteLength<d+(p||0))throw new RangeError('"length" is outside of buffer bounds');let A;return d===void 0&&p===void 0?A=new Uint8Array(b):p===void 0?A=new Uint8Array(b,d):A=new Uint8Array(b,d,p),Object.setPrototypeOf(A,a.prototype),A}function v(b){if(a.isBuffer(b)){const d=C(b.length)|0,p=o(d);return p.length===0||b.copy(p,0,0,d),p}if(b.length!==void 0)return typeof b.length!="number"||he(b.length)?o(0):m(b);if(b.type==="Buffer"&&Array.isArray(b.data))return m(b.data)}function C(b){if(b>=i)throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+i.toString(16)+" bytes");return b|0}function N(b){return+b!=b&&(b=0),a.alloc(+b)}a.isBuffer=function(d){return d!=null&&d._isBuffer===!0&&d!==a.prototype},a.compare=function(d,p){if(we(d,Uint8Array)&&(d=a.from(d,d.offset,d.byteLength)),we(p,Uint8Array)&&(p=a.from(p,p.offset,p.byteLength)),!a.isBuffer(d)||!a.isBuffer(p))throw new TypeError('The "buf1", "buf2" arguments must be one of type Buffer or Uint8Array');if(d===p)return 0;let A=d.length,T=p.length;for(let E=0,_=Math.min(A,T);E<_;++E)if(d[E]!==p[E]){A=d[E],T=p[E];break}return A<T?-1:T<A?1:0},a.isEncoding=function(d){switch(String(d).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},a.concat=function(d,p){if(!Array.isArray(d))throw new TypeError('"list" argument must be an Array of Buffers');if(d.length===0)return a.alloc(0);let A;if(p===void 0)for(p=0,A=0;A<d.length;++A)p+=d[A].length;const T=a.allocUnsafe(p);let E=0;for(A=0;A<d.length;++A){let _=d[A];if(we(_,Uint8Array))E+_.length>T.length?(a.isBuffer(_)||(_=a.from(_)),_.copy(T,E)):Uint8Array.prototype.set.call(T,_,E);else if(a.isBuffer(_))_.copy(T,E);else throw new TypeError('"list" argument must be an Array of Buffers');E+=_.length}return T};function O(b,d){if(a.isBuffer(b))return b.length;if(ArrayBuffer.isView(b)||we(b,ArrayBuffer))return b.byteLength;if(typeof b!="string")throw new TypeError('The "string" argument must be one of type string, Buffer, or ArrayBuffer. Received type '+typeof b);const p=b.length,A=arguments.length>2&&arguments[2]===!0;if(!A&&p===0)return 0;let T=!1;for(;;)switch(d){case"ascii":case"latin1":case"binary":return p;case"utf8":case"utf-8":return J(b).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return p*2;case"hex":return p>>>1;case"base64":return se(b).length;default:if(T)return A?-1:J(b).length;d=(""+d).toLowerCase(),T=!0}}a.byteLength=O;function L(b,d,p){let A=!1;if((d===void 0||d<0)&&(d=0),d>this.length||((p===void 0||p>this.length)&&(p=this.length),p<=0)||(p>>>=0,d>>>=0,p<=d))return"";for(b||(b="utf8");;)switch(b){case"hex":return ie(this,d,p);case"utf8":case"utf-8":return G(this,d,p);case"ascii":return Q(this,d,p);case"latin1":case"binary":return Y(this,d,p);case"base64":return q(this,d,p);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return Se(this,d,p);default:if(A)throw new TypeError("Unknown encoding: "+b);b=(b+"").toLowerCase(),A=!0}}a.prototype._isBuffer=!0;function R(b,d,p){const A=b[d];b[d]=b[p],b[p]=A}a.prototype.swap16=function(){const d=this.length;if(d%2!==0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(let p=0;p<d;p+=2)R(this,p,p+1);return this},a.prototype.swap32=function(){const d=this.length;if(d%4!==0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(let p=0;p<d;p+=4)R(this,p,p+3),R(this,p+1,p+2);return this},a.prototype.swap64=function(){const d=this.length;if(d%8!==0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(let p=0;p<d;p+=8)R(this,p,p+7),R(this,p+1,p+6),R(this,p+2,p+5),R(this,p+3,p+4);return this},a.prototype.toString=function(){const d=this.length;return d===0?"":arguments.length===0?G(this,0,d):L.apply(this,arguments)},a.prototype.toLocaleString=a.prototype.toString,a.prototype.equals=function(d){if(!a.isBuffer(d))throw new TypeError("Argument must be a Buffer");return this===d?!0:a.compare(this,d)===0},a.prototype.inspect=function(){let d="";const p=r.INSPECT_MAX_BYTES;return d=this.toString("hex",0,p).replace(/(.{2})/g,"$1 ").trim(),this.length>p&&(d+=" ... "),"<Buffer "+d+">"},n&&(a.prototype[n]=a.prototype.inspect),a.prototype.compare=function(d,p,A,T,E){if(we(d,Uint8Array)&&(d=a.from(d,d.offset,d.byteLength)),!a.isBuffer(d))throw new TypeError('The "target" argument must be one of type Buffer or Uint8Array. Received type '+typeof d);if(p===void 0&&(p=0),A===void 0&&(A=d?d.length:0),T===void 0&&(T=0),E===void 0&&(E=this.length),p<0||A>d.length||T<0||E>this.length)throw new RangeError("out of range index");if(T>=E&&p>=A)return 0;if(T>=E)return-1;if(p>=A)return 1;if(p>>>=0,A>>>=0,T>>>=0,E>>>=0,this===d)return 0;let _=E-T,D=A-p;const z=Math.min(_,D),ce=this.slice(T,E),Ne=d.slice(p,A);for(let Oe=0;Oe<z;++Oe)if(ce[Oe]!==Ne[Oe]){_=ce[Oe],D=Ne[Oe];break}return _<D?-1:D<_?1:0};function F(b,d,p,A,T){if(b.length===0)return-1;if(typeof p=="string"?(A=p,p=0):p>2147483647?p=2147483647:p<-2147483648&&(p=-2147483648),p=+p,he(p)&&(p=T?0:b.length-1),p<0&&(p=b.length+p),p>=b.length){if(T)return-1;p=b.length-1}else if(p<0)if(T)p=0;else return-1;if(typeof d=="string"&&(d=a.from(d,A)),a.isBuffer(d))return d.length===0?-1:K(b,d,p,A,T);if(typeof d=="number")return d=d&255,typeof Uint8Array.prototype.indexOf=="function"?T?Uint8Array.prototype.indexOf.call(b,d,p):Uint8Array.prototype.lastIndexOf.call(b,d,p):K(b,[d],p,A,T);throw new TypeError("val must be string, number or Buffer")}function K(b,d,p,A,T){let E=1,_=b.length,D=d.length;if(A!==void 0&&(A=String(A).toLowerCase(),A==="ucs2"||A==="ucs-2"||A==="utf16le"||A==="utf-16le")){if(b.length<2||d.length<2)return-1;E=2,_/=2,D/=2,p/=2}function z(Ne,Oe){return E===1?Ne[Oe]:Ne.readUInt16BE(Oe*E)}let ce;if(T){let Ne=-1;for(ce=p;ce<_;ce++)if(z(b,ce)===z(d,Ne===-1?0:ce-Ne)){if(Ne===-1&&(Ne=ce),ce-Ne+1===D)return Ne*E}else Ne!==-1&&(ce-=ce-Ne),Ne=-1}else for(p+D>_&&(p=_-D),ce=p;ce>=0;ce--){let Ne=!0;for(let Oe=0;Oe<D;Oe++)if(z(b,ce+Oe)!==z(d,Oe)){Ne=!1;break}if(Ne)return ce}return-1}a.prototype.includes=function(d,p,A){return this.indexOf(d,p,A)!==-1},a.prototype.indexOf=function(d,p,A){return F(this,d,p,A,!0)},a.prototype.lastIndexOf=function(d,p,A){return F(this,d,p,A,!1)};function H(b,d,p,A){p=Number(p)||0;const T=b.length-p;A?(A=Number(A),A>T&&(A=T)):A=T;const E=d.length;A>E/2&&(A=E/2);let _;for(_=0;_<A;++_){const D=parseInt(d.substr(_*2,2),16);if(he(D))return _;b[p+_]=D}return _}function P(b,d,p,A){return ee(J(d,b.length-p),b,p,A)}function U(b,d,p,A){return ee(ue(d),b,p,A)}function M(b,d,p,A){return ee(se(d),b,p,A)}function $(b,d,p,A){return ee(le(d,b.length-p),b,p,A)}a.prototype.write=function(d,p,A,T){if(p===void 0)T="utf8",A=this.length,p=0;else if(A===void 0&&typeof p=="string")T=p,A=this.length,p=0;else if(isFinite(p))p=p>>>0,isFinite(A)?(A=A>>>0,T===void 0&&(T="utf8")):(T=A,A=void 0);else throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");const E=this.length-p;if((A===void 0||A>E)&&(A=E),d.length>0&&(A<0||p<0)||p>this.length)throw new RangeError("Attempt to write outside buffer bounds");T||(T="utf8");let _=!1;for(;;)switch(T){case"hex":return H(this,d,p,A);case"utf8":case"utf-8":return P(this,d,p,A);case"ascii":case"latin1":case"binary":return U(this,d,p,A);case"base64":return M(this,d,p,A);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return $(this,d,p,A);default:if(_)throw new TypeError("Unknown encoding: "+T);T=(""+T).toLowerCase(),_=!0}},a.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};function q(b,d,p){return d===0&&p===b.length?e.fromByteArray(b):e.fromByteArray(b.slice(d,p))}function G(b,d,p){p=Math.min(b.length,p);const A=[];let T=d;for(;T<p;){const E=b[T];let _=null,D=E>239?4:E>223?3:E>191?2:1;if(T+D<=p){let z,ce,Ne,Oe;switch(D){case 1:E<128&&(_=E);break;case 2:z=b[T+1],(z&192)===128&&(Oe=(E&31)<<6|z&63,Oe>127&&(_=Oe));break;case 3:z=b[T+1],ce=b[T+2],(z&192)===128&&(ce&192)===128&&(Oe=(E&15)<<12|(z&63)<<6|ce&63,Oe>2047&&(Oe<55296||Oe>57343)&&(_=Oe));break;case 4:z=b[T+1],ce=b[T+2],Ne=b[T+3],(z&192)===128&&(ce&192)===128&&(Ne&192)===128&&(Oe=(E&15)<<18|(z&63)<<12|(ce&63)<<6|Ne&63,Oe>65535&&Oe<1114112&&(_=Oe))}}_===null?(_=65533,D=1):_>65535&&(_-=65536,A.push(_>>>10&1023|55296),_=56320|_&1023),A.push(_),T+=D}return j(A)}const W=4096;function j(b){const d=b.length;if(d<=W)return String.fromCharCode.apply(String,b);let p="",A=0;for(;A<d;)p+=String.fromCharCode.apply(String,b.slice(A,A+=W));return p}function Q(b,d,p){let A="";p=Math.min(b.length,p);for(let T=d;T<p;++T)A+=String.fromCharCode(b[T]&127);return A}function Y(b,d,p){let A="";p=Math.min(b.length,p);for(let T=d;T<p;++T)A+=String.fromCharCode(b[T]);return A}function ie(b,d,p){const A=b.length;(!d||d<0)&&(d=0),(!p||p<0||p>A)&&(p=A);let T="";for(let E=d;E<p;++E)T+=Ie[b[E]];return T}function Se(b,d,p){const A=b.slice(d,p);let T="";for(let E=0;E<A.length-1;E+=2)T+=String.fromCharCode(A[E]+A[E+1]*256);return T}a.prototype.slice=function(d,p){const A=this.length;d=~~d,p=p===void 0?A:~~p,d<0?(d+=A,d<0&&(d=0)):d>A&&(d=A),p<0?(p+=A,p<0&&(p=0)):p>A&&(p=A),p<d&&(p=d);const T=this.subarray(d,p);return Object.setPrototypeOf(T,a.prototype),T};function te(b,d,p){if(b%1!==0||b<0)throw new RangeError("offset is not uint");if(b+d>p)throw new RangeError("Trying to access beyond buffer length")}a.prototype.readUintLE=a.prototype.readUIntLE=function(d,p,A){d=d>>>0,p=p>>>0,A||te(d,p,this.length);let T=this[d],E=1,_=0;for(;++_<p&&(E*=256);)T+=this[d+_]*E;return T},a.prototype.readUintBE=a.prototype.readUIntBE=function(d,p,A){d=d>>>0,p=p>>>0,A||te(d,p,this.length);let T=this[d+--p],E=1;for(;p>0&&(E*=256);)T+=this[d+--p]*E;return T},a.prototype.readUint8=a.prototype.readUInt8=function(d,p){return d=d>>>0,p||te(d,1,this.length),this[d]},a.prototype.readUint16LE=a.prototype.readUInt16LE=function(d,p){return d=d>>>0,p||te(d,2,this.length),this[d]|this[d+1]<<8},a.prototype.readUint16BE=a.prototype.readUInt16BE=function(d,p){return d=d>>>0,p||te(d,2,this.length),this[d]<<8|this[d+1]},a.prototype.readUint32LE=a.prototype.readUInt32LE=function(d,p){return d=d>>>0,p||te(d,4,this.length),(this[d]|this[d+1]<<8|this[d+2]<<16)+this[d+3]*16777216},a.prototype.readUint32BE=a.prototype.readUInt32BE=function(d,p){return d=d>>>0,p||te(d,4,this.length),this[d]*16777216+(this[d+1]<<16|this[d+2]<<8|this[d+3])},a.prototype.readBigUInt64LE=Ce(function(d){d=d>>>0,k(d,"offset");const p=this[d],A=this[d+7];(p===void 0||A===void 0)&&V(d,this.length-8);const T=p+this[++d]*2**8+this[++d]*2**16+this[++d]*2**24,E=this[++d]+this[++d]*2**8+this[++d]*2**16+A*2**24;return BigInt(T)+(BigInt(E)<<BigInt(32))}),a.prototype.readBigUInt64BE=Ce(function(d){d=d>>>0,k(d,"offset");const p=this[d],A=this[d+7];(p===void 0||A===void 0)&&V(d,this.length-8);const T=p*2**24+this[++d]*2**16+this[++d]*2**8+this[++d],E=this[++d]*2**24+this[++d]*2**16+this[++d]*2**8+A;return(BigInt(T)<<BigInt(32))+BigInt(E)}),a.prototype.readIntLE=function(d,p,A){d=d>>>0,p=p>>>0,A||te(d,p,this.length);let T=this[d],E=1,_=0;for(;++_<p&&(E*=256);)T+=this[d+_]*E;return E*=128,T>=E&&(T-=Math.pow(2,8*p)),T},a.prototype.readIntBE=function(d,p,A){d=d>>>0,p=p>>>0,A||te(d,p,this.length);let T=p,E=1,_=this[d+--T];for(;T>0&&(E*=256);)_+=this[d+--T]*E;return E*=128,_>=E&&(_-=Math.pow(2,8*p)),_},a.prototype.readInt8=function(d,p){return d=d>>>0,p||te(d,1,this.length),this[d]&128?(255-this[d]+1)*-1:this[d]},a.prototype.readInt16LE=function(d,p){d=d>>>0,p||te(d,2,this.length);const A=this[d]|this[d+1]<<8;return A&32768?A|4294901760:A},a.prototype.readInt16BE=function(d,p){d=d>>>0,p||te(d,2,this.length);const A=this[d+1]|this[d]<<8;return A&32768?A|4294901760:A},a.prototype.readInt32LE=function(d,p){return d=d>>>0,p||te(d,4,this.length),this[d]|this[d+1]<<8|this[d+2]<<16|this[d+3]<<24},a.prototype.readInt32BE=function(d,p){return d=d>>>0,p||te(d,4,this.length),this[d]<<24|this[d+1]<<16|this[d+2]<<8|this[d+3]},a.prototype.readBigInt64LE=Ce(function(d){d=d>>>0,k(d,"offset");const p=this[d],A=this[d+7];(p===void 0||A===void 0)&&V(d,this.length-8);const T=this[d+4]+this[d+5]*2**8+this[d+6]*2**16+(A<<24);return(BigInt(T)<<BigInt(32))+BigInt(p+this[++d]*2**8+this[++d]*2**16+this[++d]*2**24)}),a.prototype.readBigInt64BE=Ce(function(d){d=d>>>0,k(d,"offset");const p=this[d],A=this[d+7];(p===void 0||A===void 0)&&V(d,this.length-8);const T=(p<<24)+this[++d]*2**16+this[++d]*2**8+this[++d];return(BigInt(T)<<BigInt(32))+BigInt(this[++d]*2**24+this[++d]*2**16+this[++d]*2**8+A)}),a.prototype.readFloatLE=function(d,p){return d=d>>>0,p||te(d,4,this.length),t.read(this,d,!0,23,4)},a.prototype.readFloatBE=function(d,p){return d=d>>>0,p||te(d,4,this.length),t.read(this,d,!1,23,4)},a.prototype.readDoubleLE=function(d,p){return d=d>>>0,p||te(d,8,this.length),t.read(this,d,!0,52,8)},a.prototype.readDoubleBE=function(d,p){return d=d>>>0,p||te(d,8,this.length),t.read(this,d,!1,52,8)};function de(b,d,p,A,T,E){if(!a.isBuffer(b))throw new TypeError('"buffer" argument must be a Buffer instance');if(d>T||d<E)throw new RangeError('"value" argument is out of bounds');if(p+A>b.length)throw new RangeError("Index out of range")}a.prototype.writeUintLE=a.prototype.writeUIntLE=function(d,p,A,T){if(d=+d,p=p>>>0,A=A>>>0,!T){const D=Math.pow(2,8*A)-1;de(this,d,p,A,D,0)}let E=1,_=0;for(this[p]=d&255;++_<A&&(E*=256);)this[p+_]=d/E&255;return p+A},a.prototype.writeUintBE=a.prototype.writeUIntBE=function(d,p,A,T){if(d=+d,p=p>>>0,A=A>>>0,!T){const D=Math.pow(2,8*A)-1;de(this,d,p,A,D,0)}let E=A-1,_=1;for(this[p+E]=d&255;--E>=0&&(_*=256);)this[p+E]=d/_&255;return p+A},a.prototype.writeUint8=a.prototype.writeUInt8=function(d,p,A){return d=+d,p=p>>>0,A||de(this,d,p,1,255,0),this[p]=d&255,p+1},a.prototype.writeUint16LE=a.prototype.writeUInt16LE=function(d,p,A){return d=+d,p=p>>>0,A||de(this,d,p,2,65535,0),this[p]=d&255,this[p+1]=d>>>8,p+2},a.prototype.writeUint16BE=a.prototype.writeUInt16BE=function(d,p,A){return d=+d,p=p>>>0,A||de(this,d,p,2,65535,0),this[p]=d>>>8,this[p+1]=d&255,p+2},a.prototype.writeUint32LE=a.prototype.writeUInt32LE=function(d,p,A){return d=+d,p=p>>>0,A||de(this,d,p,4,4294967295,0),this[p+3]=d>>>24,this[p+2]=d>>>16,this[p+1]=d>>>8,this[p]=d&255,p+4},a.prototype.writeUint32BE=a.prototype.writeUInt32BE=function(d,p,A){return d=+d,p=p>>>0,A||de(this,d,p,4,4294967295,0),this[p]=d>>>24,this[p+1]=d>>>16,this[p+2]=d>>>8,this[p+3]=d&255,p+4};function ae(b,d,p,A,T){I(d,A,T,b,p,7);let E=Number(d&BigInt(4294967295));b[p++]=E,E=E>>8,b[p++]=E,E=E>>8,b[p++]=E,E=E>>8,b[p++]=E;let _=Number(d>>BigInt(32)&BigInt(4294967295));return b[p++]=_,_=_>>8,b[p++]=_,_=_>>8,b[p++]=_,_=_>>8,b[p++]=_,p}function Ue(b,d,p,A,T){I(d,A,T,b,p,7);let E=Number(d&BigInt(4294967295));b[p+7]=E,E=E>>8,b[p+6]=E,E=E>>8,b[p+5]=E,E=E>>8,b[p+4]=E;let _=Number(d>>BigInt(32)&BigInt(4294967295));return b[p+3]=_,_=_>>8,b[p+2]=_,_=_>>8,b[p+1]=_,_=_>>8,b[p]=_,p+8}a.prototype.writeBigUInt64LE=Ce(function(d,p=0){return ae(this,d,p,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeBigUInt64BE=Ce(function(d,p=0){return Ue(this,d,p,BigInt(0),BigInt("0xffffffffffffffff"))}),a.prototype.writeIntLE=function(d,p,A,T){if(d=+d,p=p>>>0,!T){const z=Math.pow(2,8*A-1);de(this,d,p,A,z-1,-z)}let E=0,_=1,D=0;for(this[p]=d&255;++E<A&&(_*=256);)d<0&&D===0&&this[p+E-1]!==0&&(D=1),this[p+E]=(d/_>>0)-D&255;return p+A},a.prototype.writeIntBE=function(d,p,A,T){if(d=+d,p=p>>>0,!T){const z=Math.pow(2,8*A-1);de(this,d,p,A,z-1,-z)}let E=A-1,_=1,D=0;for(this[p+E]=d&255;--E>=0&&(_*=256);)d<0&&D===0&&this[p+E+1]!==0&&(D=1),this[p+E]=(d/_>>0)-D&255;return p+A},a.prototype.writeInt8=function(d,p,A){return d=+d,p=p>>>0,A||de(this,d,p,1,127,-128),d<0&&(d=255+d+1),this[p]=d&255,p+1},a.prototype.writeInt16LE=function(d,p,A){return d=+d,p=p>>>0,A||de(this,d,p,2,32767,-32768),this[p]=d&255,this[p+1]=d>>>8,p+2},a.prototype.writeInt16BE=function(d,p,A){return d=+d,p=p>>>0,A||de(this,d,p,2,32767,-32768),this[p]=d>>>8,this[p+1]=d&255,p+2},a.prototype.writeInt32LE=function(d,p,A){return d=+d,p=p>>>0,A||de(this,d,p,4,2147483647,-2147483648),this[p]=d&255,this[p+1]=d>>>8,this[p+2]=d>>>16,this[p+3]=d>>>24,p+4},a.prototype.writeInt32BE=function(d,p,A){return d=+d,p=p>>>0,A||de(this,d,p,4,2147483647,-2147483648),d<0&&(d=4294967295+d+1),this[p]=d>>>24,this[p+1]=d>>>16,this[p+2]=d>>>8,this[p+3]=d&255,p+4},a.prototype.writeBigInt64LE=Ce(function(d,p=0){return ae(this,d,p,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))}),a.prototype.writeBigInt64BE=Ce(function(d,p=0){return Ue(this,d,p,-BigInt("0x8000000000000000"),BigInt("0x7fffffffffffffff"))});function Le(b,d,p,A,T,E){if(p+A>b.length)throw new RangeError("Index out of range");if(p<0)throw new RangeError("Index out of range")}function Te(b,d,p,A,T){return d=+d,p=p>>>0,T||Le(b,d,p,4),t.write(b,d,p,A,23,4),p+4}a.prototype.writeFloatLE=function(d,p,A){return Te(this,d,p,!0,A)},a.prototype.writeFloatBE=function(d,p,A){return Te(this,d,p,!1,A)};function wt(b,d,p,A,T){return d=+d,p=p>>>0,T||Le(b,d,p,8),t.write(b,d,p,A,52,8),p+8}a.prototype.writeDoubleLE=function(d,p,A){return wt(this,d,p,!0,A)},a.prototype.writeDoubleBE=function(d,p,A){return wt(this,d,p,!1,A)},a.prototype.copy=function(d,p,A,T){if(!a.isBuffer(d))throw new TypeError("argument should be a Buffer");if(A||(A=0),!T&&T!==0&&(T=this.length),p>=d.length&&(p=d.length),p||(p=0),T>0&&T<A&&(T=A),T===A||d.length===0||this.length===0)return 0;if(p<0)throw new RangeError("targetStart out of bounds");if(A<0||A>=this.length)throw new RangeError("Index out of range");if(T<0)throw new RangeError("sourceEnd out of bounds");T>this.length&&(T=this.length),d.length-p<T-A&&(T=d.length-p+A);const E=T-A;return this===d&&typeof Uint8Array.prototype.copyWithin=="function"?this.copyWithin(p,A,T):Uint8Array.prototype.set.call(d,this.subarray(A,T),p),E},a.prototype.fill=function(d,p,A,T){if(typeof d=="string"){if(typeof p=="string"?(T=p,p=0,A=this.length):typeof A=="string"&&(T=A,A=this.length),T!==void 0&&typeof T!="string")throw new TypeError("encoding must be a string");if(typeof T=="string"&&!a.isEncoding(T))throw new TypeError("Unknown encoding: "+T);if(d.length===1){const _=d.charCodeAt(0);(T==="utf8"&&_<128||T==="latin1")&&(d=_)}}else typeof d=="number"?d=d&255:typeof d=="boolean"&&(d=Number(d));if(p<0||this.length<p||this.length<A)throw new RangeError("Out of range index");if(A<=p)return this;p=p>>>0,A=A===void 0?this.length:A>>>0,d||(d=0);let E;if(typeof d=="number")for(E=p;E<A;++E)this[E]=d;else{const _=a.isBuffer(d)?d:a.from(d,T),D=_.length;if(D===0)throw new TypeError('The value "'+d+'" is invalid for argument "value"');for(E=0;E<A-p;++E)this[E+p]=_[E%D]}return this};const nt={};function ot(b,d,p){nt[b]=class extends p{constructor(){super(),Object.defineProperty(this,"message",{value:d.apply(this,arguments),writable:!0,configurable:!0}),this.name=`${this.name} [${b}]`,this.stack,delete this.name}get code(){return b}set code(T){Object.defineProperty(this,"code",{configurable:!0,enumerable:!0,value:T,writable:!0})}toString(){return`${this.name} [${b}]: ${this.message}`}}}ot("ERR_BUFFER_OUT_OF_BOUNDS",function(b){return b?`${b} is outside of buffer bounds`:"Attempt to access memory outside buffer bounds"},RangeError),ot("ERR_INVALID_ARG_TYPE",function(b,d){return`The "${b}" argument must be of type number. Received type ${typeof d}`},TypeError),ot("ERR_OUT_OF_RANGE",function(b,d,p){let A=`The value of "${b}" is out of range.`,T=p;return Number.isInteger(p)&&Math.abs(p)>2**32?T=$t(String(p)):typeof p=="bigint"&&(T=String(p),(p>BigInt(2)**BigInt(32)||p<-(BigInt(2)**BigInt(32)))&&(T=$t(T)),T+="n"),A+=` It must be ${d}. Received ${T}`,A},RangeError);function $t(b){let d="",p=b.length;const A=b[0]==="-"?1:0;for(;p>=A+4;p-=3)d=`_${b.slice(p-3,p)}${d}`;return`${b.slice(0,p)}${d}`}function Et(b,d,p){k(d,"offset"),(b[d]===void 0||b[d+p]===void 0)&&V(d,b.length-(p+1))}function I(b,d,p,A,T,E){if(b>p||b<d){const _=typeof d=="bigint"?"n":"";let D;throw d===0||d===BigInt(0)?D=`>= 0${_} and < 2${_} ** ${(E+1)*8}${_}`:D=`>= -(2${_} ** ${(E+1)*8-1}${_}) and < 2 ** ${(E+1)*8-1}${_}`,new nt.ERR_OUT_OF_RANGE("value",D,b)}Et(A,T,E)}function k(b,d){if(typeof b!="number")throw new nt.ERR_INVALID_ARG_TYPE(d,"number",b)}function V(b,d,p){throw Math.floor(b)!==b?(k(b,p),new nt.ERR_OUT_OF_RANGE("offset","an integer",b)):d<0?new nt.ERR_BUFFER_OUT_OF_BOUNDS:new nt.ERR_OUT_OF_RANGE("offset",`>= 0 and <= ${d}`,b)}const re=/[^+/0-9A-Za-z-_]/g;function Z(b){if(b=b.split("=")[0],b=b.trim().replace(re,""),b.length<2)return"";for(;b.length%4!==0;)b=b+"=";return b}function J(b,d){d=d||1/0;let p;const A=b.length;let T=null;const E=[];for(let _=0;_<A;++_){if(p=b.charCodeAt(_),p>55295&&p<57344){if(!T){if(p>56319){(d-=3)>-1&&E.push(239,191,189);continue}else if(_+1===A){(d-=3)>-1&&E.push(239,191,189);continue}T=p;continue}if(p<56320){(d-=3)>-1&&E.push(239,191,189),T=p;continue}p=(T-55296<<10|p-56320)+65536}else T&&(d-=3)>-1&&E.push(239,191,189);if(T=null,p<128){if((d-=1)<0)break;E.push(p)}else if(p<2048){if((d-=2)<0)break;E.push(p>>6|192,p&63|128)}else if(p<65536){if((d-=3)<0)break;E.push(p>>12|224,p>>6&63|128,p&63|128)}else if(p<1114112){if((d-=4)<0)break;E.push(p>>18|240,p>>12&63|128,p>>6&63|128,p&63|128)}else throw new Error("Invalid code point")}return E}function ue(b){const d=[];for(let p=0;p<b.length;++p)d.push(b.charCodeAt(p)&255);return d}function le(b,d){let p,A,T;const E=[];for(let _=0;_<b.length&&!((d-=2)<0);++_)p=b.charCodeAt(_),A=p>>8,T=p%256,E.push(T),E.push(A);return E}function se(b){return e.toByteArray(Z(b))}function ee(b,d,p,A){let T;for(T=0;T<A&&!(T+p>=d.length||T>=b.length);++T)d[T+p]=b[T];return T}function we(b,d){return b instanceof d||b!=null&&b.constructor!=null&&b.constructor.name!=null&&b.constructor.name===d.name}function he(b){return b!==b}const Ie=function(){const b="0123456789abcdef",d=new Array(256);for(let p=0;p<16;++p){const A=p*16;for(let T=0;T<16;++T)d[A+T]=b[p]+b[T]}return d}();function Ce(b){return typeof BigInt>"u"?Fe:b}function Fe(){throw new Error("BigInt not supported")}}(Id)),Id}var rv=aM();function eh(r){if(typeof r!="object"||r===null)return!1;const e=Object.getPrototypeOf(r);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Symbol.toStringTag in r)&&!(Symbol.iterator in r)}const{hasOwnProperty:nv}=Object.prototype,{propertyIsEnumerable:cM}=Object,ia=(r,e,t)=>{Object.defineProperty(r,e,{value:t,writable:!0,enumerable:!0,configurable:!0})},lM=void 0,og={concatArrays:!1,ignoreUndefined:!1},Tf=r=>{const e=[];for(const t in r)nv.call(r,t)&&e.push(t);if(Object.getOwnPropertySymbols){const t=Object.getOwnPropertySymbols(r);for(const n of t)cM.call(r,n)&&e.push(n)}return e};function _a(r){return Array.isArray(r)?uM(r):eh(r)?hM(r):r}function uM(r){const e=r.slice(0,0);return Tf(r).forEach(t=>{ia(e,t,_a(r[t]))}),e}function hM(r){const e=Object.getPrototypeOf(r)===null?Object.create(null):{};return Tf(r).forEach(t=>{ia(e,t,_a(r[t]))}),e}const iv=(r,e,t,n)=>(t.forEach(i=>{typeof e[i]>"u"&&n.ignoreUndefined||(i in r&&r[i]!==Object.getPrototypeOf(r)?ia(r,i,c3(r[i],e[i],n)):ia(r,i,_a(e[i])))}),r),fM=(r,e,t)=>{let n=r.slice(0,0),i=0;return[r,e].forEach(s=>{const o=[];for(let a=0;a<s.length;a++)nv.call(s,a)&&(o.push(String(a)),s===r?ia(n,i++,s[a]):ia(n,i++,_a(s[a])));n=iv(n,s,Tf(s).filter(a=>!o.includes(a)),t)}),n};function c3(r,e,t){return t.concatArrays&&Array.isArray(r)&&Array.isArray(e)?fM(r,e,t):!eh(e)||!eh(r)?_a(e):iv(r,e,Tf(e),t)}function sv(...r){const e=c3(_a(og),this!==lM&&this||{},og);let t={_:{}};for(const n of r)if(n!==void 0){if(!eh(n))throw new TypeError("`"+n+"` is not an Option Object");t=c3(t,{_:n},e)}return t._}function ov(r){const e=[Qi.A];return r==null?e:Array.isArray(r)?r.length===0?e:r:[r]}const av=60;function cv(r){return{Status:r.Status??0,TC:r.TC??r.flag_tc??!1,RD:r.RD??r.flag_rd??!1,RA:r.RA??r.flag_ra??!1,AD:r.AD??r.flag_ad??!1,CD:r.CD??r.flag_cd??!1,Question:(r.Question??r.questions??[]).map(e=>({name:e.name,type:Qi[e.type]})),Answer:(r.Answer??r.answers??[]).map(e=>({name:e.name,type:Qi[e.type],TTL:e.TTL??e.ttl??av,data:e.data instanceof Uint8Array?Be(e.data):e.data}))}}const dM=4;function ag(r,e={}){const t=new $y({concurrency:e.queryConcurrency??dM});return async(n,i={})=>{var a;const s=new URLSearchParams;s.set("name",n),ov(i.types).forEach(c=>{s.append("type",Qi[c])}),(a=i.onProgress)==null||a.call(i,new Ar("dns:query",{detail:n}));const o=await t.add(async()=>{var u;const c=await fetch(`${r}?${s}`,{headers:{accept:"application/dns-json"},signal:i==null?void 0:i.signal});if(c.status!==200)throw new Error(`Unexpected HTTP status: ${c.status} - ${c.statusText}`);const l=cv(await c.json());return(u=i.onProgress)==null||u.call(i,new Ar("dns:response",{detail:l})),l},{signal:i.signal});if(o==null)throw new Error("No DNS response received");return o}}function pM(){return[ag("https://cloudflare-dns.com/dns-query"),ag("https://dns.google/resolve")]}var Cd,cg;function gM(){return cg||(cg=1,Cd=function(r){if(!r)throw Error("hashlru must have a max value, of type number, greater than 0");var e=0,t=Object.create(null),n=Object.create(null);function i(s,o){t[s]=o,e++,e>=r&&(e=0,n=t,t=Object.create(null))}return{has:function(s){return t[s]!==void 0||n[s]!==void 0},remove:function(s){t[s]!==void 0&&(t[s]=void 0),n[s]!==void 0&&(n[s]=void 0)},get:function(s){var o=t[s];if(o!==void 0)return o;if((o=n[s])!==void 0)return i(s,o),o},set:function(s,o){t[s]!==void 0?t[s]=o:i(s,o)},clear:function(){t=Object.create(null),n=Object.create(null)}}}),Cd}var mM=gM();const yM=S4(mM);class wM{constructor(e){h(this,"lru");this.lru=yM(e)}get(e,t){let n=!0;const i=[];for(const s of t){const o=this.getAnswers(e,s);if(o.length===0){n=!1;break}i.push(...o)}if(n)return cv({answers:i})}getAnswers(e,t){const n=`${e.toLowerCase()}-${t}`,i=this.lru.get(n);if(i!=null){const s=i.filter(o=>o.expires>Date.now()).map(({expires:o,value:a})=>({...a,TTL:Math.round((o-Date.now())/1e3),type:Qi[a.type]}));return s.length===0&&this.lru.remove(n),s}return[]}add(e,t){const n=`${e.toLowerCase()}-${t.type}`,i=this.lru.get(n)??[];i.push({expires:Date.now()+(t.TTL??av)*1e3,value:t}),this.lru.set(n,i)}remove(e,t){const n=`${e.toLowerCase()}-${t}`;this.lru.remove(n)}clear(){this.lru.clear()}}function bM(r){return new wM(r)}const vM=1e3;class SM{constructor(e){h(this,"resolvers");h(this,"cache");this.resolvers={},this.cache=bM(e.cacheSize??vM),Object.entries(e.resolvers??{}).forEach(([t,n])=>{Array.isArray(n)||(n=[n]),t.endsWith(".")||(t=`${t}.`),this.resolvers[t]=n}),this.resolvers["."]==null&&(this.resolvers["."]=pM())}async query(e,t={}){var c,l,u;const n=ov(t.types),i=t.cached!==!1?this.cache.get(e,n):void 0;if(i!=null)return(c=t.onProgress)==null||c.call(t,new Ar("dns:cache",{detail:i})),i;const s=`${e.split(".").pop()}.`,o=(this.resolvers[s]??this.resolvers["."]).sort(()=>Math.random()>.5?-1:1),a=[];for(const f of o){if(((l=t.signal)==null?void 0:l.aborted)===!0)break;try{const g=await f(e,{...t,types:n});for(const m of g.Answer)this.cache.add(e,m);return g}catch(g){a.push(g),(u=t.onProgress)==null||u.call(t,new Ar("dns:error",{detail:g}))}}throw a.length===1?a[0]:new AggregateError(a,`DNS lookup of ${e} ${n} failed`)}}var Qi;(function(r){r[r.A=1]="A",r[r.CNAME=5]="CNAME",r[r.TXT=16]="TXT",r[r.AAAA=28]="AAAA"})(Qi||(Qi={}));function EM(r={}){return new SM(r)}const Br=-1,l3={},xM={},AM=[[4,32,"ip4"],[6,16,"tcp"],[33,16,"dccp"],[41,128,"ip6"],[42,Br,"ip6zone"],[43,8,"ipcidr"],[53,Br,"dns",!0],[54,Br,"dns4",!0],[55,Br,"dns6",!0],[56,Br,"dnsaddr",!0],[132,16,"sctp"],[273,16,"udp"],[275,0,"p2p-webrtc-star"],[276,0,"p2p-webrtc-direct"],[277,0,"p2p-stardust"],[280,0,"webrtc-direct"],[281,0,"webrtc"],[290,0,"p2p-circuit"],[301,0,"udt"],[302,0,"utp"],[400,Br,"unix",!1,!0],[421,Br,"ipfs"],[421,Br,"p2p"],[443,0,"https"],[444,96,"onion"],[445,296,"onion3"],[446,Br,"garlic64"],[448,0,"tls"],[449,Br,"sni"],[460,0,"quic"],[461,0,"quic-v1"],[465,0,"webtransport"],[466,Br,"certhash"],[477,0,"ws"],[478,0,"wss"],[479,0,"p2p-websocket-star"],[480,0,"http"],[481,Br,"http-path"],[777,Br,"memory"]];AM.forEach(r=>{const e=_M(...r);xM[e.code]=e,l3[e.name]=e});function _M(r,e,t,n,i){return{code:r,size:e,name:t,resolvable:!!n,path:!!i}}function IM(r){{if(l3[r]!=null)return l3[r];throw new Error(`no protocol with name: ${r}`)}}const CM=32,{code:kM}=IM("dnsaddr");class TM extends Error{constructor(e="Max recursive depth reached"){super(e),this.name="RecursionLimitError"}}const lv=async function(e,t={}){const n=t.maxRecursiveDepth??CM;if(n===0)throw new TM("Max recursive depth reached");const[,i]=e.stringTuples().find(([l])=>l===kM)??[],o=await((t==null?void 0:t.dns)??EM()).query(`_dnsaddr.${i}`,{signal:t==null?void 0:t.signal,types:[Qi.TXT]}),a=e.getPeerId(),c=[];for(const l of o.Answer){const u=l.data.replace(/["']/g,"").trim().split("=")[1];if(u==null||a!=null&&!u.includes(a))continue;const f=Ze(u);if(u.startsWith("/dnsaddr")){const g=await f.resolve({...t,maxRecursiveDepth:n-1});c.push(...g.map(m=>m.toString()))}else c.push(f.toString())}return c},PM={addresses:{listen:[],announce:[],noAnnounce:[],announceFilter:r=>r},connectionManager:{resolvers:{dnsaddr:lv}},transportManager:{faultTolerance:mc.FATAL_ALL}};async function BM(r){var t,n;const e=sv(PM,r);if(e.connectionProtector===null&&((n=(t=globalThis.process)==null?void 0:t.env)==null?void 0:n.LIBP2P_FORCE_PNET)!=null)throw new ke("Private network is enforced, but no protector was provided");return e}const sa=1e3,oa=sa*60,aa=oa*60,Ks=aa*24,NM=Ks*7,OM=Ks*365.25;function uv(r,e){try{if(typeof r=="string"&&r.length>0)return RM(r);if(typeof r=="number"&&isFinite(r))return e!=null&&e.long?LM(r):DM(r);throw new Error("Value is not a string or number.")}catch(t){const n=MM(t)?`${t.message}. value=${JSON.stringify(r)}`:"An unknown error has occured.";throw new Error(n)}}function RM(r){if(r=String(r),r.length>100)throw new Error("Value exceeds the maximum length of 100 characters.");const e=/^(-?(?:\d+)?\.?\d+) *(milliseconds?|msecs?|ms|seconds?|secs?|s|minutes?|mins?|m|hours?|hrs?|h|days?|d|weeks?|w|years?|yrs?|y)?$/i.exec(r);if(!e)return NaN;const t=parseFloat(e[1]),n=(e[2]||"ms").toLowerCase();switch(n){case"years":case"year":case"yrs":case"yr":case"y":return t*OM;case"weeks":case"week":case"w":return t*NM;case"days":case"day":case"d":return t*Ks;case"hours":case"hour":case"hrs":case"hr":case"h":return t*aa;case"minutes":case"minute":case"mins":case"min":case"m":return t*oa;case"seconds":case"second":case"secs":case"sec":case"s":return t*sa;case"milliseconds":case"millisecond":case"msecs":case"msec":case"ms":return t;default:throw new Error(`The unit ${n} was matched, but no matching case exists.`)}}function DM(r){const e=Math.abs(r);return e>=Ks?`${Math.round(r/Ks)}d`:e>=aa?`${Math.round(r/aa)}h`:e>=oa?`${Math.round(r/oa)}m`:e>=sa?`${Math.round(r/sa)}s`:`${r}ms`}function LM(r){const e=Math.abs(r);return e>=Ks?nu(r,e,Ks,"day"):e>=aa?nu(r,e,aa,"hour"):e>=oa?nu(r,e,oa,"minute"):e>=sa?nu(r,e,sa,"second"):`${r} ms`}function nu(r,e,t,n){const i=e>=t*1.5;return`${Math.round(r/t)} ${n}${i?"s":""}`}function MM(r){return typeof r=="object"&&r!==null&&"message"in r}function UM(r){t.debug=t,t.default=t,t.coerce=c,t.disable=s,t.enable=i,t.enabled=o,t.humanize=uv,t.destroy=l,Object.keys(r).forEach(u=>{t[u]=r[u]}),t.names=[],t.skips=[],t.formatters={};function e(u){let f=0;for(let g=0;g<u.length;g++)f=(f<<5)-f+u.charCodeAt(g),f|=0;return t.colors[Math.abs(f)%t.colors.length]}t.selectColor=e;function t(u){let f,g=null,m,w;function x(...v){if(!x.enabled)return;const C=x,N=Number(new Date),O=N-(f||N);C.diff=O,C.prev=f,C.curr=N,f=N,v[0]=t.coerce(v[0]),typeof v[0]!="string"&&v.unshift("%O");let L=0;v[0]=v[0].replace(/%([a-zA-Z%])/g,(F,K)=>{if(F==="%%")return"%";L++;const H=t.formatters[K];if(typeof H=="function"){const P=v[L];F=H.call(C,P),v.splice(L,1),L--}return F}),t.formatArgs.call(C,v),(C.log||t.log).apply(C,v)}return x.namespace=u,x.useColors=t.useColors(),x.color=t.selectColor(u),x.extend=n,x.destroy=t.destroy,Object.defineProperty(x,"enabled",{enumerable:!0,configurable:!1,get:()=>g!==null?g:(m!==t.namespaces&&(m=t.namespaces,w=t.enabled(u)),w),set:v=>{g=v}}),typeof t.init=="function"&&t.init(x),x}function n(u,f){const g=t(this.namespace+(typeof f>"u"?":":f)+u);return g.log=this.log,g}function i(u){t.save(u),t.namespaces=u,t.names=[],t.skips=[];let f;const g=(typeof u=="string"?u:"").split(/[\s,]+/),m=g.length;for(f=0;f<m;f++)g[f]&&(u=g[f].replace(/\*/g,".*?"),u[0]==="-"?t.skips.push(new RegExp("^"+u.substr(1)+"$")):t.names.push(new RegExp("^"+u+"$")))}function s(){const u=[...t.names.map(a),...t.skips.map(a).map(f=>"-"+f)].join(",");return t.enable(""),u}function o(u){if(u[u.length-1]==="*")return!0;let f,g;for(f=0,g=t.skips.length;f<g;f++)if(t.skips[f].test(u))return!1;for(f=0,g=t.names.length;f<g;f++)if(t.names[f].test(u))return!0;return!1}function a(u){return u.toString().substring(2,u.toString().length-2).replace(/\.\*\?$/,"*")}function c(u){return u instanceof Error?u.stack??u.message:u}function l(){console.warn("Instance method `debug.destroy()` is deprecated and no longer does anything. It will be removed in the next major version of `debug`.")}return t.setupFormatters(t.formatters),t.enable(t.load()),t}var FM={};const Pn=zM(),$M=["#0000CC","#0000FF","#0033CC","#0033FF","#0066CC","#0066FF","#0099CC","#0099FF","#00CC00","#00CC33","#00CC66","#00CC99","#00CCCC","#00CCFF","#3300CC","#3300FF","#3333CC","#3333FF","#3366CC","#3366FF","#3399CC","#3399FF","#33CC00","#33CC33","#33CC66","#33CC99","#33CCCC","#33CCFF","#6600CC","#6600FF","#6633CC","#6633FF","#66CC00","#66CC33","#9900CC","#9900FF","#9933CC","#9933FF","#99CC00","#99CC33","#CC0000","#CC0033","#CC0066","#CC0099","#CC00CC","#CC00FF","#CC3300","#CC3333","#CC3366","#CC3399","#CC33CC","#CC33FF","#CC6600","#CC6633","#CC9900","#CC9933","#CCCC00","#CCCC33","#FF0000","#FF0033","#FF0066","#FF0099","#FF00CC","#FF00FF","#FF3300","#FF3333","#FF3366","#FF3399","#FF33CC","#FF33FF","#FF6600","#FF6633","#FF9900","#FF9933","#FFCC00","#FFCC33"];function VM(){var r,e,t,n,i;return typeof window<"u"&&window.process&&(window.process.type==="renderer"||window.process.__nwjs)?!0:typeof navigator<"u"&&((r=navigator.userAgent)==null?void 0:r.toLowerCase().match(/(edge|trident)\/(\d+)/))!=null?!1:typeof document<"u"&&((t=(e=document.documentElement)==null?void 0:e.style)==null?void 0:t.WebkitAppearance)||typeof window<"u"&&window.console&&(window.console.firebug||window.console.exception&&window.console.table)||typeof navigator<"u"&&((n=navigator.userAgent)==null?void 0:n.toLowerCase().match(/firefox\/(\d+)/))!=null&&parseInt(RegExp.$1,10)>=31||typeof navigator<"u"&&((i=navigator.userAgent)==null?void 0:i.toLowerCase().match(/applewebkit\/(\d+)/))}function qM(r){if(r[0]=(this.useColors?"%c":"")+this.namespace+(this.useColors?" %c":" ")+r[0]+(this.useColors?"%c ":" ")+"+"+uv(this.diff),!this.useColors)return;const e="color: "+this.color;r.splice(1,0,e,"color: inherit");let t=0,n=0;r[0].replace(/%[a-zA-Z%]/g,i=>{i!=="%%"&&(t++,i==="%c"&&(n=t))}),r.splice(n,0,e)}const KM=console.debug??console.log??(()=>{});function HM(r){try{r?Pn==null||Pn.setItem("debug",r):Pn==null||Pn.removeItem("debug")}catch{}}function jM(){let r;try{r=Pn==null?void 0:Pn.getItem("debug")}catch{}return!r&&typeof globalThis.process<"u"&&"env"in globalThis.process&&(r=FM.DEBUG),r}function zM(){try{return localStorage}catch{}}function WM(r){r.j=function(e){try{return JSON.stringify(e)}catch(t){return"[UnexpectedJSONParseError]: "+t.message}}}const Lr=UM({formatArgs:qM,save:HM,load:jM,useColors:VM,setupFormatters:WM,colors:$M,storage:Pn,log:KM});Lr.formatters.b=r=>r==null?"undefined":Rt.baseEncode(r);Lr.formatters.t=r=>r==null?"undefined":Fi.baseEncode(r);Lr.formatters.m=r=>r==null?"undefined":G9.baseEncode(r);Lr.formatters.p=r=>r==null?"undefined":r.toString();Lr.formatters.c=r=>r==null?"undefined":r.toString();Lr.formatters.k=r=>r==null?"undefined":r.toString();Lr.formatters.a=r=>r==null?"undefined":r.toString();Lr.formatters.e=r=>r==null?"undefined":lg(r.stack)??lg(r.message)??r.toString();function GM(r){const e=()=>{};return e.enabled=!1,e.color="",e.diff=0,e.log=()=>{},e.namespace=r,e.destroy=()=>!0,e.extend=()=>e,e}function hv(){return{forComponent(r){return QM(r)}}}function QM(r){let e=GM(`${r}:trace`);return Lr.enabled(`${r}:trace`)&&Lr.names.map(t=>t.toString()).find(t=>t.includes(":trace"))!=null&&(e=Lr(`${r}:trace`)),Object.assign(Lr(r),{error:Lr(`${r}:error`),trace:e})}function lg(r){if(r!=null&&(r=r.trim(),r.length!==0))return r}var Yd;let Hc=(Yd=class extends Error{constructor(t="The operation was aborted",...n){super(t,...n);h(this,"name","AbortError")}},h(Yd,"name","AbortError"),Yd);class fv extends Error{constructor(e="The queue was full"){super(e),this.name="QueueFullError"}}h(fv,"name","QueueFullError");class YM{constructor(e){h(this,"deferred");h(this,"signal");var t;this.signal=e,this.deferred=Promise.withResolvers(),this.onAbort=this.onAbort.bind(this),(t=this.signal)==null||t.addEventListener("abort",this.onAbort)}onAbort(){var e;this.deferred.reject(((e=this.signal)==null?void 0:e.reason)??new Hc)}cleanup(){var e;(e=this.signal)==null||e.removeEventListener("abort",this.onAbort)}}function ZM(){return`${parseInt(String(Math.random()*1e9),10).toString()}${Date.now()}`}class XM{constructor(e,t){h(this,"id");h(this,"fn");h(this,"options");h(this,"recipients");h(this,"status");h(this,"timeline");h(this,"controller");this.id=ZM(),this.status="queued",this.fn=e,this.options=t,this.recipients=[],this.timeline={created:Date.now()},this.controller=new AbortController,this.controller.signal,this.onAbort=this.onAbort.bind(this)}abort(e){this.controller.abort(e)}onAbort(){this.recipients.reduce((t,n)=>{var i;return t&&((i=n.signal)==null?void 0:i.aborted)===!0},!0)&&(this.controller.abort(new Hc),this.cleanup())}async join(e={}){var n;const t=new YM(e.signal);return this.recipients.push(t),(n=e.signal)==null||n.addEventListener("abort",this.onAbort),t.deferred.promise}async run(){this.status="running",this.timeline.started=Date.now();try{this.controller.signal.throwIfAborted();const e=await Ht(this.fn({...this.options??{},signal:this.controller.signal}),this.controller.signal);this.recipients.forEach(t=>{t.deferred.resolve(e)}),this.status="complete"}catch(e){this.recipients.forEach(t=>{t.deferred.reject(e)}),this.status="errored"}finally{this.timeline.finished=Date.now(),this.cleanup()}}cleanup(){this.recipients.forEach(e=>{var t;e.cleanup(),(t=e.signal)==null||t.removeEventListener("abort",this.onAbort)})}}function ug(r,e){let t;const n=function(){const i=function(){t=void 0,r()};clearTimeout(t),t=setTimeout(i,e)};return n.start=()=>{},n.stop=()=>{clearTimeout(t)},n}class hg extends or{constructor(t={}){super();h(this,"concurrency");h(this,"maxSize");h(this,"queue");h(this,"pending");h(this,"sort");h(this,"autoStart");this.concurrency=t.concurrency??Number.POSITIVE_INFINITY,this.maxSize=t.maxSize??Number.POSITIVE_INFINITY,this.pending=0,this.autoStart=t.autoStart??!0,this.sort=t.sort,this.queue=[],this.emitEmpty=ug(this.emitEmpty.bind(this),1),this.emitIdle=ug(this.emitIdle.bind(this),1)}[Symbol.asyncIterator](){return this.toGenerator()}emitEmpty(){this.size===0&&this.safeDispatchEvent("empty")}emitIdle(){this.running===0&&this.safeDispatchEvent("idle")}tryToStartAnother(){if(this.size===0)return this.emitEmpty(),this.running===0&&this.emitIdle(),!1;if(this.pending<this.concurrency){let t;for(const n of this.queue)if(n.status==="queued"){t=n;break}return t==null?!1:(this.safeDispatchEvent("active"),this.pending++,t.run().finally(()=>{for(let n=0;n<this.queue.length;n++)if(this.queue[n]===t){this.queue.splice(n,1);break}this.pending--,this.safeDispatchEvent("next"),this.autoStart&&this.tryToStartAnother()}),!0)}return!1}enqueue(t){this.queue.push(t),this.sort!=null&&this.queue.sort(this.sort)}start(){this.autoStart===!1&&(this.autoStart=!0,this.tryToStartAnother())}pause(){this.autoStart=!1}async add(t,n){var s;if((s=n==null?void 0:n.signal)==null||s.throwIfAborted(),this.size===this.maxSize)throw new fv;const i=new XM(t,n);return this.enqueue(i),this.safeDispatchEvent("add"),this.autoStart&&this.tryToStartAnother(),i.join(n).then(o=>(this.safeDispatchEvent("success",{detail:{job:i,result:o}}),o)).catch(o=>{if(i.status==="queued"){for(let a=0;a<this.queue.length;a++)if(this.queue[a]===i){this.queue.splice(a,1);break}}throw this.safeDispatchEvent("failure",{detail:{job:i,error:o}}),o})}clear(){this.queue.splice(0,this.queue.length)}abort(){this.queue.forEach(t=>{t.abort(new Hc)}),this.clear()}async onEmpty(t){this.size!==0&&await Ln(this,"empty",t==null?void 0:t.signal)}async onSizeLessThan(t,n){this.size<t||await Ln(this,"next",n==null?void 0:n.signal,{filter:()=>this.size<t})}async onIdle(t){this.pending===0&&this.size===0||await Ln(this,"idle",t==null?void 0:t.signal)}get size(){return this.queue.length}get queued(){return this.queue.length-this.pending}get running(){return this.pending}async*toGenerator(t){var l,u,f;(l=t==null?void 0:t.signal)==null||l.throwIfAborted();const n=bi({objectMode:!0}),i=g=>{g!=null?this.abort():this.clear(),n.end(g)},s=g=>{g.detail!=null&&n.push(g.detail.result)},o=g=>{i(g.detail.error)},a=()=>{i()},c=()=>{i(new Hc("Queue aborted"))};this.addEventListener("success",s),this.addEventListener("failure",o),this.addEventListener("idle",a),(u=t==null?void 0:t.signal)==null||u.addEventListener("abort",c);try{yield*n}finally{this.removeEventListener("success",s),this.removeEventListener("failure",o),this.removeEventListener("idle",a),(f=t==null?void 0:t.signal)==null||f.removeEventListener("abort",c),i()}}}const dv="lock:worker:request-read",pv="lock:worker:abort-read-request",gv="lock:worker:release-read",mv="lock:master:grant-read",yv="lock:master:error-read",wv="lock:worker:request-write",bv="lock:worker:abort-write-request",vv="lock:worker:release-write",Sv="lock:master:grant-write",Ev="lock:master:error-write",xv="lock:worker:finalize",Av="mortice",JM={singleProcess:!1},fg=(r,e,t,n,i,s,o,a,c)=>l=>{if(l.data==null)return;const u={type:l.data.type,name:l.data.name,identifier:l.data.identifier};u.type===i&&r.safeDispatchEvent(t,{detail:{name:u.name,identifier:u.identifier,handler:async()=>{e.postMessage({type:c,name:u.name,identifier:u.identifier}),await new Promise(f=>{const g=m=>{if((m==null?void 0:m.data)==null)return;const w={type:m.data.type,name:m.data.name,identifier:m.data.identifier};w.type===a&&w.identifier===u.identifier&&(e.removeEventListener("message",g),f())};e.addEventListener("message",g)})},onError:f=>{e.postMessage({type:o,name:u.name,identifier:u.identifier,error:{message:f.message,name:f.name,stack:f.stack}})}}}),u.type===s&&r.safeDispatchEvent(n,{detail:{name:u.name,identifier:u.identifier}}),u.type===xv&&r.safeDispatchEvent("finalizeRequest",{detail:{name:u.name}})},eU=(r=10)=>Math.random().toString().substring(2,r+2);class tU{constructor(e){h(this,"name");h(this,"channel");this.name=e,this.channel=new BroadcastChannel(Av)}readLock(e){return this.sendRequest(dv,pv,mv,yv,gv,e)}writeLock(e){return this.sendRequest(wv,bv,Sv,Ev,vv,e)}finalize(){this.channel.postMessage({type:xv,name:this.name}),this.channel.close()}async sendRequest(e,t,n,i,s,o){var c;(c=o==null?void 0:o.signal)==null||c.throwIfAborted();const a=eU();return this.channel.postMessage({type:e,identifier:a,name:this.name}),new Promise((l,u)=>{var m;const f=()=>{this.channel.postMessage({type:t,identifier:a,name:this.name})};(m=o==null?void 0:o.signal)==null||m.addEventListener("abort",f,{once:!0});const g=w=>{var x,v,C,N;if(((x=w.data)==null?void 0:x.identifier)===a&&(((v=w.data)==null?void 0:v.type)===n&&(this.channel.removeEventListener("message",g),(C=o==null?void 0:o.signal)==null||C.removeEventListener("abort",f),l(()=>{this.channel.postMessage({type:s,identifier:a,name:this.name})})),w.data.type===i)){this.channel.removeEventListener("message",g),(N=o==null?void 0:o.signal)==null||N.removeEventListener("abort",f);const O=new Error;w.data.error!=null&&(O.message=w.data.error.message,O.name=w.data.error.name,O.stack=w.data.error.stack),u(O)}};this.channel.addEventListener("message",g)})}}const rU=r=>{if(r=Object.assign({},JM,r),!!globalThis.document||r.singleProcess){const t=new BroadcastChannel(Av),n=new or;return t.addEventListener("message",fg(n,t,"requestReadLock","abortReadLockRequest",dv,pv,yv,gv,mv)),t.addEventListener("message",fg(n,t,"requestWriteLock","abortWriteLockRequest",wv,bv,Ev,vv,Sv)),n}return new tU(r.name)},ds=new Map;let La;function _v(r){return typeof(r==null?void 0:r.readLock)=="function"&&typeof(r==null?void 0:r.writeLock)=="function"}function nU(r){if(La==null&&(La=rU(r),!_v(La))){const e=La;e.addEventListener("requestReadLock",t=>{const n=t.detail.name,i=t.detail.identifier,s=ds.get(n);if(s==null)return;const o=new AbortController,a=c=>{c.detail.name!==n||c.detail.identifier!==i||o.abort()};e.addEventListener("abortReadLockRequest",a),s.readLock({signal:o.signal}).then(async c=>{await t.detail.handler().finally(()=>{c()})}).catch(c=>{t.detail.onError(c)}).finally(()=>{e.removeEventListener("abortReadLockRequest",a)})}),e.addEventListener("requestWriteLock",t=>{const n=t.detail.name,i=t.detail.identifier,s=ds.get(n);if(s==null)return;const o=new AbortController,a=c=>{c.detail.name!==n||c.detail.identifier!==i||o.abort()};e.addEventListener("abortWriteLockRequest",a),s.writeLock({signal:o.signal}).then(async c=>{await t.detail.handler().finally(()=>{c()})}).catch(c=>{t.detail.onError(c)}).finally(()=>{e.removeEventListener("abortWriteLockRequest",a)})}),e.addEventListener("finalizeRequest",t=>{const n=t.detail.name,i=ds.get(n);i!=null&&i.finalize()})}return La}async function kd(r,e){var o;let t,n;const i=new Promise((a,c)=>{t=a,n=c}),s=()=>{n(new Hc)};return(o=e==null?void 0:e.signal)==null||o.addEventListener("abort",s,{once:!0}),r.add(async()=>{await new Promise(a=>{t(()=>{var c;(c=e==null?void 0:e.signal)==null||c.removeEventListener("abort",s),a()})})},{signal:e==null?void 0:e.signal}).catch(a=>{n(a)}),i}const iU=(r,e)=>{let t=ds.get(r);if(t!=null)return t;const n=nU(e);if(_v(n))return t=n,ds.set(r,t),t;const i=new hg({concurrency:1});let s;return t={async readLock(o){if(s!=null)return kd(s,o);s=new hg({concurrency:e.concurrency,autoStart:!1});const a=s,c=kd(s,o);return i.add(async()=>{a.start(),await a.onIdle().then(()=>{s===a&&(s=null)})}),c},async writeLock(o){return s=null,kd(i,o)},finalize:()=>{ds.delete(r)},queue:i},ds.set(r,t),e.autoFinalize===!0&&i.addEventListener("idle",()=>{t.finalize()},{once:!0}),t},sU={name:"lock",concurrency:1/0,singleProcess:!1,autoFinalize:!1};function oU(r){const e=Object.assign({},sU,r);return iU(e.name,e)}const aU=36e5,cU=216e5;var ps;(function(r){(function(t){let n;t.codec=()=>(n==null&&(n=lt((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&i.value.byteLength>0&&(s.uint32(18),s.bytes(i.value)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{const a={key:"",value:dt(0)},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const l=i.uint32();switch(l>>>3){case 1:{a.key=i.string();break}case 2:{a.value=i.bytes();break}default:{i.skipType(l&7);break}}}return a})),n),t.encode=i=>ct(i,t.codec()),t.decode=(i,s)=>at(i,t.codec(),s)})(r.Peer$metadataEntry||(r.Peer$metadataEntry={})),function(t){let n;t.codec=()=>(n==null&&(n=lt((i,s,o={})=>{o.lengthDelimited!==!1&&s.fork(),i.key!=null&&i.key!==""&&(s.uint32(10),s.string(i.key)),i.value!=null&&(s.uint32(18),rh.codec().encode(i.value,s)),o.lengthDelimited!==!1&&s.ldelim()},(i,s,o={})=>{var l;const a={key:""},c=s==null?i.len:i.pos+s;for(;i.pos<c;){const u=i.uint32();switch(u>>>3){case 1:{a.key=i.string();break}case 2:{a.value=rh.codec().decode(i,i.uint32(),{limits:(l=o.limits)==null?void 0:l.value});break}default:{i.skipType(u&7);break}}}return a})),n),t.encode=i=>ct(i,t.codec()),t.decode=(i,s)=>at(i,t.codec(),s)}(r.Peer$tagsEntry||(r.Peer$tagsEntry={}));let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{if(i.lengthDelimited!==!1&&n.fork(),t.addresses!=null)for(const s of t.addresses)n.uint32(10),th.codec().encode(s,n);if(t.protocols!=null)for(const s of t.protocols)n.uint32(18),n.string(s);if(t.publicKey!=null&&(n.uint32(34),n.bytes(t.publicKey)),t.peerRecordEnvelope!=null&&(n.uint32(42),n.bytes(t.peerRecordEnvelope)),t.metadata!=null&&t.metadata.size!==0)for(const[s,o]of t.metadata.entries())n.uint32(50),r.Peer$metadataEntry.codec().encode({key:s,value:o},n);if(t.tags!=null&&t.tags.size!==0)for(const[s,o]of t.tags.entries())n.uint32(58),r.Peer$tagsEntry.codec().encode({key:s,value:o},n);t.updated!=null&&(n.uint32(64),n.uint64Number(t.updated)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{var a,c,l,u,f,g;const s={addresses:[],protocols:[],metadata:new Map,tags:new Map},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const m=t.uint32();switch(m>>>3){case 1:{if(((a=i.limits)==null?void 0:a.addresses)!=null&&s.addresses.length===i.limits.addresses)throw new Dt('Decode error - map field "addresses" had too many elements');s.addresses.push(th.codec().decode(t,t.uint32(),{limits:(c=i.limits)==null?void 0:c.addresses$}));break}case 2:{if(((l=i.limits)==null?void 0:l.protocols)!=null&&s.protocols.length===i.limits.protocols)throw new Dt('Decode error - map field "protocols" had too many elements');s.protocols.push(t.string());break}case 4:{s.publicKey=t.bytes();break}case 5:{s.peerRecordEnvelope=t.bytes();break}case 6:{if(((u=i.limits)==null?void 0:u.metadata)!=null&&s.metadata.size===i.limits.metadata)throw new v6('Decode error - map field "metadata" had too many elements');const w=r.Peer$metadataEntry.codec().decode(t,t.uint32());s.metadata.set(w.key,w.value);break}case 7:{if(((f=i.limits)==null?void 0:f.tags)!=null&&s.tags.size===i.limits.tags)throw new v6('Decode error - map field "tags" had too many elements');const w=r.Peer$tagsEntry.codec().decode(t,t.uint32(),{limits:{value:(g=i.limits)==null?void 0:g.tags$value}});s.tags.set(w.key,w.value);break}case 8:{s.updated=t.uint64Number();break}default:{t.skipType(m&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(ps||(ps={}));var th;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.multiaddr!=null&&t.multiaddr.byteLength>0&&(n.uint32(10),n.bytes(t.multiaddr)),t.isCertified!=null&&(n.uint32(16),n.bool(t.isCertified)),t.observed!=null&&(n.uint32(24),n.uint64Number(t.observed)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={multiaddr:dt(0)},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.multiaddr=t.bytes();break}case 2:{s.isCertified=t.bool();break}case 3:{s.observed=t.uint64Number();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(th||(th={}));var rh;(function(r){let e;r.codec=()=>(e==null&&(e=lt((t,n,i={})=>{i.lengthDelimited!==!1&&n.fork(),t.value!=null&&t.value!==0&&(n.uint32(8),n.uint32(t.value)),t.expiry!=null&&(n.uint32(16),n.uint64(t.expiry)),i.lengthDelimited!==!1&&n.ldelim()},(t,n,i={})=>{const s={value:0},o=n==null?t.len:t.pos+n;for(;t.pos<o;){const a=t.uint32();switch(a>>>3){case 1:{s.value=t.uint32();break}case 2:{s.expiry=t.uint64();break}default:{t.skipType(a&7);break}}}return s})),e),r.encode=t=>ct(t,r.codec()),r.decode=(t,n)=>at(t,r.codec(),n)})(rh||(rh={}));function lU(r,e){if(r.publicKey!=null||e.publicKey==null)return r;let t;r.type==="RSA"&&(t=r.toMultihash());const n=tn(e.publicKey,t);return Is(n)}function uU(r,e,t){const n=ps.decode(e);return $a(r,n,t)}function $a(r,e,t){const n=new Map,i=BigInt(Date.now());for(const[s,o]of e.tags.entries())o.expiry!=null&&o.expiry<i||n.set(s,o);return{...e,id:lU(r,e),addresses:e.addresses.filter(({observed:s})=>s!=null&&s>Date.now()-t).map(({multiaddr:s,isCertified:o})=>({multiaddr:Ze(s),isCertified:o??!1})),metadata:e.metadata,peerRecordEnvelope:e.peerRecordEnvelope??void 0,tags:n}}function hU(r,e){return fU(r.addresses,e.addresses)&&dU(r.protocols,e.protocols)&&pU(r.publicKey,e.publicKey)&&gU(r.peerRecordEnvelope,e.peerRecordEnvelope)&&mU(r.metadata,e.metadata)&&yU(r.tags,e.tags)}function fU(r,e){return Cv(r,e,(t,n)=>!(t.isCertified!==n.isCertified||!pt(t.multiaddr,n.multiaddr)))}function dU(r,e){return Cv(r,e,(t,n)=>t===n)}function pU(r,e){return Iv(r,e)}function gU(r,e){return Iv(r,e)}function mU(r,e){return kv(r,e,(t,n)=>pt(t,n))}function yU(r,e){return kv(r,e,(t,n)=>t.value===n.value&&t.expiry===n.expiry)}function Iv(r,e){return r==null&&e==null?!0:r!=null&&e!=null?pt(r,e):!1}function Cv(r,e,t){if(r.length!==e.length)return!1;for(let n=0;n<r.length;n++)if(!t(r[n],e[n]))return!1;return!0}function kv(r,e,t){if(r.size!==e.size)return!1;for(const[n,i]of r.entries()){const s=e.get(n);if(s==null||!t(i,s))return!1}return!0}const Tv="/peers/";function iu(r){if(!Ya(r)||r.type==null)throw new ke("Invalid PeerId");const e=r.toCID().toString();return new Ut(`${Tv}${e}`)}async function wU(r,e,t,n,i){const s=new Map;for(const o of t){if(o==null)continue;if(o.multiaddr instanceof Uint8Array&&(o.multiaddr=Ze(o.multiaddr)),!Ch(o.multiaddr))throw new ke("Multiaddr was invalid");if(!await e(r,o.multiaddr,i))continue;const a=o.isCertified??!1,c=o.multiaddr.toString(),l=s.get(c);l!=null?o.isCertified=l.isCertified||a:s.set(c,{multiaddr:o.multiaddr,isCertified:a})}return[...s.values()].sort((o,a)=>o.multiaddr.toString().localeCompare(a.multiaddr.toString())).map(({isCertified:o,multiaddr:a})=>{const c=a.getPeerId();return r.equals(c)&&(a=a.decapsulate(Ze(`/p2p/${r}`))),{isCertified:o,multiaddr:a.bytes}})}async function Td(r,e,t,n){var g,m;if(e==null)throw new ke("Invalid PeerData");if(e.publicKey!=null&&r.publicKey!=null&&!e.publicKey.equals(r.publicKey))throw new ke("publicKey bytes do not match peer id publicKey bytes");const i=(g=n.existingPeer)==null?void 0:g.peer;if(i!=null&&!r.equals(i.id))throw new ke("peer id did not match existing peer id");let s=(i==null?void 0:i.addresses)??[],o=new Set((i==null?void 0:i.protocols)??[]),a=(i==null?void 0:i.metadata)??new Map,c=(i==null?void 0:i.tags)??new Map,l=i==null?void 0:i.peerRecordEnvelope;if(t==="patch"){if((e.multiaddrs!=null||e.addresses!=null)&&(s=[],e.multiaddrs!=null&&s.push(...e.multiaddrs.map(w=>({isCertified:!1,multiaddr:w}))),e.addresses!=null&&s.push(...e.addresses)),e.protocols!=null&&(o=new Set(e.protocols)),e.metadata!=null){const w=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);a=su(w,{validate:dg})}if(e.tags!=null){const w=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags);c=su(w,{validate:pg,map:gg})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}if(t==="merge"){if(e.multiaddrs!=null&&s.push(...e.multiaddrs.map(w=>({isCertified:!1,multiaddr:w}))),e.addresses!=null&&s.push(...e.addresses),e.protocols!=null&&(o=new Set([...o,...e.protocols])),e.metadata!=null){const w=e.metadata instanceof Map?[...e.metadata.entries()]:Object.entries(e.metadata);for(const[x,v]of w)v==null?a.delete(x):a.set(x,v);a=su([...a.entries()],{validate:dg})}if(e.tags!=null){const w=e.tags instanceof Map?[...e.tags.entries()]:Object.entries(e.tags),x=new Map(c);for(const[v,C]of w)C==null?x.delete(v):x.set(v,C);c=su([...x.entries()],{validate:pg,map:gg})}e.peerRecordEnvelope!=null&&(l=e.peerRecordEnvelope)}let u;(i==null?void 0:i.id.publicKey)!=null?u=Yr(i.id.publicKey):e.publicKey!=null?u=Yr(e.publicKey):r.publicKey!=null&&(u=Yr(r.publicKey));const f={addresses:await wU(r,n.addressFilter??(async()=>!0),s,(m=n.existingPeer)==null?void 0:m.peerPB.addresses,n),protocols:[...o.values()].sort((w,x)=>w.localeCompare(x)),metadata:a,tags:c,publicKey:u,peerRecordEnvelope:l};return f.addresses.forEach(w=>{var x,v,C;w.observed=((C=(v=(x=n.existingPeer)==null?void 0:x.peerPB.addresses)==null?void 0:v.find(N=>pt(N.multiaddr,N.multiaddr)))==null?void 0:C.observed)??Date.now()}),r.type!=="RSA"&&delete f.publicKey,f}function su(r,e){var n;const t=new Map;for(const[i,s]of r)s!=null&&e.validate(i,s);for(const[i,s]of r.sort(([o],[a])=>o.localeCompare(a)))s!=null&&t.set(i,((n=e.map)==null?void 0:n.call(e,i,s))??s);return t}function dg(r,e){if(typeof r!="string")throw new ke("Metadata key must be a string");if(!(e instanceof Uint8Array))throw new ke("Metadata value must be a Uint8Array")}function pg(r,e){if(typeof r!="string")throw new ke("Tag name must be a string");if(e.value!=null){if(parseInt(`${e.value}`,10)!==e.value)throw new ke("Tag value must be an integer");if(e.value<0||e.value>100)throw new ke("Tag value must be between 0-100")}if(e.ttl!=null){if(parseInt(`${e.ttl}`,10)!==e.ttl)throw new ke("Tag ttl must be an integer");if(e.ttl<0)throw new ke("Tag ttl must be between greater than 0")}}function gg(r,e){let t;e.expiry!=null&&(t=e.expiry),e.ttl!=null&&(t=BigInt(Date.now()+Number(e.ttl)));const n={value:e.value??0};return t!=null&&(n.expiry=t),n}function Pv(r){const e=r.toString().split("/")[2],t=it.parse(e,Fi);return al(t)}function Pd(r,e,t){const n=Pv(r);return uU(n,e,t)}function bU(r,e){return{prefix:Tv,filters:(r.filters??[]).map(t=>({key:n,value:i})=>t(Pd(n,i,e))),orders:(r.orders??[]).map(t=>(n,i)=>t(Pd(n.key,n.value,e),Pd(i.key,i.value,e)))}}var Cr,_u,Iu,Cu;class vU{constructor(e,t={}){ut(this,Cr);h(this,"peerId");h(this,"datastore");h(this,"locks");h(this,"addressFilter");h(this,"log");h(this,"maxAddressAge");h(this,"maxPeerAge");this.log=e.logger.forComponent("libp2p:peer-store"),this.peerId=e.peerId,this.datastore=e.datastore,this.addressFilter=t.addressFilter,this.locks=Uy({name:"libp2p_peer_store_locks",metrics:e.metrics}),this.maxAddressAge=t.maxAddressAge??aU,this.maxPeerAge=t.maxPeerAge??cU}getLock(e){let t=this.locks.get(e);return t==null&&(t={refs:0,lock:oU({name:e.toString(),singleProcess:!0})},this.locks.set(e,t)),t.refs++,t}maybeRemoveLock(e,t){t.refs--,t.refs===0&&(t.lock.finalize(),this.locks.delete(e))}async getReadLock(e,t){const n=this.getLock(e);try{const i=await n.lock.readLock(t);return()=>{i(),this.maybeRemoveLock(e,n)}}catch(i){throw this.maybeRemoveLock(e,n),i}}async getWriteLock(e,t){const n=this.getLock(e);try{const i=await n.lock.writeLock(t);return()=>{i(),this.maybeRemoveLock(e,n)}}catch(i){throw this.maybeRemoveLock(e,n),i}}async has(e,t){try{return await this.load(e,t),!0}catch(n){if(n.name!=="NotFoundError")throw n}return!1}async delete(e,t){this.peerId.equals(e)||await this.datastore.delete(iu(e),t)}async load(e,t){const n=iu(e),i=await this.datastore.get(n,t),s=ps.decode(i);if(Ke(this,Cr,Cu).call(this,e,s))throw await this.datastore.delete(n,t),new zr;return $a(e,s,this.peerId.equals(e)?1/0:this.maxAddressAge)}async save(e,t,n){const i=await Ke(this,Cr,_u).call(this,e,n),s=await Td(e,t,"patch",{...n,addressFilter:this.addressFilter});return Ke(this,Cr,Iu).call(this,e,s,i)}async patch(e,t,n){const i=await Ke(this,Cr,_u).call(this,e,n),s=await Td(e,t,"patch",{...n,addressFilter:this.addressFilter,existingPeer:i});return Ke(this,Cr,Iu).call(this,e,s,i)}async merge(e,t,n){const i=await Ke(this,Cr,_u).call(this,e,n),s=await Td(e,t,"merge",{addressFilter:this.addressFilter,existingPeer:i});return Ke(this,Cr,Iu).call(this,e,s,i)}async*all(e){for await(const{key:t,value:n}of this.datastore.query(bU(e??{},this.maxAddressAge),e)){const i=Pv(t);if(i.equals(this.peerId))continue;const s=ps.decode(n);if(Ke(this,Cr,Cu).call(this,i,s)){await this.datastore.delete(t,e);continue}yield $a(i,s,this.peerId.equals(i)?1/0:this.maxAddressAge)}}}Cr=new WeakSet,_u=async function(e,t){try{const n=iu(e),i=await this.datastore.get(n,t),s=ps.decode(i);if(Ke(this,Cr,Cu).call(this,e,s))throw await this.datastore.delete(n,t),new zr;return{peerPB:s,peer:$a(e,s,this.maxAddressAge)}}catch(n){n.name!=="NotFoundError"&&this.log.error("invalid peer data found in peer store - %e",n)}},Iu=async function(e,t,n,i){t.updated=Date.now();const s=ps.encode(t);return await this.datastore.put(iu(e),s,i),{peer:$a(e,t,this.maxAddressAge),previous:n==null?void 0:n.peer,updated:n==null||!hU(t,n.peerPB)}},Cu=function(e,t){if(t.updated==null)return!0;if(this.peerId.equals(e))return!1;const n=t.updated<Date.now()-this.maxPeerAge,i=Date.now()-this.maxAddressAge,s=t.addresses.filter(o=>o.observed!=null&&o.observed>i);return n&&s.length===0};var g7,No,ku;g7=Symbol.toStringTag;class SU{constructor(e,t={}){ut(this,No);h(this,"store");h(this,"events");h(this,"peerId");h(this,"log");h(this,g7,"@libp2p/peer-store");this.log=e.logger.forComponent("libp2p:peer-store"),this.events=e.events,this.peerId=e.peerId,this.store=new vU(e,t)}async forEach(e,t){for await(const n of this.store.all(t))e(n)}async all(e){return b1(this.store.all(e))}async delete(e,t){const n=await this.store.getReadLock(e,t);try{await this.store.delete(e,t)}finally{n()}}async has(e,t){const n=await this.store.getReadLock(e,t);try{return await this.store.has(e,t)}finally{this.log.trace("has release read lock"),n==null||n()}}async get(e,t){const n=await this.store.getReadLock(e,t);try{return await this.store.load(e,t)}finally{n==null||n()}}async getInfo(e,t){const n=await this.get(e,t);return{id:n.id,multiaddrs:n.addresses.map(({multiaddr:i})=>i)}}async save(e,t,n){const i=await this.store.getWriteLock(e,n);try{const s=await this.store.save(e,t,n);return Ke(this,No,ku).call(this,e,s),s.peer}finally{i==null||i()}}async patch(e,t,n){const i=await this.store.getWriteLock(e,n);try{const s=await this.store.patch(e,t,n);return Ke(this,No,ku).call(this,e,s),s.peer}finally{i==null||i()}}async merge(e,t,n){const i=await this.store.getWriteLock(e,n);try{const s=await this.store.merge(e,t,n);return Ke(this,No,ku).call(this,e,s),s.peer}finally{i==null||i()}}async consumePeerRecord(e,t,n){const i=Ya(t)?t:Ya(t==null?void 0:t.expectedPeer)?t.expectedPeer:void 0,s=Ya(t)||t===void 0?n:t,o=await Ps.openAndCertify(e,ri.DOMAIN,s),a=al(o.publicKey.toCID());if((i==null?void 0:i.equals(a))===!1)return this.log("envelope peer id was not the expected peer id - expected: %p received: %p",i,a),!1;const c=ri.createFromProtobuf(o.payload);let l;try{l=await this.get(a,s)}catch(u){if(u.name!=="NotFoundError")throw u}if((l==null?void 0:l.peerRecordEnvelope)!=null){const u=Ps.createFromProtobuf(l.peerRecordEnvelope),f=ri.createFromProtobuf(u.payload);if(f.seqNumber>=c.seqNumber)return this.log("sequence number was lower or equal to existing sequence number - stored: %d received: %d",f.seqNumber,c.seqNumber),!1}return await this.patch(c.peerId,{peerRecordEnvelope:e,addresses:c.multiaddrs.map(u=>({isCertified:!0,multiaddr:u}))},s),!0}}No=new WeakSet,ku=function(e,t){t.updated&&(this.peerId.equals(e)?this.events.safeDispatchEvent("self:peer:update",{detail:t}):this.events.safeDispatchEvent("peer:update",{detail:t}))};function EU(r,e={}){return new SU(r,e)}const fo=class fo extends Error{constructor(t="Not Found"){super(t);h(this,"name",fo.name);h(this,"code",fo.code)}};h(fo,"name","NotFoundError"),h(fo,"code","ERR_NOT_FOUND");let u3=fo;function xU(r){return r[Symbol.asyncIterator]!=null}function io(r,e){let t=0;if(xU(r))return async function*(){for await(const c of r)await e(c,t++)&&(yield c)}();const n=f4(r),{value:i,done:s}=n.next();if(s===!0)return function*(){}();const o=e(i,t++);if(typeof o.then=="function")return async function*(){await o&&(yield i);for(const c of n)await e(c,t++)&&(yield c)}();const a=e;return function*(){o===!0&&(yield i);for(const c of n)a(c,t++)&&(yield c)}()}function AU(r){return r[Symbol.asyncIterator]!=null}function mg(r,e){return AU(r)?async function*(){yield*(await b1(r)).sort(e)}():function*(){yield*b1(r).sort(e)}()}class _U{put(e,t,n){return Promise.reject(new Error(".put is not implemented"))}get(e,t){return Promise.reject(new Error(".get is not implemented"))}has(e,t){return Promise.reject(new Error(".has is not implemented"))}delete(e,t){return Promise.reject(new Error(".delete is not implemented"))}async*putMany(e,t={}){for await(const{key:n,value:i}of e)await this.put(n,i,t),yield n}async*getMany(e,t={}){for await(const n of e)yield{key:n,value:await this.get(n,t)}}async*deleteMany(e,t={}){for await(const n of e)await this.delete(n,t),yield n}batch(){let e=[],t=[];return{put(n,i){e.push({key:n,value:i})},delete(n){t.push(n)},commit:async n=>{await _c(this.putMany(e,n)),e=[],await _c(this.deleteMany(t,n)),t=[]}}}async*_all(e,t){throw new Error("._all is not implemented")}async*_allKeys(e,t){throw new Error("._allKeys is not implemented")}query(e,t){let n=this._all(e,t);if(e.prefix!=null){const i=e.prefix;n=io(n,s=>s.key.toString().startsWith(i))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>io(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>mg(i,s),n)),e.offset!=null){let i=0;const s=e.offset;n=io(n,()=>i++>=s)}return e.limit!=null&&(n=K0(n,e.limit)),n}queryKeys(e,t){let n=this._allKeys(e,t);if(e.prefix!=null){const i=e.prefix;n=io(n,s=>s.toString().startsWith(i))}if(Array.isArray(e.filters)&&(n=e.filters.reduce((i,s)=>io(i,s),n)),Array.isArray(e.orders)&&(n=e.orders.reduce((i,s)=>mg(i,s),n)),e.offset!=null){const i=e.offset;let s=0;n=io(n,()=>s++>=i)}return e.limit!=null&&(n=K0(n,e.limit)),n}}class IU extends _U{constructor(){super();h(this,"data");this.data=new Map}put(t,n,i){var s;return(s=i==null?void 0:i.signal)==null||s.throwIfAborted(),this.data.set(t.toString(),n),t}get(t,n){var s;(s=n==null?void 0:n.signal)==null||s.throwIfAborted();const i=this.data.get(t.toString());if(i==null)throw new u3;return i}has(t,n){var i;return(i=n==null?void 0:n.signal)==null||i.throwIfAborted(),this.data.has(t.toString())}delete(t,n){var i;(i=n==null?void 0:n.signal)==null||i.throwIfAborted(),this.data.delete(t.toString())}*_all(t,n){var i,s;(i=n==null?void 0:n.signal)==null||i.throwIfAborted();for(const[o,a]of this.data.entries())yield{key:new Ut(o),value:a},(s=n==null?void 0:n.signal)==null||s.throwIfAborted()}*_allKeys(t,n){var i,s;(i=n==null?void 0:n.signal)==null||i.throwIfAborted();for(const o of this.data.keys())yield new Ut(o),(s=n==null?void 0:n.signal)==null||s.throwIfAborted()}}class CU extends Map{constructor(t){super();h(this,"metric");const{name:n,metrics:i}=t;this.metric=i.registerMetric(n),this.updateComponentMetric()}set(t,n){return super.set(t,n),this.updateComponentMetric(),this}delete(t){const n=super.delete(t);return this.updateComponentMetric(),n}clear(){super.clear(),this.updateComponentMetric()}updateComponentMetric(){this.metric.update(this.size)}}function mi(r){const{name:e,metrics:t}=r;let n;return t!=null?n=new CU({name:e,metrics:t}):n=new Map,n}const yg=864e13,kU=448,Bd=449,TU=53,PU=54,BU=55,NU=56;class OU{constructor(e,t={}){h(this,"log");h(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:dns-mappings"),this.mappings=mi({name:"libp2p_address_manager_dns_mappings",metrics:e.metrics})}has(e){const t=this.findHost(e);for(const n of this.mappings.values())if(n.domain===t)return!0;return!1}add(e,t){t.forEach(n=>{this.log("add DNS mapping %s to %s",n,e);const i=ha(n)===!0;this.mappings.set(n,{domain:e,verified:i,expires:i?yg-Date.now():0,lastVerified:i?yg-Date.now():void 0})})}remove(e){const t=this.findHost(e);let n=!1;for(const[i,s]of this.mappings.entries())s.domain===t&&(this.log("removing %s to %s DNS mapping %e",i,s.domain,new Error("where")),this.mappings.delete(i),n=n||s.verified);return n}getAll(e){const t=[];for(let n=0;n<e.length;n++){const s=e[n].multiaddr.stringTuples(),o=s[0][1];if(o!=null)for(const[a,c]of this.mappings.entries()){if(o!==a)continue;this.maybeAddSNITuple(s,c.domain)&&(e.splice(n,1),n--,t.push({multiaddr:Ze(`/${s.map(u=>[dr(u[0]).name,u[1]].join("/")).join("/")}`),verified:c.verified,type:"dns-mapping",expires:c.expires,lastVerified:c.lastVerified}))}}return t}maybeAddSNITuple(e,t){var n;for(let i=0;i<e.length;i++)if(e[i][0]===kU&&((n=e[i+1])==null?void 0:n[0])!==Bd)return e.splice(i+1,0,[Bd,t]),!0;return!1}confirm(e,t){const n=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===n&&(this.log("marking %s to %s DNS mapping as verified",s,o.domain),i=o.verified,o.verified=!0,o.expires=Date.now()+t,o.lastVerified=Date.now());return i}unconfirm(e,t){const n=this.findHost(e);let i=!1;for(const[s,o]of this.mappings.entries())o.domain===n&&(this.log("removing verification of %s to %s DNS mapping",s,o.domain),i=i||o.verified,o.verified=!1,o.expires=Date.now()+t);return i}findHost(e){for(const t of e.stringTuples())if(t[0]===Bd||t[0]===TU||t[0]===PU||t[0]===BU||t[0]===NU)return t[1]}}const Nd=4,Od=41,Rd=6,RU=273;class DU{constructor(e,t={}){h(this,"log");h(this,"mappings");this.log=e.logger.forComponent("libp2p:address-manager:ip-mappings"),this.mappings=mi({name:"libp2p_address_manager_ip_mappings",metrics:e.metrics})}has(e){const t=e.stringTuples();for(const n of this.mappings.values())for(const i of n)if(i.externalIp===t[0][1])return!0;return!1}add(e,t,n,i=t,s="tcp"){const o=`${e}-${t}-${s}`,a=this.mappings.get(o)??[],c={internalIp:e,internalPort:t,externalIp:n,externalPort:i,externalFamily:Cs(n)?4:6,protocol:s,verified:!1,expires:0};a.push(c),this.mappings.set(o,a)}remove(e){const t=e.stringTuples(),n=t[0][1]??"",i=t[1][0]===Rd?"tcp":"udp",s=parseInt(t[1][1]??"0");let o=!1;for(const[a,c]of this.mappings.entries()){for(let l=0;l<c.length;l++){const u=c[l];u.externalIp===n&&u.externalPort===s&&u.protocol===i&&(this.log("removing %s:%s to %s:%s %s IP mapping",u.externalIp,u.externalPort,n,s,i),o=o||u.verified,c.splice(l,1),l--)}c.length===0&&this.mappings.delete(a)}return o}getAll(e){const t=[];for(const{multiaddr:n}of e){const i=n.stringTuples();let s;if((i[0][0]===Nd||i[0][0]===Od)&&i[1][0]===Rd?s=`${i[0][1]}-${i[1][1]}-tcp`:(i[0][0]===Nd||i[0][0]===Od)&&i[1][0]===RU&&(s=`${i[0][1]}-${i[1][1]}-udp`),s==null)continue;const o=this.mappings.get(s);if(o!=null)for(const a of o)i[0][0]=a.externalFamily===4?Nd:Od,i[0][1]=a.externalIp,i[1][1]=`${a.externalPort}`,t.push({multiaddr:Ze(`/${i.map(c=>[dr(c[0]).name,c[1]].join("/")).join("/")}`),verified:a.verified,type:"ip-mapping",expires:a.expires,lastVerified:a.lastVerified})}return t}confirm(e,t){const i=e.stringTuples()[0][1];let s=!1;for(const o of this.mappings.values())for(const a of o)a.externalIp===i&&(this.log("marking %s to %s IP mapping as verified",a.internalIp,a.externalIp),s=a.verified,a.verified=!0,a.expires=Date.now()+t,a.lastVerified=Date.now());return s}unconfirm(e,t){const n=e.stringTuples(),i=n[0][1]??"",s=n[1][0]===Rd?"tcp":"udp",o=parseInt(n[1][1]??"0");let a=!1;for(const c of this.mappings.values())for(let l=0;l<c.length;l++){const u=c[l];u.externalIp===i&&u.externalPort===o&&u.protocol===s&&(this.log("removing verification of %s:%s to %s:%s %s IP mapping",u.externalIp,u.externalPort,i,o,s),a=a||u.verified,u.verified=!1,u.expires=Date.now()+t)}return a}}function LU(r){try{for(const{code:e,value:t}of r.getComponents())if(e!==ua&&t!=null){if(e===Ko)return t.startsWith("169.254.");if(e===On)return t.toLowerCase().startsWith("fe80")}}catch{}return!1}const MU={maxObservedAddresses:10};class UU{constructor(e,t={}){h(this,"log");h(this,"addresses");h(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=mi({name:"libp2p_address_manager_observed_addresses",metrics:e.metrics}),this.maxObservedAddresses=t.maxObservedAddresses??MU.maxObservedAddresses}has(e){return this.addresses.has(e.toString())}removePrefixed(e){for(const t of this.addresses.keys())t.toString().startsWith(e)&&this.addresses.delete(t)}add(e){this.addresses.size!==this.maxObservedAddresses&&(Cc(e)||LU(e)||(this.log("adding observed address %a",e),this.addresses.set(e.toString(),{verified:!1,expires:0})))}getAll(){return Array.from(this.addresses).map(([e,t])=>({multiaddr:Ze(e),verified:t.verified,type:"observed",expires:t.expires,lastVerified:t.lastVerified}))}remove(e){var n;const t=((n=this.addresses.get(e.toString()))==null?void 0:n.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(e.toString()),t}confirm(e,t){const n=e.toString(),i=this.addresses.get(n)??{verified:!1,expires:Date.now()+t,lastVerified:Date.now()},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.log("marking observed address %a as verified",n),this.addresses.set(n,i),s}}const FU=[Ko,On,p4,g4,Ih,m4];function wg(r){try{for(const{code:e}of r.getComponents())if(e!==ua)return FU.includes(e)}catch{}return!1}const $U={maxObservedAddresses:10};class VU{constructor(e,t={}){h(this,"log");h(this,"addresses");h(this,"maxObservedAddresses");this.log=e.logger.forComponent("libp2p:address-manager:observed-addresses"),this.addresses=mi({name:"libp2p_address_manager_transport_addresses",metrics:e.metrics}),this.maxObservedAddresses=t.maxObservedAddresses??$U.maxObservedAddresses}get(e,t){if(Cc(e))return{multiaddr:e,verified:!0,type:"transport",expires:Date.now()+t,lastVerified:Date.now()};const n=this.toKey(e);let i=this.addresses.get(n);return i==null&&(i={verified:!wg(e),expires:0},this.addresses.set(n,i)),{multiaddr:e,verified:i.verified,type:"transport",expires:i.expires,lastVerified:i.lastVerified}}has(e){const t=this.toKey(e);return this.addresses.has(t)}remove(e){var i;const t=this.toKey(e),n=((i=this.addresses.get(t))==null?void 0:i.verified)??!1;return this.log("removing observed address %a",e),this.addresses.delete(t),n}confirm(e,t){const n=this.toKey(e),i=this.addresses.get(n)??{verified:!1,expires:0,lastVerified:0},s=i.verified;return i.verified=!0,i.expires=Date.now()+t,i.lastVerified=Date.now(),this.addresses.set(n,i),s}unconfirm(e,t){const n=this.toKey(e),i=this.addresses.get(n)??{verified:!1,expires:0},s=i.verified;return i.verified=!1,i.expires=Date.now()+t,this.addresses.set(n,i),s}toKey(e){if(wg(e)){const t=e.toOptions();return`${t.host}-${t.port}-${t.transport}`}return e.toString()}}const bg=6e4,vg={addressVerificationTTL:bg*10,addressVerificationRetry:bg*5},qU=r=>r;function Dd(r,e){const t=r.getPeerId();return t!=null&&li(t).equals(e)&&(r=r.decapsulate(Ze(`/p2p/${e.toString()}`))),r}var m7;m7=Symbol.toStringTag;class KU{constructor(e,t={}){h(this,"log");h(this,"components");h(this,"listen");h(this,"announce");h(this,"appendAnnounce");h(this,"announceFilter");h(this,"observed");h(this,"dnsMappings");h(this,"ipMappings");h(this,"transportAddresses");h(this,"observedAddressFilter");h(this,"addressVerificationTTL");h(this,"addressVerificationRetry");h(this,m7,"@libp2p/address-manager");const{listen:n=[],announce:i=[],appendAnnounce:s=[]}=t;this.components=e,this.log=e.logger.forComponent("libp2p:address-manager"),this.listen=n.map(o=>o.toString()),this.announce=new Set(i.map(o=>o.toString())),this.appendAnnounce=new Set(s.map(o=>o.toString())),this.observed=new UU(e,t),this.dnsMappings=new OU(e,t),this.ipMappings=new DU(e,t),this.transportAddresses=new VU(e,t),this.announceFilter=t.announceFilter??qU,this.observedAddressFilter=v4(1024),this.addressVerificationTTL=t.addressVerificationTTL??vg.addressVerificationTTL,this.addressVerificationRetry=t.addressVerificationRetry??vg.addressVerificationRetry,this._updatePeerStoreAddresses=L0(this._updatePeerStoreAddresses.bind(this),1e3),e.events.addEventListener("transport:listening",()=>{this._updatePeerStoreAddresses()}),e.events.addEventListener("transport:close",()=>{this._updatePeerStoreAddresses()})}_updatePeerStoreAddresses(){const e=this.getAddresses().map(t=>t.getPeerId()===this.components.peerId.toString()?t.decapsulate(`/p2p/${this.components.peerId.toString()}`):t);this.components.peerStore.patch(this.components.peerId,{multiaddrs:e}).catch(t=>{this.log.error("error updating addresses",t)})}getListenAddrs(){return Array.from(this.listen).map(e=>Ze(e))}getAnnounceAddrs(){return Array.from(this.announce).map(e=>Ze(e))}getAppendAnnounceAddrs(){return Array.from(this.appendAnnounce).map(e=>Ze(e))}getObservedAddrs(){return this.observed.getAll().map(e=>e.multiaddr)}addObservedAddr(e){const t=e.stringTuples(),n=`${t[0][1]}:${t[1][1]}`;this.observedAddressFilter.has(n)||(this.observedAddressFilter.add(n),e=Dd(e,this.components.peerId),!this.ipMappings.has(e)&&(this.dnsMappings.has(e)||this.observed.add(e)))}confirmObservedAddr(e,t){e=Dd(e,this.components.peerId);let n=!0;((t==null?void 0:t.type)==="transport"||this.transportAddresses.has(e))&&!this.transportAddresses.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="dns-mapping"||this.dnsMappings.has(e))&&!this.dnsMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="ip-mapping"||this.ipMappings.has(e))&&!this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1),((t==null?void 0:t.type)==="observed"||this.observed.has(e))&&(this.maybeUpgradeToIPMapping(e)?(this.ipMappings.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL),n=!1):!this.observed.confirm(e,(t==null?void 0:t.ttl)??this.addressVerificationTTL)&&n&&(n=!1)),n||this._updatePeerStoreAddresses()}removeObservedAddr(e,t){e=Dd(e,this.components.peerId),this.observed.has(e)&&this.observed.remove(e),this.transportAddresses.has(e)&&this.transportAddresses.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.dnsMappings.has(e)&&this.dnsMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry),this.ipMappings.has(e)&&this.ipMappings.unconfirm(e,(t==null?void 0:t.ttl)??this.addressVerificationRetry)}getAddresses(){const e=new Set,t=this.getAddressesWithMetadata().filter(n=>{if(!n.verified)return!1;const i=n.multiaddr.toString();return e.has(i)?!1:(e.add(i),!0)}).map(n=>n.multiaddr);return this.announceFilter(t.map(n=>{const i=Ze(n),s=i.getComponents().pop();return(s==null?void 0:s.value)===this.components.peerId.toString()?i:i.encapsulate(`/p2p/${this.components.peerId.toString()}`)}))}getAddressesWithMetadata(){const e=this.getAnnounceAddrs();if(e.length>0)return this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(e)}),e.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()}));let t=[];t=t.concat(this.components.transportManager.getAddrs().map(i=>this.transportAddresses.get(i,this.addressVerificationTTL)));const n=this.getAppendAnnounceAddrs();return n.length>0&&(this.components.transportManager.getListeners().forEach(i=>{i.updateAnnounceAddrs(n)}),t=t.concat(n.map(i=>({multiaddr:i,verified:!0,type:"announce",expires:Date.now()+this.addressVerificationTTL,lastVerified:Date.now()})))),t=t.concat(this.observed.getAll()),t=t.concat(this.ipMappings.getAll(t)),t=t.concat(this.dnsMappings.getAll(t)),t}addDNSMapping(e,t){this.dnsMappings.add(e,t)}removeDNSMapping(e){this.dnsMappings.remove(Ze(`/dns/${e}`))&&this._updatePeerStoreAddresses()}addPublicAddressMapping(e,t,n,i=t,s="tcp"){this.ipMappings.add(e,t,n,i,s),this.observed.removePrefixed(`/ip${Cs(n)?4:6}/${n}/${s}/${i}`)}removePublicAddressMapping(e,t,n,i=t,s="tcp"){this.ipMappings.remove(Ze(`/ip${Cs(n)?4:6}/${n}/${s}/${i}`))&&this._updatePeerStoreAddresses()}maybeUpgradeToIPMapping(e){if(this.ipMappings.has(e))return!1;const t=e.toOptions();if(t.family===6||t.host==="127.0.0.1"||ha(t.host)===!0)return!1;const n=this.components.transportManager.getListeners(),i=[s=>Tc.exactMatch(s)||p1.exactMatch(s),s=>d1.exactMatch(s),s=>LB.exactMatch(s)];for(const s of i){if(!s(e))continue;const o=n.filter(l=>l.getAddrs().filter(u=>u.toOptions().family===4&&s(u)).length>0);if(o.length!==1)continue;const a=o[0].getAddrs().filter(l=>l.toOptions().host!=="127.0.0.1").pop();if(a==null)continue;const c=a.toOptions();return this.observed.remove(e),this.ipMappings.add(c.host,c.port,t.host,t.port,t.transport),!0}return!1}}var Sg;(function(r){r.NOT_STARTED_YET="The libp2p node is not started yet",r.NOT_FOUND="Not found"})(Sg||(Sg={}));class HU extends Error{constructor(e="Missing service"){super(e),this.name="MissingServiceError"}}class jU extends Error{constructor(e="Unmet service dependencies"){super(e),this.name="UnmetServiceDependenciesError"}}class Ld extends Error{constructor(e="No content routers available"){super(e),this.name="NoContentRoutersError"}}class Eg extends Error{constructor(e="No peer routers available"){super(e),this.name="NoPeerRoutersError"}}class zU extends Error{constructor(e="Should not try to find self"){super(e),this.name="QueriedForSelfError"}}class WU extends Error{constructor(e="Unhandled protocol error"){super(e),this.name="UnhandledProtocolError"}}class GU extends Error{constructor(e="Duplicate protocol handler error"){super(e),this.name="DuplicateProtocolHandlerError"}}class xg extends Error{constructor(e="Dial denied error"){super(e),this.name="DialDeniedError"}}class QU extends Error{constructor(e="No transport was configured to listen on this address"){super(e),this.name="UnsupportedListenAddressError"}}class YU extends Error{constructor(e="Configured listen addresses could not be listened on"){super(e),this.name="UnsupportedListenAddressesError"}}class ZU extends Error{constructor(e="No valid addresses"){super(e),this.name="NoValidAddressesError"}}class XU extends Error{constructor(e="Connection intercepted"){super(e),this.name="ConnectionInterceptedError"}}class JU extends Error{constructor(e="Connection denied"){super(e),this.name="ConnectionDeniedError"}}class ou extends Error{constructor(e="Stream is not multiplexed"){super(e),this.name="MuxerUnavailableError"}}class au extends Error{constructor(e="Encryption failed"){super(e),this.name="EncryptionFailedError"}}class eF extends Error{constructor(e="Transport unavailable"){super(e),this.name="TransportUnavailableError"}}class tF{constructor(e={}){h(this,"components",{});h(this,"_started",!1);this.components={};for(const[t,n]of Object.entries(e))this.components[t]=n;this.components.logger==null&&(this.components.logger=hv())}isStarted(){return this._started}async _invokeStartableMethod(e){await Promise.all(Object.values(this.components).filter(t=>q3(t)).map(async t=>{var n;await((n=t[e])==null?void 0:n.call(t))}))}async beforeStart(){await this._invokeStartableMethod("beforeStart")}async start(){await this._invokeStartableMethod("start"),this._started=!0}async afterStart(){await this._invokeStartableMethod("afterStart")}async beforeStop(){await this._invokeStartableMethod("beforeStop")}async stop(){await this._invokeStartableMethod("stop"),this._started=!1}async afterStop(){await this._invokeStartableMethod("afterStop")}}const rF=["metrics","connectionProtector","dns"],nF=["components","isStarted","beforeStart","start","afterStart","beforeStop","stop","afterStop","then","_invokeStartableMethod"];function iF(r={}){const e=new tF(r);return new Proxy(e,{get(n,i,s){if(typeof i=="string"&&!nF.includes(i)){const o=e.components[i];if(o==null&&!rF.includes(i))throw new HU(`${i} not set`);return o}return Reflect.get(n,i,s)},set(n,i,s){return typeof i=="string"?e.components[i]=s:Reflect.set(n,i,s),!0}})}function sF(r){const e={};for(const t of Object.values(r.components))for(const n of oF(t))e[n]=!0;for(const t of Object.values(r.components))for(const n of aF(t))if(e[n]!==!0)throw new jU(`Service "${cF(t)}" required capability "${n}" but it was not provided by any component, you may need to add additional configuration when creating your node.`)}function oF(r){return Array.isArray(r==null?void 0:r[Xr])?r[Xr]:[]}function aF(r){return Array.isArray(r==null?void 0:r[Uu])?r[Uu]:[]}function cF(r){return(r==null?void 0:r[Symbol.toStringTag])??(r==null?void 0:r.toString())??"unknown"}const lF=4,uF=41;function hF(r={}){return{denyDialPeer:async()=>!1,denyDialMultiaddr:async e=>{if(Tc.matches(e))return!1;const t=e.stringTuples();return t[0][0]===lF||t[0][0]===uF?!!ha(`${t[0][1]}`):!1},denyInboundConnection:async()=>!1,denyOutboundConnection:async()=>!1,denyInboundEncryptedConnection:async()=>!1,denyOutboundEncryptedConnection:async()=>!1,denyInboundUpgradedConnection:async()=>!1,denyOutboundUpgradedConnection:async()=>!1,filterMultiaddrForPeer:async()=>!0,...r}}const Ag=()=>{const r=new Error("Delay aborted");return r.name="AbortError",r},fF=new WeakMap;function dF({clearTimeout:r,setTimeout:e}={}){return(t,{value:n,signal:i}={})=>{if(i!=null&&i.aborted)return Promise.reject(Ag());let s,o,a;const c=r??clearTimeout,l=()=>{c(s),a(Ag())},u=()=>{i&&i.removeEventListener("abort",l)},f=new Promise((g,m)=>{o=()=>{u(),g(n)},a=m,s=(e??setTimeout)(o,t)});return i&&i.addEventListener("abort",l,{once:!0}),fF.set(f,()=>{c(s),s=null,o()}),f}}const pF=dF();class gF{constructor(e={}){h(this,"memoryStorage");h(this,"points");h(this,"duration");h(this,"blockDuration");h(this,"execEvenly");h(this,"execEvenlyMinDelayMs");h(this,"keyPrefix");this.points=e.points??4,this.duration=e.duration??1,this.blockDuration=e.blockDuration??0,this.execEvenly=e.execEvenly??!1,this.execEvenlyMinDelayMs=e.execEvenlyMinDelayMs??this.duration*1e3/this.points,this.keyPrefix=e.keyPrefix??"rlflx",this.memoryStorage=new mF}async consume(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n);let o=this.memoryStorage.incrby(i,t,s);if(o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o.consumedPoints>this.points)throw this.blockDuration>0&&o.consumedPoints<=this.points+t&&(o=this.memoryStorage.set(i,o.consumedPoints,this.blockDuration)),new NN("Rate limit exceeded",o);if(this.execEvenly&&o.msBeforeNext>0&&!o.isFirstInDuration){let a=Math.ceil(o.msBeforeNext/(o.remainingPoints+2));a<this.execEvenlyMinDelayMs&&(a=o.consumedPoints*this.execEvenlyMinDelayMs),await pF(a)}return o}penalty(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n),o=this.memoryStorage.incrby(i,t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}reward(e,t=1,n={}){const i=this.getKey(e),s=this._getKeySecDuration(n),o=this.memoryStorage.incrby(i,-t,s);return o.remainingPoints=Math.max(this.points-o.consumedPoints,0),o}block(e,t){const n=t*1e3,i=this.points+1;return this.memoryStorage.set(this.getKey(e),i,t),{remainingPoints:0,msBeforeNext:n===0?-1:n,consumedPoints:i,isFirstInDuration:!1}}set(e,t,n=0){const i=(n>=0?n:this.duration)*1e3;return this.memoryStorage.set(this.getKey(e),t,n),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:t,isFirstInDuration:!1}}get(e){const t=this.memoryStorage.get(this.getKey(e));return t!=null&&(t.remainingPoints=Math.max(this.points-t.consumedPoints,0)),t}delete(e){this.memoryStorage.delete(this.getKey(e))}_getKeySecDuration(e){return(e==null?void 0:e.customDuration)!=null&&e.customDuration>=0?e.customDuration:this.duration}getKey(e){return this.keyPrefix.length>0?`${this.keyPrefix}:${e}`:e}parseKey(e){return e.substring(this.keyPrefix.length)}}class mF{constructor(){h(this,"storage");this.storage=new Map}incrby(e,t,n){const i=this.storage.get(e);if(i!=null){const s=i.expiresAt!=null?i.expiresAt.getTime()-new Date().getTime():-1;return i.expiresAt==null||s>0?(i.value+=t,{remainingPoints:0,msBeforeNext:s,consumedPoints:i.value,isFirstInDuration:!1}):this.set(e,t,n)}return this.set(e,t,n)}set(e,t,n){const i=n*1e3,s=this.storage.get(e);s!=null&&clearTimeout(s.timeoutId);const o={value:t,expiresAt:i>0?new Date(Date.now()+i):void 0};return this.storage.set(e,o),i>0&&(o.timeoutId=setTimeout(()=>{this.storage.delete(e)},i),o.timeoutId.unref!=null&&o.timeoutId.unref()),{remainingPoints:0,msBeforeNext:i===0?-1:i,consumedPoints:o.value,isFirstInDuration:!0}}get(e){const t=this.storage.get(e);if(t!=null)return{remainingPoints:0,msBeforeNext:t.expiresAt!=null?t.expiresAt.getTime()-new Date().getTime():-1,consumedPoints:t.value,isFirstInDuration:!1}}delete(e){const t=this.storage.get(e);return t!=null?(t.timeoutId!=null&&clearTimeout(t.timeoutId),this.storage.delete(e),!0):!1}}function Bv(r){if(Ya(r))return{peerId:r,multiaddrs:[]};let e=Array.isArray(r)?r:[r],t;if(e.length>0){const n=e[0].getPeerId();t=n==null?void 0:li(n),e.forEach(i=>{if(!Ch(i))throw new F3("Invalid multiaddr");const s=i.getPeerId();if(s==null){if(t!=null)throw new ke("Multiaddrs must all have the same peer id or have no peer id")}else{const o=li(s);if((t==null?void 0:t.equals(o))!==!0)throw new ke("Multiaddrs must all have the same peer id or have no peer id")}})}return e=e.filter(n=>!OB.exactMatch(n)),{peerId:t,multiaddrs:e}}const yF=["/ipfs/id/1.0.0","/ipfs/id/push/1.0.0","/libp2p/autonat/1.0.0","/libp2p/dcutr"];async function wF(r,e){var i;const t=((i=r==null?void 0:r.streams)==null?void 0:i.map(s=>s.protocol))??[],n=(e==null?void 0:e.closableProtocols)??yF;if(!(t.filter(s=>s!=null&&!n.includes(s)).length>0))try{await(r==null?void 0:r.close(e))}catch(s){r==null||r.abort(s)}}async function bF(r,e){let t=!1;for(const i of y4.keys())if(t=r.protoNames().includes(i),t)break;if(!t)return[r];const n=await r.resolve(e);return e.log("resolved %s to",r,n.map(i=>i.toString())),n}function h3(r){try{let e;if(typeof r=="string"?e=Ze(r):e=r,!e.protoNames().includes("ipcidr")){const n=e.protoNames().includes("ip6")?"/ipcidr/128":"/ipcidr/32";e=e.encapsulate(n)}return yP(e)}catch{throw new Error(`Can't convert to IpNet, Invalid multiaddr format: ${r}`)}}class vF{constructor(e,t={}){h(this,"connectionManager");h(this,"peerStore");h(this,"allow");h(this,"events");h(this,"log");this.allow=(t.allow??[]).map(n=>h3(n)),this.connectionManager=e.connectionManager,this.peerStore=e.peerStore,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager:connection-pruner"),this.maybePruneConnections=this.maybePruneConnections.bind(this)}start(){this.events.addEventListener("connection:open",this.maybePruneConnections)}stop(){this.events.removeEventListener("connection:open",this.maybePruneConnections)}maybePruneConnections(){this._maybePruneConnections().catch(e=>{this.log.error("error while pruning connections %e",e)})}async _maybePruneConnections(){const e=this.connectionManager.getConnections(),t=e.length,n=this.connectionManager.getMaxConnections();if(this.log("checking max connections limit %d/%d",t,n),t<=n)return;const i=new js;for(const c of e){const l=c.remotePeer;if(!i.has(l)){i.set(l,0);try{const u=await this.peerStore.get(l);i.set(l,[...u.tags.values()].reduce((f,g)=>f+g.value,0))}catch(u){u.name!=="NotFoundError"&&this.log.error("error loading peer tags",u)}}}const s=this.sortConnections(e,i),o=Math.max(t-n,0),a=[];for(const c of s)if(this.log("too many connections open - closing a connection to %p",c.remotePeer),this.allow.some(u=>u.contains(c.remoteAddr.nodeAddress().address))||a.push(c),a.length===o)break;await Promise.all(a.map(async c=>{await wF(c,{signal:AbortSignal.timeout(1e3)})})),this.events.safeDispatchEvent("connection:prune",{detail:a})}sortConnections(e,t){return e.sort((n,i)=>{const s=n.timeline.open,o=i.timeline.open;return s<o?1:s>o?-1:0}).sort((n,i)=>n.direction==="outbound"&&i.direction==="inbound"?1:n.direction==="inbound"&&i.direction==="outbound"?-1:0).sort((n,i)=>n.streams.length>i.streams.length?1:n.streams.length<i.streams.length?-1:0).sort((n,i)=>{const s=t.get(n.remotePeer)??0,o=t.get(i.remotePeer)??0;return s>o?1:s<o?-1:0})}}const Nv=1e4,SF=1e4,_g=1e4,Ov=25,EF=5,xF=10,AF=5,_F="last-dial-failure",IF="last-dial-success",Rv=500,CF=100,Dv=50;class kF extends fl{constructor(e={}){super({...e,sort:(t,n)=>t.options.priority>n.options.priority?-1:t.options.priority<n.options.priority?1:0})}}function TF(r){return/^127\.([0-9]{1,3})\.([0-9]{1,3})\.([0-9]{1,3})$/i.test(r)||/^::1$/.test(r)}function Ig(r){if(!Gy(r))return!1;const{address:e}=r.nodeAddress();return TF(e)}function PF(r,e){const t=d1.exactMatch(r.multiaddr),n=d1.exactMatch(e.multiaddr);if(t&&!n)return-1;if(!t&&n)return 1;const i=p1.exactMatch(r.multiaddr),s=p1.exactMatch(e.multiaddr);if(i&&!s)return-1;if(!i&&s)return 1;const o=Tc.exactMatch(r.multiaddr),a=Tc.exactMatch(e.multiaddr);if(o&&!a)return-1;if(!o&&a)return 1;const c=i5.exactMatch(r.multiaddr),l=i5.exactMatch(e.multiaddr);if(c&&!l)return-1;if(!c&&l)return 1;const u=U0.exactMatch(r.multiaddr),f=U0.exactMatch(e.multiaddr);if(u&&!f)return-1;if(!u&&f)return 1;const g=n5.exactMatch(r.multiaddr),m=n5.exactMatch(e.multiaddr);return g&&!m?-1:!g&&m?1:0}function BF(r,e){const t=Ig(r.multiaddr),n=Ig(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function NF(r,e){const t=Cc(r.multiaddr),n=Cc(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function OF(r,e){return r.isCertified&&!e.isCertified?-1:!r.isCertified&&e.isCertified?1:0}function RF(r,e){const t=F0.exactMatch(r.multiaddr),n=F0.exactMatch(e.multiaddr);return t&&!n?1:!t&&n?-1:0}function DF(r){return r.sort(PF).sort(OF).sort(RF).sort(NF).sort(BF)}const cu={maxParallelDials:Dv,maxDialQueueLength:Rv,maxPeerAddrsToDial:Ov,dialTimeout:Nv};class LF{constructor(e,t={}){h(this,"queue");h(this,"components");h(this,"addressSorter");h(this,"maxPeerAddrsToDial");h(this,"maxDialQueueLength");h(this,"dialTimeout");h(this,"shutDownController");h(this,"connections");h(this,"log");this.addressSorter=t.addressSorter,this.maxPeerAddrsToDial=t.maxPeerAddrsToDial??cu.maxPeerAddrsToDial,this.maxDialQueueLength=t.maxDialQueueLength??cu.maxDialQueueLength,this.dialTimeout=t.dialTimeout??cu.dialTimeout,this.connections=t.connections??new js,this.log=e.logger.forComponent("libp2p:connection-manager:dial-queue"),this.components=e,this.shutDownController=new AbortController,this.shutDownController.signal;for(const[n,i]of Object.entries(t.resolvers??{}))y4.set(n,i);this.queue=new kF({concurrency:t.maxParallelDials??cu.maxParallelDials,metricName:"libp2p_dial_queue",metrics:e.metrics}),this.queue.addEventListener("error",n=>{var i;((i=n.detail)==null?void 0:i.name)!==Hi.name&&this.log.error("error in dial queue - %e",n.detail)})}start(){this.shutDownController=new AbortController,this.shutDownController.signal}stop(){this.shutDownController.abort(),this.queue.abort()}async dial(e,t={}){var a,c,l;const{peerId:n,multiaddrs:i}=Bv(e),s=Array.from(this.connections.values()).flat().find(u=>t.force===!0?!1:u.remotePeer.equals(n)?!0:i.find(f=>f.equals(u.remoteAddr)));if((s==null?void 0:s.status)==="open")return this.log("already connected to %a",s.remoteAddr),(a=t.onProgress)==null||a.call(t,new Ar("dial-queue:already-connected")),s;const o=this.queue.queue.find(u=>{if((n==null?void 0:n.equals(u.options.peerId))===!0)return!0;const f=u.options.multiaddrs;if(f==null)return!1;for(const g of i)if(f.has(g.toString()))return!0;return!1});if(o!=null){this.log("joining existing dial target for %p",n);for(const u of i)o.options.multiaddrs.add(u.toString());return(c=t.onProgress)==null||c.call(t,new Ar("dial-queue:already-in-dial-queue")),o.join(t)}if(this.queue.size>=this.maxDialQueueLength)throw new fu("Dial queue is full");return this.log("creating dial target for %p",n,i.map(u=>u.toString())),(l=t.onProgress)==null||l.call(t,new Ar("dial-queue:add-to-dial-queue")),this.queue.add(async u=>{var g;(g=u.onProgress)==null||g.call(u,new Ar("dial-queue:start-dial"));const f=Fr([this.shutDownController.signal,u.signal]);try{return await this.dialPeer(u,f)}finally{f.clear()}},{peerId:n,priority:t.priority??Lv,multiaddrs:new Set(i.map(u=>u.toString())),signal:t.signal??AbortSignal.timeout(this.dialTimeout),onProgress:t.onProgress})}async dialPeer(e,t){var u;const n=e.peerId,i=e.multiaddrs,s=new Set;let o=e.multiaddrs.size===0,a=0,c=0;const l=[];for(this.log("starting dial to %p",n);o||i.size>0;){c++,o=!1;const f=[],g=new Set(e.multiaddrs);i.clear(),this.log("calculating addrs to dial %p from %s",n,[...g]);const m=await this.calculateMultiaddrs(n,g,{...e,signal:t});for(const w of m){if(s.has(w.multiaddr.toString())){this.log.trace("skipping previously failed multiaddr %a while dialing %p",w.multiaddr,n);continue}f.push(w)}this.log("%s dial to %p with %s",c===1?"starting":"continuing",n,f.map(w=>w.multiaddr.toString())),(u=e==null?void 0:e.onProgress)==null||u.call(e,new Ar("dial-queue:calculated-addresses",f));for(const w of f){if(a===this.maxPeerAddrsToDial)throw this.log("dialed maxPeerAddrsToDial (%d) addresses for %p, not trying any others",a,e.peerId),new fu("Peer had more than maxPeerAddrsToDial");a++;try{const x=await this.components.transportManager.dial(w.multiaddr,{...e,signal:t});this.log("dial to %a succeeded",w.multiaddr);try{await this.components.peerStore.merge(x.remotePeer,{multiaddrs:[x.remoteAddr],metadata:{[IF]:Ae(Date.now().toString())}})}catch(v){this.log.error("could not update last dial failure key for %p",n,v)}return x}catch(x){if(this.log.error("dial failed to %a",w.multiaddr,x),s.add(w.multiaddr.toString()),n!=null)try{await this.components.peerStore.merge(n,{metadata:{[_F]:Ae(Date.now().toString())}})}catch(v){this.log.error("could not update last dial failure key for %p",n,v)}if(t.aborted)throw new ph(x.message);l.push(x)}}}throw l.length===1?l[0]:new AggregateError(l,"All multiaddr dials failed")}async calculateMultiaddrs(e,t=new Set,n={}){var f,g;const i=[...t].map(m=>({multiaddr:Ze(m),isCertified:!1}));if(e!=null){if(this.components.peerId.equals(e))throw new fu("Tried to dial self");if(await((g=(f=this.components.connectionGater).denyDialPeer)==null?void 0:g.call(f,e))===!0)throw new xg("The dial request is blocked by gater.allowDialPeer");if(i.length===0){this.log("loading multiaddrs for %p",e);try{const m=await this.components.peerStore.get(e);i.push(...m.addresses),this.log("loaded multiaddrs for %p",e,i.map(({multiaddr:w})=>w.toString()))}catch(m){if(m.name!=="NotFoundError")throw m}}if(i.length===0){this.log("looking up multiaddrs for %p in the peer routing",e);try{const m=await this.components.peerRouting.findPeer(e,n);this.log("found multiaddrs for %p in the peer routing",e,i.map(({multiaddr:w})=>w.toString())),i.push(...m.multiaddrs.map(w=>({multiaddr:w,isCertified:!1})))}catch(m){m.name==="NoPeerRoutersError"?this.log("no peer routers configured",e):this.log.error("looking up multiaddrs for %p in the peer routing failed - %e",e,m)}}}let s=(await Promise.all(i.map(async m=>{const w=await bF(m.multiaddr,{dns:this.components.dns,...n,log:this.log});return w.length===1&&w[0].equals(m.multiaddr)?m:w.map(x=>({multiaddr:x,isCertified:!1}))}))).flat();if(e!=null){const m=`/p2p/${e.toString()}`;s=s.map(w=>{const x=w.multiaddr.getComponents().pop();return(x==null?void 0:x.name)!=="p2p"?{multiaddr:w.multiaddr.encapsulate(m),isCertified:w.isCertified}:w})}const o=s.filter(m=>{if(this.components.transportManager.dialTransportForMultiaddr(m.multiaddr)==null)return!1;const w=m.multiaddr.getPeerId();return e!=null&&w!=null?e.equals(w):!0}),a=new Map;for(const m of o){const w=m.multiaddr.toString(),x=a.get(w);if(x!=null){x.isCertified=x.isCertified||m.isCertified||!1;continue}a.set(w,m)}const c=[...a.values()];if(c.length===0)throw new ZU("The dial request has no valid addresses");const l=[];for(const m of c)this.components.connectionGater.denyDialMultiaddr!=null&&await this.components.connectionGater.denyDialMultiaddr(m.multiaddr)||l.push(m);const u=this.addressSorter==null?DF(l):l.sort(this.addressSorter);if(u.length===0)throw new xg("The connection gater denied all addresses in the dial request");return this.log.trace("addresses for %p before filtering",e??"unknown peer",s.map(({multiaddr:m})=>m.toString())),this.log.trace("addresses for %p after filtering",e??"unknown peer",u.map(({multiaddr:m})=>m.toString())),u}async isDialable(e,t={}){Array.isArray(e)||(e=[e]);try{const n=await this.calculateMultiaddrs(void 0,new Set(e.map(i=>i.toString())),t);return t.runOnLimitedConnection===!1?n.find(i=>!F0.matches(i.multiaddr))!=null:!0}catch(n){this.log.trace("error calculating if multiaddr(s) were dialable",n)}return!1}}var Md={},Ud,Cg;function MF(){if(Cg)return Ud;Cg=1;function r(e,t){typeof t=="boolean"&&(t={forever:t}),this._originalTimeouts=JSON.parse(JSON.stringify(e)),this._timeouts=e,this._options=t||{},this._maxRetryTime=t&&t.maxRetryTime||1/0,this._fn=null,this._errors=[],this._attempts=1,this._operationTimeout=null,this._operationTimeoutCb=null,this._timeout=null,this._operationStart=null,this._timer=null,this._options.forever&&(this._cachedTimeouts=this._timeouts.slice(0))}return Ud=r,r.prototype.reset=function(){this._attempts=1,this._timeouts=this._originalTimeouts.slice(0)},r.prototype.stop=function(){this._timeout&&clearTimeout(this._timeout),this._timer&&clearTimeout(this._timer),this._timeouts=[],this._cachedTimeouts=null},r.prototype.retry=function(e){if(this._timeout&&clearTimeout(this._timeout),!e)return!1;var t=new Date().getTime();if(e&&t-this._operationStart>=this._maxRetryTime)return this._errors.push(e),this._errors.unshift(new Error("RetryOperation timeout occurred")),!1;this._errors.push(e);var n=this._timeouts.shift();if(n===void 0)if(this._cachedTimeouts)this._errors.splice(0,this._errors.length-1),n=this._cachedTimeouts.slice(-1);else return!1;var i=this;return this._timer=setTimeout(function(){i._attempts++,i._operationTimeoutCb&&(i._timeout=setTimeout(function(){i._operationTimeoutCb(i._attempts)},i._operationTimeout),i._options.unref&&i._timeout.unref()),i._fn(i._attempts)},n),this._options.unref&&this._timer.unref(),!0},r.prototype.attempt=function(e,t){this._fn=e,t&&(t.timeout&&(this._operationTimeout=t.timeout),t.cb&&(this._operationTimeoutCb=t.cb));var n=this;this._operationTimeoutCb&&(this._timeout=setTimeout(function(){n._operationTimeoutCb()},n._operationTimeout)),this._operationStart=new Date().getTime(),this._fn(this._attempts)},r.prototype.try=function(e){console.log("Using RetryOperation.try() is deprecated"),this.attempt(e)},r.prototype.start=function(e){console.log("Using RetryOperation.start() is deprecated"),this.attempt(e)},r.prototype.start=r.prototype.try,r.prototype.errors=function(){return this._errors},r.prototype.attempts=function(){return this._attempts},r.prototype.mainError=function(){if(this._errors.length===0)return null;for(var e={},t=null,n=0,i=0;i<this._errors.length;i++){var s=this._errors[i],o=s.message,a=(e[o]||0)+1;e[o]=a,a>=n&&(t=s,n=a)}return t},Ud}var kg;function UF(){return kg||(kg=1,function(r){var e=MF();r.operation=function(t){var n=r.timeouts(t);return new e(n,{forever:t&&(t.forever||t.retries===1/0),unref:t&&t.unref,maxRetryTime:t&&t.maxRetryTime})},r.timeouts=function(t){if(t instanceof Array)return[].concat(t);var n={retries:10,factor:2,minTimeout:1*1e3,maxTimeout:1/0,randomize:!1};for(var i in t)n[i]=t[i];if(n.minTimeout>n.maxTimeout)throw new Error("minTimeout is greater than maxTimeout");for(var s=[],o=0;o<n.retries;o++)s.push(this.createTimeout(o,n));return t&&t.forever&&!s.length&&s.push(this.createTimeout(o,n)),s.sort(function(a,c){return a-c}),s},r.createTimeout=function(t,n){var i=n.randomize?Math.random()+1:1,s=Math.round(i*Math.max(n.minTimeout,1)*Math.pow(n.factor,t));return s=Math.min(s,n.maxTimeout),s},r.wrap=function(t,n,i){if(n instanceof Array&&(i=n,n=null),!i){i=[];for(var s in t)typeof t[s]=="function"&&i.push(s)}for(var o=0;o<i.length;o++){var a=i[o],c=t[a];t[a]=(function(u){var f=r.operation(n),g=Array.prototype.slice.call(arguments,1),m=g.pop();g.push(function(w){f.retry(w)||(w&&(arguments[0]=f.mainError()),m.apply(this,arguments))}),f.attempt(function(){u.apply(t,g)})}).bind(t,c),t[a].options=n}}}(Md)),Md}var Fd,Tg;function FF(){return Tg||(Tg=1,Fd=UF()),Fd}var $F=FF();const VF=S4($F),qF=Object.prototype.toString,KF=r=>qF.call(r)==="[object Error]",HF=new Set(["network error","Failed to fetch","NetworkError when attempting to fetch resource.","The Internet connection appears to be offline.","Load failed","Network request failed","fetch failed","terminated"]);function jF(r){return r&&KF(r)&&r.name==="TypeError"&&typeof r.message=="string"?r.message==="Load failed"?r.stack===void 0:HF.has(r.message):!1}class zF extends Error{constructor(e){super(),e instanceof Error?(this.originalError=e,{message:e}=e):(this.originalError=new Error(e),this.originalError.stack=this.stack),this.name="AbortError",this.message=e}}const Pg=(r,e,t)=>{const n=t.retries-(e-1);return r.attemptNumber=e,r.retriesLeft=n,r};async function WF(r,e){return new Promise((t,n)=>{e={...e},e.onFailedAttempt??(e.onFailedAttempt=()=>{}),e.shouldRetry??(e.shouldRetry=()=>!0),e.retries??(e.retries=10);const i=VF.operation(e),s=()=>{var a;i.stop(),n((a=e.signal)==null?void 0:a.reason)};e.signal&&!e.signal.aborted&&e.signal.addEventListener("abort",s,{once:!0});const o=()=>{var a;(a=e.signal)==null||a.removeEventListener("abort",s),i.stop()};i.attempt(async a=>{try{const c=await r(a);o(),t(c)}catch(c){try{if(!(c instanceof Error))throw new TypeError(`Non-error was thrown: "${c}". You should only throw errors.`);if(c instanceof zF)throw c.originalError;if(c instanceof TypeError&&!jF(c))throw c;if(Pg(c,a,e),await e.shouldRetry(c)||(i.stop(),n(c)),await e.onFailedAttempt(c),!i.retry(c))throw i.mainError()}catch(l){Pg(l,a,e),o(),n(l)}}})})}class GF{constructor(e,t={}){h(this,"log");h(this,"queue");h(this,"started");h(this,"peerStore");h(this,"retries");h(this,"retryInterval");h(this,"backoffFactor");h(this,"connectionManager");h(this,"events");this.log=e.logger.forComponent("libp2p:reconnect-queue"),this.peerStore=e.peerStore,this.connectionManager=e.connectionManager,this.queue=new H0({concurrency:t.maxParallelReconnects??AF,metricName:"libp2p_reconnect_queue",metrics:e.metrics}),this.started=!1,this.retries=t.retries??5,this.backoffFactor=t.backoffFactor,this.retryInterval=t.retryInterval,this.events=e.events,e.events.addEventListener("peer:disconnect",n=>{this.maybeReconnect(n.detail).catch(i=>{this.log.error("failed to maybe reconnect to %p - %e",n.detail,i)})})}async maybeReconnect(e){if(!this.started)return;const t=await this.peerStore.get(e);Bg(t)&&(this.queue.has(e)||this.queue.add(async n=>{await WF(async i=>{if(this.started)try{await this.connectionManager.openConnection(e,{signal:n==null?void 0:n.signal})}catch(s){throw this.log("reconnecting to %p attempt %d of %d failed - %e",e,i,this.retries,s),s}},{signal:n==null?void 0:n.signal,retries:this.retries,factor:this.backoffFactor,minTimeout:this.retryInterval})},{peerId:e}).catch(async n=>{this.log.error("failed to reconnect to %p - %e",e,n);const i={};[...t.tags.keys()].forEach(s=>{s.startsWith(D3)&&(i[s]=void 0)}),await this.peerStore.merge(e,{tags:i}),this.events.safeDispatchEvent("peer:reconnect-failure",{detail:e})}).catch(async n=>{this.log.error("failed to remove keep-alive tag from %p - %e",e,n)}))}start(){this.started=!0}async afterStart(){Promise.resolve().then(async()=>{const e=await this.peerStore.all({filters:[t=>Bg(t)]});await Promise.all(e.map(async t=>{await this.connectionManager.openConnection(t.id).catch(n=>{this.log.error(n)})}))}).catch(e=>{this.log.error(e)})}stop(){this.started=!1,this.queue.abort()}}function Bg(r){for(const e of r.tags.keys())if(e.startsWith(D3))return!0;return!1}const Lv=50,$d={maxConnections:CF,inboundConnectionThreshold:EF,maxIncomingPendingConnections:xF};var y7;y7=Symbol.toStringTag;class QF{constructor(e,t={}){h(this,"started");h(this,"connections");h(this,"allow");h(this,"deny");h(this,"maxIncomingPendingConnections");h(this,"incomingPendingConnections");h(this,"outboundPendingConnections");h(this,"maxConnections");h(this,"dialQueue");h(this,"reconnectQueue");h(this,"connectionPruner");h(this,"inboundConnectionRateLimiter");h(this,"peerStore");h(this,"metrics");h(this,"events");h(this,"log");h(this,"peerId");h(this,y7,"@libp2p/connection-manager");var n;if(this.maxConnections=t.maxConnections??$d.maxConnections,this.maxConnections<1)throw new ke("Connection Manager maxConnections must be greater than 0");this.connections=new js,this.started=!1,this.peerId=e.peerId,this.peerStore=e.peerStore,this.metrics=e.metrics,this.events=e.events,this.log=e.logger.forComponent("libp2p:connection-manager"),this.onConnect=this.onConnect.bind(this),this.onDisconnect=this.onDisconnect.bind(this),this.allow=(t.allow??[]).map(i=>h3(i)),this.deny=(t.deny??[]).map(i=>h3(i)),this.incomingPendingConnections=0,this.maxIncomingPendingConnections=t.maxIncomingPendingConnections??$d.maxIncomingPendingConnections,this.outboundPendingConnections=0,this.inboundConnectionRateLimiter=new gF({points:t.inboundConnectionThreshold??$d.inboundConnectionThreshold,duration:1}),this.connectionPruner=new vF({connectionManager:this,peerStore:e.peerStore,events:e.events,logger:e.logger},{allow:(n=t.allow)==null?void 0:n.map(i=>Ze(i))}),this.dialQueue=new LF(e,{addressSorter:t.addressSorter,maxParallelDials:t.maxParallelDials??Dv,maxDialQueueLength:t.maxDialQueueLength??Rv,maxPeerAddrsToDial:t.maxPeerAddrsToDial??Ov,dialTimeout:t.dialTimeout??Nv,resolvers:t.resolvers??{dnsaddr:lv},connections:this.connections}),this.reconnectQueue=new GF({events:e.events,peerStore:e.peerStore,logger:e.logger,connectionManager:this},{retries:t.reconnectRetries,retryInterval:t.reconnectRetryInterval,backoffFactor:t.reconnectBackoffFactor,maxParallelReconnects:t.maxParallelReconnects})}async start(){var e,t,n;(e=this.metrics)==null||e.registerMetricGroup("libp2p_connection_manager_connections",{calculate:()=>{const i={inbound:0,"inbound pending":this.incomingPendingConnections,outbound:0,"outbound pending":this.outboundPendingConnections};for(const s of this.connections.values())for(const o of s)i[o.direction]++;return i}}),(t=this.metrics)==null||t.registerMetricGroup("libp2p_protocol_streams_total",{label:"protocol",calculate:()=>{const i={};for(const s of this.connections.values())for(const o of s)for(const a of o.streams){const c=`${a.direction} ${a.protocol??"unnegotiated"}`;i[c]=(i[c]??0)+1}return i}}),(n=this.metrics)==null||n.registerMetricGroup("libp2p_connection_manager_protocol_streams_per_connection_90th_percentile",{label:"protocol",calculate:()=>{const i={};for(const o of this.connections.values())for(const a of o){const c={};for(const l of a.streams){const u=`${l.direction} ${l.protocol??"unnegotiated"}`;c[u]=(c[u]??0)+1}for(const[l,u]of Object.entries(c))i[l]=i[l]??[],i[l].push(u)}const s={};for(let[o,a]of Object.entries(i)){a=a.sort((l,u)=>l-u);const c=Math.floor(a.length*.9);s[o]=a[c]}return s}}),this.events.addEventListener("connection:open",this.onConnect),this.events.addEventListener("connection:close",this.onDisconnect),await Mu(this.dialQueue,this.reconnectQueue,this.connectionPruner),this.started=!0,this.log("started")}async stop(){this.events.removeEventListener("connection:open",this.onConnect),this.events.removeEventListener("connection:close",this.onDisconnect),await K3(this.reconnectQueue,this.dialQueue,this.connectionPruner);const e=[];for(const t of this.connections.values())for(const n of t)e.push((async()=>{try{await n.close()}catch(i){this.log.error(i)}})());this.log("closing %d connections",e.length),await Promise.all(e),this.connections.clear(),this.log("stopped")}getMaxConnections(){return this.maxConnections}setMaxConnections(e){if(this.maxConnections<1)throw new ke("Connection Manager maxConnections must be greater than 0");let t=!1;e<this.maxConnections&&(t=!0),this.maxConnections=e,t&&this.connectionPruner.maybePruneConnections()}onConnect(e){this._onConnect(e).catch(t=>{this.log.error(t)})}async _onConnect(e){const{detail:t}=e;if(!this.started){await t.close();return}if(t.status!=="open")return;const n=t.remotePeer,i=!this.connections.has(n),s=this.connections.get(n)??[];s.push(t),this.connections.set(n,s),n.publicKey!=null&&n.type==="RSA"&&await this.peerStore.patch(n,{publicKey:n.publicKey}),i&&this.events.safeDispatchEvent("peer:connect",{detail:t.remotePeer})}onDisconnect(e){const{detail:t}=e,n=t.remotePeer,s=(this.connections.get(n)??[]).filter(o=>o.id!==t.id);this.connections.set(n,s),s.length===0&&(this.log("onDisconnect remove all connections for peer %p",n),this.connections.delete(n),this.events.safeDispatchEvent("peer:disconnect",{detail:t.remotePeer}))}getConnections(e){if(e!=null)return this.connections.get(e)??[];let t=[];for(const n of this.connections.values())t=t.concat(n);return t}getConnectionsMap(){return this.connections}async openConnection(e,t={}){var n,i;if(!this.started)throw new Ss("Not started");this.outboundPendingConnections++;try{(n=t.signal)==null||n.throwIfAborted();const{peerId:s}=Bv(e);if(this.peerId.equals(s))throw new U3("Can not dial self");if(s!=null&&t.force!==!0){this.log("dial %p",s);const l=this.getConnections(s).find(u=>u.limits==null);if(l!=null)return this.log("had an existing non-limited connection to %p",s),(i=t.onProgress)==null||i.call(t,new Ar("dial-queue:already-connected")),l}const o=await this.dialQueue.dial(e,{...t,priority:t.priority??Lv});if(o.status!=="open")throw new M3("Remote closed connection during opening");let a=this.connections.get(o.remotePeer);a==null&&(a=[],this.connections.set(o.remotePeer,a));let c=!1;for(const l of a)if(l.id===o.id&&(c=!0),t.force!==!0&&l.id!==o.id&&l.remoteAddr.equals(o.remoteAddr))return o.abort(new F3("Duplicate multiaddr connection")),l;return c||a.push(o),o}finally{this.outboundPendingConnections--}}async closeConnections(e,t={}){const n=this.connections.get(e)??[];await Promise.all(n.map(async i=>{try{await i.close(t)}catch(s){i.abort(s)}}))}async acceptIncomingConnection(e){if(this.deny.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.log("connection from %a refused - connection remote address was in deny list",e.remoteAddr),!1;if(this.allow.some(i=>i.contains(e.remoteAddr.nodeAddress().address)))return this.incomingPendingConnections++,!0;if(this.incomingPendingConnections===this.maxIncomingPendingConnections)return this.log("connection from %a refused - incomingPendingConnections exceeded by host",e.remoteAddr),!1;if(e.remoteAddr.isThinWaistAddress()){const i=e.remoteAddr.nodeAddress().address;try{await this.inboundConnectionRateLimiter.consume(i,1)}catch{return this.log("connection from %a refused - inboundConnectionThreshold exceeded by host %s",e.remoteAddr,i),!1}}return this.getConnections().length<this.maxConnections?(this.incomingPendingConnections++,!0):(this.log("connection from %a refused - maxConnections exceeded",e.remoteAddr),!1)}afterUpgradeInbound(){this.incomingPendingConnections--}getDialQueue(){const e={queued:"queued",running:"active",errored:"error",complete:"success"};return this.dialQueue.queue.queue.map(t=>({id:t.id,status:e[t.status],peerId:t.options.peerId,multiaddrs:[...t.options.multiaddrs].map(n=>Ze(n))}))}async isDialable(e,t={}){return this.dialQueue.isDialable(e,t)}}const YF=1e4,ZF="1.0.0",XF="ping",JF="ipfs",Ng=32,e$=!0;var w7,b7;b7=Symbol.toStringTag,w7=Xr;class t${constructor(e,t={}){h(this,"protocol");h(this,"components");h(this,"log");h(this,"heartbeatInterval");h(this,"pingIntervalMs");h(this,"abortController");h(this,"timeout");h(this,"abortConnectionOnPingFailure");h(this,b7,"@libp2p/connection-monitor");h(this,w7,["@libp2p/connection-monitor"]);this.components=e,this.protocol=`/${t.protocolPrefix??JF}/${XF}/${ZF}`,this.log=e.logger.forComponent("libp2p:connection-monitor"),this.pingIntervalMs=t.pingInterval??YF,this.abortConnectionOnPingFailure=t.abortConnectionOnPingFailure??e$,this.timeout=new Bc({...t.pingTimeout??{},metrics:e.metrics,metricName:"libp2p_connection_monitor_ping_time_milliseconds"})}start(){this.abortController=new AbortController,this.abortController.signal,this.heartbeatInterval=setInterval(()=>{this.components.connectionManager.getConnections().forEach(e=>{Promise.resolve().then(async()=>{var n;let t=Date.now();try{const i=this.timeout.getTimeoutSignal({signal:(n=this.abortController)==null?void 0:n.signal}),s=await e.newStream(this.protocol,{signal:i,runOnLimitedConnection:!0}),o=Yu(s);t=Date.now(),await Promise.all([o.write(ol(Ng),{signal:i}),o.read({bytes:Ng,signal:i})]),e.rtt=Date.now()-t,await o.unwrap().close({signal:i})}catch(i){if(i.name!=="UnsupportedProtocolError")throw i;e.rtt=(Date.now()-t)/2}}).catch(t=>{this.log.error("error during heartbeat",t),this.abortConnectionOnPingFailure?(this.log.error("aborting connection due to ping failure"),e.abort(t)):this.log("connection ping failed, but not aborting due to abortConnectionOnPingFailure flag")})})},this.pingIntervalMs)}stop(){var e;(e=this.abortController)==null||e.abort(),this.heartbeatInterval!=null&&clearInterval(this.heartbeatInterval)}}var v7;v7=Symbol.toStringTag;class r${constructor(e,t){h(this,"routers");h(this,"started");h(this,"components");h(this,v7,"@libp2p/content-routing");var n,i,s,o,a;this.routers=t.routers??[],this.started=!1,this.components=e,this.findProviders=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.contentRouting.findProviders",this.findProviders.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()}),getAttributesFromYieldedValue:(c,l)=>({...l,providers:[...Array.isArray(l.providers)?l.providers:[],c.id.toString()]})}))??this.findProviders,this.provide=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.contentRouting.provide",this.provide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.provide,this.cancelReprovide=((s=e.metrics)==null?void 0:s.traceFunction("libp2p.contentRouting.cancelReprovide",this.cancelReprovide.bind(this),{optionsIndex:1,getAttributesFromArgs:([c],l)=>({...l,cid:c.toString()})}))??this.cancelReprovide,this.put=((o=e.metrics)==null?void 0:o.traceFunction("libp2p.contentRouting.put",this.put.bind(this),{optionsIndex:2,getAttributesFromArgs:([c])=>({key:Be(c,"base36")})}))??this.put,this.get=((a=e.metrics)==null?void 0:a.traceFunction("libp2p.contentRouting.get",this.get.bind(this),{optionsIndex:1,getAttributesFromArgs:([c])=>({key:Be(c,"base36")})}))??this.get}isStarted(){return this.started}async start(){this.started=!0}async stop(){this.started=!1}async*findProviders(e,t={}){if(this.routers.length===0)throw new Ld("No content routers available");const n=this,i=new Dn;for await(const s of Sc(...n.routers.filter(o=>o.findProviders instanceof Function).map(o=>o.findProviders(e,t))))s!=null&&(s.multiaddrs.length>0&&await this.components.peerStore.merge(s.id,{multiaddrs:s.multiaddrs},t),!i.has(s.id)&&(i.add(s.id),yield s))}async provide(e,t={}){if(this.routers.length===0)throw new Ld("No content routers available");await Promise.all(this.routers.filter(n=>n.provide instanceof Function).map(async n=>{await n.provide(e,t)}))}async cancelReprovide(e,t={}){if(this.routers.length===0)throw new Ld("No content routers available");await Promise.all(this.routers.filter(n=>n.cancelReprovide instanceof Function).map(async n=>{await n.cancelReprovide(e,t)}))}async put(e,t,n){if(!this.isStarted())throw new Ss;await Promise.all(this.routers.filter(i=>i.put instanceof Function).map(async i=>{await i.put(e,t,n)}))}async get(e,t){if(!this.isStarted())throw new Ss;return Promise.any(this.routers.filter(n=>n.get instanceof Function).map(async n=>n.get(e,t)))}}var S7;S7=Symbol.toStringTag;class n${constructor(e,t={}){h(this,"log");h(this,"peerId");h(this,"peerStore");h(this,"routers");h(this,S7,"@libp2p/peer-routing");var n,i;this.log=e.logger.forComponent("libp2p:peer-routing"),this.peerId=e.peerId,this.peerStore=e.peerStore,this.routers=t.routers??[],this.findPeer=((n=e.metrics)==null?void 0:n.traceFunction("libp2p.peerRouting.findPeer",this.findPeer.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,peer:s.toString()})}))??this.findPeer,this.getClosestPeers=((i=e.metrics)==null?void 0:i.traceFunction("libp2p.peerRouting.getClosestPeers",this.getClosestPeers.bind(this),{optionsIndex:1,getAttributesFromArgs:([s],o)=>({...o,key:Be(s,"base36")}),getAttributesFromYieldedValue:(s,o)=>({...o,peers:[...Array.isArray(o.peers)?o.peers:[],s.id.toString()]})}))??this.getClosestPeers}async findPeer(e,t){if(this.routers.length===0)throw new Eg("No peer routers available");if(e.toString()===this.peerId.toString())throw new zU("Should not try to find self");const n=this,i=Sc(...this.routers.filter(s=>s.findPeer instanceof Function).map(s=>async function*(){try{yield await s.findPeer(e,t)}catch(o){n.log.error(o)}}()));for await(const s of i)if(s!=null)return s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs},t),s;throw new zr}async*getClosestPeers(e,t={}){if(this.routers.length===0)throw new Eg("No peer routers available");const n=this,i=v4(1024);for await(const s of x4(async function*(){const o=Sc(...n.routers.filter(a=>a.getClosestPeers instanceof Function).map(a=>a.getClosestPeers(e,t)));for await(let a of o)yield async()=>{if(a.multiaddrs.length===0)try{a=await n.findPeer(a.id,{...t,useCache:!1})}catch(c){n.log.error("could not find peer multiaddrs",c);return}return a}}()))s!=null&&(s.multiaddrs.length>0&&await this.peerStore.merge(s.id,{multiaddrs:s.multiaddrs},t),!i.has(s.id.toMultihash().bytes)&&(i.add(s.id.toMultihash().bytes),yield s))}}var E7,x7;class i$ extends(x7=or,E7=Symbol.toStringTag,x7){constructor(t){super();h(this,"peerRouting");h(this,"log");h(this,"walking");h(this,"walkers");h(this,"shutdownController");h(this,"walkController");h(this,"needNext");h(this,E7,"@libp2p/random-walk");this.log=t.logger.forComponent("libp2p:random-walk"),this.peerRouting=t.peerRouting,this.walkers=0,this.walking=!1,this.shutdownController=new AbortController,this.shutdownController.signal}start(){this.shutdownController=new AbortController,this.shutdownController.signal}stop(){this.shutdownController.abort()}async*walk(t){var i,s;this.walking||this.startWalk(),this.walkers++;const n=Fr([this.shutdownController.signal,t==null?void 0:t.signal]);try{for(;;)(i=this.needNext)==null||i.resolve(),this.needNext=St(),yield(await Ln(this,"walk:peer",n,{errorEvent:"walk:error"})).detail}finally{n.clear(),this.walkers--,this.walkers===0&&((s=this.walkController)==null||s.abort(),this.walkController=void 0)}}startWalk(){this.walking=!0,this.walkController=new AbortController,this.walkController.signal;const t=Fr([this.walkController.signal,this.shutdownController.signal]),n=Date.now();let i=0;Promise.resolve().then(async()=>{for(this.log("start walk");this.walkers>0;)try{const s=ol(32);let o=Date.now();for await(const a of this.peerRouting.getClosestPeers(s,{signal:t}))t.aborted&&this.log("aborting walk"),t.throwIfAborted(),this.log("found peer %p after %dms for %d walkers",a.id,Date.now()-o,this.walkers),i++,this.safeDispatchEvent("walk:peer",{detail:a}),this.walkers===1&&this.needNext!=null&&(this.log("wait for need next"),await Ht(this.needNext.promise,t)),o=Date.now();this.log("walk iteration for %b and %d walkers finished, found %d peers",s,this.walkers,i)}catch(s){this.log.error("random walk errored",s),this.safeDispatchEvent("walk:error",{detail:s})}this.log("no walkers left, ended walk")}).catch(s=>{this.log.error("random walk errored",s)}).finally(()=>{this.log("finished walk, found %d peers after %dms",i,Date.now()-n),this.walking=!1})}}const Mv=32,Uv=64;var A7;A7=Symbol.toStringTag;class s${constructor(e){h(this,"log");h(this,"topologies");h(this,"handlers");h(this,"components");h(this,A7,"@libp2p/registrar");var t;this.components=e,this.log=e.logger.forComponent("libp2p:registrar"),this.topologies=new Map,(t=e.metrics)==null||t.registerMetricGroup("libp2p_registrar_topologies",{calculate:()=>{const n={};for(const[i,s]of this.topologies)n[i]=s.size;return n}}),this.handlers=mi({name:"libp2p_registrar_protocol_handlers",metrics:e.metrics}),this._onDisconnect=this._onDisconnect.bind(this),this._onPeerUpdate=this._onPeerUpdate.bind(this),this._onPeerIdentify=this._onPeerIdentify.bind(this),this.components.events.addEventListener("peer:disconnect",this._onDisconnect),this.components.events.addEventListener("peer:update",this._onPeerUpdate),this.components.events.addEventListener("peer:identify",this._onPeerIdentify)}getProtocols(){return Array.from(new Set([...this.handlers.keys()])).sort()}getHandler(e){const t=this.handlers.get(e);if(t==null)throw new WU(`No handler registered for protocol ${e}`);return t}getTopologies(e){const t=this.topologies.get(e);return t==null?[]:[...t.values()]}async handle(e,t,n){if(this.handlers.has(e)&&(n==null?void 0:n.force)!==!0)throw new GU(`Handler already registered for protocol ${e}`);const i=sv.bind({ignoreUndefined:!0})({maxInboundStreams:Mv,maxOutboundStreams:Uv},n);this.handlers.set(e,{handler:t,options:i}),await this.components.peerStore.merge(this.components.peerId,{protocols:[e]},n)}async unhandle(e,t){(Array.isArray(e)?e:[e]).forEach(i=>{this.handlers.delete(i)}),await this.components.peerStore.patch(this.components.peerId,{protocols:this.getProtocols()},t)}async register(e,t){if(t==null)throw new ke("invalid topology");const n=`${(Math.random()*1e9).toString(36)}${Date.now()}`;let i=this.topologies.get(e);return i==null&&(i=new Map,this.topologies.set(e,i)),i.set(n,t),n}unregister(e){for(const[t,n]of this.topologies.entries())n.has(e)&&(n.delete(e),n.size===0&&this.topologies.delete(t))}_onDisconnect(e){const t=e.detail,n={signal:AbortSignal.timeout(5e3)};this.components.peerStore.get(t,n).then(i=>{var s,o,a;for(const c of i.protocols){const l=this.topologies.get(c);if(l!=null)for(const u of l.values())((s=u.filter)==null?void 0:s.has(t))!==!1&&((o=u.filter)==null||o.remove(t),(a=u.onDisconnect)==null||a.call(u,t))}}).catch(i=>{i.name!=="NotFoundError"&&this.log.error("could not inform topologies of disconnecting peer %p",t,i)})}_onPeerUpdate(e){var s,o,a;const{peer:t,previous:n}=e.detail,i=((n==null?void 0:n.protocols)??[]).filter(c=>!t.protocols.includes(c));for(const c of i){const l=this.topologies.get(c);if(l!=null)for(const u of l.values())((s=u.filter)==null?void 0:s.has(t.id))!==!1&&((o=u.filter)==null||o.remove(t.id),(a=u.onDisconnect)==null||a.call(u,t.id))}}_onPeerIdentify(e){var s,o,a;const t=e.detail.protocols,n=e.detail.connection,i=e.detail.peerId;for(const c of t){const l=this.topologies.get(c);if(l!=null)for(const u of l.values())n.limits!=null&&u.notifyOnLimitedConnection!==!0||((s=u.filter)==null?void 0:s.has(i))!==!0&&((o=u.filter)==null||o.add(i),(a=u.onConnect)==null||a.call(u,i,n))}}}var _7;_7=Symbol.toStringTag;class o${constructor(e,t={}){h(this,"log");h(this,"components");h(this,"transports");h(this,"listeners");h(this,"faultTolerance");h(this,"started");h(this,_7,"@libp2p/transport-manager");this.log=e.logger.forComponent("libp2p:transports"),this.components=e,this.started=!1,this.transports=mi({name:"libp2p_transport_manager_transports",metrics:this.components.metrics}),this.listeners=mi({name:"libp2p_transport_manager_listeners",metrics:this.components.metrics}),this.faultTolerance=t.faultTolerance??mc.FATAL_ALL}add(e){const t=e[Symbol.toStringTag];if(t==null)throw new ke("Transport must have a valid tag");if(this.transports.has(t))throw new ke(`There is already a transport with the tag ${t}`);this.log("adding transport %s",t),this.transports.set(t,e),this.listeners.has(t)||this.listeners.set(t,[])}isStarted(){return this.started}start(){this.started=!0}async afterStart(){const e=this.components.addressManager.getListenAddrs();await this.listen(e)}async stop(){const e=[];for(const[t,n]of this.listeners)for(this.log("closing listeners for %s",t);n.length>0;){const i=n.pop();i!=null&&e.push(i.close())}await Promise.all(e),this.log("all listeners closed");for(const t of this.listeners.keys())this.listeners.set(t,[]);this.started=!1}async dial(e,t){var i;const n=this.dialTransportForMultiaddr(e);if(n==null)throw new eF(`No transport available for address ${String(e)}`);return(i=t==null?void 0:t.onProgress)==null||i.call(t,new Ar("transport-manager:selected-transport",n[Symbol.toStringTag])),n.dial(e,{...t,upgrader:this.components.upgrader})}getAddrs(){let e=[];for(const t of this.listeners.values())for(const n of t)e=[...e,...n.getAddrs()];return e}getTransports(){return Array.of(...this.transports.values())}getListeners(){return Array.of(...this.listeners.values()).flat()}dialTransportForMultiaddr(e){for(const t of this.transports.values())if(t.dialFilter([e]).length>0)return t}listenTransportForMultiaddr(e){for(const t of this.transports.values())if(t.listenFilter([e]).length>0)return t}async listen(e){if(!this.isStarted())throw new Ss("Not started");if(e==null||e.length===0){this.log("no addresses were provided for listening, this node is dial only");return}const t={errors:new Map,ipv4:{success:0,attempts:0},ipv6:{success:0,attempts:0}};e.forEach(s=>{t.errors.set(s.toString(),new QU)});const n=[];for(const[s,o]of this.transports.entries()){const a=o.listenFilter(e);for(const c of a){this.log("creating listener for %s on %a",s,c);const l=o.createListener({upgrader:this.components.upgrader});let u=this.listeners.get(s)??[];u==null&&(u=[],this.listeners.set(s,u)),u.push(l),l.addEventListener("listening",()=>{this.components.events.safeDispatchEvent("transport:listening",{detail:l})}),l.addEventListener("close",()=>{const f=u.findIndex(g=>g===l);u.splice(f,1),this.components.events.safeDispatchEvent("transport:close",{detail:l})}),t5.matches(c)?t.ipv4.attempts++:r5.matches(c)&&t.ipv6.attempts++,n.push(l.listen(c).then(()=>{t.errors.delete(c.toString()),t5.matches(c)&&t.ipv4.success++,r5.matches(c)&&t.ipv6.success++},f=>{throw this.log.error("transport %s could not listen on address %a - %e",s,c,f),t.errors.set(c.toString(),f),f}))}}const i=await Promise.allSettled(n);if(!(i.length>0&&i.every(s=>s.status==="fulfilled"))){if(this.ipv6Unsupported(t)){this.log("all IPv4 addresses succeed but all IPv6 failed");return}if(this.faultTolerance===mc.NO_FATAL){this.log("failed to listen on any address but fault tolerance allows this");return}throw new YU(`Some configured addresses failed to be listened on, you may need to remove one or more listen addresses from your configuration or set \`transportManager.faultTolerance\` to NO_FATAL:
${[...t.errors.entries()].map(([s,o])=>`
  ${s}: ${`${o.stack??o}`.split(`
`).join(`
  `)}
`).join("")}`)}}ipv6Unsupported(e){if(e.ipv4.attempts===0||e.ipv6.attempts===0)return!1;const t=e.ipv4.attempts===e.ipv4.success,n=e.ipv6.success===0;return t&&n}async remove(e){const t=this.listeners.get(e)??[];this.log.trace("removing transport %s",e);const n=[];for(this.log.trace("closing listeners for %s",e);t.length>0;){const i=t.pop();i!=null&&n.push(i.close())}await Promise.all(n),this.transports.delete(e),this.listeners.delete(e)}async removeAll(){const e=[];for(const t of this.transports.keys())e.push(this.remove(t));await Promise.all(e)}}const xr="/multistream/1.0.0",Ep=1024,a$=Ae(`
`);async function Va(r,e,t){await r.write(e,t)}async function c$(r,e,t){await r.writeV(e,t)}async function l$(r,e){const t=await r.read(e);if(t.byteLength===0||t.get(t.byteLength-1)!==a$[0])throw e.log.error("Invalid mss message - missing newline",t),new We("Missing newline");return t.sublist(0,-1)}async function xo(r,e){const t=await l$(r,e);return Be(t.subarray())}async function Vd(r,e,t){if(e=Array.isArray(e)?[...e]:[e],e.length===1&&t.negotiateFully===!1)return u$(r,e[0],t);const n=Mo(r,{...t,maxDataLength:Ep}),i=e.shift();if(i==null)throw new Error("At least one protocol must be specified");t.log.trace('select: write ["%s", "%s"]',xr,i);const s=Ae(`${xr}
`),o=Ae(`${i}
`);await c$(n,[s,o],t),t.log.trace("select: reading multistream-select header");let a=await xo(n,t);if(t.log.trace('select: read "%s"',a),a===xr&&(t.log.trace("select: reading protocol response"),a=await xo(n,t),t.log.trace('select: read "%s"',a)),a===i)return{stream:n.unwrap(),protocol:i};for(const c of e){t.log.trace('select: write "%s"',c),await Va(n,Ae(`${c}
`),t),t.log.trace("select: reading protocol response");const l=await xo(n,t);if(t.log.trace('select: read "%s" for "%s"',l,c),l===c)return{stream:n.unwrap(),protocol:c}}throw new dh("protocol selection failed")}function u$(r,e,t){const n=r.sink.bind(r),i=r.source;let s=!1,o=!1;const a=St();let c=!1,l=!1;const u=St();let f=!1,g=!1;const m=St(),w=Mo({sink:n,source:i},{...t,maxDataLength:Ep});r.sink=async N=>{const{sink:O}=w.unwrap();await O(async function*(){let L=!1;for await(const R of N){if(l&&await u.promise,c)yield R;else{l=!0,t.log.trace('optimistic: write ["%s", "%s", data(%d)] in sink',xr,e,R.byteLength);const F=`${e}
`;yield new je(Uint8Array.from([19]),Ae(`${xr}
`),ms(F.length),Ae(F),R).subarray(),t.log.trace('optimistic: wrote ["%s", "%s", data(%d)] in sink',xr,e,R.byteLength),c=!0,l=!1,u.resolve(),x().catch(K=>{t.log.error("could not finish optimistic protocol negotiation of %s",e,K)})}L=!0}L||await x()}())};async function x(){if(o){t.log.trace("optimistic: already negotiating %s stream",e),await a.promise;return}o=!0;try{c||(t.log.trace("optimistic: doing send protocol for %s stream",e),await v()),f||(t.log.trace("optimistic: doing read protocol for %s stream",e),await C())}finally{o=!1,s=!0,a.resolve()}}async function v(){if(l){await u.promise;return}l=!0;try{t.log.trace('optimistic: write ["%s", "%s", data] in source',xr,e),await w.writeV([Ae(`${xr}
`),Ae(`${e}
`)]),t.log.trace('optimistic: wrote ["%s", "%s", data] in source',xr,e)}finally{c=!0,l=!1,u.resolve()}}async function C(){if(g){await m.promise;return}g=!0;try{t.log.trace("optimistic: reading multistream select header");let N=await xo(w,t);if(t.log.trace('optimistic: read multistream select header "%s"',N),N===xr&&(N=await xo(w,t)),t.log.trace('optimistic: read protocol "%s", expecting "%s"',N,e),N!==e)throw new dh("protocol selection failed")}finally{f=!0,g=!1,m.resolve()}}if(r.source=async function*(){await x(),t.log.trace('optimistic: reading data from "%s" stream',e),yield*w.unwrap().source}(),r.closeRead!=null){const N=r.closeRead.bind(r);r.closeRead=async O=>{s||await x().catch(L=>{t.log.error("could not negotiate protocol before close read",L)}),await N(O)}}if(r.closeWrite!=null){const N=r.closeWrite.bind(r);r.closeWrite=async O=>{s||await x().catch(L=>{t.log.error("could not negotiate protocol before close write",L)}),await N(O)}}if(r.close!=null){const N=r.close.bind(r);r.close=async O=>{const L=[];l&&L.push(u.promise),g&&L.push(m.promise),L.length>0?await Ht(Promise.all(L),O==null?void 0:O.signal):(s=!0,o=!1,a.resolve()),await N(O)}}return{stream:r,protocol:e}}async function qd(r,e,t){e=Array.isArray(e)?e:[e],t.log.trace("handle: available protocols %s",e);const n=Mo(r,{...t,maxDataLength:Ep,maxLengthLength:2});for(;;){t.log.trace("handle: reading incoming string");const i=await xo(n,t);if(t.log.trace('handle: read "%s"',i),i===xr){t.log.trace('handle: respond with "%s" for "%s"',xr,i),await Va(n,Ae(`${xr}
`),t),t.log.trace('handle: responded with "%s" for "%s"',xr,i);continue}if(e.includes(i))return t.log.trace('handle: respond with "%s" for "%s"',i,i),await Va(n,Ae(`${i}
`),t),t.log.trace('handle: responded with "%s" for "%s"',i,i),{stream:n.unwrap(),protocol:i};if(i==="ls"){const s=new je(...e.map(o=>bc.single(Ae(`${o}
`))),Ae(`
`));t.log.trace('handle: respond with "%s" for %s',e,i),await Va(n,s,t),t.log.trace('handle: responded with "%s" for %s',e,i);continue}t.log.trace('handle: respond with "na" for "%s"',i),await Va(n,Ae(`na
`),t),t.log('handle: responded with "na" for "%s"',i)}}const h$=500;var I7,C7;C7=Symbol.toStringTag,I7=vx;class f${constructor(e){h(this,"id");h(this,"remoteAddr");h(this,"remotePeer");h(this,"direction");h(this,"timeline");h(this,"multiplexer");h(this,"encryption");h(this,"status");h(this,"limits");h(this,"log");h(this,"tags");h(this,"_newStream");h(this,"_close");h(this,"_abort");h(this,"_getStreams");h(this,C7,"Connection");h(this,I7,!0);const{remoteAddr:t,remotePeer:n,newStream:i,close:s,abort:o,getStreams:a}=e;this.id=`${parseInt(String(Math.random()*1e9)).toString(36)}${Date.now()}`,this.remoteAddr=t,this.remotePeer=n,this.direction=e.direction,this.status="open",this.timeline=e.timeline,this.multiplexer=e.multiplexer,this.encryption=e.encryption,this.limits=e.limits,this.log=e.logger.forComponent(`libp2p:connection:${this.direction}:${this.id}`),this.remoteAddr.getPeerId()==null&&(this.remoteAddr=this.remoteAddr.encapsulate(`/p2p/${this.remotePeer}`)),this._newStream=i,this._close=s,this._abort=o,this._getStreams=a,this.tags=[]}get streams(){return this._getStreams()}async newStream(e,t){if(this.status==="closing")throw new D9("the connection is being closed");if(this.status==="closed")throw new M3("the connection is closed");if(Array.isArray(e)||(e=[e]),this.limits!=null&&(t==null?void 0:t.runOnLimitedConnection)!==!0)throw new $3("Cannot open protocol stream on limited connection");const n=await this._newStream(e,t);return n.direction="outbound",n}async close(e={}){if(!(this.status==="closed"||this.status==="closing")){if(this.log("closing connection to %a",this.remoteAddr),this.status="closing",e.signal==null){const t=AbortSignal.timeout(h$);e={...e,signal:t}}try{this.log.trace("closing underlying transport"),await this._close(e),this.log.trace("updating timeline with close time"),this.status="closed",this.timeline.close=Date.now()}catch(t){this.log.error("error encountered during graceful close of connection to %a",this.remoteAddr,t),this.abort(t)}}}abort(e){this.status!=="closed"&&(this.log.error("aborting connection to %a due to error",this.remoteAddr,e),this.status="closing",this._abort(e),this.status="closed",this.timeline.close=Date.now())}}function d$(r){return new f$(r)}function p$(r,e){try{const{options:t}=e.getHandler(r);return t.maxInboundStreams}catch(t){if(t.name!=="UnhandledProtocolError")throw t}return Mv}function g$(r,e,t={}){try{const{options:n}=e.getHandler(r);if(n.maxOutboundStreams!=null)return n.maxOutboundStreams}catch(n){if(n.name!=="UnhandledProtocolError")throw n}return t.maxOutboundStreams??Uv}function Og(r,e,t){let n=0;return t.streams.forEach(i=>{i.direction===e&&i.protocol===r&&n++}),n}var k7;k7=Symbol.toStringTag;class m${constructor(e,t){h(this,"components");h(this,"connectionEncrypters");h(this,"streamMuxers");h(this,"inboundUpgradeTimeout");h(this,"inboundStreamProtocolNegotiationTimeout");h(this,"outboundStreamProtocolNegotiationTimeout");h(this,"events");h(this,"metrics");h(this,k7,"@libp2p/upgrader");var n,i,s,o;this.components=e,this.connectionEncrypters=mi({name:"libp2p_upgrader_connection_encrypters",metrics:this.components.metrics}),t.connectionEncrypters.forEach(a=>{this.connectionEncrypters.set(a.protocol,a)}),this.streamMuxers=mi({name:"libp2p_upgrader_stream_multiplexers",metrics:this.components.metrics}),t.streamMuxers.forEach(a=>{this.streamMuxers.set(a.protocol,a)}),this.inboundUpgradeTimeout=t.inboundUpgradeTimeout??SF,this.inboundStreamProtocolNegotiationTimeout=t.inboundStreamProtocolNegotiationTimeout??_g,this.outboundStreamProtocolNegotiationTimeout=t.outboundStreamProtocolNegotiationTimeout??_g,this.events=e.events,this.metrics={dials:(n=e.metrics)==null?void 0:n.registerCounterGroup("libp2p_connection_manager_dials_total"),errors:(i=e.metrics)==null?void 0:i.registerCounterGroup("libp2p_connection_manager_dial_errors_total"),inboundErrors:(s=e.metrics)==null?void 0:s.registerCounterGroup("libp2p_connection_manager_dials_inbound_errors_total"),outboundErrors:(o=e.metrics)==null?void 0:o.registerCounterGroup("libp2p_connection_manager_dials_outbound_errors_total")}}async shouldBlockConnection(e,...t){const n=this.components.connectionGater[e];if(n==null)return;if(await n.apply(this.components.connectionGater,t)===!0)throw new XU(`The multiaddr connection is blocked by gater.${e}`)}createInboundAbortSignal(e){return Fr([AbortSignal.timeout(this.inboundUpgradeTimeout),e])}async upgradeInbound(e,t){var s,o,a;let n=!1;const i=this.createInboundAbortSignal(t.signal);try{if((s=this.metrics.dials)==null||s.increment({inbound:!0}),n=await Ht(this.components.connectionManager.acceptIncomingConnection(e),i),!n)throw new JU("Connection denied");await Ht(this.shouldBlockConnection("denyInboundConnection",e),i),await this._performUpgrade(e,"inbound",{...t,signal:i})}catch(c){throw(o=this.metrics.errors)==null||o.increment({inbound:!0}),(a=this.metrics.inboundErrors)==null||a.increment({[c.name??"Error"]:!0}),c}finally{i.clear(),n&&this.components.connectionManager.afterUpgradeInbound()}}async upgradeOutbound(e,t){var n,i,s;try{(n=this.metrics.dials)==null||n.increment({outbound:!0});const o=e.remoteAddr.getPeerId();let a;o!=null&&(a=li(o),await Ht(this.shouldBlockConnection("denyOutboundConnection",a,e),t.signal));let c="outbound";return t.initiator===!1&&(c="inbound"),await this._performUpgrade(e,c,t)}catch(o){throw(i=this.metrics.errors)==null||i.increment({outbound:!0}),(s=this.metrics.outboundErrors)==null||s.increment({[o.name??"Error"]:!0}),o}}async _performUpgrade(e,t,n){var u,f,g;let i,s,o,a,c;(u=this.components.metrics)==null||u.trackMultiaddrConnection(e),e.log.trace("starting the %s connection upgrade",t);let l=e;if((n==null?void 0:n.skipProtection)!==!0){const m=this.components.connectionProtector;m!=null&&(e.log("protecting the %s connection",t),l=await m.protect(e,n))}try{if(i=l,(n==null?void 0:n.skipEncryption)!==!0){(f=n==null?void 0:n.onProgress)==null||f.call(n,new Ar(`upgrader:encrypt-${t}-connection`)),{conn:i,remotePeer:s,protocol:c,streamMuxer:a}=await(t==="inbound"?this._encryptInbound(l,n):this._encryptOutbound(l,n));const m={...l,...i};await this.shouldBlockConnection(t==="inbound"?"denyInboundEncryptedConnection":"denyOutboundEncryptedConnection",s,m)}else{const m=e.remoteAddr.getPeerId();if(m==null)throw new F3(`${t} connection that skipped encryption must have a peer id`);const w=li(m);c="native",s=w}if(s.equals(this.components.peerId)){const m=new U3("Can not dial self");throw e.abort(m),m}if(o=i,(n==null?void 0:n.muxerFactory)!=null)a=n.muxerFactory;else if(a==null&&this.streamMuxers.size>0){(g=n==null?void 0:n.onProgress)==null||g.call(n,new Ar(`upgrader:multiplex-${t}-connection`));const m=await(t==="inbound"?this._multiplexInbound({...l,...i},this.streamMuxers,n):this._multiplexOutbound({...l,...i},this.streamMuxers,n));a=m.muxerFactory,o=m.stream}}catch(m){throw e.log.error("failed to upgrade inbound connection %s %a - %e",t==="inbound"?"from":"to",e.remoteAddr,m),m}return await this.shouldBlockConnection(t==="inbound"?"denyInboundUpgradedConnection":"denyOutboundUpgradedConnection",s,e),e.log("successfully upgraded %s connection",t),this._createConnection({cryptoProtocol:c,direction:t,maConn:e,upgradedConn:o,muxerFactory:a,remotePeer:s,limits:n==null?void 0:n.limits})}_createConnection(e){const{cryptoProtocol:t,direction:n,maConn:i,upgradedConn:s,remotePeer:o,muxerFactory:a,limits:c}=e;let l,u,f;a!=null&&(l=a.createStreamMuxer({direction:n,onIncomingStream:w=>{if(f==null)return;const x=AbortSignal.timeout(this.inboundStreamProtocolNegotiationTimeout);Promise.resolve().then(async()=>{var R;const v=this.components.registrar.getProtocols(),{stream:C,protocol:N}=await qd(w,v,{signal:x,log:w.log,yieldBytes:!1});if(f==null)return;f.log("incoming stream opened on %s",N);const O=p$(N,this.components.registrar);if(Og(N,"inbound",f)===O){const F=new V9(`Too many inbound protocol streams for protocol "${N}" - limit ${O}`);throw w.abort(F),F}w.source=C.source,w.sink=C.sink,w.protocol=N,C.closeWrite!=null&&(w.closeWrite=C.closeWrite),C.closeRead!=null&&(w.closeRead=C.closeRead),C.close!=null&&(w.close=C.close),await this.components.peerStore.merge(o,{protocols:[N]},{signal:x}),(R=this.components.metrics)==null||R.trackProtocolStream(w,f),this._onStream({connection:f,stream:w,protocol:N})}).catch(async v=>{f.log.error("error handling incoming stream id %s - %e",w.id,v),w.timeline.close==null&&await w.close({signal:x}).catch(C=>w.abort(C))})}}),u=async(w,x={})=>{var C;if(l==null)throw new ou("Connection is not multiplexed");f.log.trace("starting new stream for protocols %s",w);const v=await l.newStream();f.log.trace("started new stream %s for protocols %s",v.id,w);try{if(x.signal==null){v.log("no abort signal was passed while trying to negotiate protocols %s falling back to default timeout",w);const F=AbortSignal.timeout(this.outboundStreamProtocolNegotiationTimeout);x={...x,signal:F}}v.log.trace("selecting protocol from protocols %s",w);const{stream:N,protocol:O}=await Vd(v,w,{...x,log:v.log,yieldBytes:!0});v.log.trace("selected protocol %s",O);const L=g$(O,this.components.registrar,x),R=Og(O,"outbound",f);if(R>=L){const F=new V3(`Too many outbound protocol streams for protocol "${O}" - ${R}/${L}`);throw v.abort(F),F}return await this.components.peerStore.merge(o,{protocols:[O]}),v.source=N.source,v.sink=N.sink,v.protocol=O,N.closeWrite!=null&&(v.closeWrite=N.closeWrite),N.closeRead!=null&&(v.closeRead=N.closeRead),N.close!=null&&(v.close=N.close),(C=this.components.metrics)==null||C.trackProtocolStream(v,f),v}catch(N){throw f.log.error("could not create new outbound stream on connection %s %a for protocols %s - %e",n==="inbound"?"from":"to",e.maConn.remoteAddr,w,N),v.timeline.close==null&&v.abort(N),N}},Promise.all([l.sink(s.source),s.sink(l.source)]).catch(w=>{f.log.error("error piping data through muxer - %e",w)}));const g=i.timeline;i.timeline=new Proxy(g,{set:(...w)=>(w[1]==="close"&&w[2]!=null&&g.close==null&&(async()=>{try{f.status==="open"&&await f.close()}catch(x){f.log.error("error closing connection after timeline close %e",x)}finally{this.events.safeDispatchEvent("connection:close",{detail:f})}})().catch(x=>{f.log.error("error thrown while dispatching connection:close event %e",x)}),Reflect.set(...w))}),i.timeline.upgraded=Date.now();const m=()=>{throw new ou("Connection is not multiplexed")};return f=d$({remoteAddr:i.remoteAddr,remotePeer:o,status:"open",direction:n,timeline:i.timeline,multiplexer:l==null?void 0:l.protocol,encryption:t,limits:c,logger:this.components.logger,newStream:u??m,getStreams:()=>(l==null?void 0:l.streams)??[],close:async w=>{await(l==null?void 0:l.close(w)),await i.close(w)},abort:w=>{i.abort(w),l==null||l.abort(w)}}),this.events.safeDispatchEvent("connection:open",{detail:f}),f.__maConnTimeline=g,f}_onStream(e){const{connection:t,stream:n,protocol:i}=e,{handler:s,options:o}=this.components.registrar.getHandler(i);if(t.limits!=null&&o.runOnLimitedConnection!==!0)throw new $3("Cannot open protocol stream on limited connection");s({connection:t,stream:n})}async _encryptInbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{const{stream:i,protocol:s}=await qd(e,n,{...t,log:e.log}),o=this.connectionEncrypters.get(s);if(o==null)throw new au(`no crypto module found for ${s}`);return e.log("encrypting inbound connection to %a using %s",e.remoteAddr,s),{...await o.secureInbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting inbound connection from %a failed",e.remoteAddr,i),new au(i.message)}}async _encryptOutbound(e,t){const n=Array.from(this.connectionEncrypters.keys());try{e.log.trace("selecting encrypter from %s",n);const{stream:i,protocol:s}=await Vd(e,n,{...t,log:e.log,yieldBytes:!0}),o=this.connectionEncrypters.get(s);if(o==null)throw new au(`no crypto module found for ${s}`);return e.log("encrypting outbound connection to %a using %s",e.remoteAddr,s),{...await o.secureOutbound(i,t),protocol:s}}catch(i){throw e.log.error("encrypting outbound connection to %a failed",e.remoteAddr,i),new au(i.message)}}async _multiplexOutbound(e,t,n){const i=Array.from(t.keys());e.log("outbound selecting muxer %s",i);try{e.log.trace("selecting stream muxer from %s",i);const{stream:s,protocol:o}=await Vd(e,i,{...n,log:e.log,yieldBytes:!0});e.log("selected %s as muxer protocol",o);const a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing outbound connection",s),new ou(String(s))}}async _multiplexInbound(e,t,n){const i=Array.from(t.keys());e.log("inbound handling muxers %s",i);try{const{stream:s,protocol:o}=await qd(e,i,{...n,log:e.log}),a=t.get(o);return{stream:s,muxerFactory:a}}catch(s){throw e.log.error("error multiplexing inbound connection",s),new ou(String(s))}}getConnectionEncrypters(){return this.connectionEncrypters}getStreamMuxers(){return this.streamMuxers}}const Fv="2.8.11",$v="js-libp2p";function y$(r,e){return`${r??$v}/${e??Fv} browser/${globalThis.navigator.userAgent}`}var Qc,f3;class w$ extends or{constructor(t){var u,f,g,m,w,x,v,C,N,O,L,R;super();ut(this,Qc);h(this,"peerId");h(this,"peerStore");h(this,"contentRouting");h(this,"peerRouting");h(this,"metrics");h(this,"services");h(this,"logger");h(this,"status");h(this,"components");h(this,"log");this.status="stopped";const n=new or,i=n.dispatchEvent.bind(n);n.dispatchEvent=F=>{const K=i(F),H=this.dispatchEvent(new CustomEvent(F.type,{detail:F.detail}));return K||H},this.peerId=t.peerId,this.logger=t.logger??hv(),this.log=this.logger.forComponent("libp2p"),this.services={};const s=((u=t.nodeInfo)==null?void 0:u.name)??$v,o=((f=t.nodeInfo)==null?void 0:f.version)??Fv,a=this.components=iF({peerId:t.peerId,privateKey:t.privateKey,nodeInfo:{name:s,version:o,userAgent:((g=t.nodeInfo)==null?void 0:g.userAgent)??y$(s,o)},logger:this.logger,events:n,datastore:t.datastore??new IU,connectionGater:hF(t.connectionGater),dns:t.dns});t.metrics!=null&&(this.metrics=this.configureComponent("metrics",t.metrics(this.components))),this.peerStore=this.configureComponent("peerStore",EU(a,{addressFilter:this.components.connectionGater.filterMultiaddrForPeer,...t.peerStore})),a.events.addEventListener("peer:update",F=>{if(F.detail.previous==null){const K={id:F.detail.peer.id,multiaddrs:F.detail.peer.addresses.map(H=>H.multiaddr)};a.events.safeDispatchEvent("peer:discovery",{detail:K})}}),t.connectionProtector!=null&&this.configureComponent("connectionProtector",t.connectionProtector(a)),this.components.upgrader=new m$(this.components,{connectionEncrypters:(t.connectionEncrypters??[]).map((F,K)=>this.configureComponent(`connection-encryption-${K}`,F(this.components))),streamMuxers:(t.streamMuxers??[]).map((F,K)=>this.configureComponent(`stream-muxers-${K}`,F(this.components))),inboundUpgradeTimeout:(m=t.connectionManager)==null?void 0:m.inboundUpgradeTimeout,inboundStreamProtocolNegotiationTimeout:((w=t.connectionManager)==null?void 0:w.inboundStreamProtocolNegotiationTimeout)??((x=t.connectionManager)==null?void 0:x.protocolNegotiationTimeout),outboundStreamProtocolNegotiationTimeout:((v=t.connectionManager)==null?void 0:v.outboundStreamProtocolNegotiationTimeout)??((C=t.connectionManager)==null?void 0:C.protocolNegotiationTimeout)}),this.configureComponent("transportManager",new o$(this.components,t.transportManager)),this.configureComponent("connectionManager",new QF(this.components,t.connectionManager)),((N=t.connectionMonitor)==null?void 0:N.enabled)!==!1&&this.configureComponent("connectionMonitor",new t$(this.components,t.connectionMonitor)),this.configureComponent("registrar",new s$(this.components)),this.configureComponent("addressManager",new KU(this.components,t.addresses));const c=(t.peerRouters??[]).map((F,K)=>this.configureComponent(`peer-router-${K}`,F(this.components)));this.peerRouting=this.components.peerRouting=this.configureComponent("peerRouting",new n$(this.components,{routers:c}));const l=(t.contentRouters??[]).map((F,K)=>this.configureComponent(`content-router-${K}`,F(this.components)));if(this.contentRouting=this.components.contentRouting=this.configureComponent("contentRouting",new r$(this.components,{routers:l})),this.configureComponent("randomWalk",new i$(this.components)),(t.peerDiscovery??[]).forEach((F,K)=>{this.configureComponent(`peer-discovery-${K}`,F(this.components)).addEventListener("peer",P=>{Ke(this,Qc,f3).call(this,P)})}),(O=t.transports)==null||O.forEach((F,K)=>{this.components.transportManager.add(this.configureComponent(`transport-${K}`,F(this.components)))}),t.services!=null)for(const F of Object.keys(t.services)){const K=t.services[F],H=K(this.components);if(H==null){this.log.error("service factory %s returned null or undefined instance",F);continue}this.services[F]=H,this.configureComponent(F,H),H[u0]!=null&&(this.log("registering service %s for content routing",F),l.push(H[u0])),H[h0]!=null&&(this.log("registering service %s for peer routing",F),c.push(H[h0])),H[Ru]!=null&&(this.log("registering service %s for peer discovery",F),(R=(L=H[Ru]).addEventListener)==null||R.call(L,"peer",P=>{Ke(this,Qc,f3).call(this,P)}))}sF(a)}configureComponent(t,n){return n==null&&this.log.error("component %s was null or undefined",t),this.components[t]=n,n}async start(){var t,n,i,s;if(this.status==="stopped"){this.status="starting",this.log("libp2p is starting");try{await((n=(t=this.components).beforeStart)==null?void 0:n.call(t)),await this.components.start(),await((s=(i=this.components).afterStart)==null?void 0:s.call(i)),this.status="started",this.safeDispatchEvent("start",{detail:this}),this.log("libp2p has started")}catch(o){throw this.log.error("An error occurred starting libp2p",o),this.status="started",await this.stop(),o}}}async stop(){var t,n,i,s;this.status==="started"&&(this.log("libp2p is stopping"),this.status="stopping",await((n=(t=this.components).beforeStop)==null?void 0:n.call(t)),await this.components.stop(),await((s=(i=this.components).afterStop)==null?void 0:s.call(i)),this.status="stopped",this.safeDispatchEvent("stop",{detail:this}),this.log("libp2p has stopped"))}getConnections(t){return this.components.connectionManager.getConnections(t)}getDialQueue(){return this.components.connectionManager.getDialQueue()}getPeers(){const t=new Dn;for(const n of this.components.connectionManager.getConnections())t.add(n.remotePeer);return Array.from(t)}async dial(t,n={}){return this.components.connectionManager.openConnection(t,{priority:75,...n})}async dialProtocol(t,n,i={}){if(n==null)throw new ke("no protocols were provided to open a stream");if(n=Array.isArray(n)?n:[n],n.length===0)throw new ke("no protocols were provided to open a stream");return(await this.dial(t,i)).newStream(n,i)}getMultiaddrs(){return this.components.addressManager.getAddresses()}getProtocols(){return this.components.registrar.getProtocols()}async hangUp(t,n={}){Ch(t)&&(t=li(t.getPeerId()??"")),await this.components.connectionManager.closeConnections(t,n)}async getPublicKey(t,n={}){if(this.log("getPublicKey %p",t),t.publicKey!=null)return t.publicKey;try{const a=await this.peerStore.get(t,n);if(a.id.publicKey!=null)return a.id.publicKey}catch(a){if(a.name!=="NotFoundError")throw a}const i=Jr([Ae("/pk/"),t.toMultihash().bytes]),s=await this.contentRouting.get(i,n),o=tn(s);return await this.peerStore.patch(t,{publicKey:o},n),o}async handle(t,n,i){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async s=>{await this.components.registrar.handle(s,n,i)}))}async unhandle(t,n){Array.isArray(t)||(t=[t]),await Promise.all(t.map(async i=>{await this.components.registrar.unhandle(i,n)}))}async register(t,n,i){return this.components.registrar.register(t,n,i)}unregister(t){this.components.registrar.unregister(t)}async isDialable(t,n={}){return this.components.connectionManager.isDialable(t,n)}}Qc=new WeakSet,f3=function(t){const{detail:n}=t;if(n.id.toString()===this.peerId.toString()){this.log.error("peer discovery mechanism discovered self");return}this.components.peerStore.merge(n.id,{multiaddrs:n.multiaddrs}).catch(i=>{this.log.error(i)})};async function b$(r={}){r.privateKey??(r.privateKey=await Lm("Ed25519"));const e=new w$({...await BM(r),peerId:Km(r.privateKey)});return r.start!==!1&&await e.start(),e}window.Buffer=rv.Buffer;async function v$(r){return await b$({...r,streamMuxers:[sT()],connectionEncrypters:[ay()],services:{identify:KB(),ping:jO(),dht:MO({clientMode:!1,protocol:"/ipfs/lan/kad/1.0.0",peerInfoMapper:e=>(console.log(e),e)}),pubsub:aB()}})}async function S$(){const r=await v$({transports:[iM(),FL()],peerDiscovery:[kP({list:["/dns4/libp2p-bootstrap.robonomics.network/tcp/443/wss/p2p/12D3KooWRdvHvy3Co6BiVkceuFhJttPhoy5aG8KcvT2Zeu2f4zm3"]})],connectionGater:{denyDialMultiaddr:()=>!1}});await r.start(),console.log("Node started with ID:",r.peerId.toString()),console.log("Node listening on:",r.getMultiaddrs().map(e=>e.toString())),r.addEventListener("peer:connect",()=>{setTimeout(()=>{console.log("PEERS ON NODE:",r.getPeers())},3e3)}),r.services.pubsub.subscribe("topic-pubsub"),r.services.pubsub.addEventListener("message",e=>{console.log(e.type);const t=e.detail.from.toString();console.log(t),console.log(rv.Buffer.from(e.detail.data).toString("utf8")),console.log("=======================")})}const E$={__name:"App",setup(r){return S$().catch(console.error),(e,t)=>(_9(),I9(dn,null,[t[0]||(t[0]=qt("div",null,[qt("a",{href:"https://vite.dev",target:"_blank"},[qt("img",{src:gx,class:"logo",alt:"Vite logo"})]),qt("a",{href:"https://vuejs.org/",target:"_blank"},[qt("img",{src:mx,class:"logo vue",alt:"Vue logo"})])],-1)),Ui(bx,{msg:"Vite + Vue"})],64))}},x$=N9(E$,[["__scopeId","data-v-d6e6fe03"]]);fx(x$).mount("#app");
